'----------------------------------------------------------------
' Copyright (C) 2006-2016 Josco Software Corporation
' All rights reserved.
'
' This source code is intended only as a supplement to Microsoft
' Development Tools and/or on-line documentation. See these other
' materials for detailed information regarding Microsoft code samples.
'
' THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY 
' OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT 
' LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR 
' FITNESS FOR A PARTICULAR PURPOSE.
'----------------------------------------------------------------
Option Strict On
Option Explicit On 

Imports Microsoft.VisualBasic

Imports System
Imports System.Data
Imports System.Data.SqlTypes
Imports System.Data.SqlClient

Imports Josco.JsKernal.Common
Imports Josco.JsKernal.Common.Data
Imports Josco.JsKernal.SystemFramework

Namespace Josco.JSOA.DataAccess

    '----------------------------------------------------------------
    ' 命名空间：Josco.JSOA.DataAccess
    ' 类名    ：dacEstateRenshiXingye
    '
    ' 功能描述：
    '     提供对兴业公司特殊的人事管理数据的相关数据层操作
    '
    ' 更改记录：
    '     zengxianglin 2009-05-14 更改
    '     zengxianglin 2009-05-16 更改
    '     zengxianglin 2009-05-18 更改
    '     zengxianglin 2009-12-29 更改
    '     zengxianglin 2009-12-31 更改
    '     zengxianglin 2010-01-13 更改
    '     zengxianglin 2010-05-04 更改
    '     zengxianglin 2010-05-06 更改
    '     zengxianglin 2011-01-10 更改
    '----------------------------------------------------------------

    Public Class dacEstateRenshiXingye
        Implements IDisposable

        Private m_objSqlDataAdapter As System.Data.SqlClient.SqlDataAdapter








        '----------------------------------------------------------------
        ' 构造函数
        '----------------------------------------------------------------
        Public Sub New()
            MyBase.New()
            m_objSqlDataAdapter = New System.Data.SqlClient.SqlDataAdapter
        End Sub

        '----------------------------------------------------------------
        ' 虚拟析构函数
        '----------------------------------------------------------------
        Public Sub Dispose() Implements IDisposable.Dispose
            Dispose(True)
            GC.SuppressFinalize(True)
        End Sub

        '----------------------------------------------------------------
        ' 析构函数重载
        '----------------------------------------------------------------
        Protected Overridable Sub Dispose(ByVal disposing As Boolean)
            If (Not disposing) Then
                Exit Sub
            End If
            If Not m_objSqlDataAdapter Is Nothing Then
                m_objSqlDataAdapter.Dispose()
                m_objSqlDataAdapter = Nothing
            End If
        End Sub

        '----------------------------------------------------------------
        ' 安全释放本身资源
        '----------------------------------------------------------------
        Public Shared Sub SafeRelease(ByRef obj As Josco.JSOA.DataAccess.dacEstateRenshiXingye)
            Try
                If Not (obj Is Nothing) Then
                    obj.Dispose()
                End If
            Catch ex As Exception
            End Try
            obj = Nothing
        End Sub










        '----------------------------------------------------------------
        ' 将数据从DataSet导出到Excel
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataSet             ：要导出的数据集
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strMacroName           ：宏名列表
        '     strMacroValue          ：宏值列表
        '     strDateFormat          ：日期格式字符串
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataSet As System.Data.DataSet, _
            ByVal strExcelFile As String, _
            Optional ByVal strMacroName As String = "", _
            Optional ByVal strMacroValue As String = "", _
            Optional ByVal strDateFormat As String = "") As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataSet, strExcelFile, strMacroName, strMacroValue, strDateFormat)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将数据从DataSet导出到Excel
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataSet             ：要导出的数据集
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strColorFieldName      ：用来确定行颜色的字段名
        '     objColors              ：字段值对应的颜色集合
        '     strMacroName           ：宏名列表
        '     strMacroValue          ：宏值列表
        '     strDateFormat          ：日期格式字符串
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataSet As System.Data.DataSet, _
            ByVal strExcelFile As String, _
            ByVal strColorFieldName As String, _
            ByVal objColors As System.Collections.Specialized.ListDictionary, _
            Optional ByVal strMacroName As String = "", _
            Optional ByVal strMacroValue As String = "", _
            Optional ByVal strDateFormat As String = "") As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataSet, strExcelFile, strColorFieldName, objColors, strMacroName, strMacroValue, strDateFormat)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将strSrcFile中的strSrcSheet复制到strDesFile中的strDesSheet
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strSrcFile             ：源文件的完整路径
        '     strSrcSheet            ：源文件的sheet名
        '     strDesFile             ：目标文件的完整路径
        '     strDesSheet            ：目标文件的sheet名
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2009-05-18 创建
        '----------------------------------------------------------------
        Public Function doExcelAddCopy( _
            ByRef strErrMsg As String, _
            ByVal strSrcFile As String, _
            ByVal strSrcSheet As String, _
            ByVal strDesFile As String, _
            ByVal strDesSheet As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExcelAddCopy = .doSheetAddCopy(strErrMsg, strSrcFile, strSrcSheet, strDesFile, strDesSheet)
            End With
        End Function

        '----------------------------------------------------------------
        ' 删除strSrcFile中的strSrcSheet
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strSrcFile             ：源文件的完整路径
        '     strSrcSheet            ：源文件的sheet名
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2009-05-18 创建
        '----------------------------------------------------------------
        Public Function doExcelSheetDelete( _
            ByRef strErrMsg As String, _
            ByVal strSrcFile As String, _
            ByVal strSrcSheet As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExcelSheetDelete = .doSheetDelete(strErrMsg, strSrcFile, strSrcSheet)
            End With
        End Function










        '----------------------------------------------------------------
        ' 检验代码字段的合法性
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strNewCode                ：新代码
        '     strOldCode                ：旧代码
        '     strFieldName              ：代码字段名
        '     strTableName              ：代码字段所在表名
        '     objenumEditType           ：编辑模式
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doValidCode( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strNewCode As String, _
            ByVal strOldCode As String, _
            ByVal strFieldName As String, _
            ByVal strTableName As String, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intSegLen As Integer = 3
            Dim strSep As String = "."

            doValidCode = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doValidCode]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strNewCode Is Nothing Then strNewCode = ""
                strNewCode = strNewCode.Trim
                If strOldCode Is Nothing Then strOldCode = ""
                strOldCode = strOldCode.Trim
                If strFieldName Is Nothing Then strFieldName = ""
                strFieldName = strFieldName.Trim
                If strTableName Is Nothing Then strTableName = ""
                strTableName = strTableName.Trim
                If strTableName = "" Or strFieldName = "" Then
                    strErrMsg = "错误：[doValidCode]中没有指定[检测表名]！"
                    GoTo errProc
                End If
                If strFieldName = "" Then
                    strErrMsg = "错误：[doValidCode]中没有指定[检测字段名]！"
                    GoTo errProc
                End If

                '检查值nnn.nnn.nnn.nnn
                Dim strArray() As String
                strArray = strNewCode.Split(strSep.ToCharArray())
                Dim intCount As Integer = 0
                Dim intLen As Integer = 0
                Dim i As Integer = 0
                intCount = strArray.Length
                For i = 1 To intCount Step 1
                    intLen = objPulicParameters.getStringLength(strArray(i - 1))
                    If intLen <> intSegLen Then
                        strErrMsg = "错误：[doValidCode][" + strFieldName + "]必须是[" + intSegLen.ToString + "]位数字！"
                        GoTo errProc
                    End If
                    If objPulicParameters.isIntegerString(strArray(i - 1)) = False Then
                        strErrMsg = "错误：[doValidCode][" + strFieldName + "]必须是[" + intSegLen.ToString + "]位数字！"
                        GoTo errProc
                    End If
                Next

                '计算上级代码
                Dim strPrevCode As String = ""
                If intCount <= 1 Then
                    strPrevCode = ""
                Else
                    For i = 0 To intCount - 2 Step 1
                        If strPrevCode = "" Then
                            strPrevCode = strArray(i)
                        Else
                            strPrevCode = strPrevCode + strSep + strArray(i)
                        End If
                    Next
                End If

                '是否发生更改
                Dim strSQL As String = ""
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                         Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        If strPrevCode <> "" Then
                            strSQL = ""
                            strSQL = strSQL + " select " + strFieldName + " from " + strTableName + vbCr
                            strSQL = strSQL + " where " + strFieldName + " = '" + strPrevCode + "'" + vbCr
                        End If
                    Case Else
                        If strOldCode = strNewCode Then
                            '未改变！
                            Exit Try
                        End If
                        If strPrevCode <> "" Then
                            strSQL = ""
                            strSQL = strSQL + " select " + strFieldName + " from " + strTableName + vbCr
                            strSQL = strSQL + " where " + strFieldName + " = '" + strPrevCode + "'" + vbCr
                            strSQL = strSQL + " and " + strFieldName + " <> '" + strOldCode + "'" + vbCr
                        End If
                End Select
                If strSQL <> "" Then
                    If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    With objDataSet
                        If .Tables.Count < 1 Then
                            strErrMsg = "错误：[doValidCode]无法获取数据！"
                            GoTo errProc
                        End If
                        If .Tables(0).Rows.Count < 1 Then
                            strErrMsg = "错误：[doValidCode]中上级代码[" + strPrevCode + "]不存在！！"
                            GoTo errProc
                        End If
                    End With
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

normExit:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doValidCode = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 获取“地产_B_人事_职级定义”的SQL语句(以“职级代码”升序排序)
        ' 返回
        '                          ：SQL
        '----------------------------------------------------------------
        Public Function getTableSQL_ZhijiDingyi() As String
            getTableSQL_ZhijiDingyi = "select * from 地产_B_人事_职级定义 order by 职级代码"
        End Function

        '----------------------------------------------------------------
        ' 根据“职级代码”获取“职级名称”
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strZjdm                   ：职级代码
        '     strZjmc                   ：职级名称(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getZjmc( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strZjdm As String, _
            ByRef strZjmc As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getZjmc = False
            strErrMsg = ""
            strZjmc = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strZjdm Is Nothing Then strZjdm = ""

                '计算
                strSQL = "select dbo.uf_estate_rs_getZjmc('" + strZjdm + "')"
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    strZjmc = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), "")
                End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getZjmc = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_人事_职级定义”完全数据的数据集(以“职级代码”升序排序)
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索字符串
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ZhijiDingyi( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ZhijiDingyi = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()

                '检查
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_ZHIJIDINGYI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* " + vbCr
                        strSQL = strSQL + " from 地产_B_人事_职级定义 a " + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_ZHIJIDINGYI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_ZhijiDingyi = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_人事_职级定义”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function doVerifyData_ZhijiDingyi( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ZhijiDingyi = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_人事_职级定义"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_人事_职级定义", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_JBSZ
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：输入的[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                        Case Else
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                    End Select
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '检查“职级代码”约束
                Dim strOldZJDM As String = ""
                Dim strNewZJDM As String = ""
                strNewZJDM = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_ZJDM)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                        strSQL = "select * from 地产_B_人事_职级定义 where 职级代码 = @zjdm"
                        objListDictionary.Add("@zjdm", strNewZJDM)
                    Case Else
                        strOldZJDM = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_ZJDM), "")
                        strSQL = "select * from 地产_B_人事_职级定义 where 职级代码 = @zjdm and 职级代码 <> @oldzjdm"
                        objListDictionary.Add("@zjdm", strNewZJDM)
                        objListDictionary.Add("@oldzjdm", strOldZJDM)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewZJDM + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                ''检查“职级名称”约束
                'Dim strNewZJMC As String = ""
                'strNewZJMC = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_ZJMC)
                'Select Case objenumEditType
                '    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                '        strSQL = "select * from 地产_B_人事_职级定义 where 职级名称 = @zjmc"
                '        objListDictionary.Add("@zjmc", strNewZJMC)
                '    Case Else
                '        strSQL = "select * from 地产_B_人事_职级定义 where 职级名称 = @zjmc and 职级代码 <> @oldzjdm"
                '        objListDictionary.Add("@zjmc", strNewZJMC)
                '        objListDictionary.Add("@oldzjdm", strOldZJDM)
                'End Select
                'If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                '    GoTo errProc
                'End If
                'If objDataSet.Tables(0).Rows.Count > 0 Then
                '    strErrMsg = "错误：[" + strNewZJMC + "]已经存在！"
                '    GoTo errProc
                'End If
                'Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                'objListDictionary.Clear()

                '检查代码字段
                If Me.doValidCode(strErrMsg, strUserId, strPassword, strNewZJDM, strOldZJDM, "职级代码", "地产_B_人事_职级定义", objenumEditType) = False Then
                    GoTo errProc
                End If

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ZhijiDingyi = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_职级定义”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ZhijiDingyi( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_ZhijiDingyi = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '检查数据
                If Me.doVerifyData_ZhijiDingyi(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_JBSZ
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objPulicParameters.getObjectValue(strValue, 0))
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_职级定义 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr

                        Case Else
                            '获取主键
                            strOldKey = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_ZJDM), "")

                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField + " = @A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField + " = @A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_JBSZ
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objPulicParameters.getObjectValue(strValue, 0))
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_职级定义 set " + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " where 职级代码 = @oldkey" + vbCr
                    End Select

                    '执行SQL
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ZhijiDingyi = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_人事_职级定义”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ZhijiDingyi( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDeleteData_ZhijiDingyi = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：未传入旧的数据！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '删除数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String
                    strOldKey = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHIJIDINGYI_ZJDM), "")
                    '删除所有下级
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_人事_职级定义 "
                    strSQL = strSQL + " where 职级代码 like @oldkey + '.%'"
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                    '删除自身
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_人事_职级定义 "
                    strSQL = strSQL + " where 职级代码 = @oldkey"
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDeleteData_ZhijiDingyi = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 计算佣金计提标准-公佣部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_GY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_GY = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGYINJITIBIAOZUN_GY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.职级代码,a.适用方法,a.业绩标记," + vbCr
                        strSQL = strSQL + "     职级名称 = dbo.uf_estate_rs_getZjmc(a.职级代码)," + vbCr
                        strSQL = strSQL + "     直管直接计提 = isnull(b.直接计提,0)," + vbCr
                        strSQL = strSQL + "     直管保留计提 = isnull(b.保留计提,0)," + vbCr
                        strSQL = strSQL + "     协管直接计提 = isnull(c.直接计提,0)," + vbCr
                        strSQL = strSQL + "     协管保留计提 = isnull(c.保留计提, 0)" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 职级代码,适用方法=1,业绩标记=0" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + "     where 适用方法 & 0x1 = 0x1" + vbCr
                        strSQL = strSQL + "     and   业绩标记 & 0x1 = 0x0" + vbCr
                        strSQL = strSQL + "     group by 职级代码" + vbCr
                        strSQL = strSQL + "   ) a"
                        '计算直管公佣计提标准
                        strSQL = strSQL + "   Left Join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 职级代码,业绩标记=业绩标记 & 0x1,直接计提,保留计提" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + "     where 直管标记 = 1" + vbCr
                        strSQL = strSQL + "     and   适用方法 & 0x1 = 0x1" + vbCr
                        strSQL = strSQL + "     and   业绩标记 & 0x1 = 0x0" + vbCr
                        strSQL = strSQL + "   ) b on a.职级代码 = b.职级代码 and a.业绩标记 = b.业绩标记" + vbCr
                        '计算协管公佣计提标准
                        strSQL = strSQL + "   Left Join" + vbCr
                        strSQL = strSQL + "   ("
                        strSQL = strSQL + "     select 职级代码,业绩标记=业绩标记 & 0x1,直接计提,保留计提" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + "     where 直管标记 = 0" + vbCr
                        strSQL = strSQL + "     and   适用方法 & 0x1 = 0x1" + vbCr
                        strSQL = strSQL + "     and   业绩标记 & 0x1 = 0x0" + vbCr
                        strSQL = strSQL + "   ) c on a.职级代码 = c.职级代码 and a.业绩标记 = c.业绩标记" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_GY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_GY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-私佣部分-定义的职级列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_SYZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_SYZJ = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGYINJITIBIAOZUN_SYZJ)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "	  a.*, 职级名称 = dbo.uf_estate_rs_getZjmc(a.职级代码)" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.职级代码, a.适用方法, a.业绩标记, a.直管标记" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select" + vbCr
                        strSQL = strSQL + "       职级代码, 适用方法 = 2, 直管标记, 业绩标记 = 1, 直接计提, 区间最小, 区间最大" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + "     where 适用方法 & 0x2 = 0x2" + vbCr '私佣
                        strSQL = strSQL + "     and   直管标记 = -1" + vbCr        '无效
                        strSQL = strSQL + "     and   业绩标记 & 0x1 = 1" + vbCr   '私人业绩
                        strSQL = strSQL + "     group by 职级代码,直管标记,直接计提,区间最小,区间最大" + vbCr '指标相同
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   group by a.职级代码,a.适用方法,a.业绩标记,a.直管标记" + vbCr '提取职级列表
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_SYZJ))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_SYZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-私佣部分-定义的各职级指标定义相同的指标列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_SYZB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_SYZB = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGYINJITIBIAOZUN_SYZB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "	  a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     适用方法 = 2, 直管标记, 业绩标记 = 1, 计提比例=直接计提, 区间最小, 区间最大" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + "   where 适用方法 & 0x2 = 0x2" + vbCr '私佣
                        strSQL = strSQL + "   and   直管标记 = -1" + vbCr        '无效
                        strSQL = strSQL + "   and   业绩标记 & 0x1 = 1" + vbCr   '私人业绩
                        strSQL = strSQL + "   group by 直管标记,直接计提,区间最小,区间最大" + vbCr '指标相同
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.区间最小" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_SYZB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_SYZB = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存佣金计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY             ：公佣指标数据集
        '     objDataSet_SYZJ           ：私佣指标数据集-职级部分
        '     objDataSet_SYZB           ：私佣指标数据集-指标部分
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_YongjinJitiBiaozhun( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_SYZJ As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_SYZB As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YongjinJitiBiaozhun = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun]未传入[公佣指标数据集]！"
                    GoTo errProc
                End If
                If objDataSet_SYZJ Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun]未传入[私佣指标数据集-职级部分]！"
                    GoTo errProc
                End If
                If objDataSet_SYZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun]未传入[私佣指标数据集-指标部分]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金计提标准"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加公佣指标
                    With objDataSet_GY.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_GY).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            '直管标准
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金计提标准(" + vbCr
                            strSQL = strSQL + "   唯一标识,职级代码,适用方法,直管标记,业绩标记,条件行号,直接计提,保留计提,区间最小,区间最大" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(), @zjdm, @syff, @zgbj, @yjbj, @tjhh, @zjjt, @bljt, @qjzx, @qjzd"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@zjdm", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_ZJDM))
                            objSqlCommand.Parameters.AddWithValue("@syff", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_SYFF))
                            objSqlCommand.Parameters.AddWithValue("@zgbj", Josco.JSOA.Common.Data.estateRenshiXingyeData.YJJT_ZGBJ_ZG)
                            objSqlCommand.Parameters.AddWithValue("@yjbj", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_YJBJ))
                            objSqlCommand.Parameters.AddWithValue("@tjhh", CType(1, Integer))
                            objSqlCommand.Parameters.AddWithValue("@zjjt", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_ZGZJJT))
                            objSqlCommand.Parameters.AddWithValue("@bljt", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_ZGBLJT))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", CType(0.0, Double))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", CType(0.0, Double))
                            objSqlCommand.ExecuteNonQuery()

                            '协管标准
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金计提标准(" + vbCr
                            strSQL = strSQL + "   唯一标识,职级代码,适用方法,直管标记,业绩标记,条件行号,直接计提,保留计提,区间最小,区间最大" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(), @zjdm, @syff, @zgbj, @yjbj, @tjhh, @zjjt, @bljt, @qjzx, @qjzd"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@zjdm", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_ZJDM))
                            objSqlCommand.Parameters.AddWithValue("@syff", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_SYFF))
                            objSqlCommand.Parameters.AddWithValue("@zgbj", Josco.JSOA.Common.Data.estateRenshiXingyeData.YJJT_ZGBJ_XG)
                            objSqlCommand.Parameters.AddWithValue("@yjbj", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_YJBJ))
                            objSqlCommand.Parameters.AddWithValue("@tjhh", CType(2, Integer))
                            objSqlCommand.Parameters.AddWithValue("@zjjt", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_XGZJJT))
                            objSqlCommand.Parameters.AddWithValue("@bljt", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_GY_XGBLJT))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", CType(0.0, Double))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", CType(0.0, Double))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    '增加私佣指标
                    Dim objZJDM As Object = Nothing
                    With objDataSet_SYZJ.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_SYZJ).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            objZJDM = .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_SYZJ_ZJDM)

                            With objDataSet_SYZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGYINJITIBIAOZUN_SYZB).DefaultView
                                intCountA = .Count
                                For j = 0 To intCountA - 1 Step 1
                                    '直管标准
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_佣金计提标准(" + vbCr
                                    strSQL = strSQL + "   唯一标识,职级代码,适用方法,直管标记,业绩标记,条件行号,直接计提,保留计提,区间最小,区间最大" + vbCr
                                    strSQL = strSQL + " ) values(" + vbCr
                                    strSQL = strSQL + "   newid(), @zjdm, @syff, @zgbj, @yjbj, @tjhh, @zjjt, @bljt, @qjzx, @qjzd"
                                    strSQL = strSQL + " )" + vbCr
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zjdm", objZJDM)
                                    objSqlCommand.Parameters.AddWithValue("@syff", Josco.JSOA.Common.Data.estateRenshiXingyeData.YJJT_SYFF_SY)
                                    objSqlCommand.Parameters.AddWithValue("@zgbj", Josco.JSOA.Common.Data.estateRenshiXingyeData.YJJT_ZGBJ_WX)
                                    objSqlCommand.Parameters.AddWithValue("@yjbj", Josco.JSOA.Common.Data.estateRenshiXingyeData.YJJT_YJBJ_GR)
                                    objSqlCommand.Parameters.AddWithValue("@tjhh", CType(j + 3, Integer))
                                    objSqlCommand.Parameters.AddWithValue("@zjjt", .Item(j).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_SYZB_JTBL))
                                    objSqlCommand.Parameters.AddWithValue("@bljt", CType(0.0, Double))
                                    objSqlCommand.Parameters.AddWithValue("@qjzx", .Item(j).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_SYZB_QJZX))
                                    objSqlCommand.Parameters.AddWithValue("@qjzd", .Item(j).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGYINJITIBIAOZUN_SYZB_QJZD))
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        Next
                    End With

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YongjinJitiBiaozhun = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function








        '----------------------------------------------------------------
        ' 计算考核指标定义包含的序列数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_Khbz_XL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Khbz_XL = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YEJIKAOHEBIAOZHUN_XL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getKaoheZhibiaoXulie() a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YEJIKAOHEBIAOZHUN_XL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Khbz_XL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算定义在指定考核标准序列下的单位数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     intZbxl                   ：指标序列(1,2,3三个值)
        '     intDwbz                   ：指定单位标志(1-管理处,3-分行)
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_Khbz_DW( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intZbxl As Integer, _
            ByVal intDwbz As Integer, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Khbz_DW = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YEJIKAOHEBIAOZHUN_DW)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.适用单位,适用单位名称=b.组织名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.适用单位" + vbCr
                        strSQL = strSQL + "     from" + vbCr
                        strSQL = strSQL + "     (" + vbCr
                        strSQL = strSQL + "       select 适用单位" + vbCr
                        strSQL = strSQL + "       from 地产_B_人事_业绩考核标准" + vbCr
                        strSQL = strSQL + "       group by 适用单位" + vbCr
                        strSQL = strSQL + "     ) a" + vbCr
                        strSQL = strSQL + "     where dbo.uf_estate_rs_isInKaoheZhibiaoXulie(a.适用单位," + intZbxl.ToString + ") = 1" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 b on a.适用单位 = b.组织代码" + vbCr
                        strSQL = strSQL + "   where b.组织代码 is not null" + vbCr
                        strSQL = strSQL + "   and   b.是否分行 & 0x3" + " = " + intDwbz.ToString + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.适用单位" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YEJIKAOHEBIAOZHUN_DW))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Khbz_DW = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存业绩考核标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_XL             ：序列数据集
        '     objDataSet_DWFH01         ：指标一定义的分行
        '     objDataSet_DWFH02         ：指标二定义的分行
        '     objDataSet_DWFH03         ：指标三定义的分行
        '     objDataSet_DWGLC01        ：指标一定义的管理处
        '     objDataSet_DWGLC02        ：指标二定义的管理处
        '     objDataSet_DWGLC03        ：指标三定义的管理处
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_KaoheBiaozhun( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_XL As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWFH01 As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWFH02 As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWFH03 As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWGLC01 As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWGLC02 As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_DWGLC03 As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_KaoheBiaozhun = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_XL Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[序列数据集]！"
                    GoTo errProc
                End If
                If objDataSet_DWFH01 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标一定义的分行]！"
                    GoTo errProc
                End If
                If objDataSet_DWFH02 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标二定义的分行]！"
                    GoTo errProc
                End If
                If objDataSet_DWFH03 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标三定义的分行]！"
                    GoTo errProc
                End If
                If objDataSet_DWGLC01 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标一定义的管理处]！"
                    GoTo errProc
                End If
                If objDataSet_DWGLC02 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标二定义的管理处]！"
                    GoTo errProc
                End If
                If objDataSet_DWGLC03 Is Nothing Then
                    strErrMsg = "错误：[doSaveData_KaoheBiaozhun]未传入[指标三定义的管理处]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCountB As Integer = 0
                Dim intCountA As Integer = 0
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim j As Integer = 0
                Dim k As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除数据
                    strSQL = " delete from 地产_B_人事_业绩考核标准"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
                    Dim objZJDM As Object = Nothing
                    Dim objSYDW As Object = Nothing
                    Dim strZBNR As String = ""
                    Dim intSYFF As Integer = 1
                    Dim intZBXL As Integer = 1
                    Dim dblZBSZ As Double = 0
                    Dim strZBGS As String = ""
                    intCountB = 6
                    For k = 0 To intCountB - 1 Step 1
                        Select Case k
                            Case 0
                                objDataSet = objDataSet_DWFH01
                            Case 1
                                objDataSet = objDataSet_DWFH02
                            Case 2
                                objDataSet = objDataSet_DWFH03
                            Case 3
                                objDataSet = objDataSet_DWGLC01
                            Case 4
                                objDataSet = objDataSet_DWGLC02
                            Case 5
                                objDataSet = objDataSet_DWGLC03
                        End Select

                        With objDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YEJIKAOHEBIAOZHUN_DW).DefaultView
                            intCountA = .Count
                            For j = 0 To intCountA - 1 Step 1
                                objSYDW = .Item(j).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YEJIKAOHEBIAOZHUN_DW_SYDW)

                                With objDataSet_XL.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YEJIKAOHEBIAOZHUN_XL).DefaultView
                                    intCount = .Count
                                    For i = 0 To intCount - 1 Step 1
                                        objZJDM = .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YEJIKAOHEBIAOZHUN_XL_ZJDM)

                                        '处理序列1
                                        If k = 0 Or k = 3 Then
                                            strZBNR = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YEJIKAOHEBIAOZHUN_XL_ZBNR01), "")
                                            intZBXL = 1
                                            If strZBNR = "" Then
                                                dblZBSZ = 0
                                                strZBGS = ""
                                                intSYFF = 1
                                            Else
                                                If objPulicParameters.isFloatString(strZBNR) = True Then
                                                    dblZBSZ = objPulicParameters.getObjectValue(strZBNR, 0.0)
                                                    strZBGS = ""
                                                    intSYFF = 1
                                                Else
                                                    dblZBSZ = 0
                                                    strZBGS = strZBNR
                                                    intSYFF = 2
                                                End If
                                            End If
                                            '加入
                                            strSQL = ""
                                            strSQL = strSQL + " insert into 地产_B_人事_业绩考核标准(" + vbCr
                                            strSQL = strSQL + "   唯一标识,职级代码,适用单位,适用方法,指标序列,指标数值,指标公式" + vbCr
                                            strSQL = strSQL + " ) values(" + vbCr
                                            strSQL = strSQL + "   newid(), @zjdm, @sydw, @syff, @zbxl, @zbsz, @zbgs"
                                            strSQL = strSQL + " )" + vbCr
                                            objSqlCommand.CommandText = strSQL
                                            objSqlCommand.Parameters.Clear()
                                            objSqlCommand.Parameters.AddWithValue("@zjdm", objZJDM)
                                            objSqlCommand.Parameters.AddWithValue("@sydw", objSYDW)
                                            objSqlCommand.Parameters.AddWithValue("@syff", intSYFF)
                                            objSqlCommand.Parameters.AddWithValue("@zbxl", intZBXL)
                                            objSqlCommand.Parameters.AddWithValue("@zbsz", dblZBSZ)
                                            objSqlCommand.Parameters.AddWithValue("@zbgs", strZBGS)
                                            objSqlCommand.ExecuteNonQuery()
                                        End If

                                        '处理序列2
                                        If k = 1 Or k = 4 Then
                                            strZBNR = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YEJIKAOHEBIAOZHUN_XL_ZBNR02), "")
                                            intZBXL = 2
                                            If strZBNR = "" Then
                                                dblZBSZ = 0
                                                strZBGS = ""
                                                intSYFF = 1
                                            Else
                                                If objPulicParameters.isFloatString(strZBNR) = True Then
                                                    dblZBSZ = objPulicParameters.getObjectValue(strZBNR, 0.0)
                                                    strZBGS = ""
                                                    intSYFF = 1
                                                Else
                                                    dblZBSZ = 0
                                                    strZBGS = strZBNR
                                                    intSYFF = 2
                                                End If
                                            End If
                                            '加入
                                            strSQL = ""
                                            strSQL = strSQL + " insert into 地产_B_人事_业绩考核标准(" + vbCr
                                            strSQL = strSQL + "   唯一标识,职级代码,适用单位,适用方法,指标序列,指标数值,指标公式" + vbCr
                                            strSQL = strSQL + " ) values(" + vbCr
                                            strSQL = strSQL + "   newid(), @zjdm, @sydw, @syff, @zbxl, @zbsz, @zbgs"
                                            strSQL = strSQL + " )" + vbCr
                                            objSqlCommand.CommandText = strSQL
                                            objSqlCommand.Parameters.Clear()
                                            objSqlCommand.Parameters.AddWithValue("@zjdm", objZJDM)
                                            objSqlCommand.Parameters.AddWithValue("@sydw", objSYDW)
                                            objSqlCommand.Parameters.AddWithValue("@syff", intSYFF)
                                            objSqlCommand.Parameters.AddWithValue("@zbxl", intZBXL)
                                            objSqlCommand.Parameters.AddWithValue("@zbsz", dblZBSZ)
                                            objSqlCommand.Parameters.AddWithValue("@zbgs", strZBGS)
                                            objSqlCommand.ExecuteNonQuery()
                                        End If

                                        '处理序列3
                                        If k = 2 Or k = 5 Then
                                            strZBNR = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YEJIKAOHEBIAOZHUN_XL_ZBNR03), "")
                                            intZBXL = 3
                                            If strZBNR = "" Then
                                                dblZBSZ = 0
                                                strZBGS = ""
                                                intSYFF = 1
                                            Else
                                                If objPulicParameters.isFloatString(strZBNR) = True Then
                                                    dblZBSZ = objPulicParameters.getObjectValue(strZBNR, 0.0)
                                                    strZBGS = ""
                                                    intSYFF = 1
                                                Else
                                                    dblZBSZ = 0
                                                    strZBGS = strZBNR
                                                    intSYFF = 2
                                                End If
                                            End If
                                            '加入
                                            strSQL = ""
                                            strSQL = strSQL + " insert into 地产_B_人事_业绩考核标准(" + vbCr
                                            strSQL = strSQL + "   唯一标识,职级代码,适用单位,适用方法,指标序列,指标数值,指标公式" + vbCr
                                            strSQL = strSQL + " ) values(" + vbCr
                                            strSQL = strSQL + "   newid(), @zjdm, @sydw, @syff, @zbxl, @zbsz, @zbgs"
                                            strSQL = strSQL + " )" + vbCr
                                            objSqlCommand.CommandText = strSQL
                                            objSqlCommand.Parameters.Clear()
                                            objSqlCommand.Parameters.AddWithValue("@zjdm", objZJDM)
                                            objSqlCommand.Parameters.AddWithValue("@sydw", objSYDW)
                                            objSqlCommand.Parameters.AddWithValue("@syff", intSYFF)
                                            objSqlCommand.Parameters.AddWithValue("@zbxl", intZBXL)
                                            objSqlCommand.Parameters.AddWithValue("@zbsz", dblZBSZ)
                                            objSqlCommand.Parameters.AddWithValue("@zbgs", strZBGS)
                                            objSqlCommand.ExecuteNonQuery()
                                        End If
                                    Next
                                End With
                            Next
                        End With
                    Next
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_KaoheBiaozhun = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function













        '----------------------------------------------------------------
        ' 计算指定时间点的人员架构的单位数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：时间点
        '     strWhere                  ：搜索条件
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_DW( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_DW = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_DW]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_RENYUANJIAGOU_DW)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getRenyuanJiagou_DW(@jcsj) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.单位序号,a.所属单位" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RENYUANJIAGOU_DW))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_RYJG_DW = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定时间点的指定单位的人员架构的所有人员数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：时间点
        '     strZZDM                   ：组织代码
        '     strWhere                  ：搜索条件
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strZZDM As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strZZDM Is Nothing Then strZZDM = ""
                strZZDM = strZZDM.Trim
                If strZZDM = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY]未指定[组织代码]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_RENYUANJIAGOU_RY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getRenyuanJiagou_RY(@ssdw,@jcsj) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ssdw", strZZDM)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RENYUANJIAGOU_RY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_RYJG_RY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定时间点的指定职级列表的人员架构的最大人员数目
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：时间点
        '     strZJLIST                 ：职级列表(标准SQL列表格式)
        '     intMaxCount               ：最大数目
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getRYJG_MaxRYSM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strZJLIST As String, _
            ByRef intMaxCount As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getRYJG_MaxRYSM = False
            intMaxCount = 0
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getRYJG_MaxRYSM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strZJLIST Is Nothing Then strZJLIST = ""
                strZJLIST = strZJLIST.Trim
                If strZJLIST = "" Then
                    strErrMsg = "错误：[getRYJG_MaxRYSM]未指定[职级列表]！"
                    GoTo errProc
                End If

                '转换SQL列表到参数规定的列表
                Dim strNewList As String = strZJLIST
                strNewList = strNewList.Replace("'", "")
                strNewList = strNewList.Replace(",", "|")

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    strSQL = ""
                    strSQL = strSQL + " select max(a.最大人数)" + vbCr
                    strSQL = strSQL + " from" + vbCr
                    strSQL = strSQL + " (" + vbCr
                    strSQL = strSQL + "   select a.所属单位, 最大人数=dbo.uf_estate_rs_getRenyuanJiagou_RYSM(a.所属单位,'" + objTime.ToString("yyyy-MM-dd HH:mm:ss") + "','" + strNewList + "')" + vbCr
                    strSQL = strSQL + "   from" + vbCr
                    strSQL = strSQL + "   (" + vbCr
                    strSQL = strSQL + "     select a.所属单位" + vbCr
                    strSQL = strSQL + "     from" + vbCr
                    strSQL = strSQL + "     (" + vbCr
                    strSQL = strSQL + "       select 所属单位" + vbCr
                    strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + objTime.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                    strSQL = strSQL + "       group by 所属单位" + vbCr
                    strSQL = strSQL + "       union" + vbCr
                    strSQL = strSQL + "       select 所属单位" + vbCr
                    strSQL = strSQL + "       from dbo.uf_estate_rs_getValidZhuliJiagou('" + objTime.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                    strSQL = strSQL + "       group by 所属单位" + vbCr
                    strSQL = strSQL + "     ) a" + vbCr
                    strSQL = strSQL + "     group by a.所属单位" + vbCr
                    strSQL = strSQL + "   ) a" + vbCr
                    strSQL = strSQL + " ) a" + vbCr
                    If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    If objDataSet.Tables.Count < 1 Then
                        Exit Try
                    End If
                    With objDataSet.Tables(0)
                        intMaxCount = objPulicParameters.getObjectValue(.Rows(0).Item(0), 0)
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getRYJG_MaxRYSM = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_人事_管理架构”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        '     blnCheckKey          ：True-检查键值
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改描述
        '     zengxianglin 2008-10-14 增加接口参数[blnCheckKey]
        '     zengxianglin 2010-01-04 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_GuanliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal blnCheckKey As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_GuanliJiagou = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_GuanliJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_GuanliJiagou]未传入[新数据]！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_GuanliJiagou]未传入[旧数据]！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_人事_管理架构"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_人事_管理架构", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                            '显示列
                           
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                           

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT
                            If strValue = "" Then
                                strValue = CType(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shiyong, Integer).ToString
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB
                            If strValue = "" Then
                                strValue = "1"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-01-04
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL
                            If strValue = "" Then
                                strValue = "1"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                            If strValue = "" Then
                                strValue = "0"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-01-04

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Else
                            Select Case strField
                                Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM, _
                                    Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJDM
                                    If strValue = "" Then
                                        strErrMsg = "错误：没有输入[" + strField + "]！"
                                        GoTo errProc
                                    End If
                                Case Else
                            End Select
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                    End Select
                    objNewData.Item(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                'zengxianglin 2008-10-14
                If blnCheckKey = False Then
                    Exit Try
                End If
                'zengxianglin 2008-10-14

                '检查“人员代码”约束
                Dim strOldWYBS As String = ""
                Dim strOldRYDM As String = ""
                Dim strNewRYDM As String = ""
                strNewRYDM = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                        strSQL = "select * from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) where 人员代码 = @newrydm"
                        objListDictionary.Add("@jcsj", Now)
                        objListDictionary.Add("@newrydm", strNewRYDM)
                    Case Else
                        strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS), "")
                        strSQL = "select * from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) where 人员代码 = @newrydm and 唯一标识 <> @oldwybs"
                        objListDictionary.Add("@jcsj", Now)
                        objListDictionary.Add("@newrydm", strNewRYDM)
                        objListDictionary.Add("@oldwybs", strOldWYBS)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewRYDM + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '检查人员的“生效时间”是唯一的
                Dim strNewSXSJ As String = ""
                strNewSXSJ = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ)
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                        strSQL = "select * from 地产_B_人事_管理架构 where 人员代码 = @newrydm and 生效时间 = @newsxsj"
                        objListDictionary.Add("@newrydm", strNewRYDM)
                        objListDictionary.Add("@newsxsj", strNewSXSJ)
                    Case Else
                        strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS), "")
                        strSQL = "select * from 地产_B_人事_管理架构 where 人员代码 = @newrydm and 生效时间 = @newsxsj and 唯一标识 <> @oldwybs"
                        objListDictionary.Add("@newrydm", strNewRYDM)
                        objListDictionary.Add("@newsxsj", strNewSXSJ)
                        objListDictionary.Add("@oldwybs", strOldWYBS)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewSXSJ + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_GuanliJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_人事_助理架构”的数据的合法性
        ' 适用于管理模式一
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        '     blnCheckKey          ：True-检查键值
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改描述
        '     zengxianglin 2008-10-14 增加接口参数[blnCheckKey]
        '     zengxianglin 2010-01-04 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ZhuliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal blnCheckKey As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ZhuliJiagou = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ZhuliJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ZhuliJiagou]未传入[新数据]！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ZhuliJiagou]未传入[旧数据]！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_人事_助理架构"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_人事_助理架构", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                            '显示列

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT
                            If strValue = "" Then
                                strValue = CType(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shiyong, Integer).ToString
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB
                            If strValue = "" Then
                                strValue = "1"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-01-04
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL
                            If strValue = "" Then
                                strValue = "1"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                            If strValue = "" Then
                                strValue = "0"
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的整数！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-01-04

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]是无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Else
                            Select Case strField
                                Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM, _
                                    Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJDM
                                    If strValue = "" Then
                                        strErrMsg = "错误：没有输入[" + strField + "]！"
                                        GoTo errProc
                                    End If
                                Case Else
                            End Select
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                    End Select
                    objNewData.Item(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                'zengxianglin 2008-10-14
                If blnCheckKey = False Then
                    Exit Try
                End If
                'zengxianglin 2008-10-14

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ZhuliJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取没有在架构中定义的人员列表
        ' 适用于人员管理模式一、二
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-01-04 重新设计
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY_NotIn( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY_NotIn = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY_NotIn]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                Dim objTime As System.DateTime = Now

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.人员代码 as 人员代码," + vbCr
                        strSQL = strSQL + "     a.组织代码 as 所属单位," + vbCr
                        strSQL = strSQL + "     a.所属分组 as 所属分组," + vbCr
                        strSQL = strSQL + "     a.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     1          as 人员类型," + vbCr
                        strSQL = strSQL + "     ''         as 唯一标识," + vbCr
                        strSQL = strSQL + "     ''         as 职级代码," + vbCr
                        strSQL = strSQL + "     0          as 人员状态," + vbCr
                        strSQL = strSQL + "     1          as 是否占编," + vbCr
                        strSQL = strSQL + "     ''         as 上级领导," + vbCr
                        strSQL = strSQL + "     null       as 生效时间," + vbCr
                        strSQL = strSQL + "     null       as 失效时间," + vbCr
                        strSQL = strSQL + "     ''         as 职级名称," + vbCr
                        strSQL = strSQL + "     ''         as 人员状态名称," + vbCr
                        strSQL = strSQL + "     ''         as 直管单位名称," + vbCr
                        strSQL = strSQL + "     ''         as 上级领导名称," + vbCr
                        strSQL = strSQL + "     ''         as 变动原因," + vbCr
                        strSQL = strSQL + "     ''         as 变动原因名称," + vbCr
                        strSQL = strSQL + "     1          as 标准序列," + vbCr
                        strSQL = strSQL + "     0          as 团队编号," + vbCr
                        strSQL = strSQL + "     ''         as 直管团队," + vbCr
                        strSQL = strSQL + "     ''         as 协管团队," + vbCr
                        strSQL = strSQL + "     0          as 是否兼职 " + vbCr
                        strSQL = strSQL + "   from 公共_B_人员 a " + vbCr
                        strSQL = strSQL + "   left join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 人员代码" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "   ) b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 c on a.组织代码 = c.组织代码" + vbCr
                        strSQL = strSQL + "   where a.是否有效 = 1" + vbCr         '有效人员
                        strSQL = strSQL + "   and   b.人员代码 is null" + vbCr     '没有定义过
                        strSQL = strSQL + "   union " + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.人员代码 as 人员代码," + vbCr
                        strSQL = strSQL + "     a.组织代码 as 所属单位," + vbCr
                        strSQL = strSQL + "     a.所属分组 as 所属分组," + vbCr
                        strSQL = strSQL + "     a.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     0          as 人员类型," + vbCr
                        strSQL = strSQL + "     ''         as 唯一标识," + vbCr
                        strSQL = strSQL + "     ''         as 职级代码," + vbCr
                        strSQL = strSQL + "     0          as 人员状态," + vbCr
                        strSQL = strSQL + "     1          as 是否占编," + vbCr
                        strSQL = strSQL + "     ''         as 上级领导," + vbCr
                        strSQL = strSQL + "     null       as 生效时间," + vbCr
                        strSQL = strSQL + "     null       as 失效时间," + vbCr
                        strSQL = strSQL + "     ''         as 职级名称," + vbCr
                        strSQL = strSQL + "     ''         as 人员状态名称," + vbCr
                        strSQL = strSQL + "     ''         as 直管单位名称," + vbCr
                        strSQL = strSQL + "     ''         as 上级领导名称," + vbCr
                        strSQL = strSQL + "     ''         as 变动原因," + vbCr
                        strSQL = strSQL + "     ''         as 变动原因名称," + vbCr
                        strSQL = strSQL + "     1          as 标准序列," + vbCr
                        strSQL = strSQL + "     0          as 团队编号," + vbCr
                        strSQL = strSQL + "     ''         as 直管团队," + vbCr
                        strSQL = strSQL + "     ''         as 协管团队," + vbCr
                        strSQL = strSQL + "     0          as 是否兼职 " + vbCr
                        strSQL = strSQL + "   from 公共_B_人员 a " + vbCr
                        strSQL = strSQL + "   left join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 人员代码" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "   ) b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 c on a.组织代码 = c.组织代码" + vbCr
                        strSQL = strSQL + "   where a.是否有效 = 1" + vbCr             '有效人员
                        strSQL = strSQL + "   and   b.人员代码 is not null" + vbCr     '已经定义过
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.所属单位" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempestateRenshiXingyeData
            getDataSet_RYJG_RY_NotIn = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取在指定时间的管理架构数据集
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：指定时间
        '     strWhere                  ：搜索条件
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2010-01-02 更改
        '----------------------------------------------------------------
        Public Function getDataSet_GuanliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_GuanliJiagou = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_GUANLIJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     人员名称 = b.人员真名," + vbCr
                        strSQL = strSQL + "     职级名称 = c.职级名称," + vbCr
                        strSQL = strSQL + "     人员状态名称 = case when a.人员状态 & 1 = 1 then @shiyong" + vbCr
                        strSQL = strSQL + "                         when a.人员状态 & 2 = 2 then @ruzhi" + vbCr
                        'zengxianglin 2010-01-02
                        strSQL = strSQL + "                         when a.人员状态 & 4 = 4 then @shixisheng" + vbCr
                        'zengxianglin 2010-01-02
                        strSQL = strSQL + "                         else '' end," + vbCr
                        strSQL = strSQL + "     上级领导名称 = d.人员真名," + vbCr
                        strSQL = strSQL + "     所属单位名称 = e.组织名称," + vbCr
                       
                        strSQL = strSQL + "     直管单位名称 = f.组织名称 " + vbCr
                       
                        strSQL = strSQL + "   from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 c on a.职级代码 = c.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          d on a.上级领导 = d.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      e on a.所属单位 = e.组织代码" + vbCr
                       
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                       
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        objSqlCommand.Parameters.AddWithValue("@shiyong", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shiyong))
                        objSqlCommand.Parameters.AddWithValue("@ruzhi", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Ruzhi))
                        'zengxianglin 2010-01-02
                        objSqlCommand.Parameters.AddWithValue("@shixisheng", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shixisheng))
                        'zengxianglin 2010-01-02
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_GUANLIJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_GuanliJiagou = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取在指定时间的助理架构数据集
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：指定时间
        '     strWhere                  ：搜索条件
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2010-01-02 更改
        '----------------------------------------------------------------
        Public Function getDataSet_ZhuliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ZhuliJiagou = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_ZHULIJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     人员名称 = b.人员真名," + vbCr
                        strSQL = strSQL + "     职级名称 = c.职级名称," + vbCr
                        strSQL = strSQL + "     人员状态名称 = case when a.人员状态 & 1 = 1 then @shiyong" + vbCr
                        strSQL = strSQL + "                         when a.人员状态 & 2 = 2 then @ruzhi" + vbCr
                        'zengxianglin 2010-01-02
                        strSQL = strSQL + "                         when a.人员状态 & 4 = 4 then @shixisheng" + vbCr
                        'zengxianglin 2010-01-02
                        strSQL = strSQL + "                         else '' end," + vbCr
                        strSQL = strSQL + "     所属单位名称 = e.组织名称" + vbCr
                        strSQL = strSQL + "   from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 c on a.职级代码 = c.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      e on a.所属单位 = e.组织代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.所属单位" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        objSqlCommand.Parameters.AddWithValue("@shiyong", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shiyong))
                        objSqlCommand.Parameters.AddWithValue("@ruzhi", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Ruzhi))
                        'zengxianglin 2010-01-02
                        objSqlCommand.Parameters.AddWithValue("@shixisheng", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRenyuanZhuangtaiName(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumRenyuanZhuangtai.Shixisheng))
                        'zengxianglin 2010-01-02
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_ZHULIJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_ZhuliJiagou = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取在架构中有定义的人员列表(包括管理架构和助理架构)
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY_In( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY_In = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY_In]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                Dim objTime As System.DateTime = Now

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.*," + vbCr
                        strSQL = strSQL + "     b.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.人员真名 as 上级领导名称," + vbCr
                        strSQL = strSQL + "     d.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     e.职级名称 as 职级名称," + vbCr
                        strSQL = strSQL + "     f.组织名称 as 直管单位名称," + vbCr
                        strSQL = strSQL + "     g.原因名称 as 变动原因名称," + vbCr
                        strSQL = strSQL + "     dbo.uf_estate_rs_getRYZTtoZGSXName(a.人员状态) as 人员状态名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 1 as 人员类型,*" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "     union" + vbCr
                        strSQL = strSQL + "     select 0 as 人员类型,*" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          c on a.上级领导 = c.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      d on a.所属单位 = d.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 e on a.职级代码 = e.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                        strSQL = strSQL + "   left join 人事_B_变动原因      g on a.变动原因 = g.原因代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempestateRenshiXingyeData
            getDataSet_RYJG_RY_In = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        ' 获取在架构中有定义的人员列表(包括管理架构和助理架构)
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY_In( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal blnOption As Boolean) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY_In = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY_In]未指定[连接用户]！"
                    GoTo errProc
                End If
                Dim objTime As System.DateTime = Now

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    Dim blnWhere As Boolean = True
                    'If strUserId = "yangxianzhi" Or strUserId = "linjunli" Or strUserId = "wenluxi" Or strUserId = "wuxinxia" Then
                    '    blnWhere = False
                    'Else
                    '    blnWhere = True
                    'End If

                    Dim strArray() As String
                    Dim i As Integer
                    Dim intCount As Integer

                    Dim strJSRList As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.RS_JIAGOU_ADMIN
                    strArray = strJSRList.Split(Josco.JsKernal.Common.Utilities.PulicParameters.CharSeparate.ToCharArray)

                    '逐个对比
                    intCount = strArray.Length
                    For i = 0 To intCount - 1 Step 1
                        If strUserId = strArray(i) Then
                            blnWhere = False
                            GoTo goNext
                        End If
                    Next
goNext:
                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.*," + vbCr
                        strSQL = strSQL + "     b.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.人员真名 as 上级领导名称," + vbCr
                        strSQL = strSQL + "     d.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     e.职级名称 as 职级名称," + vbCr
                        strSQL = strSQL + "     f.组织名称 as 直管单位名称," + vbCr
                        strSQL = strSQL + "     g.原因名称 as 变动原因名称," + vbCr
                        strSQL = strSQL + "     dbo.uf_estate_rs_getRYZTtoZGSXName(a.人员状态) as 人员状态名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 1 as 人员类型,*" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "     union" + vbCr
                        strSQL = strSQL + "     select 0 as 人员类型,*" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          c on a.上级领导 = c.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      d on a.所属单位 = d.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 e on a.职级代码 = e.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                        strSQL = strSQL + "   left join 人事_B_变动原因      g on a.变动原因 = g.原因代码" + vbCr
                        strSQL = strSQL + "  ) a" + vbCr
                        
                        If blnWhere = True Then
                            strSQL = strSQL + "  where 所属单位 in " + vbCr
                            strSQL = strSQL + "  ("
                            strSQL = strSQL + "  select distinct  所属单位 from" + vbCr
                            strSQL = strSQL + "  (" + vbCr
                            strSQL = strSQL + "  select 人员代码,所属单位 from 地产_B_人事_助理架构 where 人员代码=@rydm and 失效时间 is null" + vbCr
                            strSQL = strSQL + "  union"
                            strSQL = strSQL + "  select 人员代码,所属单位 from 地产_B_人事_管理架构 where 人员代码=@rydm and 失效时间 is null" + vbCr
                            strSQL = strSQL + "  union"
                            strSQL = strSQL + "  select 人员代码,b.所属单位 from 地产_B_人事_管理架构 a left join 地产_B_人事_团队组合 b on a.直管团队=b.组别标识 where a.人员代码=@rydm and a.失效时间 is null " + vbCr
                            strSQL = strSQL + "  union"
                            strSQL = strSQL + "  select 人员代码,b.所属单位 from 地产_B_人事_管理架构 a left join 地产_B_人事_团队组合 b on a.协管团队=b.组别标识 where a.人员代码=@rydm and a.失效时间 is null " + vbCr
                            strSQL = strSQL + "  ) a " + vbCr
                            strSQL = strSQL + "  ) " + vbCr
                        End If

                        If strWhere <> "" Then
                            If blnWhere = True Then
                                strSQL = strSQL + " and " + strWhere + vbCr
                            Else
                                strSQL = strSQL + "  where " + strWhere + vbCr
                            End If
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        If blnWhere = True Then
                            objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                        End If
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempestateRenshiXingyeData
            getDataSet_RYJG_RY_In = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function









        '----------------------------------------------------------------
        ' 获取“地产_B_人事_个人履历”完全数据的数据集(以“人员代码”升序排序)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     objestateRenshiXingyeData  ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改记录：
        '     zengxianglin 2009-05-14 更改
        '----------------------------------------------------------------
        Public Function getDataSet_GRLL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_GRLL = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_GRLL]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_GERENLVLI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     年龄             = abs(datediff(yyyy,getdate(),a.出生日期))," + vbCr
                        strSQL = strSQL + "     婚姻状况名称     = dbo.uf_rs_getHunyinStatusName(a.婚姻状况)," + vbCr
                        strSQL = strSQL + "     生育情况名称     = dbo.uf_rs_getShengyuStatusName(a.生育情况)," + vbCr
                        strSQL = strSQL + "     最高学历名称     = dbo.uf_rs_getXueliName(a.最高学历)," + vbCr
                        strSQL = strSQL + "     最高学位名称     = dbo.uf_rs_getXueweiName(a.最高学位)," + vbCr
                        strSQL = strSQL + "     技术职称名称     = dbo.uf_rs_getZhichengName(a.技术职称)," + vbCr
                        strSQL = strSQL + "     执业资格名称     = dbo.uf_rs_getZhiyezigeName(a.执业资格)," + vbCr
                        strSQL = strSQL + "     政治面貌名称     = dbo.uf_rs_getZhengzhimianmaoName(a.政治面貌)," + vbCr
                        strSQL = strSQL + "     是否录用         = case when b.人员代码 is null then @false else @true end," + vbCr
                        'zengxianglin 2009-05-14
                        strSQL = strSQL + "     拟用部门名称     = c.组织名称," + vbCr
                        strSQL = strSQL + "     登记人员名称     = d.人员名称," + vbCr
                        strSQL = strSQL + "     登记部门名称     = e.组织名称 " + vbCr
                        'zengxianglin 2009-05-14
                        strSQL = strSQL + "   from 地产_B_人事_个人履历 a " + vbCr
                        strSQL = strSQL + "   left join 人事_B_人事卡片 b on a.人员代码 = b.人员代码" + vbCr
                        'zengxianglin 2009-05-14
                        strSQL = strSQL + "   left join 公共_B_组织机构 c on a.拟用部门 = c.组织代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员     d on a.登记人员 = d.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 e on a.登记部门 = e.组织代码" + vbCr
                        'zengxianglin 2009-05-14
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.人员代码 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_GERENLVLI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_GRLL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_人事_学习经历”完全数据的数据集(以“开始年月”升序排序)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strRYDM                    ：人员代码
        '     strWhere                   ：搜索字符串
        '     objestateRenshiXingyeData  ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_GRLL_XXJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_GRLL_XXJL = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_GRLL_XXJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_XUEXIJINGLI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     有学历证名称 = case when a.有学历证 = 1 then @true else @false end," + vbCr
                        strSQL = strSQL + "     有学位证名称 = case when a.有学位证 = 1 then @true else @false end " + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_学习经历 a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " where a.人员代码 = @rydm" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " and " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.开始年月 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_XUEXIJINGLI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_GRLL_XXJL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_人事_工作经历”完全数据的数据集(以“开始年月”升序排序)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strRYDM                    ：人员代码
        '     strWhere                   ：搜索字符串
        '     objestateRenshiXingyeData  ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_GRLL_GZJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_GRLL_GZJL = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_GRLL_GZJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_GONGZUOJINGLI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_B_人事_工作经历 a" + vbCr
                        strSQL = strSQL + " where a.人员代码 = @rydm" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " and " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.开始年月 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_GONGZUOJINGLI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_GRLL_GZJL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取新的“简历编号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strJLBH              ：简历编号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录：
        '     zengxianglin 2009-05-14 更改
        '----------------------------------------------------------------
        Public Function getNewJLBH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strJLBH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewJLBH = False
            strErrMsg = ""

            Try
                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-05-14
                '简历编号：YYYYnnnn
                'zengxianglin 2009-05-14
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "简历编号", "地产_B_人事_个人履历", 8, Now.Year.ToString, True, strJLBH) = False Then
                    GoTo errProc
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewJLBH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_人事_个人履历”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型

        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '
        ' 更改记录：
        '     zengxianglin 2009-05-14 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_GRLL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_GRLL = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_人事_个人履历"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_人事_个人履历", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NN, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZKMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQKMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXLMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXWMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JSZCMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZZMMMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZYZGMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SFLY, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                            '显示列
                            'zengxianglin 2009-05-14
                            'zengxianglin 2009-05-14
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                            'zengxianglin 2009-05-15
                            'Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JLBH
                            '    '自动赋值
                            '    If strValue = "" Then
                            '        If Me.getNewJLBH(strErrMsg, strUserId, strPassword, strValue) = False Then
                            '            GoTo errProc
                            '        End If
                            '    End If
                            'zengxianglin 2009-05-15

                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYDM, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_XM, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_XB, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JLBH
                            'zengxianglin 2009-05-15
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JLBH
                            'zengxianglin 2009-05-15
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_CSRQ, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TBRQ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_BYSJ, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZCQDSJ, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RDSJ, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                            'zengxianglin 2009-05-14
                            'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                            'zengxianglin 2009-05-14
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZK, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQK, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_YZGZ
                            If strValue <> "" Then
                                If objPulicParameters.isIntegerString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SG, _
                            Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TZ
                            If strValue <> "" Then
                                If objPulicParameters.isFloatString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                    GoTo errProc
                                End If
                            End If
                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                Dim strKeyValue As String = ""

                '检查“人员代码”约束
                Dim strNewRYDM As String = ""
                strNewRYDM = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYDM)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_人事_个人履历 where 人员代码 = @rydm"
                        objListDictionary.Add("@rydm", strNewRYDM)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_WYBS), "")
                        strSQL = "select * from 地产_B_人事_个人履历 where 人员代码 = @rydm and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@rydm", strNewRYDM)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewRYDM + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '检查“简历编号”约束
                Dim strNewJLBH As String = ""
                strNewJLBH = objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JLBH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_人事_个人履历 where 简历编号 = @jlbh"
                        objListDictionary.Add("@jlbh", strNewJLBH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_WYBS), "")
                        strSQL = "select * from 地产_B_人事_个人履历 where 简历编号 = @jlbh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@jlbh", strNewJLBH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    'zengxianglin 2009-05-15
                    If Me.getNewJLBH(strErrMsg, strUserId, strPassword, strValue) = True Then
                        objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JLBH) = strValue
                    End If
                    'zengxianglin 2009-05-15
                    strErrMsg = "错误：[" + strNewJLBH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_GRLL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 备份Http文件
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strOldFileHttpSpec     ：相片文件的现HTTP路径
        '     strAppRoot             ：应用根Http路径(不带/)
        '     objServer              ：服务器对象
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Private Function doHttpBackupFiles( _
            ByRef strErrMsg As String, _
            ByVal strOldFileHttpSpec As String, _
            ByVal strAppRoot As String, _
            ByVal objServer As System.Web.HttpServerUtility) As Boolean

            Dim strBakExt As String = Josco.JsKernal.Common.Utilities.PulicParameters.BACKUPFILEEXT
            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile

            doHttpBackupFiles = False
            strErrMsg = ""

            Try
                '检查
                If strOldFileHttpSpec Is Nothing Then strOldFileHttpSpec = ""
                strOldFileHttpSpec = strOldFileHttpSpec.Trim
                If strOldFileHttpSpec = "" Then
                    Exit Try
                End If
                If objServer Is Nothing Then
                    Exit Try
                End If
                If strAppRoot Is Nothing Then strAppRoot = ""
                strAppRoot = strAppRoot.Trim

                '备份
                Dim strLocalFile As String = ""
                Dim strHttpFile As String = ""
                strHttpFile = strAppRoot + Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP + strOldFileHttpSpec
                strLocalFile = objServer.MapPath(strHttpFile)
                Dim blnDo As Boolean
                If objBaseLocalFile.doFileExisted(strErrMsg, strLocalFile, blnDo) = False Then
                    Exit Try
                End If
                If blnDo = True Then
                    '备份文件
                    If objBaseLocalFile.doCopyFile(strErrMsg, strLocalFile, strLocalFile + strBakExt, True) = False Then
                        GoTo errProc
                    End If
                    '删除现有文件
                    If objBaseLocalFile.doDeleteFile(strErrMsg, strLocalFile) = False Then
                        '形成垃圾文件！
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)

            doHttpBackupFiles = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除Http备份文件
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strOldFileHttpSpec     ：相片文件的原HTTP路径
        '     strAppRoot             ：应用根Http路径(不带/)
        '     objServer              ：服务器对象
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Private Function doHttpDeleteBackupFiles( _
            ByRef strErrMsg As String, _
            ByVal strOldFileHttpSpec As String, _
            ByVal strAppRoot As String, _
            ByVal objServer As System.Web.HttpServerUtility) As Boolean

            Dim strBakExt As String = Josco.JsKernal.Common.Utilities.PulicParameters.BACKUPFILEEXT
            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile

            doHttpDeleteBackupFiles = False
            strErrMsg = ""

            Try
                '检查
                If strOldFileHttpSpec Is Nothing Then strOldFileHttpSpec = ""
                strOldFileHttpSpec = strOldFileHttpSpec.Trim
                If strOldFileHttpSpec = "" Then
                    Exit Try
                End If
                If objServer Is Nothing Then
                    Exit Try
                End If
                If strAppRoot Is Nothing Then strAppRoot = ""
                strAppRoot = strAppRoot.Trim

                '删除备份
                Dim strLocalFile As String = ""
                Dim strHttpFile As String = ""
                strHttpFile = strAppRoot + Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP + strOldFileHttpSpec
                strLocalFile = objServer.MapPath(strHttpFile)
                strLocalFile = strLocalFile + strBakExt
                If objBaseLocalFile.doDeleteFile(strErrMsg, strLocalFile) = False Then
                    '形成垃圾文件！
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)

            doHttpDeleteBackupFiles = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 从备份中恢复Http文件
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strOldFileHttpSpec     ：相片文件的原HTTP路径
        '     strAppRoot             ：应用根Http路径(不带/)
        '     objServer              ：服务器对象
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Private Function doHttpRestoreFiles( _
            ByRef strErrMsg As String, _
            ByVal strOldFileHttpSpec As String, _
            ByVal strAppRoot As String, _
            ByVal objServer As System.Web.HttpServerUtility) As Boolean

            Dim strBakExt As String = Josco.JsKernal.Common.Utilities.PulicParameters.BACKUPFILEEXT
            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile

            doHttpRestoreFiles = False
            strErrMsg = ""

            Try
                '检查
                If strOldFileHttpSpec Is Nothing Then strOldFileHttpSpec = ""
                strOldFileHttpSpec = strOldFileHttpSpec.Trim
                If strOldFileHttpSpec = "" Then
                    Exit Try
                End If
                If objServer Is Nothing Then
                    Exit Try
                End If
                If strAppRoot Is Nothing Then strAppRoot = ""
                strAppRoot = strAppRoot.Trim

                '恢复
                Dim strLocalFile As String = ""
                Dim strHttpFile As String = ""
                strHttpFile = strAppRoot + Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP + strOldFileHttpSpec
                strLocalFile = objServer.MapPath(strHttpFile)
                '恢复文件
                If objBaseLocalFile.doCopyFile(strErrMsg, strLocalFile + strBakExt, strLocalFile, True) = False Then
                    GoTo errProc
                End If
                '删除备份
                If objBaseLocalFile.doDeleteFile(strErrMsg, strLocalFile + strBakExt) = False Then
                    '形成垃圾文件
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)

            doHttpRestoreFiles = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_个人履历”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录：
        '     zengxianglin 2009-05-14 更改
        '----------------------------------------------------------------
        Public Function doSaveData_GRLL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_GRLL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strValue As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NN, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXLMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JSZCMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZZMMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZYZGMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SFLY, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        '显示列
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        'zengxianglin 2009-05-14
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_个人履历 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NN, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXLMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JSZCMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZZMMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZYZGMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SFLY, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        '显示列
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        'zengxianglin 2009-05-14

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_CSRQ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TBRQ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_BYSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZCQDSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RDSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                                        'zengxianglin 2009-05-14
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZK, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQK, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_YZGZ
                                        If objNewData.Item(i) = "" Then
                                            strValue = "0"
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SG, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TZ
                                        If objNewData.Item(i) = "" Then
                                            strValue = "0.0"
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If

                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NN, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXLMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JSZCMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZZMMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZYZGMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SFLY, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        '显示列
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        'zengxianglin 2009-05-14

                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_个人履历 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NN, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQKMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXLMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZGXWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_JSZCMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZZMMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZYZGMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SFLY, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        '显示列
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_NYBMMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJRYMC, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJBMMC
                                        'zengxianglin 2009-05-14

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_CSRQ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TBRQ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_BYSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_ZCQDSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RDSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                                        'zengxianglin 2009-05-14
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_DJSJ
                                        'zengxianglin 2009-05-14
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_HYZK, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SYQK, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_YZGZ
                                        If objNewData.Item(i) = "" Then
                                            strValue = "0"
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_SG, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_TZ
                                        If objNewData.Item(i) = "" Then
                                            strValue = "0.0"
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If

                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_GRLL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据本地文件获取相片文件的HTTP服务器文件的命名
        ' 命名方案：唯一标识+文件扩展名
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strLocalFile         ：本地文件名
        '     strWYBS              ：唯一标识
        '     strBasePath          ：该文件存放的HTTP基准路径(/)
        '     strRemoteFile        ：返回HTTP服务器文件路径(首字符不带/)
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Private Function getHTTPNewFileName( _
            ByRef strErrMsg As String, _
            ByVal strLocalFile As String, _
            ByVal strWYBS As String, _
            ByVal strBasePath As String, _
            ByRef strRemoteFile As String) As Boolean

            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile

            getHTTPNewFileName = False
            strRemoteFile = ""

            Try
                '检查
                If strLocalFile Is Nothing Then strLocalFile = ""
                strLocalFile = strLocalFile.Trim()
                If strLocalFile = "" Then
                    Exit Try
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim()
                If strWYBS = "" Then
                    Exit Try
                End If
                If strBasePath Is Nothing Then strBasePath = ""
                strBasePath = strBasePath.Trim
                strBasePath = strBasePath.Replace(Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP, Josco.JsKernal.Common.Utilities.BaseLocalFile.DEFAULT_DIRSEP)

                '获取文件名
                Dim strFileName As String = ""
                Dim strFileExt As String = ""
                strFileExt = objBaseLocalFile.getExtension(strLocalFile)

                '命名方案：资源标识+文件扩展名
                strFileName = strWYBS + strFileExt

                '复合目录+文件
                strFileName = objBaseLocalFile.doMakePath(strBasePath, strFileName)

                '转换分隔符
                strFileName = strFileName.Replace(Josco.JsKernal.Common.Utilities.BaseLocalFile.DEFAULT_DIRSEP, Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP)
                If strFileName.Substring(0) = Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP Then
                    strFileName = strFileName.Substring(1)
                End If

                '返回
                strRemoteFile = strFileName

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)

            getHTTPNewFileName = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存相片文件
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objSqlTransaction      ：现有事务
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strWYBS                ：唯一标识
        '     strOldFile             ：旧文件路径(相对HTTP根目录路径)
        '     strNewFile             ：要保存的文件的本地缓存文件完整路径
        '     strAppRoot             ：应用根Http路径(不带/)
        '     strBasePath            ：从应用根到存放地的相对HTTP目录(开头不带/)
        '     objServer              ：服务器对象
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_GRLL_File( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal strOldFile As String, _
            ByVal strNewFile As String, _
            ByVal strAppRoot As String, _
            ByVal strBasePath As String, _
            ByVal objServer As System.Web.HttpServerUtility) As Boolean

            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim blnNewTrans As Boolean = False
            Dim strWJWZ As String
            Dim strSQL As String

            doSaveData_GRLL_File = False
            strErrMsg = ""

            Try
                '检查输入参数
                If objSqlTransaction Is Nothing Then
                    If strUserId Is Nothing Then strUserId = ""
                    strUserId = strUserId.Trim
                    If strUserId = "" Then
                        strErrMsg = "错误：未传入连接用户！"
                        GoTo errProc
                    End If
                End If
                If strNewFile Is Nothing Then strNewFile = ""
                strNewFile = strNewFile.Trim()
                If strNewFile = "" Then
                    '不用保存
                    Exit Try
                End If
                If objServer Is Nothing Then
                    strErrMsg = "错误：未传入[System.Web.HttpServerUtility]！"
                    GoTo errProc
                End If
                If strAppRoot Is Nothing Then strAppRoot = ""
                strAppRoot = strAppRoot.Trim
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    Exit Try
                End If
                If strOldFile Is Nothing Then strOldFile = ""
                strOldFile = strOldFile.Trim
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strBasePath Is Nothing Then strBasePath = ""
                strBasePath = strBasePath.Trim

                '检查文件是否存在?
                Dim blnExisted As Boolean
                If objBaseLocalFile.doFileExisted(strErrMsg, strNewFile, blnExisted) = False Then
                    GoTo errProc
                End If
                If blnExisted = False Then
                    strErrMsg = "错误：相片文件[" + strNewFile + "]不存在！"
                    GoTo errProc
                End If

                '获取文件信息
                strWJWZ = strOldFile

                '获取服务器文件
                Dim strDesFile As String
                If Me.getHTTPNewFileName(strErrMsg, strNewFile, strWYBS, strBasePath, strDesFile) = False Then
                    GoTo errProc
                End If

                '更新文件路径
                '获取事务连接
                If objSqlTransaction Is Nothing Then
                    If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                        GoTo errProc
                    End If
                Else
                    objSqlConnection = objSqlTransaction.Connection
                End If

                '备份原文件
                If Me.doHttpBackupFiles(strErrMsg, strWJWZ, strAppRoot, objServer) = False Then
                    GoTo errProc
                End If

                '开始事务
                If objSqlTransaction Is Nothing Then
                    blnNewTrans = True
                    objSqlTransaction = objSqlConnection.BeginTransaction
                Else
                    blnNewTrans = False
                End If

                '保存文件
                Dim strHttpFile As String = strAppRoot + Josco.JsKernal.Common.Utilities.BaseURI.DEFAULT_DIRSEP + strDesFile
                Dim strLocalFile As String = objServer.MapPath(strHttpFile)
                '创建路径
                If objBaseLocalFile.doCreateDirectory(strErrMsg, strLocalFile) = False Then
                    GoTo errProc
                End If
                '上传到HTTP最终位置
                If objBaseLocalFile.doCopyFile(strErrMsg, strNewFile, strLocalFile, True) = False Then
                    GoTo rollDatabaseAndFile
                End If

                Try
                    '准备命令参数
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '准备SQL
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_人事_个人履历 set " + vbCr
                    strSQL = strSQL + "   人员相片 = @wjwz " + vbCr
                    strSQL = strSQL + " where 唯一标识  = @wjbs " + vbCr
                    strSQL = strSQL + " and   人员相片 <> @wjwz " + vbCr

                    '执行命令
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@wjwz", strDesFile)
                    objSqlCommand.Parameters.AddWithValue("@wjbs", strWYBS)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabaseAndFile
                End Try

                '提交事务
                If blnNewTrans = True Then
                    objSqlTransaction.Commit()
                End If

                '删除备份文件
                If blnNewTrans = True Then
                    If Me.doHttpDeleteBackupFiles(strErrMsg, strWJWZ, strAppRoot, objServer) = False Then
                        '可以不成功，形成垃圾文件！
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            If blnNewTrans = True Then
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            End If

            doSaveData_GRLL_File = True
            Exit Function

rollDatabaseAndFile:
            If blnNewTrans = True Then
                objSqlTransaction.Rollback()
                If Me.doHttpRestoreFiles(strSQL, strWJWZ, strAppRoot, objServer) = False Then
                    '可以不成功，形成垃圾数据
                End If
            End If
            GoTo errProc

errProc:
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            If blnNewTrans = True Then
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            End If
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_学习经历”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strRYDM              ：人员代码
        '     objDataSet_XXJL      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_GRLL_XXJL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strRYDM As String, _
            ByVal objDataSet_XXJL As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_GRLL_XXJL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_XXJL Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_人事_学习经历" + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_XXJL.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_XUEXIJINGLI).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_学习经历 (" + vbCr
                            strSQL = strSQL + "   唯一标识,人员代码,开始年月,终止年月,学习类型,学习院校,学习专业,学习结果,有学历证,有学位证" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @rydm, @ksny, @zzny, @xxlx, @xxyx, @xxzy, @xxjg, @yxlz, @yxwz" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.Parameters.AddWithValue("@ksny", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_KSNY))
                            objSqlCommand.Parameters.AddWithValue("@zzny", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_ZZNY))
                            objSqlCommand.Parameters.AddWithValue("@xxlx", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_XXLX))
                            objSqlCommand.Parameters.AddWithValue("@xxyx", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_XXYX))
                            objSqlCommand.Parameters.AddWithValue("@xxzy", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_XXZY))
                            objSqlCommand.Parameters.AddWithValue("@xxjg", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_XXJG))
                            objSqlCommand.Parameters.AddWithValue("@yxlz", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_YXLZ))
                            objSqlCommand.Parameters.AddWithValue("@yxwz", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_XUEXIJINGLI_YXWZ))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_GRLL_XXJL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_工作经历”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strRYDM              ：人员代码
        '     objDataSet_GZJL      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_GRLL_GZJL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strRYDM As String, _
            ByVal objDataSet_GZJL As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_GRLL_GZJL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_GZJL Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_人事_工作经历" + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_GZJL.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_GONGZUOJINGLI).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_工作经历 (" + vbCr
                            strSQL = strSQL + "   唯一标识,人员代码,开始年月,终止年月,服务单位,担任职务,月薪,离职原因,证明人,电话" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @rydm, @ksny, @zzny, @fwdw, @drzw, @yx, @lzyy, @zmr, @dh" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.Parameters.AddWithValue("@ksny", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_KSNY))
                            objSqlCommand.Parameters.AddWithValue("@zzny", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_ZZNY))
                            objSqlCommand.Parameters.AddWithValue("@fwdw", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_FWDW))
                            objSqlCommand.Parameters.AddWithValue("@drzw", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_DRZW))
                            objSqlCommand.Parameters.AddWithValue("@yx", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_YX))
                            objSqlCommand.Parameters.AddWithValue("@lzyy", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_LZYY))
                            objSqlCommand.Parameters.AddWithValue("@zmr", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_ZMR))
                            objSqlCommand.Parameters.AddWithValue("@dh", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GONGZUOJINGLI_DH))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_GRLL_GZJL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_个人履历”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(返回保存后的新值)
        '     objOldData             ：记录旧值
        '     objenumEditType        ：编辑类型
        '     strUploadFile          ：上载文件的WEB本地完全路径
        '     strAppRoot             ：应用根Http路径(不带/)
        '     strBasePath            ：从应用根到存放地的相对HTTP目录(开头不带/)
        '     objServer              ：服务器对象
        '     objDataSet_XXJL        ：学习经历数据集
        '     objDataSet_GZJL        ：工作经历数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_GRLL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal strUploadFile As String, _
            ByVal strAppRoot As String, _
            ByVal strBasePath As String, _
            ByVal objServer As System.Web.HttpServerUtility, _
            ByVal objDataSet_XXJL As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_GZJL As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim strWJWZ As String = ""
            Dim strSQL As String

            doSaveData_GRLL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：未传入连接用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objServer Is Nothing Then
                    strErrMsg = "错误：没有指定[System.Web.HttpServerUtility]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strUploadFile Is Nothing Then strUploadFile = ""
                strUploadFile = strUploadFile.Trim
                If strAppRoot Is Nothing Then strAppRoot = ""
                strAppRoot = strAppRoot.Trim
                If strBasePath Is Nothing Then strBasePath = strBasePath.Trim
                strBasePath = strBasePath.Trim

                '检查主记录
                If Me.doVerifyData_GRLL(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存主记录
                    If Me.doSaveData_GRLL(strErrMsg, objSqlTransaction, objOldData, objNewData, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If

                    '获取唯一标识
                    Dim strWYBS As String = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_WYBS)
                    Dim strRYDM As String = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYDM)

                    '保存“学习经历”数据
                    If Me.doSaveData_GRLL_XXJL(strErrMsg, objSqlTransaction, strRYDM, objDataSet_XXJL) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“工作经历”数据
                    If Me.doSaveData_GRLL_GZJL(strErrMsg, objSqlTransaction, strRYDM, objDataSet_GZJL) = False Then
                        GoTo rollDatabase
                    End If

                    '保存新图片文件
                    If objOldData Is Nothing Then
                        strWJWZ = ""
                    Else
                        strWJWZ = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYXP), "")
                    End If
                    If strUploadFile <> "" Then
                        If Me.doSaveData_GRLL_File(strErrMsg, objSqlTransaction, strUserId, strPassword, strWYBS, strWJWZ, strUploadFile, strAppRoot, strBasePath, objServer) = False Then
                            GoTo rollDatabaseAndFile
                        End If
                    End If

                    '删除备份文件
                    If Me.doHttpDeleteBackupFiles(strErrMsg, strWJWZ, strAppRoot, objServer) = False Then
                        '可以不成功，形成垃圾文件！
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_GRLL = True
            Exit Function
rollDatabaseAndFile:
            If Me.doHttpRestoreFiles(strSQL, strWJWZ, strAppRoot, objServer) = False Then
                '可以不成功，形成垃圾数据
            End If
            GoTo rollDatabase
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_人事_个人履历”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        '     objServer            ：System.Web.HttpServerUtility
        '     strHttpPathPrefix    ：Http目录前缀部分(末尾=/)
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_GRLL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal objServer As System.Web.HttpServerUtility, _
            ByVal strHttpPathPrefix As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_GRLL = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：没有指定连接用户！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If objServer Is Nothing Then
                    strErrMsg = "错误：没有指定[System.Web.HttpServerUtility]！"
                    GoTo errProc
                End If
                If strHttpPathPrefix Is Nothing Then strHttpPathPrefix = ""
                strHttpPathPrefix = strHttpPathPrefix.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_人事_个人履历 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strRYDM As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strRYDM = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYDM), "")
                End With

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim strFilePath As String = ""
                Dim strUrl As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Try
                    '删除“地产_B_人事_学习经历”
                    strSQL = "delete from 地产_B_人事_学习经历 where 人员代码 = '" + strRYDM + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_人事_工作经历”
                    strSQL = "delete from 地产_B_人事_工作经历 where 人员代码 = '" + strRYDM + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除主记录
                    strSQL = "delete from 地产_B_人事_个人履历 where 唯一标识 = '" + strWYBS + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除Http文件
                    With objDataSet_MAIN.Tables(0)
                        If .Rows.Count > 0 Then
                            strFilePath = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GERENLVLI_RYXP), "")
                            If strFilePath <> "" Then
                                strFilePath = strHttpPathPrefix + strFilePath
                                strFilePath = objServer.MapPath(strFilePath)
                                If objBaseLocalFile.doDeleteFile(strErrMsg, strFilePath) = False Then
                                    '可以不成功，形成垃圾文件！
                                End If
                            End If
                        End If
                    End With
                    Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_GRLL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取简历编号搜索SQL
        ' 更改记录：
        '     zengxianglin 2009-05-16 更改
        '----------------------------------------------------------------
        Public Function getSearchSQL_JLBH() As String

            Dim strSQL As String = ""

            strSQL = ""
            strSQL = strSQL + " select a.*" + vbCr
            strSQL = strSQL + " from" + vbCr
            strSQL = strSQL + " (" + vbCr
            strSQL = strSQL + "   select " + vbCr
            strSQL = strSQL + "     a.人员代码,a.简历编号,a.姓名,a.性别," + vbCr
            strSQL = strSQL + "     年龄 = abs(datediff(yyyy,getdate(),a.出生日期))," + vbCr
            strSQL = strSQL + "     学历 = dbo.uf_rs_getXueliName(a.最高学历)," + vbCr
            'zengxianglin 2009-05-16
            strSQL = strSQL + "     a.现场意见,拟分配部门=c.组织名称," + vbCr
            strSQL = strSQL + "     a.薪金要求," + vbCr
            strSQL = strSQL + "     a.身份证号,a.民族,a.籍贯" + vbCr
            'zengxianglin 2009-05-16
            strSQL = strSQL + "   from 地产_B_人事_个人履历 a" + vbCr
            strSQL = strSQL + "   left join 人事_B_人事卡片 b on a.人员代码 = b.人员代码" + vbCr
            strSQL = strSQL + "   left join 公共_B_组织机构 c on a.拟用部门 = c.组织代码" + vbCr
            strSQL = strSQL + "   where b.人员代码 is null" + vbCr
            strSQL = strSQL + " ) a" + vbCr

            getSearchSQL_JLBH = strSQL

        End Function












        '----------------------------------------------------------------
        ' 计算指定人员在指定时间点的所有下属人员
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     objJCSJ              ：时间点
        '     objXJRY              ：下属人员的代码列表
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Private Function getAllXiashuRenyuan( _
            ByRef strErrMsg As String, _
            ByVal objSqlConnection As System.Data.SqlClient.SqlConnection, _
            ByVal strRYDM As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef objXJRY As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objXJ As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getAllXiashuRenyuan = False
            strErrMsg = ""

            Try
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '获取直接下级
                strSQL = ""
                strSQL = strSQL + " select 人员代码" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + " where 上级领导 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " group by 人员代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objXJ) = False Then
                    GoTo errProc
                End If

                '计算
                Dim intCount As Integer = 0
                Dim strXJRY As String = ""
                Dim i As Integer = 0
                With objXJ.Tables(0)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strXJRY = objPulicParameters.getObjectValue(.Rows(i).Item(0), "")

                        '加入
                        If objXJRY(strXJRY) Is Nothing Then
                            objXJRY.Add(strXJRY, strXJRY)
                        End If

                        '计算新的下级
                        If Me.getAllXiashuRenyuan(strErrMsg, objSqlConnection, strXJRY, objJCSJ, objXJRY) = False Then
                            GoTo errProc
                        End If
                    Next
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getAllXiashuRenyuan = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员在指定时间点的所有下属人员
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     objJCSJ              ：时间点
        '     objXJRY              ：下属人员的代码列表
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-01-13 创建
        '----------------------------------------------------------------
        Public Function getAllXiashuRenyuan_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef objXJRY As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objXJ As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getAllXiashuRenyuan_X2 = False
            objXJRY = Nothing
            strErrMsg = ""

            Try
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '准备缓冲区
                objXJRY = New System.Collections.Specialized.NameValueCollection

                '获取管理团队下的所有人员
                strSQL = ""
                strSQL = strSQL + " select a.人员代码" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "') a" + vbCr
                strSQL = strSQL + " left join" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select b.所属单位,b.团队编号" + vbCr
                strSQL = strSQL + "   from" + vbCr
                strSQL = strSQL + "   (" + vbCr
                strSQL = strSQL + "     select a.组别标识" + vbCr
                strSQL = strSQL + "     from" + vbCr
                strSQL = strSQL + "     (" + vbCr
                strSQL = strSQL + "       select 直管团队 as 组别标识" + vbCr
                strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + "       where rtrim(isnull(直管团队,'')) <> ''" + vbCr
                strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "       union" + vbCr
                strSQL = strSQL + "       select 协管团队 as 组别标识" + vbCr
                strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + "       where rtrim(isnull(协管团队,'')) <> ''" + vbCr
                strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "     ) a" + vbCr
                strSQL = strSQL + "     group by a.组别标识" + vbCr
                strSQL = strSQL + "   ) a" + vbCr
                strSQL = strSQL + "   left join 地产_B_人事_团队组合 b on a.组别标识=b.组别标识" + vbCr
                strSQL = strSQL + "   where b.组别标识 is not null" + vbCr
                strSQL = strSQL + "   group by b.所属单位,b.团队编号" + vbCr
                strSQL = strSQL + " ) b on a.所属单位=b.所属单位 and a.团队编号=b.团队编号" + vbCr
                strSQL = strSQL + " where b.所属单位 is not null" + vbCr
                strSQL = strSQL + " group by a.人员代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objXJ) = False Then
                    GoTo errProc
                End If

                '计算
                Dim intCount As Integer = 0
                Dim strXJRY As String = ""
                Dim i As Integer = 0
                With objXJ.Tables(0)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strXJRY = objPulicParameters.getObjectValue(.Rows(i).Item(0), "")

                        '加入
                        If objXJRY(strXJRY) Is Nothing Then
                            objXJRY.Add(strXJRY, strXJRY)
                        End If
                    Next
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getAllXiashuRenyuan_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员在指定时间点的所有下属人员
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     objJCSJ              ：时间点
        '     objXJRY              ：下属人员的代码列表
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-01-13 更改
        '----------------------------------------------------------------
        Public Function getAllXiashuRenyuan( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef objXJRY As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objXJ As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getAllXiashuRenyuan = False
            objXJRY = Nothing
            strErrMsg = ""

            Try
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                'zengxianglin 2010-01-13
                '计算objJCSJ时执行的人事管理模式
                Dim intBZXL As Integer = 0
                If Me.getBZXL_RSJG(strErrMsg, strUserId, strPassword, objJCSJ.ToString("yyyy-MM-dd HH:mm:ss"), intBZXL) = False Then
                    GoTo errProc
                End If
                Select Case intBZXL
                    Case 1
                    Case 2
                        '管理模式二
                        If Me.getAllXiashuRenyuan_X2(strErrMsg, strUserId, strPassword, strRYDM, objJCSJ, objXJRY) = False Then
                            GoTo errProc
                        End If
                        Exit Try
                    Case Else
                        '其他模式
                        Exit Try
                End Select
                '继续处理管理模式一
                'zengxianglin 2010-01-13

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '准备缓冲区
                objXJRY = New System.Collections.Specialized.NameValueCollection

                '获取直接下级
                strSQL = ""
                strSQL = strSQL + " select 人员代码" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + " where 上级领导 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " group by 人员代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objXJ) = False Then
                    GoTo errProc
                End If

                '计算
                Dim intCount As Integer = 0
                Dim strXJRY As String = ""
                Dim i As Integer = 0
                With objXJ.Tables(0)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strXJRY = objPulicParameters.getObjectValue(.Rows(i).Item(0), "")

                        '加入
                        If objXJRY(strXJRY) Is Nothing Then
                            objXJRY.Add(strXJRY, strXJRY)
                        End If

                        '计算新的下级
                        If Me.getAllXiashuRenyuan(strErrMsg, objSqlConnection, strXJRY, objJCSJ, objXJRY) = False Then
                            GoTo errProc
                        End If
                    Next
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getAllXiashuRenyuan = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员在指定时间点的所有担任行政助理的单位列表
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     objJCSJ              ：时间点
        '     objDWLB              ：单位列表
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getAllXingzhengZhuliDanwei( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef objDWLB As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objXJ As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getAllXingzhengZhuliDanwei = False
            objDWLB = Nothing
            strErrMsg = ""

            Try
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '准备缓冲区
                objDWLB = New System.Collections.Specialized.NameValueCollection

                '获取数据
                strSQL = ""
                strSQL = strSQL + " select 所属单位" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidZhuliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " group by 所属单位" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objXJ) = False Then
                    GoTo errProc
                End If

                '计算
                Dim intCount As Integer = 0
                Dim strXJRY As String = ""
                Dim i As Integer = 0
                With objXJ.Tables(0)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strXJRY = objPulicParameters.getObjectValue(.Rows(i).Item(0), "")

                        '加入
                        If objDWLB(strXJRY) Is Nothing Then
                            objDWLB.Add(strXJRY, strXJRY)
                        End If
                    Next
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getAllXingzhengZhuliDanwei = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员在指定时间点的所担任的职级
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     objJCSJ              ：时间点
        '     strZJDM              ：职级代码
        '     strZJMC              ：职级名称
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getRenyuanZhiji( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef strZJDM As String, _
            ByRef strZJMC As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objXJ As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getRenyuanZhiji = False
            strErrMsg = ""
            strZJDM = ""
            strZJMC = ""

            Try
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                strSQL = ""
                strSQL = strSQL + " select 职级代码,职级名称=dbo.uf_estate_rs_getZjmc(职级代码)" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + objJCSJ.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objXJ) = False Then
                    GoTo errProc
                End If

                '返回
                If objXJ.Tables(0) Is Nothing Then
                    Exit Try
                End If
                If objXJ.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If
                strZJDM = objPulicParameters.getObjectValue(objXJ.Tables(0).Rows(0)("职级代码"), "")
                strZJMC = objPulicParameters.getObjectValue(objXJ.Tables(0).Rows(0)("职级名称"), "")
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getRenyuanZhiji = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJ)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function













        '----------------------------------------------------------------
        ' 根据strWYBS和当前时间获取在架构中有定义的人员列表
        ' 只从管理架构获取数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWYBS                   ：唯一标识
        '     blnWYBS                   ：接口重载
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-01-04 重新设计
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY_In( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal blnWYBS As Boolean, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY_In = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY_In]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                Dim objTime As System.DateTime = Now

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.*," + vbCr
                        strSQL = strSQL + "     b.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.人员真名 as 上级领导名称," + vbCr
                        strSQL = strSQL + "     d.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     e.职级名称 as 职级名称," + vbCr
                        strSQL = strSQL + "     f.组织名称 as 直管单位名称," + vbCr
                        strSQL = strSQL + "     g.原因名称 as 变动原因名称," + vbCr
                        strSQL = strSQL + "     dbo.uf_estate_rs_getRYZTtoZGSXName(a.人员状态) as 人员状态名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from" + vbCr
                        strSQL = strSQL + "     (" + vbCr
                        strSQL = strSQL + "       select 1 as 人员类型,*" + vbCr
                        strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "     ) a" + vbCr
                        strSQL = strSQL + "     where a.唯一标识 = @wybs" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          c on a.上级领导 = c.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      d on a.所属单位 = d.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 e on a.职级代码 = e.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                        strSQL = strSQL + "   left join 人事_B_变动原因      g on a.变动原因 = g.原因代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempestateRenshiXingyeData
            getDataSet_RYJG_RY_In = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 对单个人员进行[内部调整处理]
        ' 适用于[管理架构]中的人员
        ' 基于现有事务处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objBDSJ              ：调整时间
        '     objOldData           ：调整前数据
        '     objNewData           ：调整后数据
        '     blnUseInNewData      ：True-变动原因从objNewData中获取,False-过程内默认
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改备注
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-05 更新
        '     zengxianglin 2010-03-19 更新
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objBDSJ As System.DateTime, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal blnUseInNewData As Boolean, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定事务！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整前的数据]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整后的数据]！"
                    GoTo errProc
                End If
                objSqlConnection = objSqlTransaction.Connection

                '获取新旧数据
                Dim strNewVals(23) As String
                strNewVals(0) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                strNewVals(1) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYDM), "")
                strNewVals(2) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")
                strNewVals(3) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJDM), "")
                strNewVals(4) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJMC), "")
                strNewVals(5) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZT), "")
                strNewVals(6) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZTMC), "")
                strNewVals(7) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDW), "")
                strNewVals(8) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDWMC), "")
                strNewVals(9) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSFZ), "")
                strNewVals(10) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFZB), "")
                strNewVals(11) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLD), "")
                strNewVals(12) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLDMC), "")
                strNewVals(13) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_KSSJ), "")
                strNewVals(14) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_JSSJ), "")
                strNewVals(15) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYY), "")
                strNewVals(16) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYYMC), "")
                strNewVals(17) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), "")
               
                strNewVals(18) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDW), "")
                strNewVals(19) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDWMC), "")
               
                
                strNewVals(20) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFJZ), "")
                strNewVals(21) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_TDBH), "")
                strNewVals(22) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGTD), "")
                strNewVals(23) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_XGTD), "")
                
                Dim strOldVals(23) As String
                strOldVals(0) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                strOldVals(1) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYDM), "")
                strOldVals(2) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")
                strOldVals(3) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJDM), "")
                strOldVals(4) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJMC), "")
                strOldVals(5) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZT), "")
                strOldVals(6) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZTMC), "")
                strOldVals(7) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDW), "")
                strOldVals(8) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDWMC), "")
                strOldVals(9) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSFZ), "")
                strOldVals(10) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFZB), "")
                strOldVals(11) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLD), "")
                strOldVals(12) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLDMC), "")
                strOldVals(13) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_KSSJ), "")
                strOldVals(14) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_JSSJ), "")
                strOldVals(15) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYY), "")
                strOldVals(16) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYYMC), "")
                strOldVals(17) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), "")
               
                strOldVals(18) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDW), "")
                strOldVals(19) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDWMC), "")
               
                
                strOldVals(20) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFJZ), "")
                strOldVals(21) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_TDBH), "")
                strOldVals(22) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGTD), "")
                strOldVals(23) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_XGTD), "")
                

                '统一设置变动原因代码
                Dim strBDYY As String = ""
                If blnUseInNewData = True Then
                    strBDYY = strNewVals(15)
                Else
                    strBDYY = Josco.JsKernal.Common.jsoaConfiguration.RS_NBTZ_CODE
                End If

                '检查变化
                Dim blnModifyAll As Boolean = False
                Dim blnModifyZJDM As Boolean = False
                Dim blnModifyRYZT As Boolean = False
                Dim blnModifySSDW As Boolean = False
                Dim blnModifySSFZ As Boolean = False
                Dim blnModifySFZB As Boolean = False
                Dim blnModifySJLD As Boolean = False
                Dim blnModifyTDBH As Boolean = False
                '================================================================
                If strNewVals(3) <> strOldVals(3) Then blnModifyZJDM = True
                If strNewVals(7) <> strOldVals(7) Then blnModifySSDW = True
                If strNewVals(9) <> strOldVals(9) Then blnModifySSFZ = True
                '================================================================
                If strNewVals(5) <> strOldVals(5) Then blnModifyRYZT = True
                If strNewVals(10) <> strOldVals(10) Then blnModifySFZB = True
                If strNewVals(11) <> strOldVals(11) Then blnModifySJLD = True
                '================================================================
                
                If strNewVals(21) <> strOldVals(21) Then blnModifyTDBH = True
                
                '================================================================

                '需要向[人事_B_人事异动]写信息？
                Dim blnNeedWrite As Boolean = False
                blnNeedWrite = blnModifyZJDM Or blnModifySSDW Or blnModifySSFZ Or blnModifyRYZT Or blnModifySFZB Or blnModifyTDBH
                
                'Dim strBzxx As String = ""
                ''人员状态变化
                'If strBzxx = "" Then
                '    strBzxx = strOldVals(6) + "→" + strNewVals(6)
                'Else
                '    strBzxx = strBzxx + "," + strOldVals(6) + "→" + strNewVals(6)
                'End If
                ''编外/编内变化
                'Dim strTempA As String = ""
                'Dim strTempB As String = ""
                'If strOldVals(10) = "1" Then
                '    strTempA = "编内人员"
                'Else
                '    strTempA = "编外人员"
                'End If
                'If strNewVals(10) = "1" Then
                '    strTempB = "编内人员"
                'Else
                '    strTempB = "编外人员"
                'End If
                'If strBzxx = "" Then
                '    strBzxx = strTempA + "→" + strTempB
                'Else
                '    strBzxx = strBzxx + "," + strTempA + "→" + strTempB
                'End If
                

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算新的GUID
                    Dim strNewId As String = objPulicParameters.getNewGuid()

                    'zengxianglin 2010-03-19
                    '写对应的直管团队数据
                    Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    Dim strZBBS As String = ""
                    Dim i, intCount As Integer
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    'zengxianglin 2010-03-19

                    'zengxianglin 2010-03-19
                    '写对应的协管团队数据
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    'zengxianglin 2010-03-19

                    '加入新记录
                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_人事_管理架构 (" + vbCr
                    strSQL = strSQL + "   唯一标识," + vbCr
                    strSQL = strSQL + "   人员代码," + vbCr
                    strSQL = strSQL + "   人员状态," + vbCr
                    strSQL = strSQL + "   是否占编," + vbCr
                    strSQL = strSQL + "   职级代码," + vbCr
                    strSQL = strSQL + "   所属单位," + vbCr
                    strSQL = strSQL + "   所属分组," + vbCr
                   
                    strSQL = strSQL + "   直管单位," + vbCr
                   
                    strSQL = strSQL + "   上级领导," + vbCr
                    strSQL = strSQL + "   生效时间," + vbCr
                    strSQL = strSQL + "   失效时间," + vbCr
                    
                    strSQL = strSQL + "   标准序列," + vbCr
                    strSQL = strSQL + "   团队编号," + vbCr
                    strSQL = strSQL + "   直管团队," + vbCr
                    strSQL = strSQL + "   协管团队," + vbCr
                    strSQL = strSQL + "   变动原因 " + vbCr
                    
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   @wybs," + vbCr
                    strSQL = strSQL + "   @rydm," + vbCr
                    strSQL = strSQL + "   @ryzt," + vbCr
                    strSQL = strSQL + "   @sfzb," + vbCr
                    strSQL = strSQL + "   @zjdm," + vbCr
                    strSQL = strSQL + "   @ssdw," + vbCr
                    strSQL = strSQL + "   @ssfz," + vbCr
                   
                    strSQL = strSQL + "   @zgdw," + vbCr
                   
                    strSQL = strSQL + "   @sjld," + vbCr
                    strSQL = strSQL + "   @kssj," + vbCr
                    strSQL = strSQL + "   null," + vbCr
                    
                    strSQL = strSQL + "   1," + vbCr
                    strSQL = strSQL + "   @tdbh," + vbCr
                    strSQL = strSQL + "   @zgtd," + vbCr
                    strSQL = strSQL + "   @xgtd," + vbCr
                    strSQL = strSQL + "   @bdyy " + vbCr
                    
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@wybs", strNewId)
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@ryzt", objPulicParameters.getObjectValue(strNewVals(5), 0))
                    objSqlCommand.Parameters.AddWithValue("@sfzb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                    objSqlCommand.Parameters.AddWithValue("@zjdm", strNewVals(3))
                    objSqlCommand.Parameters.AddWithValue("@ssdw", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                   
                    objSqlCommand.Parameters.AddWithValue("@zgdw", strNewVals(18))
                   
                    objSqlCommand.Parameters.AddWithValue("@sjld", strNewVals(11))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                    
                    objSqlCommand.Parameters.AddWithValue("@tdbh", objPulicParameters.getObjectValue(strNewVals(21), 0))
                    objSqlCommand.Parameters.AddWithValue("@zgtd", strNewVals(22))
                    objSqlCommand.Parameters.AddWithValue("@xgtd", strNewVals(23))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                    
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                   
                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                    strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                    strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@zzdm", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                   

                    '标记strWYBS的“失效时间”
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_人事_管理架构 set" + vbCr
                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                    objSqlCommand.Parameters.AddWithValue("@wybs", strOldVals(0))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    If blnNeedWrite = True Then
                        Dim intGWSX As Integer = 1

                        '让以前[人事_B_人事异动]失效
                        strSQL = ""
                        strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                        strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        strSQL = strSQL + " and   开始时间 <= @jssj" + vbCr
                        strSQL = strSQL + " and   终止时间 is null" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@rydm", strOldVals(1))
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                        '写新的[人事_B_人事异动]记录
                        strSQL = ""
                        strSQL = strSQL + " insert into 人事_B_人事异动 (" + vbCr
                        strSQL = strSQL + "   唯一标识,人员代码,开始时间,终止时间," + vbCr
                        strSQL = strSQL + "   关联标识,变动原因,任职单位,任职级别," + vbCr
                        strSQL = strSQL + "   所属分组,原属分组,原任单位,原任级别," + vbCr
                        strSQL = strSQL + "   备注信息,岗位属性," + vbCr
                        
                        strSQL = strSQL + "   原岗属性,本次占编,上次占编,职工属性,原职属性,原属团队,现属团队" + vbCr
                        
                        strSQL = strSQL + " ) values (" + vbCr
                        strSQL = strSQL + "   newid(), @rydm, @kssj, null," + vbCr
                        strSQL = strSQL + "   @glbs,   @bdyy, @rzdw, @rzjb," + vbCr
                        strSQL = strSQL + "   @ssfz,   @rsfz, @rrdw, @rrjb," + vbCr
                        strSQL = strSQL + "   @bzxx,   @gwsx," + vbCr
                        
                        strSQL = strSQL + "   @ygsx,   @bczb, @sczb, @zgsx, @yzsx, @ystd, @xstd" + vbCr
                        
                        strSQL = strSQL + " )" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@glbs", strNewId)
                        objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                        objSqlCommand.Parameters.AddWithValue("@rzdw", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rzjb", strNewVals(4))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rsfz", strOldVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rrdw", strOldVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rrjb", strOldVals(4))
                        objSqlCommand.Parameters.AddWithValue("@bzxx", "")
                        objSqlCommand.Parameters.AddWithValue("@gwsx", intGWSX)
                        
                        objSqlCommand.Parameters.AddWithValue("@ygsx", intGWSX)
                        objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@sczb", objPulicParameters.getObjectValue(strOldVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(objPulicParameters.getObjectValue(strNewVals(5), 0)))
                        objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(objPulicParameters.getObjectValue(strOldVals(5), 0)))
                        objSqlCommand.Parameters.AddWithValue("@xstd", objPulicParameters.getObjectValue(strNewVals(21), 0))
                        objSqlCommand.Parameters.AddWithValue("@ystd", objPulicParameters.getObjectValue(strOldVals(21), 0))
                        
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)

            '返回
            doAdjust_RenyuanJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 按指定信息将人员从架构中注销
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objEnvInfo           ：变动通用参数（BDLX,BDSJ,BDYY,BDYYMC）
        '     objMainInfo          ：主变动人当前人员架构参数
        '     objDataSet_XJ        ：受影响的直接下属调整后的信息
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-05 更新
        '----------------------------------------------------------------
        Public Function doDelete_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objEnvInfo As System.Collections.Specialized.NameValueCollection, _
            ByVal objMainInfo As System.Data.DataRow, _
            ByVal objDataSet_XJ As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objXJTmpData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objXJData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDelete_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objEnvInfo Is Nothing Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End If
                If objMainInfo Is Nothing Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]没有指定[离岗人员信息]！"
                    GoTo errProc
                End If

                '获取环境参数
                Dim objBDSJ As System.DateTime
                Dim strBDYY As String = ""
                Dim intBDLX As Integer
                Try
                    intBDLX = objPulicParameters.getObjectValue(objEnvInfo("BDLX"), 0)
                    objBDSJ = CType(objEnvInfo("BDSJ"), System.DateTime)
                    strBDYY = objEnvInfo("BDYY")
                Catch ex As Exception
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End Try

                '获取主变动人参数
                Dim strRYDM As String = ""
                Dim strWYBS As String = ""
                Dim strSSDW As String = ""
                Dim strZJMC As String = ""
                Dim strSSFZ As String = ""
                Dim intRYLX As Integer
                strWYBS = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                strRYDM = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYDM), "")
                strSSDW = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDW), "")
                strZJMC = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJMC), "")
                strSSFZ = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSFZ), "")
                intRYLX = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), 0)
                
                Dim intRYZT As Integer
                Dim intSFZB As Integer
                Dim intTDBH As Integer
                intRYZT = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZT), 0)
                intSFZB = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFZB), 0)
                intTDBH = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_TDBH), 0)
                

                '计算下属人员的旧数据
                Dim objDataRow As System.Data.DataRow = Nothing
                Dim strWYBS_XJ As String = ""
                Dim strRYMC_XJ As String = ""
                Dim strFilter As String = ""
                Dim intCount As Integer = 0
                Dim intCols As Integer = 0
                Dim i As Integer = 0
                Dim j As Integer = 0
                If intRYLX = 1 Then
                    If Not (objDataSet_XJ Is Nothing) Then
                        If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                            With objDataSet_XJ.Tables(strTable).DefaultView
                                intCount = .Count
                                For i = 0 To intCount - 1 Step 1
                                    strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                    strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                    '获取下级原数据！
                                    If Me.getDataSet_RYJG_RY_In(strErrMsg, strUserId, strPassword, strWYBS_XJ, True, objXJTmpData) = False Then
                                        GoTo errProc
                                    End If
                                    If objXJTmpData.Tables(strTable) Is Nothing Then
                                        strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                        GoTo errProc
                                    End If
                                    If objXJTmpData.Tables(strTable).Rows.Count < 1 Then
                                        strErrMsg = "错误：没有[" + strRYMC_XJ + "]的数据！"
                                        GoTo errProc
                                    End If
                                    If objXJTmpData.Tables(strTable).Rows.Count > 1 Then
                                        strErrMsg = "错误：[" + strRYMC_XJ + "]的数据不唯一！"
                                        GoTo errProc
                                    End If

                                    '保存数据
                                    If objXJData Is Nothing Then
                                        objXJData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)
                                    End If
                                    objDataRow = objXJData.Tables(strTable).NewRow
                                    intCols = objXJTmpData.Tables(strTable).Columns.Count
                                    For j = 0 To intCols - 1 Step 1
                                        objDataRow.Item(j) = objXJTmpData.Tables(strTable).Rows(0).Item(j)
                                    Next
                                    objXJData.Tables(strTable).Rows.Add(objDataRow)

                                    '释放资源
                                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJTmpData)
                                Next
                            End With
                        End If
                    End If
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intGWSX As Integer = 0
                Dim strGLBS As String = ""
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    Select Case intBDLX
                        Case 0, 1
                            '离开单位 或 离开业务岗位

                            '注销“地产_B_人事_管理架构”
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_管理架构 set " + vbCr
                            strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   失效时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '注销“地产_B_人事_助理架构”
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_助理架构 set " + vbCr
                            strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   失效时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '写对应人员的人事异动记录的“终止时间”
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   开始时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   终止时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                           
                            If intBDLX = 0 Then
                                Dim intDefVal As Integer = 0
                                '自动更新[公共_B_人员]中的[是否有效]=0
                                strSQL = ""
                                strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                                strSQL = strSQL + "   是否有效 = @sfyx" + vbCr
                                strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                                objSqlCommand.Parameters.AddWithValue("@sfyx", intDefVal)
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If
                           

                            '记新的“人事_B_人事异动”
                            If intBDLX = 0 Then
                                '发生人员增减！
                                intGWSX = 0
                                strGLBS = ""
                                strSQL = ""
                                strSQL = strSQL + " insert into 人事_B_人事异动 ("
                                
                                strSQL = strSQL + "   唯一标识," + vbCr
                                strSQL = strSQL + "   人员代码,开始时间,关联标识,变动原因," + vbCr
                                strSQL = strSQL + "   任职单位,原任单位," + vbCr
                                strSQL = strSQL + "   任职级别,原任级别," + vbCr
                                strSQL = strSQL + "   职工属性,原职属性," + vbCr
                                strSQL = strSQL + "   岗位属性,原岗属性," + vbCr
                                strSQL = strSQL + "   所属分组,原属分组," + vbCr
                                strSQL = strSQL + "   本次占编,上次占编," + vbCr
                                strSQL = strSQL + "   现属团队,原属团队 " + vbCr
                                
                                strSQL = strSQL + " ) values ("
                                
                                strSQL = strSQL + "   newid(), "
                                strSQL = strSQL + "   @rydm, @kssj, @glbs, @bdyy," + vbCr
                                strSQL = strSQL + "   ' '  , @yrdw," + vbCr
                                strSQL = strSQL + "   ' '  , @yrjb," + vbCr
                                strSQL = strSQL + "   ' '  , @yzsx," + vbCr
                                strSQL = strSQL + "   0    , 1," + vbCr
                                strSQL = strSQL + "   ' '  , @ysfz," + vbCr
                                strSQL = strSQL + "   0    , @sczb," + vbCr
                                strSQL = strSQL + "   0    , @ystd" + vbCr
                                
                                strSQL = strSQL + " )" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                                objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                                objSqlCommand.Parameters.AddWithValue("@glbs", strGLBS)
                                objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                                objSqlCommand.Parameters.AddWithValue("@yrdw", strSSDW)  '单位代码
                                objSqlCommand.Parameters.AddWithValue("@yrjb", strZJMC)  '级别名称
                                objSqlCommand.Parameters.AddWithValue("@ysfz", strSSFZ)  '分组名称
                                objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(intRYZT))
                                objSqlCommand.Parameters.AddWithValue("@sczb", intSFZB)
                                objSqlCommand.Parameters.AddWithValue("@ystd", intTDBH)
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If

                        Case Else
                            '离开当前岗位,不发生人员增减

                            '注销strWYBS
                            Select Case intRYLX
                                Case 0
                                    '注销“地产_B_人事_助理架构”
                                    strSQL = ""
                                    strSQL = strSQL + " update 地产_B_人事_助理架构 set " + vbCr
                                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                    strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                                    strSQL = strSQL + " and   失效时间 is null" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                                    objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Case 1
                                    '注销“地产_B_人事_管理架构”
                                    strSQL = ""
                                    strSQL = strSQL + " update 地产_B_人事_管理架构 set " + vbCr
                                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                    strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                                    strSQL = strSQL + " and   失效时间 is null" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                                    objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                            End Select
                            '写对应的人事异动记录的“终止时间”
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 关联标识 = @wybs" + vbCr
                            strSQL = strSQL + " and   开始时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   终止时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '不记新的“人事_B_人事异动”
                    End Select

                    '处理下属的“上级领导”信息
                    If intRYLX = 1 Then
                        If Not (objDataSet_XJ Is Nothing) Then
                            If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                                With objDataSet_XJ.Tables(strTable).DefaultView
                                    intCount = .Count
                                    For i = 0 To intCount - 1 Step 1
                                        strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                        strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                        '获取下级原数据！
                                        strFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS + " = '" + strWYBS_XJ + "'"
                                        objXJData.Tables(strTable).DefaultView.RowFilter = strFilter
                                        If objXJData.Tables(strTable).DefaultView.Count < 1 Then
                                            strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                            GoTo rollback
                                        End If

                                        '对当前人员进行[内部调整]处理
                                        If Me.doAdjust_RenyuanJiagou(strErrMsg, objSqlTransaction, objBDSJ, objXJData.Tables(strTable).DefaultView.Item(0).Row, .Item(i).Row, True, Nothing) = False Then
                                            GoTo rollback
                                        End If
                                    Next
                                End With
                            End If
                        End If
                    End If
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDelete_RenyuanJiagou = True
            Exit Function
rollback:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查入职输入的时间有效性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     intRYLX              ：人员类型(1-业务人员，0-行政助理)
        '     strRYDM              ：人员代码
        '     strRYMC              ：人员名称
        '     strSSDW              ：所属单位代码
        '     strBDSJ              ：变动时间
        '     blnValid             ：返回True-有效 False-无效
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 变更说明
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2009-12-31 创建
        '----------------------------------------------------------------
        Public Function doValidParamsJG_Add( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intRYLX As Integer, _
            ByVal strRYDM As String, _
            ByVal strRYMC As String, _
            ByVal strSSDW As String, _
            ByVal strBDSJ As String, _
            ByRef blnValid As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            doValidParamsJG_Add = False
            blnValid = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYMC Is Nothing Then strRYMC = ""
                strRYMC = strRYMC.Trim
                If strSSDW Is Nothing Then strSSDW = ""
                strSSDW = strSSDW.Trim
                If strBDSJ Is Nothing Then strBDSJ = ""
                strBDSJ = strBDSJ.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                'zengxianglin 2009-12-31
                '检查是否与标准一的执行时期一致？
                Dim intBZXL As Integer
                If Me.getBZXL_RSJG(strErrMsg, strUserId, strPassword, strBDSJ, intBZXL) = False Then
                    GoTo errProc
                End If
                If intBZXL <> 1 Then
                    strErrMsg = "错误：[" + strBDSJ + "]不在人事管理模式一所在的有效期内！"
                    GoTo errProc
                End If
                'zengxianglin 2009-12-31

                '计算
                Dim strMaxSXSJ As String = ""
                Dim intRows As Integer
                Select Case intRYLX
                    Case 1    '业务人员
                        '判断原则：
                        '  该人有定义：
                        '    (1)如果有正在生效的记录，则错误！ 
                        '    (2)如果没有正在生效的记录，则日期必须大于最大失效时间！ 
                        '    (3)其他为有效 
                        '  该人未定义：
                        '     有效

                        '存在？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows < 1 Then
                            blnValid = True
                            Exit Try
                        End If

                        '生效？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   失效时间 is null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows > 0 Then
                            strErrMsg = "错误：[" + strRYMC + "]已经定义过！"
                            blnValid = False
                            Exit Try
                        End If

                        '时间正确？
                        strSQL = ""
                        strSQL = strSQL + " select max(失效时间) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        strMaxSXSJ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd hh:mm:ss")
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If CType(strBDSJ, System.DateTime) <= CType(strMaxSXSJ, System.DateTime) Then
                            strErrMsg = "错误：[" + strRYMC + "]只能在[" + strMaxSXSJ + "]时间以后！"
                            blnValid = False
                            Exit Try
                        End If

                        blnValid = True

                    Case Else '行政助理
                        '判断原则：
                        '  该人该单位有定义：
                        '    (1)如果有正在生效的记录，则错误！ 
                        '    (2)如果没有正在生效的记录，则日期必须大于最大失效时间！ 
                        '    (3)其他为有效 
                        '  该人该单位未定义：
                        '     有效

                        '存在？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows < 1 Then
                            blnValid = True
                            Exit Try
                        End If

                        '生效？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        strSQL = strSQL + " and   失效时间 is null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows > 0 Then
                            strErrMsg = "错误：[" + strRYMC + "]已经定义过！"
                            blnValid = False
                            Exit Try
                        End If

                        '时间正确？
                        strSQL = ""
                        strSQL = strSQL + " select max(失效时间) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        strMaxSXSJ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd hh:mm:ss")
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If CType(strBDSJ, System.DateTime) <= CType(strMaxSXSJ, System.DateTime) Then
                            strErrMsg = "错误：[" + strRYMC + "]只能在[" + strMaxSXSJ + "]时间以后！"
                            blnValid = False
                            Exit Try
                        End If

                        blnValid = True
                End Select
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doValidParamsJG_Add = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 对单个人员进行[内部调整处理]
        ' 适用于[管理架构]和[助理架构]中的人员
        ' 基于现有事务处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objBDSJ              ：调整时间
        '     objOldData           ：调整前数据
        '     objNewData           ：调整后数据
        '     blnUseInNewData      ：True-变动原因从objNewData中获取,False-过程内默认
        '     blnUnused            ：接口重载
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-05 更改
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objBDSJ As System.DateTime, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal blnUseInNewData As Boolean, _
            ByVal blnUnused As Boolean, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定事务！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整前的数据]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整后的数据]！"
                    GoTo errProc
                End If
                objSqlConnection = objSqlTransaction.Connection

                '获取新旧数据
                Dim strNewVals(21) As String
                strNewVals(0) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                strNewVals(1) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYDM), "")
                strNewVals(2) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")
                strNewVals(3) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJDM), "")
                strNewVals(4) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJMC), "")
                strNewVals(5) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZT), "")
                strNewVals(6) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZTMC), "")
                strNewVals(7) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDW), "")
                strNewVals(8) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDWMC), "")
                strNewVals(9) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSFZ), "")
                strNewVals(10) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFZB), "")
                strNewVals(11) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLD), "")
                strNewVals(12) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLDMC), "")
                strNewVals(13) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_KSSJ), "")
                strNewVals(14) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_JSSJ), "")
                strNewVals(15) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYY), "")
                strNewVals(16) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYYMC), "")
                strNewVals(17) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), "")
               
                strNewVals(18) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDW), "")
                strNewVals(19) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDWMC), "")
               
                
                strNewVals(20) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFJZ), "")
                strNewVals(21) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_TDBH), "")
                
                Dim strOldVals(21) As String
                strOldVals(0) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                strOldVals(1) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYDM), "")
                strOldVals(2) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")
                strOldVals(3) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJDM), "")
                strOldVals(4) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZJMC), "")
                strOldVals(5) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZT), "")
                strOldVals(6) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYZTMC), "")
                strOldVals(7) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDW), "")
                strOldVals(8) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSDWMC), "")
                strOldVals(9) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SSFZ), "")
                strOldVals(10) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFZB), "")
                strOldVals(11) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLD), "")
                strOldVals(12) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SJLDMC), "")
                strOldVals(13) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_KSSJ), "")
                strOldVals(14) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_JSSJ), "")
                strOldVals(15) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYY), "")
                strOldVals(16) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_YDYYMC), "")
                strOldVals(17) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), "")
               
                strOldVals(18) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDW), "")
                strOldVals(19) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_ZGDWMC), "")
               
                
                strOldVals(20) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_SFJZ), "")
                strOldVals(21) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_TDBH), "")
                

                '如果是[管理架构]人员，则
                Dim intRYLX As Integer
                intRYLX = objPulicParameters.getObjectValue(strOldVals(17), 1)
                If intRYLX = 1 Then
                    If Me.doAdjust_RenyuanJiagou(strErrMsg, objSqlTransaction, objBDSJ, objOldData, objNewData, True, objDataSet_TDZH) = False Then
                        GoTo errProc
                    End If
                    Exit Try
                End If

                '统一设置变动原因代码
                Dim strBDYY As String = ""
                If blnUseInNewData = True Then
                    strBDYY = strNewVals(15)
                Else
                    strBDYY = Josco.JsKernal.Common.jsoaConfiguration.RS_NBTZ_CODE
                End If

                '检查变化
                Dim blnModifyAll As Boolean = False
                Dim blnModifyZJDM As Boolean = False
                Dim blnModifyRYZT As Boolean = False
                Dim blnModifySSDW As Boolean = False
                Dim blnModifySSFZ As Boolean = False
                Dim blnModifySFZB As Boolean = False
                Dim blnModifySJLD As Boolean = False
                Dim blnModifyTDBH As Boolean = False
                '================================================================
                If strNewVals(3) <> strOldVals(3) Then blnModifyZJDM = True
                If strNewVals(7) <> strOldVals(7) Then blnModifySSDW = True
                If strNewVals(9) <> strOldVals(9) Then blnModifySSFZ = True
                '================================================================
                If strNewVals(5) <> strOldVals(5) Then blnModifyRYZT = True
                If strNewVals(10) <> strOldVals(10) Then blnModifySFZB = True
                If strNewVals(11) <> strOldVals(11) Then blnModifySJLD = True
                '================================================================
                
                If strNewVals(21) <> strOldVals(21) Then blnModifyTDBH = True
                
                '================================================================

                '需要向[人事_B_人事异动]写信息？
                Dim blnNeedWrite As Boolean = False
                blnNeedWrite = blnModifyZJDM Or blnModifySSDW Or blnModifySSFZ Or blnModifyRYZT Or blnModifySFZB
                
                'Dim strBzxx As String = ""
                ''人员状态变化
                'If strBzxx = "" Then
                '    strBzxx = strOldVals(6) + "→" + strNewVals(6)
                'Else
                '    strBzxx = strBzxx + "," + strOldVals(6) + "→" + strNewVals(6)
                'End If
                ''编外/编内变化
                'Dim strTempA As String = ""
                'Dim strTempB As String = ""
                'If strOldVals(10) = "1" Then
                '    strTempA = "编内人员"
                'Else
                '    strTempA = "编外人员"
                'End If
                'If strNewVals(10) = "1" Then
                '    strTempB = "编内人员"
                'Else
                '    strTempB = "编外人员"
                'End If
                'If strBzxx = "" Then
                '    strBzxx = strTempA + "→" + strTempB
                'Else
                '    strBzxx = strBzxx + "," + strTempA + "→" + strTempB
                'End If
                

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算新的GUID
                    Dim strNewId As String = objPulicParameters.getNewGuid()

                    '加入新记录
                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_人事_助理架构 (" + vbCr
                    strSQL = strSQL + "   唯一标识," + vbCr
                    strSQL = strSQL + "   人员代码," + vbCr
                    strSQL = strSQL + "   人员状态," + vbCr
                    strSQL = strSQL + "   是否占编," + vbCr
                    strSQL = strSQL + "   职级代码," + vbCr
                    strSQL = strSQL + "   所属单位," + vbCr
                    strSQL = strSQL + "   生效时间," + vbCr
                    strSQL = strSQL + "   失效时间," + vbCr
                    
                    strSQL = strSQL + "   标准序列," + vbCr
                    strSQL = strSQL + "   是否兼职," + vbCr
                    strSQL = strSQL + "   变动原因 " + vbCr
                    
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   @wybs," + vbCr
                    strSQL = strSQL + "   @rydm," + vbCr
                    strSQL = strSQL + "   @ryzt," + vbCr
                    strSQL = strSQL + "   @sfzb," + vbCr
                    strSQL = strSQL + "   @zjdm," + vbCr
                    strSQL = strSQL + "   @ssdw," + vbCr
                    strSQL = strSQL + "   @kssj," + vbCr
                    strSQL = strSQL + "   null," + vbCr
                    
                    strSQL = strSQL + "   1," + vbCr
                    strSQL = strSQL + "   @sfjz," + vbCr
                    strSQL = strSQL + "   @bdyy " + vbCr
                    
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@wybs", strNewId)
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@ryzt", objPulicParameters.getObjectValue(strNewVals(5), 0))
                    objSqlCommand.Parameters.AddWithValue("@sfzb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                    objSqlCommand.Parameters.AddWithValue("@zjdm", strNewVals(3))
                    objSqlCommand.Parameters.AddWithValue("@ssdw", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                    
                    objSqlCommand.Parameters.AddWithValue("@sfjz", objPulicParameters.getObjectValue(strNewVals(20), 0))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                    
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    
                    '写对应的直管团队数据
                    Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    Dim strZBBS As String = ""
                    Dim i, intCount As Integer
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    

                    
                    '写对应的协管团队数据
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    

                   
                    If strNewVals(20) <> "1" Then
                        '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                        strSQL = ""
                        strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                        strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                        strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@zzdm", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", "")
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                   

                    '标记strWYBS的“失效时间”
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_人事_助理架构 set" + vbCr
                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                    objSqlCommand.Parameters.AddWithValue("@wybs", strOldVals(0))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    If blnNeedWrite = True Then
                        Dim intGWSX As Integer = 1

                        '让以前[人事_B_人事异动]失效
                        strSQL = ""
                        strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                        strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        strSQL = strSQL + " and   开始时间 <= @jssj" + vbCr
                        strSQL = strSQL + " and   终止时间 is null" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@rydm", strOldVals(1))
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                        '写新的[人事_B_人事异动]记录
                        strSQL = ""
                        strSQL = strSQL + " insert into 人事_B_人事异动 (" + vbCr
                        strSQL = strSQL + "   唯一标识,人员代码,开始时间,终止时间," + vbCr
                        strSQL = strSQL + "   关联标识,变动原因,任职单位,任职级别," + vbCr
                        strSQL = strSQL + "   所属分组,原属分组,原任单位,原任级别," + vbCr
                        strSQL = strSQL + "   备注信息,岗位属性," + vbCr
                        
                        strSQL = strSQL + "   本次占编,上次占编,原岗属性,职工属性,原职属性,原属团队,现属团队" + vbCr
                        
                        strSQL = strSQL + " ) values (" + vbCr
                        strSQL = strSQL + "   newid(), @rydm, @kssj, null," + vbCr
                        strSQL = strSQL + "   @glbs,   @bdyy, @rzdw, @rzjb," + vbCr
                        strSQL = strSQL + "   @ssfz,   @rsfz, @rrdw, @rrjb," + vbCr
                        strSQL = strSQL + "   @bzxx,   @gwsx," + vbCr
                        
                        strSQL = strSQL + "   @bczb,   @sczb, @ygsx, @zgsx, @yzsx, @ystd, @xstd" + vbCr
                        
                        strSQL = strSQL + " )" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@glbs", strNewId)
                        objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                        objSqlCommand.Parameters.AddWithValue("@rzdw", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rzjb", strNewVals(4))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rsfz", strOldVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rrdw", strOldVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rrjb", strOldVals(4))
                        objSqlCommand.Parameters.AddWithValue("@bzxx", "")
                        objSqlCommand.Parameters.AddWithValue("@gwsx", intGWSX)
                        
                        objSqlCommand.Parameters.AddWithValue("@ygsx", intGWSX)
                        objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@sczb", objPulicParameters.getObjectValue(strOldVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strNewVals(5), Integer)))
                        objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strOldVals(5), Integer)))
                        objSqlCommand.Parameters.AddWithValue("@xstd", objPulicParameters.getObjectValue(strNewVals(21), 0))
                        objSqlCommand.Parameters.AddWithValue("@ystd", objPulicParameters.getObjectValue(strOldVals(21), 0))
                        
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)

            '返回
            doAdjust_RenyuanJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 按指定的信息调整人员架构
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objEnvInfo           ：变动通用参数（BDSJ,BDYY,BDYYMC）
        '     objOldData           ：主变动人旧数据
        '     objNewData           ：主变动人新数据
        '     objDataSet_XJ        ：要调整的下级人员信息列表
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-05 更新
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objEnvInfo As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal objDataSet_XJ As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objOldXJTmpData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objOldXJData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objEnvInfo Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[主变动人]数据！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[主变动人]数据！"
                    GoTo errProc
                End If

                '获取环境参数
                Dim objBDSJ As System.DateTime
                Dim strBDYY As String = ""
                Try
                    objBDSJ = CType(objEnvInfo("BDSJ"), System.DateTime)
                    strBDYY = objEnvInfo("BDYY")
                Catch ex As Exception
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End Try

                '计算下级的旧数据
                Dim objDataRow As System.Data.DataRow = Nothing
                Dim strWYBS_XJ As String = ""
                Dim strRYMC_XJ As String = ""
                Dim strFilter As String = ""
                Dim intCount As Integer = 0
                Dim intCols As Integer = 0
                Dim i As Integer = 0
                Dim j As Integer = 0
                If Not (objDataSet_XJ Is Nothing) Then
                    If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                        With objDataSet_XJ.Tables(strTable).DefaultView
                            intCount = .Count
                            For i = 0 To intCount - 1 Step 1
                                strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                '获取下级原数据！
                                If Me.getDataSet_RYJG_RY_In(strErrMsg, strUserId, strPassword, strWYBS_XJ, True, objOldXJTmpData) = False Then
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable) Is Nothing Then
                                    strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable).Rows.Count < 1 Then
                                    strErrMsg = "错误：没有[" + strRYMC_XJ + "]的数据！"
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable).Rows.Count > 1 Then
                                    strErrMsg = "错误：[" + strRYMC_XJ + "]的数据不唯一！"
                                    GoTo errProc
                                End If

                                '保存数据
                                If objOldXJData Is Nothing Then
                                    objOldXJData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)
                                End If
                                objDataRow = objOldXJData.Tables(strTable).NewRow
                                intCols = objOldXJTmpData.Tables(strTable).Columns.Count
                                For j = 0 To intCols - 1 Step 1
                                    objDataRow.Item(j) = objOldXJTmpData.Tables(strTable).Rows(0).Item(j)
                                Next
                                objOldXJData.Tables(strTable).Rows.Add(objDataRow)

                                '释放资源
                                Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
                            Next
                        End With
                    End If
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '对主变动人进行处理
                    If Me.doAdjust_RenyuanJiagou(strErrMsg, objSqlTransaction, objBDSJ, objOldData, objNewData, True, True, objDataSet_TDZH) = False Then
                        GoTo rollback
                    End If

                    '对下级逐个进行变动处理
                    If Not (objDataSet_XJ Is Nothing) Then
                        If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                            With objDataSet_XJ.Tables(strTable).DefaultView
                                intCount = .Count
                                For i = 0 To intCount - 1 Step 1
                                    strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                    strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                    '获取下级原数据！
                                    strFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS + " = '" + strWYBS_XJ + "'"
                                    objOldXJData.Tables(strTable).DefaultView.RowFilter = strFilter
                                    If objOldXJData.Tables(strTable).DefaultView.Count < 1 Then
                                        strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                        GoTo rollback
                                    End If

                                    '对当前人员进行[内部调整]处理
                                    If Me.doAdjust_RenyuanJiagou(strErrMsg, objSqlTransaction, objBDSJ, objOldXJData.Tables(strTable).DefaultView.Item(0).Row, .Item(i).Row, True, objDataSet_TDZH) = False Then
                                        GoTo rollback
                                    End If
                                Next
                            End With
                        End If
                    End If
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doAdjust_RenyuanJiagou = True
            Exit Function
rollback:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定时间点的指定职级序列集中各序列的人员架构的最大人员数目数据集
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objTime                   ：时间点
        '     strZJLIST                 ：职级列表(标准SQL列表格式)
        '     intMaxCount               ：最大数目
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '----------------------------------------------------------------
        Public Function getRYJG_MaxRYSM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objTime As System.DateTime, _
            ByVal strZJLIST As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getRYJG_MaxRYSM = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getRYJG_MaxRYSM]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_ZHIJIMAXRENYUAN)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getRenyuanJiagou_RYSM_max(@jcsj, @zjlist) a" + vbCr
                        strSQL = strSQL + " order by a.序列号码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        objSqlCommand.Parameters.AddWithValue("@zjlist", strZJLIST)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_ZHIJIMAXRENYUAN))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getRYJG_MaxRYSM = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取在架构中有定义的人员列表(仅含管理架构中的人员)
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     blnOnlyGLJG               ：接口重载
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-01-04 重新设计
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_RY_In( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal blnOnlyGLJG As Boolean, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_RY_In = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_RY_In]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                Dim objTime As System.DateTime = Now

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.*," + vbCr
                        strSQL = strSQL + "     b.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.人员真名 as 上级领导名称," + vbCr
                        strSQL = strSQL + "     d.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     e.职级名称 as 职级名称," + vbCr
                        strSQL = strSQL + "     f.组织名称 as 直管单位名称," + vbCr
                        strSQL = strSQL + "     g.原因名称 as 变动原因名称," + vbCr
                        strSQL = strSQL + "     dbo.uf_estate_rs_getRYZTtoZGSXName(a.人员状态) as 人员状态名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 1 as 人员类型,*" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          c on a.上级领导 = c.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      d on a.所属单位 = d.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 e on a.职级代码 = e.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                        strSQL = strSQL + "   left join 人事_B_变动原因      g on a.变动原因 = g.原因代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", objTime)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_RYJG_RY_In = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取在架构中有定义的人员列表(包括管理架构和助理架构)
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：(返回)信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-01-04 重新设计
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.*," + vbCr
                        strSQL = strSQL + "     b.人员真名 as 人员名称," + vbCr
                        strSQL = strSQL + "     c.人员真名 as 上级领导名称," + vbCr
                        strSQL = strSQL + "     d.组织名称 as 所属单位名称," + vbCr
                        strSQL = strSQL + "     e.职级名称 as 职级名称," + vbCr
                        strSQL = strSQL + "     f.组织名称 as 直管单位名称," + vbCr
                        strSQL = strSQL + "     g.原因名称 as 变动原因名称," + vbCr
                        strSQL = strSQL + "     dbo.uf_estate_rs_getRYZTtoZGSXName(a.人员状态) as 人员状态名称" + vbCr
                        strSQL = strSQL + "   from 地产_V_人事_人员架构      a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.人员代码 = b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          c on a.上级领导 = c.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      d on a.所属单位 = d.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 e on a.职级代码 = e.职级代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      f on a.直管单位 = f.组织代码" + vbCr
                        strSQL = strSQL + "   left join 人事_B_变动原因      g on a.变动原因 = g.原因代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.人员代码,a.生效时间,a.失效时间 desc" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_RYJG = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_管理架构”的数据(现有事务)
        ' 适用管理模式一、二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-04 更改
        '----------------------------------------------------------------
        Public Function doSaveData_RYJG_GLJG( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_RYJG_GLJG = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列
                                       
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                       

                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_管理架构 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列
                                       
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                       

                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                                        'zengxianglin 2010-01-04
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                                        'zengxianglin 2010-01-04
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列
                                       
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                       
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_管理架构 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列
                                       
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                       
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                                        'zengxianglin 2010-01-04
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                                        'zengxianglin 2010-01-04
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                            'zengxianglin 2010-01-04
                            '自动更新[人事_B_人事异动]对应内容
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   关联标识 = @wybs," + vbCr
                            strSQL = strSQL + "   人员代码 = @rydm," + vbCr
                            strSQL = strSQL + "   开始时间 = @kssj," + vbCr
                            strSQL = strSQL + "   终止时间 = @zzsj," + vbCr
                            strSQL = strSQL + "   变动原因 = @ydyy," + vbCr
                            strSQL = strSQL + "   任职单位 = @rzdw," + vbCr
                            strSQL = strSQL + "   任职级别 = @rzjb," + vbCr
                            strSQL = strSQL + "   职工属性 = @zgsx," + vbCr
                            strSQL = strSQL + "   所属分组 = @ssfz," + vbCr
                            strSQL = strSQL + "   本次占编 = @bczb," + vbCr
                            strSQL = strSQL + "   现属团队 = @xstd " + vbCr
                            strSQL = strSQL + " where 关联标识 = @oldwybs" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@wybs", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS), ""))
                            objSqlCommand.Parameters.AddWithValue("@rydm", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM), ""))
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@kssj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@kssj", CType(strValue, System.DateTime))
                            End If
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@zzsj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@zzsj", CType(strValue, System.DateTime))
                            End If
                            objSqlCommand.Parameters.AddWithValue("@ydyy", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_YDYY), ""))
                            objSqlCommand.Parameters.AddWithValue("@rzdw", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW), ""))
                            objSqlCommand.Parameters.AddWithValue("@rzjb", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC), ""))
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT), "0")
                            objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strValue, Integer)))
                            objSqlCommand.Parameters.AddWithValue("@ssfz", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ), ""))
                            objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB), 0))
                            objSqlCommand.Parameters.AddWithValue("@xstd", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH), 0))
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            'zengxianglin 2010-01-04
                    End Select

                   
                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                    strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                    strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM), ""))
                    objSqlCommand.Parameters.AddWithValue("@zzdm", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW), ""))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ), ""))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                   

                    
                    '写对应的直管团队数据
                    Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    Dim strZBBS As String = ""
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    

                    
                    '写对应的协管团队数据
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If
                    
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_RYJG_GLJG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_助理架构”的数据(现有事务)
        ' 适用管理模式一、二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-04 更改
        '----------------------------------------------------------------
        Public Function doSaveData_RYJG_ZLJG( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_RYJG_ZLJG = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intValue As Integer
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_助理架构 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                                        'zengxianglin 2010-01-04
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                                        'zengxianglin 2010-01-04
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_助理架构 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                                        'zengxianglin 2010-01-04
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL, _
                                        'Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                                        'zengxianglin 2010-01-04
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                            'zengxianglin 2010-01-04
                            '自动更新[人事_B_人事异动]对应内容
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   关联标识 = @wybs," + vbCr
                            strSQL = strSQL + "   人员代码 = @rydm," + vbCr
                            strSQL = strSQL + "   开始时间 = @kssj," + vbCr
                            strSQL = strSQL + "   终止时间 = @zzsj," + vbCr
                            strSQL = strSQL + "   变动原因 = @ydyy," + vbCr
                            strSQL = strSQL + "   任职单位 = @rzdw," + vbCr
                            strSQL = strSQL + "   任职级别 = @rzjb," + vbCr
                            strSQL = strSQL + "   职工属性 = @zgsx," + vbCr
                            strSQL = strSQL + "   所属分组 = @ssfz," + vbCr
                            strSQL = strSQL + "   本次占编 = @bczb," + vbCr
                            strSQL = strSQL + "   现属团队 = @xstd " + vbCr
                            strSQL = strSQL + " where 关联标识 = @oldwybs" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@wybs", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_WYBS), ""))
                            objSqlCommand.Parameters.AddWithValue("@rydm", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM), ""))
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@kssj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@kssj", CType(strValue, System.DateTime))
                            End If
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@zzsj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@zzsj", CType(strValue, System.DateTime))
                            End If
                            objSqlCommand.Parameters.AddWithValue("@ydyy", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_YDYY), ""))
                            objSqlCommand.Parameters.AddWithValue("@rzdw", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDW), ""))
                            objSqlCommand.Parameters.AddWithValue("@rzjb", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC), ""))
                            strValue = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT), "0")
                            objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strValue, Integer)))
                            objSqlCommand.Parameters.AddWithValue("@ssfz", "")
                            objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB), 0))
                            intValue = 0
                            objSqlCommand.Parameters.AddWithValue("@xstd", intValue)
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            'zengxianglin 2010-01-04
                    End Select

                    'zengxianglin 2010-01-04
                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    Dim intSFJZ As Integer = 0
                    intSFJZ = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ), 0)
                    If intSFJZ = 0 Then
                        strSQL = ""
                        strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                        strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                        strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM))
                        objSqlCommand.Parameters.AddWithValue("@zzdm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDW))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", "")
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                    'zengxianglin 2010-01-04
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_RYJG_ZLJG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_管理架构”或“地产_B_人事_助理架构”数据记录(整个事务完成)
        ' 适用管理模式一、二
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(TABLE_DC_V_RS_RENYUANJIAGOU记录格式)
        '     objOldData             ：记录旧值(TABLE_DC_V_RS_RENYUANJIAGOU记录格式)
        '     objenumEditType        ：编辑类型
        '     objDataSet_TDZH        ：团队组合缓存数据
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-04 重新设计
        '----------------------------------------------------------------
        Public Function doSaveData_RYJG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objNewVals As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_RYJG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：未传入连接用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '计算人员类型
                Dim intRYLX As Integer = 0
                intRYLX = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), 0)

                '准备保存的数据
                Dim strFName As String = ""
                objNewVals = New System.Collections.Specialized.NameValueCollection
                Select Case intRYLX
                    Case 1     '管理架构
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJDM
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))

                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLD
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDW
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))

                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "0"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_YDYY
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))

                    Case Else  '助理架构
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_WYBS
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJDM
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDW
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))

                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "1"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), "0"))
                        strFName = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_YDYY
                        objNewVals.Add(strFName, objPulicParameters.getObjectValue(objNewData(strFName), ""))
                End Select

                '检查主记录
                Select Case intRYLX
                    Case 1     '管理架构
                        If Me.doVerifyData_GuanliJiagou(strErrMsg, strUserId, strPassword, objOldData, objNewVals, objenumEditType, False) = False Then
                            GoTo errProc
                        End If
                    Case Else  '助理架构
                        If Me.doVerifyData_ZhuliJiagou(strErrMsg, strUserId, strPassword, objOldData, objNewVals, objenumEditType, False) = False Then
                            GoTo errProc
                        End If
                End Select

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    Select Case intRYLX
                        Case 1     '管理架构
                            If Me.doSaveData_RYJG_GLJG(strErrMsg, objSqlTransaction, objOldData, objNewVals, objenumEditType, objDataSet_TDZH) = False Then
                                GoTo rollDatabase
                            End If
                        Case Else  '助理架构
                            If Me.doSaveData_RYJG_ZLJG(strErrMsg, objSqlTransaction, objOldData, objNewVals, objenumEditType) = False Then
                                GoTo rollDatabase
                            End If
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objNewVals)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_RYJG = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objNewVals)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_人事_管理架构”或“地产_B_人事_助理架构”记录及相关记录
        ' 适用管理模式一、管理模式二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     objOldData           ：记录旧值(TABLE_DC_V_RS_RENYUANJIAGOU记录格式)
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '----------------------------------------------------------------
        Public Function doDeleteData_RYJG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doDeleteData_RYJG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：没有指定连接用户！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If objOldData Is Nothing Then
                    Exit Try
                End If

                '计算人员类型
                Dim intRYLX As Integer = 0
                intRYLX = objPulicParameters.getObjectValue(objOldData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYLX), 0)
                Dim strWYBS As String = ""
                strWYBS = objPulicParameters.getObjectValue(objOldData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                If strWYBS = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    Select Case intRYLX
                        Case 1     '管理架构
                            '删除“人事_B_人事异动”
                            strSQL = "delete from 人事_B_人事异动 where 关联标识 = '" + strWYBS + "'"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.ExecuteNonQuery()

                            '删除“地产_B_人事_管理架构”
                            strSQL = "delete from 地产_B_人事_管理架构 where 唯一标识 = '" + strWYBS + "'"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.ExecuteNonQuery()

                        Case Else  '助理架构
                            '删除“人事_B_人事异动”
                            strSQL = "delete from 人事_B_人事异动 where 关联标识 = '" + strWYBS + "'"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.ExecuteNonQuery()

                            '删除“地产_B_人事_助理架构”
                            strSQL = "delete from 地产_B_人事_助理架构 where 唯一标识 = '" + strWYBS + "'"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_RYJG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 将[人员架构]中的[所属单位]、[所属分组]同步到[公共_B_人员]
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strJCSJ              ：检测时间
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function doTongbuRyxx( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJCSJ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doTongbuRyxx = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doTongbuRyxx]没有指定连接用户！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strJCSJ Is Nothing Then strJCSJ = Now.ToString("yyyy-MM-dd")
                If strJCSJ = "" Then strJCSJ = Now.ToString("yyyy-MM-dd")
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    strErrMsg = "错误：[doTongbuRyxx]指定无效的时间！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    '从[地产_B_人事_管理架构]中更新
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set" + vbCr
                    strSQL = strSQL + "   组织代码 = b.所属单位," + vbCr
                    strSQL = strSQL + "   所属分组 = b.所属分组 " + vbCr
                    strSQL = strSQL + " from 公共_B_人员 a" + vbCr
                    strSQL = strSQL + " left join dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + " where b.人员代码 is not null" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                    objSqlCommand.ExecuteNonQuery()

                    '从[地产_B_人事_助理架构]中更新
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set" + vbCr
                    strSQL = strSQL + "   组织代码 = b.所属单位" + vbCr
                    strSQL = strSQL + " from 公共_B_人员 a" + vbCr
                    strSQL = strSQL + " left join dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj) b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + " where b.人员代码 is not null" + vbCr
                    strSQL = strSQL + " and   b.是否占编 = 1" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doTongbuRyxx = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 获取指定时间的人员架构报表的所有数据
        ' 适用于人事管理模式一
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJCSJ                    ：检测时间
        '     objDataSet                 ：数据集(返回)
        '                        table(0)：报表参数
        '                        table(1)：索引数据
        '                        table(2)：业务经理
        '                        table(3)：营业经理
        '                        table(4)：区域经理
        '                        table(5)：区域总监
        '                        table(6)：管理架构
        '                        table(7)：助理架构
        '                        table(8)：单位信息
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJCSJ As String, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim objDataSet01 As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJCSJ = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG]未指定[检测时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    strErrMsg = "错误：[getDataSet_RYJG]无效的[检测时间]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取临时SQL
                Dim strTempSQL1 As String = ""
                strSQL = "select dbo.uf_estate_rs_getRYJG01Sql('" + strJCSJ + "')"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet01) = False Then
                    GoTo errProc
                End If
                If objDataSet01.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG]无法计算[uf_estate_rs_getRYJGSql]！"
                    GoTo errProc
                End If
                If objDataSet01.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG]无法计算[uf_estate_rs_getRYJGSql]！"
                    GoTo errProc
                End If
                strTempSQL1 = objPulicParameters.getObjectValue(objDataSet01.Tables(0).Rows(0).Item(0), "")
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
                Dim strTempSQL2 As String = ""
                strSQL = "select dbo.uf_estate_rs_getRYJG02Sql('" + strJCSJ + "')"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet01) = False Then
                    GoTo errProc
                End If
                If objDataSet01.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG]无法计算[uf_estate_rs_getRYJGSql]！"
                    GoTo errProc
                End If
                If objDataSet01.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG]无法计算[uf_estate_rs_getRYJGSql]！"
                    GoTo errProc
                End If
                strTempSQL2 = objPulicParameters.getObjectValue(objDataSet01.Tables(0).Rows(0).Item(0), "")
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)

                '获取数据
                Try
                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '填充报表参数
                    objTempDataSet = New System.Data.DataSet
                    Dim objDataTable As System.Data.DataTable = Nothing
                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("报表行数", GetType(System.Int32))
                    objDataTable.Columns.Add("报表列数", GetType(System.Int32))
                    objDataTable.Columns.Add("总监列数", GetType(System.Int32))
                    objDataTable.Columns.Add("区经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("营经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("业经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("顾问列数", GetType(System.Int32))
                    objDataTable.Columns.Add("文员列数", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("单位序号", GetType(System.Int32))
                    objDataTable.Columns.Add("单位行数", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("唯一标识", GetType(String))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("人员状态", GetType(System.Int32))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("所属分组", GetType(String))
                    objDataTable.Columns.Add("直管单位", GetType(String))
                    objDataTable.Columns.Add("是否占编", GetType(System.Int32))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("生效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("失效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("人员名称", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("唯一标识", GetType(String))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("人员状态", GetType(System.Int32))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("所属分组", GetType(String))
                    objDataTable.Columns.Add("直管单位", GetType(String))
                    objDataTable.Columns.Add("是否占编", GetType(System.Int32))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("生效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("失效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("人员名称", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("单位名称", GetType(String))
                    objDataTable.Columns.Add("单位序号", GetType(System.Int32))
                    objDataTable.Columns.Add("编制人数", GetType(System.Int32))
                    objDataTable.Columns.Add("实际编制", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    Dim strGUID As String = objPulicParameters.getNewGuid()
                    strGUID = strGUID.Replace("-", "_")
                    strGUID = "tempTable_" + strGUID
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " " + strTempSQL1 + vbCr
                        strSQL = strSQL + " " + strTempSQL2 + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_BBCS from #tempTable_BBCS" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_SYSJ from #tempTable_SYSJ" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_YWJL from #tempTable_YWJL" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_YYJL from #tempTable_YYJL" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_QYJL from #tempTable_QYJL" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_QYZJ from #tempTable_QYZJ" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_BBCS" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_SYSJ order by 单位序号,职级代码,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_YWJL order by 所属单位,人员代码,职级代码,上级领导" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_YYJL order by 所属单位,人员代码,职级代码,上级领导" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_QYJL order by 所属单位,人员代码,职级代码,上级领导" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_QYZJ order by 所属单位,人员代码,职级代码,上级领导" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        strSQL = ""
                        strSQL = strSQL + " select a.*,b.人员名称" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + " order by a.所属单位,a.上级领导,a.职级代码,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(6))

                        strSQL = ""
                        strSQL = strSQL + " select a.*,b.人员名称" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + " order by a.所属单位,a.上级领导,a.职级代码,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(7))

                        strSQL = ""
                        strSQL = strSQL + " select * from dbo.uf_estate_rs_getRenyuanJiagou_DW(@jcsj) order by 单位序号,所属单位" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(8))

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strGUID + "_BBCS" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_SYSJ" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_YWJL" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_YYJL" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_QYJL" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_QYZJ" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    If objTempDataSet.Tables.Count < 9 Then
                        strErrMsg = "错误：[getDataSet_RYJG]获取数据出错！"
                        GoTo errProc
                    End If
                    objDataSet = objTempDataSet
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getDataSet_RYJG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定人员在指定时间可操作的部门SQL列表
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     strJCSJ              ：检测时间
        '     strList              ：返回部门SQL列表
        '     blnSFFH              ：返回是否售楼部人员
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '     zengxianglin 2009-05-16 重写
        '     zengxianglin 2010-01-13 更改
        '----------------------------------------------------------------
        Public Function getBumenSqlList( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strJCSJ As String, _
            ByRef strList As String, _
            ByRef blnSFFH As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objBumenList As New System.Collections.ArrayList
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getBumenSqlList = False
            blnSFFH = True
            strList = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getBumenSqlList]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算[公共_B_人员]所在部门
                Dim blnTemp As Boolean = True
                Dim blnVal As Boolean = True
                Dim strZZDM As String = ""
                Dim intSFFH As Integer = 1
                Dim intCount As Integer
                Dim i As Integer
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select a.组织代码" + vbCr
                strSQL = strSQL + "   from 公共_B_人员 a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Add(strZZDM)
                                If i = 0 Then
                                    blnTemp = blnVal
                                Else
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '计算[地产_B_人事_管理架构]的所在部门
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select 组织代码=a.所属单位" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Sort()
                                If objBumenList.BinarySearch(strZZDM) < 0 Then
                                    objBumenList.Add(strZZDM)
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                'zengxianglin 2010-01-13
                '计算strJCSJ时执行的人事管理模式
                Dim intBZXL As Integer = 0
                If Me.getBZXL_RSJG(strErrMsg, strUserId, strPassword, strJCSJ, intBZXL) = False Then
                    GoTo errProc
                End If
                '计算strRYDM管理的部门
                Select Case intBZXL
                    Case 1 '模式一
                        strSQL = ""
                        strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " ("
                        strSQL = strSQL + "   select 组织代码=a.单位代码" + vbCr
                        strSQL = strSQL + "   from dbo.uf_estate_rs_getRelateManager04('" + strRYDM + "','" + strJCSJ + "') a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                        strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        If objDataSet.Tables.Count > 0 Then
                            With objDataSet.Tables(0)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strZZDM = CType(.Rows(i).Item("组织代码"), String)
                                    intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                                    If strZZDM <> "" Then
                                        objBumenList.Sort()
                                        If objBumenList.BinarySearch(strZZDM) < 0 Then
                                            objBumenList.Add(strZZDM)
                                        End If
                                    End If
                                Next
                            End With
                        End If
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                    Case 2 '模式二
                        strSQL = ""
                        strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " ("
                        strSQL = strSQL + "   select b.所属单位 as 组织代码" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.组别标识" + vbCr
                        strSQL = strSQL + "     from" + vbCr
                        strSQL = strSQL + "     (" + vbCr
                        strSQL = strSQL + "       select 直管团队 as 组别标识" + vbCr
                        strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "')" + vbCr
                        strSQL = strSQL + "       where rtrim(isnull(直管团队,'')) <> ''" + vbCr
                        strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + "       union" + vbCr
                        strSQL = strSQL + "       select 协管团队 as 组别标识" + vbCr
                        strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "')" + vbCr
                        strSQL = strSQL + "       where rtrim(isnull(协管团队,'')) <> ''" + vbCr
                        strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + "     ) a" + vbCr
                        strSQL = strSQL + "     group by a.组别标识" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_团队组合 b on a.组别标识=b.组别标识" + vbCr
                        strSQL = strSQL + "   where b.组别标识 is not null" + vbCr
                        strSQL = strSQL + "   group by b.所属单位" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                        strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        If objDataSet.Tables.Count > 0 Then
                            With objDataSet.Tables(0)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strZZDM = CType(.Rows(i).Item("组织代码"), String)
                                    intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                                    If strZZDM <> "" Then
                                        objBumenList.Sort()
                                        If objBumenList.BinarySearch(strZZDM) < 0 Then
                                            objBumenList.Add(strZZDM)
                                        End If
                                    End If
                                Next
                            End With
                        End If
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                    Case Else
                        strErrMsg = "错误：不支持的人事管理模式！"
                        GoTo errProc
                End Select
                'zengxianglin 2010-01-13

                '计算[地产_B_人事_助理架构]的所在部门
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select 组织代码=a.所属单位" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidZhuliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Sort()
                                If objBumenList.BinarySearch(strZZDM) < 0 Then
                                    objBumenList.Add(strZZDM)
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '返回数据
                intCount = objBumenList.Count
                For i = 0 To intCount - 1 Step 1
                    If strList = "" Then
                        strList = "'" + CType(objBumenList(i), String) + "'"
                    Else
                        strList = strList + "," + "'" + CType(objBumenList(i), String) + "'"
                    End If
                Next
                blnSFFH = blnTemp
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objBumenList)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getBumenSqlList = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objBumenList)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定人员在指定时间所在部门以及管理的部门SQL列表
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     strJCSJ              ：检测时间
        '     blnSZBM_GLBM         ：接口重载
        '     strList              ：返回部门SQL列表
        '     blnSFFH              ：返回是否售楼部人员
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '     zengxianglin 2009-05-16 重写
        '     zengxianglin 2010-01-13 更改
        '----------------------------------------------------------------
        Public Function getBumenSqlList( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strJCSJ As String, _
            ByVal blnSZBM_GLBM As Boolean, _
            ByRef strList As String, _
            ByRef blnSFFH As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objBumenList As New System.Collections.ArrayList
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getBumenSqlList = False
            blnSFFH = True
            strList = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getBumenSqlList]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算[公共_B_人员]所在部门
                Dim blnTemp As Boolean = True
                Dim blnVal As Boolean = True
                Dim strZZDM As String = ""
                Dim intSFFH As Integer = 1
                Dim intCount As Integer
                Dim i As Integer
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select a.组织代码" + vbCr
                strSQL = strSQL + "   from 公共_B_人员 a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Add(strZZDM)
                                If i = 0 Then
                                    blnTemp = blnVal
                                Else
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '计算[地产_B_人事_管理架构]的所在部门
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select 组织代码=a.所属单位" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Sort()
                                If objBumenList.BinarySearch(strZZDM) < 0 Then
                                    objBumenList.Add(strZZDM)
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                'zengxianglin 2010-01-13
                '计算strJCSJ时执行的人事管理模式
                Dim intBZXL As Integer = 0
                If Me.getBZXL_RSJG(strErrMsg, strUserId, strPassword, strJCSJ, intBZXL) = False Then
                    GoTo errProc
                End If
                '计算strRYDM管理的部门
                Select Case intBZXL
                    Case 1 '模式一
                        strSQL = ""
                        strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " ("
                        strSQL = strSQL + "   select 组织代码=a.单位代码" + vbCr
                        strSQL = strSQL + "   from dbo.uf_estate_rs_getRelateManager04('" + strRYDM + "','" + strJCSJ + "') a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                        strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        If objDataSet.Tables.Count > 0 Then
                            With objDataSet.Tables(0)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strZZDM = CType(.Rows(i).Item("组织代码"), String)
                                    intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                                    If strZZDM <> "" Then
                                        objBumenList.Sort()
                                        If objBumenList.BinarySearch(strZZDM) < 0 Then
                                            objBumenList.Add(strZZDM)
                                        End If
                                    End If
                                Next
                            End With
                        End If
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                    Case 2 '模式二
                        strSQL = ""
                        strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select b.所属单位 as 组织代码" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.组别标识" + vbCr
                        strSQL = strSQL + "     from" + vbCr
                        strSQL = strSQL + "     (" + vbCr
                        strSQL = strSQL + "       select 直管团队 as 组别标识" + vbCr
                        strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "')" + vbCr
                        strSQL = strSQL + "       where rtrim(isnull(直管团队,'')) <> ''" + vbCr
                        strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + "       union" + vbCr
                        strSQL = strSQL + "       select 协管团队 as 组别标识" + vbCr
                        strSQL = strSQL + "       from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "')" + vbCr
                        strSQL = strSQL + "       where rtrim(isnull(协管团队,'')) <> ''" + vbCr
                        strSQL = strSQL + "       and   人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + "     ) a" + vbCr
                        strSQL = strSQL + "     group by a.组别标识" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_团队组合 b on a.组别标识=b.组别标识" + vbCr
                        strSQL = strSQL + "   where b.组别标识 is not null" + vbCr
                        strSQL = strSQL + "   group by b.所属单位" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                        strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        If objDataSet.Tables.Count > 0 Then
                            With objDataSet.Tables(0)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strZZDM = CType(.Rows(i).Item("组织代码"), String)
                                    intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                                    If strZZDM <> "" Then
                                        objBumenList.Sort()
                                        If objBumenList.BinarySearch(strZZDM) < 0 Then
                                            objBumenList.Add(strZZDM)
                                        End If
                                    End If
                                Next
                            End With
                        End If
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                    Case Else
                        strErrMsg = "错误：不支持的人事管理模式！"
                        GoTo errProc
                End Select
                'zengxianglin 2010-01-13

                '计算[地产_B_人事_助理架构]的所在部门
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select 组织代码=a.所属单位" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidZhuliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "   group by a.所属单位" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    With objDataSet.Tables(0)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strZZDM = CType(.Rows(i).Item("组织代码"), String)
                            intSFFH = CType(.Rows(i).Item("是否分行"), Integer)
                            If intSFFH = 1 Then
                                blnVal = True
                            Else
                                blnVal = False
                            End If
                            If strZZDM <> "" Then
                                objBumenList.Sort()
                                If objBumenList.BinarySearch(strZZDM) < 0 Then
                                    objBumenList.Add(strZZDM)
                                    If blnVal = False Then
                                        blnTemp = False
                                    End If
                                End If
                            End If
                        Next
                    End With
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '返回数据
                intCount = objBumenList.Count
                For i = 0 To intCount - 1 Step 1
                    If strList = "" Then
                        strList = "'" + CType(objBumenList(i), String) + "'"
                    Else
                        strList = strList + "," + "'" + CType(objBumenList(i), String) + "'"
                    End If
                Next
                blnSFFH = blnTemp
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objBumenList)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getBumenSqlList = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objBumenList)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定人员在指定时间管理的部门SQL列表
        ' 如果碰到不是分行的单位，则终止搜索
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlConnection     ：当前连接
        '     strRYDM              ：人员代码
        '     strJCSJ              ：检测时间
        '     objBumenList         ：返回部门SQL列表
        '     blnSFFH              ：返回是否售楼部人员
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '     zengxianglin 2009-05-16 弃用
        '----------------------------------------------------------------
        Private Function getBumenSqlList( _
            ByRef strErrMsg As String, _
            ByVal objSqlConnection As System.Data.SqlClient.SqlConnection, _
            ByVal strRYDM As String, _
            ByVal strJCSJ As String, _
            ByRef objBumenList As System.Collections.ArrayList, _
            ByRef blnSFFH As Boolean) As Boolean

            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getBumenSqlList = False

            Try
                '检查
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    Exit Try
                End If

                '计算[地产_B_人事_管理架构]的所在部门
                Dim blnTemp As Boolean = True
                Dim blnVal As Boolean = True
                Dim strZZDM As String = ""
                Dim intSFFH As Integer
                Dim intCount As Integer
                Dim i As Integer
                strSQL = ""
                strSQL = strSQL + " select a.组织代码,是否分行=case when b.是否分行&1=1 then 1 else 0 end" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " ("
                strSQL = strSQL + "   select 组织代码=a.所属单位" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.上级领导 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "   group by a.所属单位" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码=b.组织代码" + vbCr
                strSQL = strSQL + " where b.组织代码 is not null" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    intCount = objDataSet.Tables(0).Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strZZDM = CType(objDataSet.Tables(0).Rows(i).Item("组织代码"), String)
                        intSFFH = CType(objDataSet.Tables(0).Rows(i).Item("是否分行"), Integer)
                        If intSFFH = 1 Then
                            blnVal = True
                        Else
                            blnVal = False
                        End If
                        If strZZDM <> "" Then
                            objBumenList.Sort()
                            If objBumenList.BinarySearch(strZZDM) < 0 Then
                                objBumenList.Add(strZZDM)
                                If blnVal = False Then
                                    blnTemp = False
                                End If
                            End If
                        End If
                    Next
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '返回数据
                If blnTemp = False Then
                    blnSFFH = False
                    Exit Try
                End If
                blnSFFH = blnTemp

                '计算该人员管理的部门
                Dim strRYDM1 As String = ""
                strSQL = ""
                strSQL = strSQL + " select a.人员代码" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + " where a.上级领导 = '" + strRYDM + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                intCount = objDataSet.Tables(0).Rows.Count
                For i = 0 To intCount - 1 Step 1
                    strRYDM1 = CType(objDataSet.Tables(0).Rows(i).Item("人员代码"), String)
                    strRYDM1 = strRYDM1.Trim
                    If strRYDM1 <> "" Then
                        If Me.getBumenSqlList(strErrMsg, objSqlConnection, strRYDM1, strJCSJ, objBumenList, blnSFFH) = False Then
                            GoTo errProc
                        End If
                    End If
                    '终止搜索
                    If blnSFFH = False Then
                        Exit Try
                    End If
                Next
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getBumenSqlList = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定部门指定年、季度的正式职工业绩考核数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strBMDM                    ：统计部门
        '     intND                      ：考核年度
        '     intJD                      ：考核季度
        '     intYJZR                    ：月截止日
        '     strCHCR                    ：换行字符串
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-08 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_RSRYKH_ZSZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strBMDM As String, _
            ByVal intND As Integer, _
            ByVal intJD As Integer, _
            ByVal intYJZR As Integer, _
            ByVal strCHCR As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_RSRYKH_ZSZG = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_ZSZG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim
                If strCHCR Is Nothing Then strCHCR = ""
                strCHCR = strCHCR.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_VT_RS_ZSZGKH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " exec dbo.up_estate_rs_getRYKH_ZSZG @bmdm,@nd,@jd,@yjzr,@chcr" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        objSqlCommand.Parameters.AddWithValue("@nd", intND)
                        objSqlCommand.Parameters.AddWithValue("@jd", intJD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        objSqlCommand.Parameters.AddWithValue("@chcr", strCHCR)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_ZSZGKH))
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 1 Then
                        Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_RSRYKH_ZSZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算考核指标
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strBMDM                   ：考核单位代码
        '     strZJDM                   ：职级代码
        '     dblPJRS                   ：平均人数
        '     dblKHZB                   ：考核指标(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getKHZB( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strBMDM As String, _
            ByVal strZJDM As String, _
            ByVal dblPJRS As Double, _
            ByRef dblKHZB As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getKHZB = False
            strErrMsg = ""
            dblKHZB = 0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getKHZB]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim
                If strBMDM = "" Then
                    strErrMsg = "错误：[getKHZB]未指定[单位]！"
                    GoTo errProc
                End If
                If strZJDM Is Nothing Then strZJDM = ""
                strZJDM = strZJDM.Trim
                If strZJDM = "" Then
                    strErrMsg = "错误：[getKHZB]未指定[职级]！"
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " declare @khzb float" + vbCr
                strSQL = strSQL + " exec dbo.up_estate_rs_getZhibiaoMethod00 '" + strZJDM + "','" + strBMDM + "'," + dblPJRS.ToString("##0.00") + ",@khzb output" + vbCr
                strSQL = strSQL + " select @khzb" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    dblKHZB = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0.0)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getKHZB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算平均人数
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strBMDM                   ：单位代码
        '     strKSSJ                   ：开始时间
        '     strZZSJ                   ：终止时间
        '     strZJDM                   ：职级搜索码
        '     dblPJRS                   ：平均人数(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getPJRS( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strBMDM As String, _
            ByVal strKSSJ As String, _
            ByVal strZZSJ As String, _
            ByVal strZJDM As String, _
            ByRef dblPJRS As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getPJRS = False
            strErrMsg = ""
            dblPJRS = 0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPJRS]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                If strBMDM = "" Then
                    strErrMsg = "错误：[getPJRS]未指定[单位]！"
                    GoTo errProc
                End If
                If strZJDM Is Nothing Then strZJDM = ""
                If strZJDM = "" Then
                    strErrMsg = "错误：[getPJRS]未指定[职级]！"
                    GoTo errProc
                End If
                If strKSSJ Is Nothing Then strKSSJ = ""
                strKSSJ = strKSSJ.Trim
                If strKSSJ = "" Then
                    strErrMsg = "错误：[getPJRS]未指定[开始时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSSJ) = False Then
                    strErrMsg = "错误：[getPJRS]无效的日期[" + strKSSJ + "]！"
                    GoTo errProc
                End If
                If strZZSJ Is Nothing Then strZZSJ = ""
                strZZSJ = strZZSJ.Trim
                If strZZSJ = "" Then
                    strErrMsg = "错误：[getPJRS]未指定[结束时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZSJ) = False Then
                    strErrMsg = "错误：[getPJRS]无效的日期[" + strZZSJ + "]！"
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select dbo.uf_estate_rs_getPzrsN('" + strBMDM + "','" + strKSSJ + "','" + strZZSJ + "','" + strZJDM + "')" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    dblPJRS = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0.0)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getPJRS = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 输出正式职工的考核报表
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strBMDM                ：考核单位代码
        '     intND                  ：考核年度
        '     intJD                  ：考核季度
        '     intYJZR                ：月截止日
        '     objDataSet             ：要导出的数据集
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strMacroName           ：宏名列表
        '     strMacroValue          ：宏值列表
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2008-11-09 创建
        '     zengxianglin 2009-05-18 更改(职级代码调整)
        '----------------------------------------------------------------
        Public Function doPrint_BB_RSRYKH_ZSZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strBMDM As String, _
            ByVal intND As Integer, _
            ByVal intJD As Integer, _
            ByVal intYJZR As Integer, _
            ByVal objDataSet As System.Data.DataSet, _
            ByVal strExcelFile As String, _
            Optional ByVal strMacroName As String = "", _
            Optional ByVal strMacroValue As String = "") As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objBaseLocalFile As New Josco.JsKernal.Common.Utilities.BaseLocalFile
            Dim objParamDataSet As Josco.JsKernal.Common.Data.DrdcData = Nothing
            Dim objExcelFile As New GemBox.ExcelLite.ExcelFile

            doPrint_BB_RSRYKH_ZSZG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim
                If strBMDM = "" Then
                    strErrMsg = "错误：[doPrint_BB_RSRYKH_ZSZG]未指定[单位]！"
                    GoTo errProc
                End If
                If strExcelFile Is Nothing Then strExcelFile = ""
                strExcelFile = strExcelFile.Trim
                If objDataSet Is Nothing Then
                    strErrMsg = "错误：[doPrint_BB_RSRYKH_ZSZG]未指定要导出的数据！"
                    GoTo errProc
                End If
                If strExcelFile = "" Then
                    strErrMsg = "错误：[doPrint_BB_RSRYKH_ZSZG]未指定的Excel文件！"
                    GoTo errProc
                End If
                Dim blnExisted As Boolean
                If objBaseLocalFile.doFileExisted(strErrMsg, strExcelFile, blnExisted) = False Then
                    GoTo errProc
                End If
                If blnExisted = False Then
                    strErrMsg = "错误：[doPrint_BB_RSRYKH_ZSZG]Excel文件[" + strExcelFile + "]不存在！"
                    GoTo errProc
                End If

                '没有数据
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If

                '解析宏数据
                Dim strSep As String = Josco.JsKernal.Common.Utilities.PulicParameters.CharSeparate
                Dim strValueList() As String = {}
                Dim strNameList() As String = {}
                If strMacroName <> "" Then
                    strNameList = strMacroName.Split(strSep.ToCharArray)
                    strValueList = strMacroValue.Split(strSep.ToCharArray)
                End If

                '装载Excel
                objExcelFile.LoadXls(strExcelFile)

                '输出数据
                Dim objExcelWorksheet As GemBox.ExcelLite.ExcelWorksheet = Nothing
                objExcelWorksheet = objExcelFile.Worksheets(0)

                '输出宏数据
                Dim strCellValue As String = ""
                Dim intMacros As Integer = strNameList.Length
                Dim intRows As Integer = 25
                Dim intCols As Integer = 57
                Dim i As Integer
                Dim j As Integer
                Dim k As Integer
                For i = 0 To intRows - 1 Step 1
                    For j = 0 To intCols - 1 Step 1
                        strCellValue = objPulicParameters.getObjectValue(objExcelWorksheet.Cells(i, j).Value, "")
                        For k = 0 To intMacros - 1 Step 1
                            strCellValue = strCellValue.Replace(strNameList(k), strValueList(k))
                        Next
                        objExcelWorksheet.Cells(i, j).Value = strCellValue
                    Next
                Next

                '输出表头数据
                '计算考核指标数据
                Dim dblKHZB As Double
                If Me.getKHZB(strErrMsg, strUserId, strPassword, strBMDM, "020.010.010", 1.0, dblKHZB) = False Then
                    GoTo errProc
                End If
                objExcelWorksheet.Cells(3, 3).Value = dblKHZB
                If Me.getKHZB(strErrMsg, strUserId, strPassword, strBMDM, "020.010.020", 1.0, dblKHZB) = False Then
                    GoTo errProc
                End If
                objExcelWorksheet.Cells(4, 3).Value = dblKHZB
                If Me.getKHZB(strErrMsg, strUserId, strPassword, strBMDM, "020.010.030", 1.0, dblKHZB) = False Then
                    GoTo errProc
                End If
                objExcelWorksheet.Cells(5, 3).Value = dblKHZB
                If Me.getKHZB(strErrMsg, strUserId, strPassword, strBMDM, "020.010.040", 1.0, dblKHZB) = False Then
                    GoTo errProc
                End If
                objExcelWorksheet.Cells(6, 3).Value = dblKHZB
                '计算月度平均人数数据
                Dim objNCRQ As System.DateTime
                Dim objQCRQ As System.DateTime
                Dim objQMRQ As System.DateTime
                Dim strNCRQ As String = ""
                Dim dblRSHJ As Double
                strNCRQ = intND.ToString + "-01-" + intYJZR.ToString
                objNCRQ = CType(strNCRQ, System.DateTime)
                objNCRQ = objNCRQ.AddMonths(-1)
                dblRSHJ = 0
                j = 3
                For i = (intJD - 1) * 3 + 1 To intJD * 3 Step 1
                    objQCRQ = objNCRQ.AddMonths(i - 1)
                    objQMRQ = objQCRQ.AddMonths(1)
                    objQMRQ = objQMRQ.AddDays(-1)
                    If Me.getPJRS(strErrMsg, strUserId, strPassword, strBMDM, objQCRQ.ToString("yyyy-MM-dd"), objQMRQ.ToString("yyyy-MM-dd"), "020.010.", dblKHZB) = False Then
                        GoTo errProc
                    End If
                    objExcelWorksheet.Cells(j, 9).Value = dblKHZB
                    dblRSHJ = dblRSHJ + dblKHZB
                    j = j + 1
                Next
                objExcelWorksheet.Cells(6, 9).Value = dblRSHJ

                '输出考核数据
                Dim strCellValue1 As String = ""
                Dim strCellValue2 As String = ""
                With objDataSet.Tables(0)
                    '行数足够？
                    If .Rows.Count > 16 Then
                        For i = 16 To .Rows.Count - 1 Step 1
                            objExcelWorksheet.Rows(23).InsertCopy(1, objExcelWorksheet.Rows(23))
                        Next
                    End If
                    For i = 0 To .Rows.Count - 1 Step 1
                        For j = 0 To 11 Step 1
                            strCellValue = ""
                            Select Case j
                                Case 0
                                    strCellValue = (i + 1).ToString
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 1
                                    strCellValue = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_RYMC), "")
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 2
                                    strCellValue = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_ZJMC), "")
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 3
                                    strCellValue = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_GZQK), "")
                                    strCellValue = strCellValue.Replace("<br>", Chr(10))
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 4
                                    strCellValue1 = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_SRYJ), "", "##0.00", True)
                                    strCellValue2 = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_TDYJ), "", "##0.00", True)
                                    strCellValue = strCellValue2 + Chr(10) + "(" + strCellValue1 + ")"
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 6
                                    strCellValue1 = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_SRPJ), "", "##0.00", True)
                                    strCellValue2 = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_TDPJ), "", "##0.00", True)
                                    strCellValue = strCellValue2 + Chr(10) + "(" + strCellValue1 + ")"
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                                Case 7
                                    objExcelWorksheet.Cells(i + 8, j).Value = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_PJRS), 0.0)
                                Case 8
                                    objExcelWorksheet.Cells(i + 8, j).Value = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_KHYJ), 0.0)
                                Case 9
                                    objExcelWorksheet.Cells(i + 8, j).Value = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_KHZB), 0.0)
                                Case 10
                                Case 11
                                    strCellValue = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_VT_RS_ZSZGKH_DDDJ), "")
                                    objExcelWorksheet.Cells(i + 8, j).Value = strCellValue
                            End Select
                        Next
                    Next
                End With

                '保存Excel
                objExcelFile.SaveXls(strExcelFile)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Data.DrdcData.SafeRelease(objParamDataSet)
            objExcelFile = Nothing

            doPrint_BB_RSRYKH_ZSZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.BaseLocalFile.SafeRelease(objBaseLocalFile)
            Josco.JsKernal.Common.Data.DrdcData.SafeRelease(objParamDataSet)
            objExcelFile = Nothing
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员、指定时间段内的试用期职工考核数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strRYDM                    ：考核人员
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intSYQY                    ：试用期(月)
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-08 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_RSRYKH_SYZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intSYQY As Integer, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_RSRYKH_SYZG = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]未指定[考核人员]！"
                    GoTo errProc
                End If
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If intSYQY < 1 Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]无效的[试用期]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_VT_RS_SYZGKH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from dbo.up_estate_rs_getRYKH_SYZG(@rydm,@ksrq,@zzrq,@syqy) a" + vbCr
                        strSQL = strSQL + " order by a.显示级别,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@syqy", intSYQY)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_SYZGKH))
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 1 Then
                        Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_RSRYKH_SYZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定时间段内的发生试用的人员数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intSYQY                    ：试用期(月)
        '     objDataSet                 ：信息数据集(Table(0))
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-08 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_RSRYKH_SYZG_RY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intSYQY As Integer, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_RSRYKH_SYZG_RY = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG_RY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG_RY]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG_RY]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG_RY]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG_RY]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If intSYQY < 1 Then
                    strErrMsg = "错误：[getDataSet_BB_RSRYKH_SYZG]无效的[试用期]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New System.Data.DataSet

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.人员代码,人员名称=isnull(b.人员名称,'无姓名'),a.入职日期" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 人员代码,入职日期=max(生效时间)" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + "     where 人员状态 & 1 = 1" + vbCr
                        strSQL = strSQL + "     and  dbo.uf_gg_IsDateSegIntersect(生效时间,dateadd(m,@syqy,生效时间),@ksrq,@zzrq) = 1" + vbCr
                        strSQL = strSQL + "     group by 人员代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.入职日期,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@syqy", intSYQY)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet)
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 1 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_RSRYKH_SYZG_RY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function







        '----------------------------------------------------------------
        ' 增加“地产_B_人事_管理架构”的新数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        '     strYDYY              ：变动原因代码
        '     blnSFJZ              ：True-兼职,False-不是兼职
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doAddNew_GuanliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal strYDYY As String, _
            ByVal blnSFJZ As Boolean) As Boolean

            Dim objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doAddNew_GuanliJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doAddNew_GuanliJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAddNew_GuanliJiagou]未传入[新数据]！"
                    GoTo errProc
                End If

                '准备新数据
                objenumEditType = Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew

                '检查数据
                If Me.doVerifyData_GuanliJiagou(strErrMsg, strUserId, strPassword, Nothing, objNewData, objenumEditType, True) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列

                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL
                                                If strValue = "" Then strValue = "0"
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_管理架构 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                   
                    '写对应人员的人事异动记录的“终止时间”
                    strSQL = ""
                    strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                    strSQL = strSQL + "   终止时间 = dateadd(ss, -1, @zzsj) " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    strSQL = strSQL + " and   开始时间 is not null" + vbCr
                    strSQL = strSQL + " and   开始时间 < @zzsj" + vbCr
                    strSQL = strSQL + " and   终止时间 is null" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@zzsj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ))
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '写新的人事异动记录
                    Dim strZGSX As String = ""
                    Dim intValue As Integer
                    Dim intRYZT As Integer
                    intRYZT = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT), 0)
                    strZGSX = Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(intRYZT)
                    strSQL = ""
                    strSQL = strSQL + " insert into 人事_B_人事异动 (唯一标识,人员代码,开始时间,变动原因,任职单位,任职级别,岗位属性,关联标识,所属分组,职工属性,本次占编,现属团队)" + vbCr
                    strSQL = strSQL + " values (newid(), @rydm, @kssj, @bdyy, @rzdw, @rzjb, @gwsx, @glbs, @ssfz, @zgsx, @bczb, @xstd)" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strYDYY)
                    objSqlCommand.Parameters.AddWithValue("@rzdw", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW))
                    objSqlCommand.Parameters.AddWithValue("@rzjb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC))
                    intValue = 1
                    objSqlCommand.Parameters.AddWithValue("@gwsx", intValue) '在岗
                    objSqlCommand.Parameters.AddWithValue("@glbs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ))
                    objSqlCommand.Parameters.AddWithValue("@zgsx", strZGSX)
                    objSqlCommand.Parameters.AddWithValue("@bczb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB))
                    objSqlCommand.Parameters.AddWithValue("@xstd", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doAddNew_GuanliJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function





        '----------------------------------------------------------------
        ' 增加“地产_B_人事_管理架构”的新数据
        ' 适用管理模式一、二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        '     strYDYY              ：变动原因代码
        '     blnSFJZ              ：True-兼职,False-不是兼职
        '     objDataSet_TDZH      ：要创建的团队组合数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-01-04 更改
        '     zengxianglin 2009-12-31 重新设计
        '----------------------------------------------------------------
        Public Function doAddNew_GuanliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal strYDYY As String, _
            ByVal blnSFJZ As Boolean, _
            ByVal objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doAddNew_GuanliJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doAddNew_GuanliJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAddNew_GuanliJiagou]未传入[新数据]！"
                    GoTo errProc
                End If

                '准备新数据
                objenumEditType = Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew

                '检查数据
                If Me.doVerifyData_GuanliJiagou(strErrMsg, strUserId, strPassword, Nothing, objNewData, objenumEditType, True) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDWMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SJLDMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGDWMC
                                        '显示列

                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_BZXL
                                                If strValue = "" Then strValue = "0"
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_JSSJ
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_管理架构 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select

                    '写对应的直管团队数据
                    Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    Dim strZBBS As String = ""
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If

                    '写对应的协管团队数据
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If

                    '写对应人员的人事异动记录的“终止时间”
                    strSQL = ""
                    strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                    strSQL = strSQL + "   终止时间 = dateadd(ss, -1, @zzsj) " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    strSQL = strSQL + " and   开始时间 is not null" + vbCr
                    strSQL = strSQL + " and   开始时间 < @zzsj" + vbCr
                    strSQL = strSQL + " and   终止时间 is null" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@zzsj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ))
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '写新的人事异动记录
                    Dim strZGSX As String = ""
                    Dim intValue As Integer
                    Dim intRYZT As Integer
                    intRYZT = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYZT), 0)
                    strZGSX = Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(intRYZT)
                    strSQL = ""
                    strSQL = strSQL + " insert into 人事_B_人事异动 (唯一标识,人员代码,开始时间,变动原因,任职单位,任职级别,岗位属性,关联标识,所属分组,职工属性,本次占编,现属团队)" + vbCr
                    strSQL = strSQL + " values (newid(), @rydm, @kssj, @bdyy, @rzdw, @rzjb, @gwsx, @glbs, @ssfz, @zgsx, @bczb, @xstd)" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_KSSJ))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strYDYY)
                    objSqlCommand.Parameters.AddWithValue("@rzdw", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW))
                    objSqlCommand.Parameters.AddWithValue("@rzjb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZJMC))
                    intValue = 1
                    objSqlCommand.Parameters.AddWithValue("@gwsx", intValue) '在岗
                    objSqlCommand.Parameters.AddWithValue("@glbs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_WYBS))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ))
                    objSqlCommand.Parameters.AddWithValue("@zgsx", strZGSX)
                    objSqlCommand.Parameters.AddWithValue("@bczb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SFZB))
                    objSqlCommand.Parameters.AddWithValue("@xstd", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_TDBH))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                    strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                    strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_RYDM))
                    objSqlCommand.Parameters.AddWithValue("@zzdm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSDW))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_SSFZ))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doAddNew_GuanliJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 增加“地产_B_人事_助理架构”的新数据
        ' 适用管理模式一、二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        '     strYDYY              ：变动原因代码
        '     blnSFJZ              ：True-兼职,False-不是兼职
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-01-04 更改
        '     zengxianglin 2009-12-31 重新设计
        '----------------------------------------------------------------
        Public Function doAddNew_ZhuliJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal strYDYY As String, _
            ByVal blnSFJZ As Boolean) As Boolean

            Dim objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doAddNew_ZhuliJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doAddNew_ZhuliJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAddNew_ZhuliJiagou]未传入[新数据]！"
                    GoTo errProc
                End If
                If strYDYY Is Nothing Then strYDYY = ""
                strYDYY = strYDYY.Trim

                '准备新数据
                objenumEditType = Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew

                '检查数据
                If Me.doVerifyData_ZhuliJiagou(strErrMsg, strUserId, strPassword, Nothing, objNewData, objenumEditType, True) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZTMC, _
                                        Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDWMC
                                        '显示列
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_BZXL, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFJZ
                                                If strValue = "" Then strValue = "0"
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                            Case Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ, _
                                                Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_JSSJ
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_助理架构 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select

                    '写对应人员的人事异动记录的“终止时间”
                    If blnSFJZ = False Then
                        strSQL = ""
                        strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                        strSQL = strSQL + "   终止时间 = dateadd(ss, -1, @zzsj) " + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        strSQL = strSQL + " and   开始时间 is not null" + vbCr
                        strSQL = strSQL + " and   开始时间 < @zzsj" + vbCr
                        strSQL = strSQL + " and   终止时间 is null" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zzsj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ))
                        objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM))
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If

                    '写新的人事异动记录
                    Dim strZGSX As String = ""
                    Dim intValue As Integer
                    Dim intRYZT As Integer
                    intRYZT = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYZT), 0)
                    strZGSX = Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(intRYZT)
                    strSQL = ""
                    strSQL = strSQL + " insert into 人事_B_人事异动 (唯一标识,人员代码,开始时间,变动原因,任职单位,任职级别,岗位属性,关联标识,职工属性,本次占编,现属团队)" + vbCr
                    strSQL = strSQL + " values (newid(), @rydm, @kssj, @bdyy, @rzdw, @rzjb, @gwsx, @glbs, @zgsx, @bczb, @xstd)" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_KSSJ))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strYDYY)
                    objSqlCommand.Parameters.AddWithValue("@rzdw", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDW))
                    objSqlCommand.Parameters.AddWithValue("@rzjb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_ZJMC))
                    intValue = 1
                    objSqlCommand.Parameters.AddWithValue("@gwsx", intValue) '在岗
                    objSqlCommand.Parameters.AddWithValue("@glbs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_WYBS))
                    objSqlCommand.Parameters.AddWithValue("@zgsx", strZGSX)
                    objSqlCommand.Parameters.AddWithValue("@bczb", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SFZB))
                    intValue = 0
                    objSqlCommand.Parameters.AddWithValue("@xstd", intValue)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    If blnSFJZ = False Then
                        strSQL = ""
                        strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                        strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                        strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_RYDM))
                        objSqlCommand.Parameters.AddWithValue("@zzdm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHULIJIAGOU_SSDW))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", "")
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doAddNew_ZhuliJiagou = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 计算指定时间执行的人员管理模式
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strJCSJ                   ：检测时间
        '     intBZXL                   ：标准序列(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2009-12-29 创建
        '----------------------------------------------------------------
        Public Function getBZXL_RSJG( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJCSJ As String, _
            ByRef intBZXL As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getBZXL_RSJG = False
            strErrMsg = ""
            intBZXL = 0

            Try
                '检查
                '====================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getBZXL_RSJG]未指定[连接用户]！"
                    GoTo errProc
                End If
                '====================================================================================================================================
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ <> "" Then
                    If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                        strErrMsg = "错误：[getBZXL_RSJG]无效的[检测时间][" + strJCSJ + "]！"
                        GoTo errProc
                    End If
                    strJCSJ = CType(strJCSJ, System.DateTime).ToString("yyyy-MM-dd HH:mm:ss")
                End If
                '====================================================================================================================================

                '计算
                If strJCSJ <> "" Then
                    strSQL = ""
                    strSQL = strSQL + " select dbo.uf_estate_rs_getBZXL('" + strJCSJ + "','人事架构',null)" + vbCr
                Else
                    strSQL = ""
                    strSQL = strSQL + " select dbo.uf_estate_rs_getBZXL(null,'人事架构')" + vbCr
                End If
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    intBZXL = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getBZXL_RSJG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算strZBBS指定的团队组合数据(如果数据库中不存在,则从缓存数据集中检索)
        ' 适用管理模式二
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strZBBS                   ：组别标识
        '     objBufDataSet             ：缓存数据集
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2009-12-29 创建
        '----------------------------------------------------------------
        Public Function getDataSet_TDZH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strZBBS As String, _
            ByVal objBufDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_TDZH = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_TDZH]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strZBBS Is Nothing Then strZBBS = ""
                strZBBS = strZBBS.Trim
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_TDZH)
                    If strZBBS = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '先从数据库中检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.组织名称 as 单位名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select *" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_团队组合" + vbCr
                        strSQL = strSQL + "     where 组别标识 = @zbbs" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 b on a.所属单位=b.组织代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.单位名称,a.团队编号" + vbCr
                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        .SelectCommand = objSqlCommand
                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH))
                    End With

                    '如果数据不存在！
                    If objTempDataSet.Tables(strTable).Rows.Count < 1 Then
                        '从缓存中检索
                        If Not (objBufDataSet Is Nothing) Then
                            If Not (objBufDataSet.Tables(strTable) Is Nothing) Then
                                Dim objDataRow As System.Data.DataRow = Nothing
                                Dim i, j, intRows, intCols As Integer
                                Dim strOldFilter As String = ""
                                With objBufDataSet.Tables(strTable)
                                    strOldFilter = .DefaultView.RowFilter
                                    .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + " = '" + strZBBS + "'"
                                    If .DefaultView.Count > 0 Then
                                        intCols = .Columns.Count
                                        intRows = .DefaultView.Count
                                        For i = 0 To intRows - 1 Step 1
                                            With objTempDataSet.Tables(strTable)
                                                objDataRow = .NewRow
                                            End With
                                            For j = 0 To intCols - 1 Step 1
                                                objDataRow.Item(j) = .DefaultView.Item(i).Item(j)
                                            Next
                                            With objTempDataSet.Tables(strTable)
                                                .Rows.Add(objDataRow)
                                            End With
                                        Next
                                    End If
                                    .DefaultView.RowFilter = strOldFilter
                                End With
                            End If
                        End If
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_TDZH = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定时间生效的团队列表
        ' 适用管理模式二
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strJCSJ                   ：检测时间
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2009-12-29 创建
        '----------------------------------------------------------------
        Public Function getDataSet_TEAM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJCSJ As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_TEAM = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_TEAM]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    strErrMsg = "错误：[getDataSet_TEAM]未指定[检测时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    strErrMsg = "错误：[getDataSet_TEAM]无效的[检测时间][" + strJCSJ + "]！"
                    GoTo errProc
                End If
                strJCSJ = CType(strJCSJ, System.DateTime).ToString("yyyy-MM-dd HH:mm:ss")
                '========================================================================================================================================
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_TDZH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '先从数据库中检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.组织名称 as 单位名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select '' as 组合标识,'' as 组别标识,所属单位,团队编号" + vbCr
                        strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj)" + vbCr '有效管理架构
                        strSQL = strSQL + "     where 团队编号 > 0" + vbCr                                '有效团队
                        strSQL = strSQL + "     group by 所属单位,团队编号" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 b on a.所属单位=b.组织代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.单位名称,a.团队编号" + vbCr
                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", strJCSJ)
                        .SelectCommand = objSqlCommand
                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_TEAM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查入职输入的时间有效性
        ' 适用管理模式二
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     intRYLX              ：人员类型(1-业务人员，0-行政助理)
        '     strRYDM              ：人员代码
        '     strRYMC              ：人员名称
        '     strSSDW              ：所属单位代码
        '     strBDSJ              ：变动时间
        '     blnValid             ：返回True-有效 False-无效
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 变更说明
        '     zengxianglin 2009-12-31 创建
        '----------------------------------------------------------------
        Public Function doValidParamsJG_Add_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intRYLX As Integer, _
            ByVal strRYDM As String, _
            ByVal strRYMC As String, _
            ByVal strSSDW As String, _
            ByVal strBDSJ As String, _
            ByRef blnValid As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            doValidParamsJG_Add_X2 = False
            blnValid = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYMC Is Nothing Then strRYMC = ""
                strRYMC = strRYMC.Trim
                If strSSDW Is Nothing Then strSSDW = ""
                strSSDW = strSSDW.Trim
                If strBDSJ Is Nothing Then strBDSJ = ""
                strBDSJ = strBDSJ.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '检查是否与标准二的执行时期一致？
                Dim intBZXL As Integer
                If Me.getBZXL_RSJG(strErrMsg, strUserId, strPassword, strBDSJ, intBZXL) = False Then
                    GoTo errProc
                End If
                If intBZXL <> 2 Then
                    strErrMsg = "错误：[" + strBDSJ + "]不在人事管理模式二所在的有效期内！"
                    GoTo errProc
                End If

                '计算
                Dim strMaxSXSJ As String = ""
                Dim intRows As Integer
                Select Case intRYLX
                    Case 1    '业务人员
                        '判断原则：
                        '  该人有定义：
                        '    (1)如果有正在生效的记录，则错误！ 
                        '    (2)如果没有正在生效的记录，则日期必须大于最大失效时间！ 
                        '    (3)其他为有效 
                        '  该人未定义：
                        '     有效

                        '记录存在？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows < 1 Then
                            blnValid = True
                            Exit Try
                        End If

                        '仍在生效？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   失效时间 is null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows > 0 Then
                            strErrMsg = "错误：[" + strRYMC + "]已经定义过！"
                            blnValid = False
                            Exit Try
                        End If

                        '时间正确？
                        strSQL = ""
                        strSQL = strSQL + " select max(失效时间) from 地产_B_人事_管理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        strMaxSXSJ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd hh:mm:ss")
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If CType(strBDSJ, System.DateTime) <= CType(strMaxSXSJ, System.DateTime) Then
                            strErrMsg = "错误：[" + strRYMC + "]只能在[" + strMaxSXSJ + "]时间以后！"
                            blnValid = False
                            Exit Try
                        End If

                        blnValid = True

                    Case Else '行政助理
                        '判断原则：
                        '  该人该单位有定义：
                        '    (1)如果有正在生效的记录，则错误！ 
                        '    (2)如果没有正在生效的记录，则日期必须大于最大失效时间！ 
                        '    (3)其他为有效 
                        '  该人该单位未定义：
                        '     有效

                        '记录存在？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows < 1 Then
                            blnValid = True
                            Exit Try
                        End If

                        '仍在生效？
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        strSQL = strSQL + " and   失效时间 is null" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        intRows = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 0)
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If intRows > 0 Then
                            strErrMsg = "错误：[" + strRYMC + "]已经定义过！"
                            blnValid = False
                            Exit Try
                        End If

                        '时间正确？
                        strSQL = ""
                        strSQL = strSQL + " select max(失效时间) from 地产_B_人事_助理架构" + vbCr
                        strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                        strSQL = strSQL + " and   所属单位 = '" + strSSDW + "'" + vbCr
                        If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                            GoTo errProc
                        End If
                        strMaxSXSJ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd hh:mm:ss")
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                        If CType(strBDSJ, System.DateTime) <= CType(strMaxSXSJ, System.DateTime) Then
                            strErrMsg = "错误：[" + strRYMC + "]只能在[" + strMaxSXSJ + "]时间以后！"
                            blnValid = False
                            Exit Try
                        End If

                        blnValid = True
                End Select
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doValidParamsJG_Add_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定时间的人员架构报表的所有数据
        ' 适用于人事管理模式二
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJCSJ                    ：检测时间
        '     objDataSet                 ：数据集(返回)
        '                        table(0)：报表参数
        '                        table(1)：索引数据
        '                        table(2)：业务经理
        '                        table(3)：营业经理协管
        '                        table(4)：营业经理直管
        '                        table(5)：区域经理
        '                        table(6)：区域总监
        '                        table(7)：管理架构
        '                        table(8)：助理架构
        '                        table(9)：单位信息
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-01-01 创建
        '     zengxianglin 2010-03-17 更改
        '----------------------------------------------------------------
        Public Function getDataSet_RYJG_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJCSJ As String, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim objDataSet01 As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_RYJG_X2 = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJCSJ = "" Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]未指定[检测时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]无效的[检测时间]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取临时SQL
                Dim strTempSQL1 As String = ""
                strSQL = "select dbo.uf_estate_rs_getRYJG01Sql_X2('" + strJCSJ + "')"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet01) = False Then
                    GoTo errProc
                End If
                If objDataSet01.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]无法计算[uf_estate_rs_getRYJG01Sql_X2]！"
                    GoTo errProc
                End If
                If objDataSet01.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]无法计算[uf_estate_rs_getRYJG01Sql_X2]！"
                    GoTo errProc
                End If
                strTempSQL1 = objPulicParameters.getObjectValue(objDataSet01.Tables(0).Rows(0).Item(0), "")
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
                Dim strTempSQL2 As String = ""
                strSQL = "select dbo.uf_estate_rs_getRYJG02Sql_X2('" + strJCSJ + "')"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet01) = False Then
                    GoTo errProc
                End If
                If objDataSet01.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]无法计算[uf_estate_rs_getRYJG02Sql_X2]！"
                    GoTo errProc
                End If
                If objDataSet01.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_RYJG_X2]无法计算[uf_estate_rs_getRYJG02Sql_X2]！"
                    GoTo errProc
                End If
                strTempSQL2 = objPulicParameters.getObjectValue(objDataSet01.Tables(0).Rows(0).Item(0), "")
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)

                '获取数据
                Try
                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '填充报表参数
                    objTempDataSet = New System.Data.DataSet
                    Dim objDataTable As System.Data.DataTable = Nothing
                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("报表行数", GetType(System.Int32))
                    objDataTable.Columns.Add("报表列数", GetType(System.Int32))
                    objDataTable.Columns.Add("总监列数", GetType(System.Int32))
                    objDataTable.Columns.Add("区经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("营直列数", GetType(System.Int32))
                    objDataTable.Columns.Add("营协列数", GetType(System.Int32))
                    objDataTable.Columns.Add("业经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("客经列数", GetType(System.Int32))
                    objDataTable.Columns.Add("顾问列数", GetType(System.Int32))
                    objDataTable.Columns.Add("文员列数", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("单位序号", GetType(System.Int32))
                    objDataTable.Columns.Add("单位行数", GetType(System.Int32))
                    'zengxianglin 2010-03-17
                    objDataTable.Columns.Add("团队人数", GetType(System.Int32))
                    'zengxianglin 2010-03-17
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("是否直管", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("是否直管", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("是否直管", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("是否直管", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("是否直管", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("唯一标识", GetType(String))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("人员状态", GetType(System.Int32))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("所属分组", GetType(String))
                    objDataTable.Columns.Add("直管单位", GetType(String))
                    objDataTable.Columns.Add("是否占编", GetType(System.Int32))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("生效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("失效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("人员名称", GetType(String))
                    objDataTable.Columns.Add("标准序列", GetType(System.Int32))
                    objDataTable.Columns.Add("团队编号", GetType(System.Int32))
                    objDataTable.Columns.Add("直管团队", GetType(String))
                    objDataTable.Columns.Add("协管团队", GetType(String))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("唯一标识", GetType(String))
                    objDataTable.Columns.Add("人员代码", GetType(String))
                    objDataTable.Columns.Add("职级代码", GetType(String))
                    objDataTable.Columns.Add("人员状态", GetType(System.Int32))
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("所属分组", GetType(String))
                    objDataTable.Columns.Add("直管单位", GetType(String))
                    objDataTable.Columns.Add("是否占编", GetType(System.Int32))
                    objDataTable.Columns.Add("上级领导", GetType(String))
                    objDataTable.Columns.Add("生效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("失效时间", GetType(System.DateTime))
                    objDataTable.Columns.Add("人员名称", GetType(String))
                    objDataTable.Columns.Add("标准序列", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    objDataTable = New System.Data.DataTable
                    objDataTable.Columns.Add("所属单位", GetType(String))
                    objDataTable.Columns.Add("单位名称", GetType(String))
                    objDataTable.Columns.Add("单位序号", GetType(System.Int32))
                    objDataTable.Columns.Add("编制人数", GetType(System.Int32))
                    objDataTable.Columns.Add("实际编制", GetType(System.Int32))
                    objTempDataSet.Tables.Add(objDataTable)

                    Dim strGUID As String = objPulicParameters.getNewGuid()
                    strGUID = strGUID.Replace("-", "_")
                    strGUID = "tempTable_" + strGUID
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " " + strTempSQL1 + vbCr
                        strSQL = strSQL + " " + strTempSQL2 + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_BBCS    from #tempTable_BBCS" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_SYSJ    from #tempTable_SYSJ" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_YWJL    from #tempTable_YWJL" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_YYJL_XG from #tempTable_YYJL_XG" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_YYJL_ZG from #tempTable_YYJL_ZG" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_QYJL    from #tempTable_QYJL" + vbCr
                        strSQL = strSQL + " select * into " + strGUID + "_QYZJ    from #tempTable_QYZJ" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_BBCS" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_SYSJ order by 单位序号,团队编号" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_YWJL order by 所属单位,团队编号,职级代码,是否直管,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_YYJL_XG order by 所属单位,团队编号,职级代码,是否直管,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_YYJL_ZG order by 所属单位,团队编号,职级代码,是否直管,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_QYJL order by 所属单位,团队编号,职级代码,是否直管,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        strSQL = ""
                        strSQL = strSQL + " select * from " + strGUID + "_QYZJ order by 所属单位,团队编号,职级代码,是否直管,人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(6))

                        strSQL = ""
                        strSQL = strSQL + " select a.*,b.人员名称" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + " order by a.所属单位,a.团队编号,a.职级代码,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(7))

                        strSQL = ""
                        strSQL = strSQL + " select a.*,b.人员名称" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getValidZhuliJiagou(@jcsj) a" + vbCr
                        strSQL = strSQL + " left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + " order by a.所属单位,a.职级代码,a.人员代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(8))

                        strSQL = ""
                        strSQL = strSQL + " select * from dbo.uf_estate_rs_getRenyuanJiagou_DW_X2(@jcsj) order by 单位序号,所属单位" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strJCSJ, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(9))

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strGUID + "_BBCS" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_SYSJ" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_YWJL" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_YYJL_XG" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_YYJL_ZG" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_QYJL" + vbCr
                        strSQL = strSQL + " drop table " + strGUID + "_QYZJ" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    If objTempDataSet.Tables.Count < 10 Then
                        strErrMsg = "错误：[getDataSet_RYJG_X2]获取数据出错！"
                        GoTo errProc
                    End If
                    objDataSet = objTempDataSet
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getDataSet_RYJG_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet01)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 获取[地产_B_人事_考核标准_X2_精英]数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2010-01-13 创建
        '----------------------------------------------------------------
        Public Function getDataSet_X2_KHBZ_JY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_JY
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_X2_KHBZ_JY = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_X2_KHBZ_JY]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_X2_KHBZ_JY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '从数据库中检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_考核标准_X2_精英 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_JY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_X2_KHBZ_JY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取[地产_B_人事_考核标准_X2_管理]数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2010-01-13 创建
        '----------------------------------------------------------------
        Public Function getDataSet_X2_KHBZ_GL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_GL
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_X2_KHBZ_GL = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_X2_KHBZ_GL]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_X2_KHBZ_GL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '从数据库中检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,case when a.团队属性=1 then '营业经理团队' when a.团队属性=2 then '业务经理团队' else '' end as 团队属性名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_考核标准_X2_管理 a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.团队属性" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_GL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_X2_KHBZ_GL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 完整事务保存
        '     [地产_B_人事_考核标准_X2_精英]
        '     [地产_B_人事_考核标准_X2_管理]
        ' 数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objDataSet_JY        ：要保存的[地产_B_人事_考核标准_X2_精英]
        '     objDataSet_GL        ：要保存的[地产_B_人事_考核标准_X2_管理]
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-01-13 创建
        '----------------------------------------------------------------
        Public Function doSave_X2_KHBZ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_JY As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal objDataSet_GL As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable_GL As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_GL
            Dim strTable_JY As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_X2_KHBZ_JY
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSave_X2_KHBZ = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSave_X2_KHBZ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_JY Is Nothing And objDataSet_GL Is Nothing Then
                    '不用保存！
                    Exit Try
                End If
                If objDataSet_JY.Tables(strTable_JY) Is Nothing And objDataSet_GL.Tables(strTable_GL) Is Nothing Then
                    '不用保存！
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                Dim i, intCount As Integer
                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()
                '核心处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '保存[地产_B_人事_考核标准_X2_精英]数据
                    If Not (objDataSet_JY Is Nothing) Then
                        If Not (objDataSet_JY.Tables(strTable_JY) Is Nothing) Then
                            Dim strWYBS As String = ""
                            Dim strZJDM As String = ""
                            Dim dblZSBZ As Double = 0
                            Dim dblSYBZ As Double = 0
                            With objDataSet_JY.Tables(strTable_JY)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strWYBS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_JY_WYBS), "")
                                    strZJDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_JY_ZJDM), "")
                                    dblZSBZ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_JY_ZSBZ), 0.0)
                                    dblSYBZ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_JY_SYBZ), 0.0)
                                    If strWYBS = "" Then
                                        strWYBS = objPulicParameters.getNewGuid()
                                        strSQL = ""
                                        strSQL = strSQL + " insert into 地产_B_人事_考核标准_X2_精英 (" + vbCr
                                        strSQL = strSQL + "   唯一标识,职级代码,正式标准,试用标准" + vbCr
                                        strSQL = strSQL + " ) values (" + vbCr
                                        strSQL = strSQL + "   @wybs,@zjdm,@zsbz,@sybz" + vbCr
                                        strSQL = strSQL + " )" + vbCr
                                        objSqlCommand.Parameters.Clear()
                                        objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                        objSqlCommand.Parameters.AddWithValue("@zjdm", strZJDM)
                                        objSqlCommand.Parameters.AddWithValue("@zsbz", dblZSBZ)
                                        objSqlCommand.Parameters.AddWithValue("@sybz", dblSYBZ)
                                        objSqlCommand.CommandText = strSQL
                                        objSqlCommand.ExecuteNonQuery()
                                    Else
                                        strSQL = ""
                                        strSQL = strSQL + " update 地产_B_人事_考核标准_X2_精英 set " + vbCr
                                        strSQL = strSQL + "   职级代码 = @zjdm,正式标准=@zsbz,试用标准=@sybz" + vbCr
                                        strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                        objSqlCommand.Parameters.Clear()
                                        objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                        objSqlCommand.Parameters.AddWithValue("@zjdm", strZJDM)
                                        objSqlCommand.Parameters.AddWithValue("@zsbz", dblZSBZ)
                                        objSqlCommand.Parameters.AddWithValue("@sybz", dblSYBZ)
                                        objSqlCommand.CommandText = strSQL
                                        objSqlCommand.ExecuteNonQuery()
                                    End If
                                Next
                            End With
                        End If
                    End If

                    '保存[地产_B_人事_考核标准_X2_管理]数据
                    If Not (objDataSet_GL Is Nothing) Then
                        If Not (objDataSet_GL.Tables(strTable_GL) Is Nothing) Then
                            Dim strWYBS As String = ""
                            Dim intTDSX As Integer
                            Dim intJZRS As Integer
                            Dim dblJZZB As Double = 0
                            Dim dblTZZB As Double = 0
                            With objDataSet_GL.Tables(strTable_GL)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strWYBS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_GL_WYBS), "")
                                    intTDSX = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_GL_TDSX), 0)
                                    intJZRS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_GL_JZRS), 0)
                                    dblJZZB = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_GL_JZZB), 0.0)
                                    dblTZZB = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_X2_KHBZ_GL_TZZB), 0.0)
                                    If strWYBS = "" Then
                                        strWYBS = objPulicParameters.getNewGuid()
                                        strSQL = ""
                                        strSQL = strSQL + " insert into 地产_B_人事_考核标准_X2_管理 (" + vbCr
                                        strSQL = strSQL + "   唯一标识,团队属性,基准指标,基准人数,调整指标" + vbCr
                                        strSQL = strSQL + " ) values (" + vbCr
                                        strSQL = strSQL + "   @wybs,@tdsx,@jzzb,@jzrs,@tzzb" + vbCr
                                        strSQL = strSQL + " )" + vbCr
                                        objSqlCommand.Parameters.Clear()
                                        objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                        objSqlCommand.Parameters.AddWithValue("@tdsx", intTDSX)
                                        objSqlCommand.Parameters.AddWithValue("@jzzb", dblJZZB)
                                        objSqlCommand.Parameters.AddWithValue("@jzrs", intJZRS)
                                        objSqlCommand.Parameters.AddWithValue("@tzzb", dblTZZB)
                                        objSqlCommand.CommandText = strSQL
                                        objSqlCommand.ExecuteNonQuery()
                                    Else
                                        strSQL = ""
                                        strSQL = strSQL + " update 地产_B_人事_考核标准_X2_管理 set " + vbCr
                                        strSQL = strSQL + "   团队属性 = @tdsx,基准指标=@jzzb,基准人数=@jzrs,调整指标=@tzzb" + vbCr
                                        strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                        objSqlCommand.Parameters.Clear()
                                        objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                        objSqlCommand.Parameters.AddWithValue("@tdsx", intTDSX)
                                        objSqlCommand.Parameters.AddWithValue("@jzzb", dblJZZB)
                                        objSqlCommand.Parameters.AddWithValue("@jzrs", intJZRS)
                                        objSqlCommand.Parameters.AddWithValue("@tzzb", dblTZZB)
                                        objSqlCommand.CommandText = strSQL
                                        objSqlCommand.ExecuteNonQuery()
                                    End If
                                Next
                            End With
                        End If
                    End If
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSave_X2_KHBZ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算业务精英的季度考核结果
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strJDKS                   ：考核季度开始日期
        '     strJDJS                   ：考核季度结束日期
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-01-13 创建
        '     zengxianglin 2010-05-06 更改(指定年度、季度、月截止日 -> 季度开始日期、季度结束日期)
        '----------------------------------------------------------------
        Public Function getDataSet_TJBB_X2_KHJG_JY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJDKS As String, _
            ByVal strJDJS As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_X2_KHJG_JY
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_TJBB_X2_KHJG_JY = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_JY]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                '========================================================================================================================================
                If strJDKS Is Nothing Then strJDKS = ""
                strJDKS = strJDKS.Trim
                If objPulicParameters.isDatetimeString(strJDKS) = False Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_JY]无效的日期[" + strJDKS + "]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strJDJS Is Nothing Then strJDJS = ""
                strJDJS = strJDJS.Trim
                If objPulicParameters.isDatetimeString(strJDJS) = False Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_JY]无效的日期[" + strJDJS + "]！"
                    GoTo errProc
                End If
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_VT_RS_X2_KHJG_JY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '从数据库中检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_x2_getKhjg_JY(@jdks, @jdjs) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.人员代码,a.考核年度,a.考核季度,a.考核月度,a.单位序号,a.团队编号,a.显示级别,a.结算日期,a.合同日期" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jdks", CType(strJDKS, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@jdjs", CType(strJDJS, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_X2_KHJG_JY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_TJBB_X2_KHJG_JY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算业务主管的季度考核结果
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strJDKS                   ：考核季度开始日期
        '     strJDJS                   ：考核季度结束日期
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     zengxianglin 2010-01-13 创建
        '     zengxianglin 2010-05-06 更改(指定年度、季度、月截止日 -> 季度开始日期、季度结束日期)
        '----------------------------------------------------------------
        Public Function getDataSet_TJBB_X2_KHJG_GL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJDKS As String, _
            ByVal strJDJS As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_X2_KHJG_GL
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_TJBB_X2_KHJG_GL = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_GL]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim
                '========================================================================================================================================
                If strJDKS Is Nothing Then strJDKS = ""
                strJDKS = strJDKS.Trim
                If objPulicParameters.isDatetimeString(strJDKS) = False Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_GL]无效的日期[" + strJDKS + "]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strJDJS Is Nothing Then strJDJS = ""
                strJDJS = strJDJS.Trim
                If objPulicParameters.isDatetimeString(strJDJS) = False Then
                    strErrMsg = "错误：[getDataSet_TJBB_X2_KHJG_GL]无效的日期[" + strJDJS + "]！"
                    GoTo errProc
                End If
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_VT_RS_X2_KHJG_GL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '从数据库中检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_x2_getKhjg_GL(@jdks, @jdjs) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.人员代码,a.考核年度,a.考核季度,a.考核月度,a.直管标记,a.单位序号,a.团队编号,a.显示级别,a.结算日期,a.合同日期" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jdks", CType(strJDKS, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@jdjs", CType(strJDJS, System.DateTime))
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_VT_RS_X2_KHJG_GL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_TJBB_X2_KHJG_GL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-公佣直提部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_GYZT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_GYZT = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*,职级名称 = dbo.uf_estate_rs_getZjmc(a.职级代码) " + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select 职级代码,计提比例 from 地产_B_人事_佣金标准_X2_公佣_直提" + vbCr
                        strSQL = strSQL + " ) a "
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_GYZT = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-公佣直提部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_GYXGZB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_GYXGZB = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select 计提比例, 区间最小, 区间最大" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X2_公佣_协管" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.区间最小" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_GYXGZB = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-公佣直提管部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        '     strWhere                  ：条件
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_GYZGZB( _
           ByRef strErrMsg As String, _
           ByVal strUserId As String, _
           ByVal strPassword As String, _
           ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
           ByVal strWhere As String) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_GYZGZB = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* " + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select 计提比例,最小任务比例,最大任务比例,区间最小,区间最大 " + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X2_公佣_直管" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + strWhere + vbCr
                        End If
                        strSQL = strSQL + "   group by 计提比例,区间最小,区间最大,最小任务比例,最大任务比例" + vbCr
                        strSQL = strSQL + " ) a order by a.区间最小,a.区间最大" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_GYZGZB = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准-公佣直管职级标准部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_GYZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_GYZG = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZJ)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   a.*,职级名称 = dbo.uf_estate_rs_getZjmc(a.职级代码) " + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.职级代码" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "	    select 职级代码,计提比例,最小任务比例,最大任务比例,区间最小,区间最大 " + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X2_公佣_直管" + vbCr
                        strSQL = strSQL + "     group by 职级代码,计提比例,最小任务比例,最大任务比例,区间最小,区间最大" + vbCr
                        strSQL = strSQL + "   ) a group by 职级代码" + vbCr
                        strSQL = strSQL + " ) a " + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZJ))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_GYZG = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        '' 计算佣金计提标准-私佣标准部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objestateRenshiXingyeData ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_Yjjtbz_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_Yjjtbz_SY = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select 计提比例, 区间最小, 区间最大,最小额度,最大额度" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X2_私佣" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.区间最小,a.最小额度" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getDataSet_Yjjtbz_SY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存地产_B_人事_佣金标准_X2_私佣计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_SYZB           ：私佣指标数据集-指标部分
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YongjinJitiBiaozhun_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_SYZB As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YongjinJitiBiaozhun_SY = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_SYZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_SY]未传入[私佣指标数据集-指标部分]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X2_私佣"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_SYZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X2_私佣(" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,最小额度,最大额度,生效时间" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl, @qjzx, @qjzd,@zxed,@zded,@sxsj"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY_JTBL))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY_QJZX))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY_QJZD))
                            objSqlCommand.Parameters.AddWithValue("@zxed", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY_ZXED))
                            objSqlCommand.Parameters.AddWithValue("@zded", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_SY_ZDED))
                            objSqlCommand.Parameters.AddWithValue("@sxsj", Now())
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YongjinJitiBiaozhun_SY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存地产_B_人事_佣金标准_X2_公佣_直管计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GYXGZB         ：直管指标数据集-指标部分
        '     strJJDM                   ：职级代码
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YongjinJitiBiaozhun_GYZGZB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GYZGZB As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal strJJDM As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YongjinJitiBiaozhun_GYZGZB = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYZGZB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GYZGZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYZGZB]未传入[公佣指标数据集-指标部分]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X2_公佣_直管 where 职级代码 = '" + strJJDM + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GYZGZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X2_公佣_直管(" + vbCr
                            strSQL = strSQL + "   唯一标识,职级代码,计提比例,区间最小,区间最大,最小任务比例,最大任务比例,生效时间" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jjdm,@jtbl, @qjzx, @qjzd,@zxrwbl,@zdrwbl,@sxsj"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jjdm", strJJDM)
                            objSqlCommand.Parameters.AddWithValue("@jtbl", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB_JTBL))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB_QJZX))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB_QJZD))
                            objSqlCommand.Parameters.AddWithValue("@zxrwbl", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB_ZXBL))
                            objSqlCommand.Parameters.AddWithValue("@zdrwbl", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZGZB_ZDBL))
                            objSqlCommand.Parameters.AddWithValue("@sxsj", Now())
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YongjinJitiBiaozhun_GYZGZB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 删除地产_B_人事_佣金标准_X2_公佣_直管计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strJJDM                   ：职级代码
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function doDelete_GYZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJJDM As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDelete_GYZG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDelete_GYZG]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X2_公佣_直管 where 职级代码 = '" + strJJDM + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDelete_GYZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存地产_B_人事_佣金标准_X2_公佣_直提计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GYZT           ：公佣_直提指标数据集-指标部分
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YongjinJitiBiaozhun_GYZT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GYZT As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YongjinJitiBiaozhun_GYZT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYZT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GYZT Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYZT]未传入[公佣_直提指标数据集-指标部分]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X2_公佣_直提"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GYZT.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZT).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X2_公佣_直提(" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,职级代码,生效时间" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl, @jjdm,@sxsj"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZT_JTBL))
                            objSqlCommand.Parameters.AddWithValue("@jjdm", .Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_ZT_ZJDM))
                            objSqlCommand.Parameters.AddWithValue("@sxsj", Now())
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YongjinJitiBiaozhun_GYZT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存地产_B_人事_佣金标准_X2_公佣_协管计提标准数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GYXGZB         ：协管指标数据集-指标部分
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     lijie 2010-1-17 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YongjinJitiBiaozhun_GYXG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GYXGZB As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YongjinJitiBiaozhun_GYXG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYXG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GYXGZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YongjinJitiBiaozhun_GYXG]未传入[公佣_协管指标数据集-指标部分]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim intCountA As Integer = 0
                Dim j As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X2_公佣_协管"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                    Dim strJTBL As String = ""
                    Dim strQJZX As String = ""
                    Dim strQJZD As String = ""

                    '增加私佣指标
                    With objDataSet_GYXGZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strJTBL = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG_JTBL), "")
                            strQJZX = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG_QJZX), "")
                            strQJZD = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_X2_GY_XG_QJZD), "")

                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X2_公佣_协管(" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,生效时间" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),'" + strJTBL + "', '" + strQJZX + "','" + strQJZD + "',getdate()"
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YongjinJitiBiaozhun_GYXG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function










        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-私佣标准部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_SY = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_SY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_B_人事_佣金标准_X3_私佣 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.区间最小,a.最小额度" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_SY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_SY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-直管公佣标准部分的涉及职级数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_GY_ZG_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_GY_ZG_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_GY_ZG_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_GY_ZG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select '' as 唯一标识,a.职级代码,0 as 区间最小,0 as 区间最大,0 as 最小额度,0 as 最大额度, 0 as 计提比例," + vbCr
                        strSQL = strSQL + "     b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   ("
                        strSQL = strSQL + "     select 职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X3_公佣_直管" + vbCr
                        strSQL = strSQL + "     group by 职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_GY_ZG_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-直管公佣标准部分的涉及指标数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_GY_ZG_ZB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_GY_ZG_ZB = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_GY_ZG_ZB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_GY_ZG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X3_公佣_直管 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小,a.最小额度" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_GY_ZG_ZB = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-协管公佣标准部分
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_GY_XG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_GY_XG = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_GY_XG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_GY_XG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_B_人事_佣金标准_X3_公佣_协管 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.区间最小" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_XG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_GY_XG = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-直提公佣标准部分的涉及职级数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_GY_ZT_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_GY_ZT_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_GY_ZT_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_GY_ZT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select '' as 唯一标识,a.职级代码,0 as 区间最小,0 as 区间最大,0 as 计提比例," + vbCr
                        strSQL = strSQL + "     b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   ("
                        strSQL = strSQL + "     select 职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X3_公佣_直提" + vbCr
                        strSQL = strSQL + "     group by 职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_GY_ZT_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X3]-直提公佣标准部分的涉及指标数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X3_GY_ZT_ZB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X3_GY_ZT_ZB = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X3_GY_ZT_ZB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X3_GY_ZT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X3_公佣_直提 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X3_GY_ZT_ZB = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X3_私佣]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_SY             ：私佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X3_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_SY As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_SY
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X3_SY = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_SY Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_SY]未传入[私佣指标]！"
                    GoTo errProc
                End If
                If objDataSet_SY.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_SY]未传入[私佣指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount, intCountA As Integer
                Dim i, j As Integer
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X3_私佣"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_SY.Tables(strTable).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X3_私佣" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,最小额度,最大额度" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd,@zxed,@zded" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_SY_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_SY_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_SY_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zxed", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_SY_ZXED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zded", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_SY_ZDED), 0.0))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X3_SY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X3_公佣_直管]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_ZG_ZB       ：指标数据
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X3_GY_ZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_ZG_ZB As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X3_GY_ZG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZG_ZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZG]未传入[直管指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZG_ZB.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZG]未传入[直管指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount, intCountA As Integer
                Dim i, j As Integer
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X3_公佣_直管"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '备份[RowFilter]
                    Dim strOldFilter As String = ""
                    With objDataSet_GY_ZG_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    '增加私佣指标
                    With objDataSet_GY_ZG_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X3_公佣_直管" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,职级代码,计提比例,区间最小,区间最大,最小额度,最大额度" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@zjdm,@jtbl,@qjzx,@qjzd,@zxed,@zded" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_ZJDM), ""))
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zxed", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_ZXED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zded", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZG_ZDED), 0.0))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    '还原[RowFilter]
                    With objDataSet_GY_ZG_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZG).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X3_GY_ZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X3_公佣_协管]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_XG          ：私佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X3_GY_XG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_XG As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_XG
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X3_GY_XG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_XG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_XG Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_XG]未传入[协管指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_XG.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_XG]未传入[协管指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount, intCountA As Integer
                Dim i, j As Integer
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X3_公佣_协管"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GY_XG.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_XG).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X3_公佣_协管" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_XG_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_XG_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_XG_QJZD), 0.0))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X3_GY_XG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X3_公佣_直提]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_ZT_ZB       ：指标数据
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2010-05-04 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X3_GY_ZT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_ZT_ZB As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X3_GY_ZT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZT_ZB Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZT]未传入[直提指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZT_ZB.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X3_GY_ZT]未传入[直提指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intCount, intCountA As Integer
                Dim i, j As Integer
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X3_公佣_直提"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '备份[RowFilter]
                    Dim strOldFilter As String = ""
                    With objDataSet_GY_ZT_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    '增加私佣指标
                    With objDataSet_GY_ZT_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X3_公佣_直提" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,职级代码,计提比例,区间最小,区间最大" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@zjdm,@jtbl,@qjzx,@qjzd" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZT_ZJDM), ""))
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZT_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZT_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X3_GY_ZT_QJZD), 0.0))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    '还原[RowFilter]
                    With objDataSet_GY_ZT_ZB.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X3_GY_ZT).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X3_GY_ZT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-私佣标准部分-职级列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_SY_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_SY_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_SY_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_SY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.职级代码,b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X4_私佣 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "     group by a.职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_SY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_SY_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-私佣标准部分-全部数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_SY = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_SY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X4_私佣 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小,a.区间最大" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_SY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_SY = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-直管公佣标准部分-职级列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_ZG_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_ZG_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_ZG_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_ZG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.职级代码,b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X4_公佣_直管 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "     group by a.职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_ZG_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-直管公佣标准部分-全部数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_ZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_ZG = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_ZG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_ZG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X4_公佣_直管 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小,a.区间最大" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_ZG = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-协管公佣标准部分-职级列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_XG_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_XG_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_XG_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_XG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.职级代码,b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X4_公佣_协管 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "     group by a.职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_XG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_XG_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-协管公佣标准部分-全部数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_XG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_XG = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_XG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_XG)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X4_公佣_协管 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小,a.区间最大" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_XG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_XG = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-直接计提公佣标准部分-职级列表
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_ZT_ZJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_ZT_ZJ = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_ZT_ZJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_ZT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.职级代码,b.职级名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.职级代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_佣金标准_X4_公佣_直提 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "     group by a.职级代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.职级代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_ZT_ZJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算佣金计提标准[X4]-直接计提公佣标准部分-全部数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strWhere                  ：搜索条件
        '     objRetDataSet             ：信息数据集
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function getDataSet_YJBZ_X4_GY_ZT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_YJBZ_X4_GY_ZT = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_YJBZ_X4_GY_ZT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_YJBZ_X4_GY_ZT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.职级名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_人事_佣金标准_X4_公佣_直提 a" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 b on a.职级代码=b.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "     where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.职级代码,a.区间最小,a.区间最大" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_YJBZ_X4_GY_ZT = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X4_私佣]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_SY             ：私佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X4_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_SY As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_SY
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X4_SY = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_SY Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_SY]未传入[私佣指标]！"
                    GoTo errProc
                End If
                If objDataSet_SY.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_SY]未传入[私佣指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intCount, intCountA As Integer
                Dim strOldFilter As String = ""
                Dim i, j As Integer
                Try
                    '保存现有过滤条件
                    With objDataSet_SY.Tables(strTable).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X4_私佣"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_SY.Tables(strTable).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X4_私佣" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,最小额度,最大额度,职级代码" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd,@zxed,@zded,@zjdm" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zxed", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_ZXED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zded", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_ZDED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_SY_ZJDM), ""))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    With objDataSet_SY.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    With objDataSet_SY.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X4_SY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X4_公佣_直管]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_ZG          ：直管公佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X4_GY_ZG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_ZG As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZG
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X4_GY_ZG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZG Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZG]未传入[私佣指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZG.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZG]未传入[私佣指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intCount, intCountA As Integer
                Dim strOldFilter As String = ""
                Dim i, j As Integer
                Try
                    '保存现有过滤条件
                    With objDataSet_GY_ZG.Tables(strTable).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X4_公佣_直管"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GY_ZG.Tables(strTable).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X4_公佣_直管" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,最小额度,最大额度,职级代码" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd,@zxed,@zded,@zjdm" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zxed", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_ZXED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zded", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_ZDED), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZG_ZJDM), ""))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    With objDataSet_GY_ZG.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    With objDataSet_GY_ZG.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X4_GY_ZG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X4_公佣_协管]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_XG          ：协管公佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X4_GY_XG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_XG As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_XG
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X4_GY_XG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_XG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_XG Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_XG]未传入[私佣指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_XG.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_XG]未传入[私佣指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intCount, intCountA As Integer
                Dim strOldFilter As String = ""
                Dim i, j As Integer
                Try
                    '保存现有过滤条件
                    With objDataSet_GY_XG.Tables(strTable).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X4_公佣_协管"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GY_XG.Tables(strTable).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X4_公佣_协管" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,职级代码" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd,@zjdm" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_XG_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_XG_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_XG_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_XG_ZJDM), ""))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    With objDataSet_GY_XG.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    With objDataSet_GY_XG.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X4_GY_XG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存[地产_B_人事_佣金标准_X4_公佣_协管]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objDataSet_GY_ZT          ：直接计提公佣指标
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改
        '     zengxianglin 2011-01-10 创建
        '----------------------------------------------------------------
        Public Function doSaveData_YJBZ_X4_GY_ZT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objDataSet_GY_ZT As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_YJBZ_X4_GY_ZT
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_YJBZ_X4_GY_ZT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZT Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZT]未传入[私佣指标]！"
                    GoTo errProc
                End If
                If objDataSet_GY_ZT.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_YJBZ_X4_GY_ZT]未传入[私佣指标]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intCount, intCountA As Integer
                Dim strOldFilter As String = ""
                Dim i, j As Integer
                Try
                    '保存现有过滤条件
                    With objDataSet_GY_ZT.Tables(strTable).DefaultView
                        strOldFilter = .RowFilter
                        .RowFilter = ""
                    End With

                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除全部指标数据
                    strSQL = " delete from 地产_B_人事_佣金标准_X4_公佣_直提"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '增加私佣指标
                    With objDataSet_GY_ZT.Tables(strTable).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_佣金标准_X4_公佣_直提" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,计提比例,区间最小,区间最大,职级代码" + vbCr
                            strSQL = strSQL + " ) values(" + vbCr
                            strSQL = strSQL + "   newid(),@jtbl,@qjzx,@qjzd,@zjdm" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jtbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZT_JTBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZT_QJZX), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@qjzd", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZT_QJZD), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zjdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YJBZ_X4_GY_ZT_ZJDM), ""))
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                    With objDataSet_GY_ZT.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                Catch ex As Exception
                    With objDataSet_GY_ZT.Tables(strTable).DefaultView
                        .RowFilter = strOldFilter
                    End With
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_YJBZ_X4_GY_ZT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_人事_招聘渠道”的SQL语句(以招聘渠道代码升序排序)
        ' 返回
        '                          ：SQL
        '----------------------------------------------------------------
        Public Function getZhaopinqudaoSQL() As String
            getZhaopinqudaoSQL = "select * from 地产_B_人事_招聘渠道 order by 招聘渠道代码"
        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_人事_招聘渠道”完全数据的数据集(以招聘渠道代码升序排序)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWhere             ：搜索字符串
        '     objestateRenshiXingyeData：信息数据集
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getZhaopinqudaoData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objTempestateRenshiXingyeData As Josco.JSOA.Common.Data.estateRenshiXingyeData
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand

            '初始化
            getZhaopinqudaoData = False
            objestateRenshiXingyeData = Nothing
            strErrMsg = ""

            Try
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()

                '检查
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Dim strSQL As String
                Try
                    '创建数据集
                    objTempestateRenshiXingyeData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_ZHAOPINQUDAO)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* " + vbCr
                        strSQL = strSQL + " from 地产_B_人事_招聘渠道 a " + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.招聘渠道代码 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateRenshiXingyeData.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_ZHAOPINQUDAO))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateRenshiXingyeData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateRenshiXingyeData = objTempestateRenshiXingyeData
            getZhaopinqudaoData = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempestateRenshiXingyeData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_人事_招聘渠道”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型

        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function doVerifyZhaopinqudaoData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim objListDictionary As System.Collections.Specialized.ListDictionary

            doVerifyZhaopinqudaoData = False

            Try
                Dim strOldKHLXDM As String
                Dim strKHLXDM As String
                Dim strKHLXMC As String
                Dim intLen As Integer
                Dim strSQL As String

                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                        strOldKHLXDM = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM), "")
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_人事_招聘渠道"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_人事_招聘渠道", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                strKHLXDM = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM), "")
                If strKHLXDM = "" Then
                    strErrMsg = "错误：[招聘渠道代码]不能为空！"
                    GoTo errProc
                End If
                With objDataSet.Tables(0).Columns(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM)
                    intLen = objPulicParameters.getStringLength(strKHLXDM)
                    If intLen > .MaxLength Then
                        strErrMsg = "错误：[招聘渠道代码]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                        GoTo errProc
                    End If
                End With

                strKHLXMC = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_MC), "")
                If strKHLXMC = "" Then
                    strErrMsg = "错误：[招聘渠道名称]不能为空！"
                    GoTo errProc
                End If
                With objDataSet.Tables(0).Columns(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_MC)
                    intLen = objPulicParameters.getStringLength(strKHLXMC)
                    If intLen > .MaxLength Then
                        strErrMsg = "错误：[招聘渠道名称]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                        GoTo errProc
                    End If
                End With

                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objDataSet = Nothing

                '检查约束
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                        strSQL = "select * from 地产_B_人事_招聘渠道 where 招聘渠道代码 = @KHLXDM"
                        objListDictionary.Add("@KHLXDM", strKHLXDM)
                    Case Else
                        strSQL = "select * from 地产_B_人事_招聘渠道 where 招聘渠道代码 = @KHLXDM and 招聘渠道代码 <> @oldKHLXDM"
                        objListDictionary.Add("@KHLXDM", strKHLXDM)
                        objListDictionary.Add("@oldKHLXDM", strOldKHLXDM)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strKHLXDM + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objDataSet = Nothing
                objListDictionary.Clear()

                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                        strSQL = "select * from 地产_B_人事_招聘渠道 where 招聘渠道名称 = @KHLXMC"
                        objListDictionary.Add("@KHLXMC", strKHLXMC)
                    Case Else
                        strSQL = "select * from 地产_B_人事_招聘渠道 where 招聘渠道名称 = @KHLXMC and 招聘渠道代码 <> @oldKHLXDM"
                        objListDictionary.Add("@KHLXMC", strKHLXMC)
                        objListDictionary.Add("@oldKHLXDM", strOldKHLXDM)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strKHLXMC + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objDataSet = Nothing
                objListDictionary.Clear()
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyZhaopinqudaoData = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_人事_招聘渠道”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveZhaopinqudaoData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand

            '初始化
            doSaveZhaopinqudaoData = False
            strErrMsg = ""

            Try
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""

                '检查
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim strSQL As String
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKHLXDM As String
                    Dim strKHLXDM As String
                    Dim strKHLXMC As String
                    strKHLXDM = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM)
                    strKHLXMC = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_MC)
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_人事_招聘渠道 (招聘渠道代码,招聘渠道名称)"
                            strSQL = strSQL + " values (@KHLXDM, @KHLXMC)"
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@KHLXDM", strKHLXDM)
                            objSqlCommand.Parameters.AddWithValue("@KHLXMC", strKHLXMC)
                        Case Else
                            With New Josco.JsKernal.Common.Utilities.PulicParameters
                                strOldKHLXDM = .getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM), "")
                            End With
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_招聘渠道 set "
                            strSQL = strSQL + "   招聘渠道代码 = @KHLXDM,"
                            strSQL = strSQL + "   招聘渠道名称 = @KHLXMC"
                            strSQL = strSQL + " where 招聘渠道代码 = @oldKHLXDM"
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@KHLXDM", strKHLXDM)
                            objSqlCommand.Parameters.AddWithValue("@KHLXMC", strKHLXMC)
                            objSqlCommand.Parameters.AddWithValue("@oldKHLXDM", strOldKHLXDM)
                    End Select

                    '执行SQL
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveZhaopinqudaoData = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_人事_招聘渠道”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteZhaopinqudaoData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow) As Boolean

            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand

            '初始化
            doDeleteZhaopinqudaoData = False
            strErrMsg = ""

            Try
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""

                '检查
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：未传入旧的数据！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '删除数据
                Dim strSQL As String
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKHLXDM As String
                    With New Josco.JsKernal.Common.Utilities.PulicParameters
                        strOldKHLXDM = .getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_ZHAOPINQUDAO_DM), "")
                    End With
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_人事_招聘渠道 "
                    strSQL = strSQL + " where 招聘渠道代码 = @oldKHLXDM"
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldKHLXDM", strOldKHLXDM)

                    '执行SQL
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDeleteZhaopinqudaoData = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        '获取入职信息的简历编号
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strJLBH        ：简历编号
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function getNewRZJLBH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strJLBH As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand

            '初始化
            getNewRZJLBH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '检索数据
                Dim strPrefix As String
                Dim intMon As Integer
                Dim strMon As String = ""

                intMon = Month(Now)
                If intMon < 10 Then
                    strMon = "0" & intMon.ToString
                End If
                strPrefix = Right(Year(Now).ToString(), 2) + strMon
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "简历编号", "地产_B_人事_入职审批_人员信息", 7, strPrefix, True, strJLBH) = False Then
                    GoTo errProc
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getNewRZJLBH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function


        '----------------------------------------------------------------
        ' 保存不通过“地产_B_人事_入职审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_BTG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_BTG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout


                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_入职审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)
               

                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPSM))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                'Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_BTG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function


        '----------------------------------------------------------------
        ' 保存不通过“地产_B_人事_调整审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_BTG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal blnTZ As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_BTG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout


                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_调整审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)
               

                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPSM))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                'Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_BTG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存不通过“地产_B_人事_离职审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_BTG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal strLZ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_BTG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout


                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_离职审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)


                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPSM))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                'Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_BTG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存不通过“地产_B_人事_实习生审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_BTG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal intSXS As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_BTG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout


                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_实习生审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)


                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPSM))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                'Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_BTG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function


        '----------------------------------------------------------------
        ' 保存通过“地产_B_人事_入职审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_TG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_TG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_入职审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm, 拟报到日期=@bdrq,"
                strSQL = strSQL + "  是否兼职=@sfjz"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)
             
              
                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_WYBS))
                 strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SFJZ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sfjz", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sfjz", CType(strValue, System.Int32))
                End If
               
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_SPSM))

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_NBDRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@bdrq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@bdrq", CType(strValue, System.DateTime))
                End If

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                '    Next
                'End With

                strSQL = ""
                strSQL = strSQL + " update  公共_B_人员 " + vbCr
                strSQL = strSQL + "  set 是否考勤=@sfkq,入职时间=@rzrq"
                strSQL = strSQL + " where 人员代码= @rydm" + vbCr

                objSqlCommand.Parameters.Clear()
                strValue = "1"
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sfkq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sfkq", CType(strValue, System.Int32))
                End If
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_NBDRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@rzrq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@rzrq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@rydm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_RUZHISHENPI_RENYUANXINXI_RYDM))
                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_TG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存通过“地产_B_人事_调整审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_TG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal blnTZ As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_TG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_调整审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm, 报到日期=@bdrq"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)
               
                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SPSM))

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_BDRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@bdrq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@bdrq", CType(strValue, System.DateTime))
                End If

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                '    Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_TG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 保存通过“地产_B_人事_离职审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_TG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal strLZ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_TG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_离职审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)

                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_SPSM))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                '    Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_TG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function


        '----------------------------------------------------------------
        ' 保存通过“地产_B_人事_实习生审批_人员信息”数据
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strWJBS                ：文件标识
        '     objNewData             ：记录新值(返回保存后的新值)
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function doSaveRyxx_TG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWJBS As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal intSXS As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI

            '初始化
            doSaveRyxx_TG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                strUserId = strUserId.Trim()
                strPassword = strPassword.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If


                ''获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlCommand = objSqlConnection.CreateCommand()
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.Transaction = objSqlTransaction
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '保存新数据
                Dim strSQL As String = ""
                Dim strValue As String = ""
                Dim intCount As Integer
                Dim i As Integer

                '写数据
                strSQL = ""
                strSQL = strSQL + " update  地产_B_人事_实习生审批_人员信息 " + vbCr
                strSQL = strSQL + "  set 审批结果=@spjg,审批日期=@sprq,审批人=@spr,审批说明=@spsm, 拟报到日期=@bdrq,"
                strSQL = strSQL + "  是否兼职=@sfjz,工资待遇=@gzdy"
                strSQL = strSQL + " where 文件标识 = @wjbs and 唯一标识=@wybs" + vbCr

                objSqlCommand.Parameters.Clear()
                objSqlCommand.Parameters.AddWithValue("@wjbs", strWJBS)


                objSqlCommand.Parameters.AddWithValue("@wybs", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_WYBS))
                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPJG)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@spjg", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@spjg", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SFJZ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sfjz", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sfjz", CType(strValue, System.Int32))
                End If

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@sprq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@sprq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@spr", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPR))
                objSqlCommand.Parameters.AddWithValue("@spsm", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_SPSM))

                strValue = objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_NBDRQ)
                If strValue = "" Then
                    objSqlCommand.Parameters.AddWithValue("@bdrq", System.DBNull.Value)
                Else
                    objSqlCommand.Parameters.AddWithValue("@bdrq", CType(strValue, System.DateTime))
                End If
                objSqlCommand.Parameters.AddWithValue("@gzdy", objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI_GZDY))

                objSqlCommand.CommandText = strSQL
                objSqlCommand.ExecuteNonQuery()
                '    Next
                'End With

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveRyxx_TG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function
        End Function

        '----------------------------------------------------------------
        ' 获取审批人员打印数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strUserXM                 :打印者姓名
        '     strWhere                  ：搜索条件
        '     objDataSet                ：信息数据集

        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getPrintRyxxData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strUserXM As String, _
            ByVal strWhere As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getPrintRyxxData = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_RUZHISHENPI_RENYUANXINXI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                       
                        strSQL = ""
                        strSQL = strSQL + " select count(*) as 序号,a.唯一标识,a.招聘渠道,a.人员姓名,a.人员性别,a.人员年龄,a.人员学历,a.拟分配部门,a.拟担任职位,a.招聘说明,a.网络技能,a.人员状态名称,a.现有人员,a.定编人数"
                        strSQL = strSQL + " from "
                        strSQL = strSQL + " ("
                        strSQL = strSQL + " select 唯一标识,招聘渠道,人员姓名,人员性别,人员年龄,人员学历,拟分配部门 + '('+ 部门经理+')' as 拟分配部门,拟担任职位,招聘说明,网络技能,"
                        strSQL = strSQL + "     人员状态名称 = case  when a.人员状态 & 2 = 2 then '正'" + vbCr
                        strSQL = strSQL + "                         else '' end," + vbCr
                        strSQL = strSQL + " 现有人员=isnull(dbo.uf_estate_rs_getRenyuanJiagou_DW_SJBZ(getdate(),单位代码),0),  "
                        strSQL = strSQL + " 定编人数=dbo.uf_estate_rs_getRenyuanJiagou_DW_BZRS_LJ(getdate(),a.单位代码)  from  "
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + " select a.* from 地产_B_人事_入职审批_人员信息  a " + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " inner join "
                        strSQL = strSQL + " ("
                        strSQL = strSQL + " select 唯一标识,招聘渠道,人员姓名,人员性别,人员年龄,人员学历,拟分配部门 + '('+ 部门经理+')' as 拟分配部门,拟担任职位,招聘说明,网络技能,"
                        strSQL = strSQL + "     人员状态名称 = case  when a.人员状态 & 2 = 2 then '正'" + vbCr
                        strSQL = strSQL + "                         else '' end," + vbCr
                        strSQL = strSQL + " 现有人员=isnull(dbo.uf_estate_rs_getRenyuanJiagou_DW_SJBZ(getdate(),单位代码),0),  "
                        strSQL = strSQL + " 定编人数=dbo.uf_estate_rs_getRenyuanJiagou_DW_BZRS_LJ(getdate(),a.单位代码)  from  "
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + " select a.* from 地产_B_人事_入职审批_人员信息  a " + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "  ) b on a.唯一标识>=b.唯一标识 group by a.唯一标识,a.招聘渠道,a.人员姓名,a.人员性别,a.人员年龄,a.人员学历,a.拟分配部门,a.拟担任职位,a.招聘说明,a.网络技能,a.人员状态名称,a.现有人员,a.定编人数"
                        strSQL = strSQL + " order by a.序号,a.拟分配部门 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_RUZHISHENPI_RENYUANXINXI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getPrintRyxxData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取调整审批人员打印数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strUserXM                 :打印者姓名
        '     strWhere                  ：搜索条件
        '     objDataSet                ：信息数据集

        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getPrintRyxxData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strUserXM As String, _
            ByVal strWhere As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal strTZ As String) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getPrintRyxxData = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_TIAOZHENG_RENYUANXINXI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL

                        strSQL = ""
                        strSQL = strSQL + " select count(*) as 序号,substring(convert(varchar(100),a.生效日期,120),1,10) as '生效日期',a.唯一标识,a.人员姓名,a.人员代码,a.原职级名称,a.职级名称,a.原单位名称,a.单位名称"
                        strSQL = strSQL + " from "
                        strSQL = strSQL + " ("
                        strSQL = strSQL + " select 生效日期,唯一标识,文件标识,人员姓名,人员代码,原职级名称,职级名称, '原单位名称'=case   when left(原职级名称,7)='030.010' then 原单位名称 "
                        strSQL = strSQL + " else 原单位名称 + '('+ 上级经理 +')' end"
                        strSQL = strSQL + "  , '单位名称'=case   when left(职级名称,7)='030.010' then 单位名称 "
                        strSQL = strSQL + "  else 单位名称 + '('+ 上级领导名称 +')' end   from  "
                        strSQL = strSQL + "     ( "
                        strSQL = strSQL + "  select 唯一标识,文件标识,人员姓名,人员代码,  '原单位名称'=case "
                        strSQL = strSQL + "  when 原直管团队名称=''and 原协管团队名称='' then 原单位名称+'_'+ cast(原团队编号 as varchar(2))    "
                        strSQL = strSQL + "  when 原直管团队名称<>'' and 原协管团队名称<>'' then 原直管团队名称+'(直管)'+原协管团队名称+'(协管)'  "
                        strSQL = strSQL + "  when 原直管团队名称<>'' and 原协管团队名称='' then 原直管团队名称+'(直管)'   when 原直管团队名称=''"
                        strSQL = strSQL + "  and 原协管团队名称<>'' then 原协管团队名称+'(协管)'   end, 	  '单位名称'=case   when 直管团队名称=''"
                        strSQL = strSQL + " and 协管团队名称='' then 单位名称+'_'+cast(团队编号 as varchar(2))    when 直管团队名称<>'' and 协管团队名称<>''"
                        strSQL = strSQL + "  then 直管团队名称+'(直管)'+协管团队名称+'(协管)'    when 直管团队名称<>'' and 协管团队名称='' then 直管团队名称+'(直管)'"
                        strSQL = strSQL + "   when 直管团队名称='' and 协管团队名称<>'' then 协管团队名称+'(协管)' "
                        strSQL = strSQL + "  end,  单位代码,原单位代码,原职级代码,职级代码,原职级名称,职级名称,原团队编号,团队编号,上级领导名称,上级经理,生效日期  "
                        strSQL = strSQL + "  from   "
                        strSQL = strSQL + "             (    "
                        strSQL = strSQL + "   select a.* from 地产_B_人事_调整审批_人员信息  a     "
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "             )a "
                        strSQL = strSQL + "      )a"
                        strSQL = strSQL + " )a"
                        strSQL = strSQL + " inner join "
                        strSQL = strSQL + " ("
                        strSQL = strSQL + " select 生效日期,唯一标识,文件标识,人员姓名,人员代码,原职级名称,职级名称, '原单位名称'=case   when left(原职级名称,7)='030.010' then 原单位名称 "
                        strSQL = strSQL + " else 原单位名称 + '('+ 上级经理 +')' end"
                        strSQL = strSQL + "  , '单位名称'=case   when left(职级名称,7)='030.010' then 单位名称 "
                        strSQL = strSQL + "  else 单位名称 + '('+ 上级领导名称 +')' end   from  "
                        strSQL = strSQL + "    ( "
                        strSQL = strSQL + "  select 唯一标识,文件标识,人员姓名,人员代码,  '原单位名称'=case "
                        strSQL = strSQL + "  when 原直管团队名称=''and 原协管团队名称='' then 原单位名称+'_'+ cast(原团队编号 as varchar(2))    "
                        strSQL = strSQL + "   when 原直管团队名称<>'' and 原协管团队名称<>'' then 原直管团队名称+'(直管)'+原协管团队名称+'(协管)'  "
                        strSQL = strSQL + "   when 原直管团队名称<>'' and 原协管团队名称='' then 原直管团队名称+'(直管)'   when 原直管团队名称=''"
                        strSQL = strSQL + "  and 原协管团队名称<>'' then 原协管团队名称+'(协管)'   end, 	  '单位名称'=case   when 直管团队名称=''"
                        strSQL = strSQL + " and 协管团队名称='' then 单位名称+'_'+cast(团队编号 as varchar(2))    when 直管团队名称<>'' and 协管团队名称<>''"
                        strSQL = strSQL + "  then 直管团队名称+'(直管)'+协管团队名称+'(协管)'    when 直管团队名称<>'' and 协管团队名称='' then 直管团队名称+'(直管)'"
                        strSQL = strSQL + "  when 直管团队名称='' and 协管团队名称<>'' then 协管团队名称+'(协管)' "
                        strSQL = strSQL + " end,  单位代码,原单位代码,原职级代码,职级代码,原职级名称,职级名称,原团队编号,团队编号,上级领导名称,上级经理,生效日期  "
                        strSQL = strSQL + "  from   "
                        strSQL = strSQL + "         (     "
                        strSQL = strSQL + "  select a.* from 地产_B_人事_调整审批_人员信息  a "
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "         )a "
                        strSQL = strSQL + "     )a"
                        strSQL = strSQL + "  ) b on a.唯一标识>=b.唯一标识 group by a.唯一标识,a.人员姓名,a.人员代码,a.原职级名称,a.职级名称,a.原单位名称,a.生效日期,a.单位名称"
                        strSQL = strSQL + " order by 序号 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TIAOZHENG_RENYUANXINXI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getPrintRyxxData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取实习生审批人员打印数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strUserXM                 :打印者姓名
        '     strWhere                  ：搜索条件
        '     objDataSet                ：信息数据集

        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getPrintRyxxData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strUserXM As String, _
            ByVal strWhere As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal intSXS As Integer) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getPrintRyxxData = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL

                        strSQL = ""
                        strSQL = strSQL + " select 招聘渠道,就读学校,专业,人员姓名,人员性别,人员年龄,人员学历,拟分配部门 + '('+ 部门经理+')' as 拟分配部门,拟担任职位,招聘说明,网络技能,"
                        strSQL = strSQL + " 现有人员=isnull(dbo.uf_estate_rs_getRenyuanJiagou_DW_SJBZ(getdate(),单位代码),0),  "
                        strSQL = strSQL + " 定编人数=dbo.uf_estate_rs_getRenyuanJiagou_DW_BZRS_LJ(getdate(),a.单位代码)  from  "
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + " select a.* from 地产_B_人事_实习生审批_人员信息  a " + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.拟分配部门 " + vbCr


                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_SHIXISHENGSHENPI_RENYUANXINXI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getPrintRyxxData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        ' 获取离职审批人员打印数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strUserXM                 :打印者姓名
        '     strWhere                  ：搜索条件
        '     objDataSet                ：信息数据集

        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getPrintRyxxData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strUserXM As String, _
            ByVal strWhere As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal strLZ As Boolean) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getPrintRyxxData = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_RUZHISHENPI_RENYUANXINXI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL

                        strSQL = ""
                        strSQL = strSQL + " select a.* from 地产_B_人事_离职审批_人员信息  a " + vbCr
                        'strSQL = strSQL + " left join 公文_b_交接 b " + vbCr
                        'strSQL = strSQL + " on a.文件标识= b.文件标识 " + vbCr
                        ''strSQL = strSQL + " where  a.审批结果=1 and a.审批人 = '' and a.审批日期 is  null and b.办理状态='正在办理' " + vbCr
                        'strSQL = strSQL + " where  b.接收人='" + strUserXM + "'" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.单位名称 " + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_LIZHI_RENYUANXINXI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getPrintRyxxData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存团队临时数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objNewData                :准备数据
        '     intZTLX                   :审批状态类型
        '     objDataSet_TDZH           ：团队数据

        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doSaveTDTempData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intZTLX As Integer, _
            ByVal objNewData As System.Data.DataRow, _
            ByRef objDataSet_TDZH As Josco.JSOA.Common.Data.estateRenshiXingyeData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveTDTempData = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                objSqlTransaction = objSqlConnection.BeginTransaction()

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_TIAOZHENG_RENYUANXINXI)

                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算新的GUID
                    Dim strNewId As String = objPulicParameters.getNewGuid()
                    Dim strTable_Insert As String = ""

                    '写对应的直管团队数据
                    If intZTLX = 0 Then
                        strTable_Insert = "地产_B_人事_团队组合_临时"
                    Else
                        strTable_Insert = "地产_B_人事_团队组合_审批"
                    End If

                    Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    Dim strZBBS As String = ""
                    Dim i, intCount As Integer
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into " + strTable_Insert + " (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If

                    '写对应的协管团队数据
                    strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_XGTD), "")
                    If Not (objDataSet_TDZH Is Nothing) Then
                        If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                            With objDataSet_TDZH.Tables(strTable)
                                .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                                intCount = .DefaultView.Count
                                For i = 0 To intCount - 1 Step 1
                                    strSQL = ""
                                    strSQL = strSQL + " insert into " + strTable_Insert + " (组合标识,组别标识,所属单位,团队编号)" + vbCr
                                    strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                                    objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                                    objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                                    objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Next
                            End With
                        End If
                    End If

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveTDTempData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除团队临时数据
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strZBBS                   :准备数据
        '     intZTLX                   :审批状态类型
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doDeleteTDTempData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strZBBS As String, _
            ByVal intZTLX As Integer) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDeleteTDTempData = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If
               

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                Dim strTable_Delete As String = ""
                '写对应的直管团队数据
                If intZTLX = 0 Then
                    strTable_Delete = "地产_B_人事_团队组合_临时"
                Else
                    strTable_Delete = "地产_B_人事_团队组合_审批"
                End If

                '获取数据
                Try
                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL

                        strSQL = ""
                        strSQL = " delete  " + strTable_Delete + " where 组别标识='" + strZBBS + "'"

                        '设置参数
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
               
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            
            doDeleteTDTempData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function



        '----------------------------------------------------------------
        ' 按指定信息将人员从架构中注销
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objEnvInfo           ：变动通用参数（BDLX,BDSJ,BDYY,BDYYMC）
        '     objMainInfo          ：主变动人当前人员架构参数
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDelete_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objEnvInfo As System.Collections.Specialized.NameValueCollection, _
            ByVal objMainInfo As System.Data.DataRow) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objXJTmpData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objXJData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDelete_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objEnvInfo Is Nothing Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End If
                If objMainInfo Is Nothing Then
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]没有指定[离岗人员信息]！"
                    GoTo errProc
                End If

                '获取环境参数
                Dim objBDSJ As System.DateTime
                Dim strBDYY As String = ""
                Dim intBDLX As Integer
                Try
                    intBDLX = objPulicParameters.getObjectValue(objEnvInfo("BDLX"), 0)
                    objBDSJ = CType(objEnvInfo("BDSJ"), System.DateTime)
                    strBDYY = objEnvInfo("BDYY")
                Catch ex As Exception
                    strErrMsg = "错误：[doDelete_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End Try

                '获取主变动人参数
                Dim strRYDM As String = ""
                Dim strWYBS As String = ""
                Dim strSSDW As String = ""
                Dim strZJMC As String = ""
                Dim strSSFZ As String = ""
                Dim intRYLX As Integer
                strWYBS = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_WYBS), "")
                strRYDM = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_RYDM), "")
                strSSDW = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_DWDM), "")
                strZJMC = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_ZJMC), "")
                strSSFZ = ""
                intRYLX = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_RYLX), 0)

                Dim intRYZT As Integer
                Dim intSFZB As Integer
                Dim intTDBH As Integer
                intRYZT = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_RYZT), 0)
                intSFZB = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_SFZB), 0)
                intTDBH = objPulicParameters.getObjectValue(objMainInfo.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_LIZHI_RENYUANXINXI_TDBH), 0)



                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intGWSX As Integer = 0
                Dim strGLBS As String = ""
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    Select Case intBDLX
                        Case 0, 1
                            '离开单位 或 离开业务岗位

                            '注销“地产_B_人事_管理架构”
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_管理架构 set " + vbCr
                            strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   失效时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '注销“地产_B_人事_助理架构”
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_人事_助理架构 set " + vbCr
                            strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   失效时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '写对应人员的人事异动记录的“终止时间”
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " and   开始时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   终止时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                           
                            If intBDLX = 0 Then
                                Dim intDefVal As Integer = 0
                                '自动更新[公共_B_人员]中的[是否有效]=0
                                strSQL = ""
                                strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                                strSQL = strSQL + "   是否有效 = @sfyx," + vbCr
                                strSQL = strSQL + "   是否考勤 = @sfkq" + vbCr
                                strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                                objSqlCommand.Parameters.AddWithValue("@sfyx", intDefVal)
                                objSqlCommand.Parameters.AddWithValue("@sfkq", intDefVal)
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If
                           

                            '记新的“人事_B_人事异动”
                            If intBDLX = 0 Then
                                '发生人员增减！
                                intGWSX = 0
                                strGLBS = ""
                                strSQL = ""
                                strSQL = strSQL + " insert into 人事_B_人事异动 ("
                                
                                strSQL = strSQL + "   唯一标识," + vbCr
                                strSQL = strSQL + "   人员代码,开始时间,关联标识,变动原因," + vbCr
                                strSQL = strSQL + "   任职单位,原任单位," + vbCr
                                strSQL = strSQL + "   任职级别,原任级别," + vbCr
                                strSQL = strSQL + "   职工属性,原职属性," + vbCr
                                strSQL = strSQL + "   岗位属性,原岗属性," + vbCr
                                strSQL = strSQL + "   所属分组,原属分组," + vbCr
                                strSQL = strSQL + "   本次占编,上次占编," + vbCr
                                strSQL = strSQL + "   现属团队,原属团队 " + vbCr
                                
                                strSQL = strSQL + " ) values ("
                                
                                strSQL = strSQL + "   newid(), "
                                strSQL = strSQL + "   @rydm, @kssj, @glbs, @bdyy," + vbCr
                                strSQL = strSQL + "   ' '  , @yrdw," + vbCr
                                strSQL = strSQL + "   ' '  , @yrjb," + vbCr
                                strSQL = strSQL + "   ' '  , @yzsx," + vbCr
                                strSQL = strSQL + "   0    , 1," + vbCr
                                strSQL = strSQL + "   ' '  , @ysfz," + vbCr
                                strSQL = strSQL + "   0    , @sczb," + vbCr
                                strSQL = strSQL + "   0    , @ystd" + vbCr
                                
                                strSQL = strSQL + " )" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                                objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                                objSqlCommand.Parameters.AddWithValue("@glbs", strGLBS)
                                objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                                objSqlCommand.Parameters.AddWithValue("@yrdw", strSSDW)  '单位代码
                                objSqlCommand.Parameters.AddWithValue("@yrjb", strZJMC)  '级别名称
                                objSqlCommand.Parameters.AddWithValue("@ysfz", strSSFZ)  '分组名称
                                objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(intRYZT))
                                objSqlCommand.Parameters.AddWithValue("@sczb", intSFZB)
                                objSqlCommand.Parameters.AddWithValue("@ystd", intTDBH)
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If

                        Case Else
                            '离开当前岗位,不发生人员增减

                            '注销strWYBS
                            Select Case intRYLX
                                Case 0
                                    '注销“地产_B_人事_助理架构”
                                    strSQL = ""
                                    strSQL = strSQL + " update 地产_B_人事_助理架构 set " + vbCr
                                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                    strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                                    strSQL = strSQL + " and   失效时间 is null" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                                    objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                                Case 1
                                    '注销“地产_B_人事_管理架构”
                                    strSQL = ""
                                    strSQL = strSQL + " update 地产_B_人事_管理架构 set " + vbCr
                                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                                    strSQL = strSQL + " and   生效时间 < @jssj" + vbCr
                                    strSQL = strSQL + " and   失效时间 is null" + vbCr
                                    objSqlCommand.Parameters.Clear()
                                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                                    objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                    objSqlCommand.CommandText = strSQL
                                    objSqlCommand.ExecuteNonQuery()
                            End Select
                            '写对应的人事异动记录的“终止时间”
                            strSQL = ""
                            strSQL = strSQL + " update 人事_B_人事异动 set " + vbCr
                            strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                            strSQL = strSQL + " where 关联标识 = @wybs" + vbCr
                            strSQL = strSQL + " and   开始时间 < @jssj" + vbCr
                            strSQL = strSQL + " and   终止时间 is null" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                            objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                            '不记新的“人事_B_人事异动”
                    End Select


                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDelete_RenyuanJiagou = True
            Exit Function
rollback:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        ' 按指定的信息调整人员架构
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objEnvInfo           ：变动通用参数（BDSJ,BDYY,BDYYMC）
        '     objOldData           ：主变动人旧数据
        '     objNewData           ：主变动人新数据
        '     objDataSet_XJ        ：要调整的下级人员信息列表
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objEnvInfo As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal objDataSet_XJ As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal blnTZ As Boolean) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_V_RS_RENYUANJIAGOU
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objOldXJTmpData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objOldXJData As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objEnvInfo Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[主变动人]数据！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[主变动人]数据！"
                    GoTo errProc
                End If

                '获取环境参数
                Dim objBDSJ As System.DateTime
                Dim strBDYY As String = ""
                Try
                    objBDSJ = CType(objEnvInfo("BDSJ"), System.DateTime)
                    strBDYY = objEnvInfo("BDYY")
                Catch ex As Exception
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]指定无效的接口参数！"
                    GoTo errProc
                End Try

                '计算下级的旧数据
                Dim objDataRow As System.Data.DataRow = Nothing
                Dim strWYBS_XJ As String = ""
                Dim strRYMC_XJ As String = ""
                Dim strFilter As String = ""
                Dim intCount As Integer = 0
                Dim intCols As Integer = 0
                Dim i As Integer = 0
                Dim j As Integer = 0
                If Not (objDataSet_XJ Is Nothing) Then
                    If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                        With objDataSet_XJ.Tables(strTable).DefaultView
                            intCount = .Count
                            For i = 0 To intCount - 1 Step 1
                                strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                '获取下级原数据！
                                If Me.getDataSet_RYJG_RY_In(strErrMsg, strUserId, strPassword, strWYBS_XJ, True, objOldXJTmpData) = False Then
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable) Is Nothing Then
                                    strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable).Rows.Count < 1 Then
                                    strErrMsg = "错误：没有[" + strRYMC_XJ + "]的数据！"
                                    GoTo errProc
                                End If
                                If objOldXJTmpData.Tables(strTable).Rows.Count > 1 Then
                                    strErrMsg = "错误：[" + strRYMC_XJ + "]的数据不唯一！"
                                    GoTo errProc
                                End If

                                '保存数据
                                If objOldXJData Is Nothing Then
                                    objOldXJData = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_V_RS_RENYUANJIAGOU)
                                End If
                                objDataRow = objOldXJData.Tables(strTable).NewRow
                                intCols = objOldXJTmpData.Tables(strTable).Columns.Count
                                For j = 0 To intCols - 1 Step 1
                                    objDataRow.Item(j) = objOldXJTmpData.Tables(strTable).Rows(0).Item(j)
                                Next
                                objOldXJData.Tables(strTable).Rows.Add(objDataRow)

                                '释放资源
                                Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
                            Next
                        End With
                    End If
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '对主变动人进行处理
                    If Me.doAdjust_RenyuanJiagou2(strErrMsg, objSqlTransaction, objBDSJ, objOldData, objNewData, True, True) = False Then
                        GoTo rollback
                    End If

                    '对下级逐个进行变动处理
                    If Not (objDataSet_XJ Is Nothing) Then
                        If Not (objDataSet_XJ.Tables(strTable) Is Nothing) Then
                            With objDataSet_XJ.Tables(strTable).DefaultView
                                intCount = .Count
                                For i = 0 To intCount - 1 Step 1
                                    strWYBS_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS), "")
                                    strRYMC_XJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_RYMC), "")

                                    '获取下级原数据！
                                    strFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_V_RS_RENYUANJIAGOU_WYBS + " = '" + strWYBS_XJ + "'"
                                    objOldXJData.Tables(strTable).DefaultView.RowFilter = strFilter
                                    If objOldXJData.Tables(strTable).DefaultView.Count < 1 Then
                                        strErrMsg = "错误：无法获取[" + strRYMC_XJ + "]的数据！"
                                        GoTo rollback
                                    End If

                                    '对当前人员进行[内部调整]处理
                                    If Me.doAdjust_RenyuanJiagou3(strErrMsg, objSqlTransaction, objBDSJ, objOldXJData.Tables(strTable).DefaultView.Item(0).Row, .Item(i).Row, True) = False Then
                                        GoTo rollback
                                    End If
                                Next
                            End With
                        End If
                    End If
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doAdjust_RenyuanJiagou = True
            Exit Function
rollback:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJTmpData)
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objOldXJData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 对单个人员进行[内部调整处理]
        ' 适用于[管理架构]和[助理架构]中的人员
        ' 基于现有事务处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objBDSJ              ：调整时间
        '     objOldData           ：调整前数据
        '     objNewData           ：调整后数据
        '     blnUseInNewData      ：True-变动原因从objNewData中获取,False-过程内默认
        '     blnUnused            ：接口重载
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '    lj-2013-04
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou2( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objBDSJ As System.DateTime, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal blnUseInNewData As Boolean, _
            ByVal blnUnused As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou2 = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定事务！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整前的数据]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整后的数据]！"
                    GoTo errProc
                End If
                objSqlConnection = objSqlTransaction.Connection

                '获取新旧数据
                Dim strNewVals(21) As String
                strNewVals(0) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_WYBS), "")
                strNewVals(1) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYDM), "")
                strNewVals(2) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYXM), "")
                strNewVals(3) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZJDM), "")
                strNewVals(4) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZJMC), "")
                strNewVals(5) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYZT), "")
                strNewVals(6) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYZTMC), "")
                strNewVals(7) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_DWDM), "")
                strNewVals(8) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_DWMC), "")
                strNewVals(9) = ""
                strNewVals(10) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFZB), "")
                strNewVals(11) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLD), "")
                strNewVals(12) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLDMC), "")
                strNewVals(13) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_BDRQ), "")
                strNewVals(14) = ""
                strNewVals(15) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYDM), "")
                strNewVals(16) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYMC), "")
                strNewVals(17) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYLX), "")
                strNewVals(18) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWDM), "")
                strNewVals(19) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWMC), "")
                strNewVals(20) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFJZ), "")
                strNewVals(21) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_TDBH), "")
                
                Dim strOldVals(21) As String
                strOldVals(0) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YWYBS), "")
                strOldVals(1) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYDM), "")
                strOldVals(2) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYXM), "")
                strOldVals(3) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YZJDM), "")
                strOldVals(4) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YZJMC), "")
                strOldVals(5) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YRYZT), "")
                strOldVals(6) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YRYZTMC), "")
                strOldVals(7) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YDWDM), "")
                strOldVals(8) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YDWMC), "")
                strOldVals(9) = ""
                strOldVals(10) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YSFZB), "")
                strOldVals(11) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLD), "")
                strOldVals(12) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLDMC), "")
                strOldVals(13) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_BDRQ), "")
                strOldVals(14) = ""
                strOldVals(15) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYDM), "")
                strOldVals(16) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYMC), "")
                strOldVals(17) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYLX), "")
                strOldVals(18) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWDM), "")
                strOldVals(19) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWMC), "")
                strOldVals(20) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFJZ), "")
                strOldVals(21) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YTDBH), "")
                

                '如果是[管理架构]人员，则
                Dim intRYLX As Integer
                intRYLX = objPulicParameters.getObjectValue(strOldVals(17), 1)
                If intRYLX = 1 Then
                    If Me.doAdjust_RenyuanJiagou3(strErrMsg, objSqlTransaction, objBDSJ, objOldData, objNewData, True) = False Then
                        GoTo errProc
                    End If
                    Exit Try
                End If

                '统一设置变动原因代码
                Dim strBDYY As String = ""
                If blnUseInNewData = True Then
                    strBDYY = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYDM), "")
                Else
                    strBDYY = Josco.JsKernal.Common.jsoaConfiguration.RS_NBTZ_CODE
                End If

                '检查变化
                Dim blnModifyAll As Boolean = False
                Dim blnModifyZJDM As Boolean = False
                Dim blnModifyRYZT As Boolean = False
                Dim blnModifySSDW As Boolean = False
                Dim blnModifySSFZ As Boolean = False
                Dim blnModifySFZB As Boolean = False
                Dim blnModifySJLD As Boolean = False
                Dim blnModifyTDBH As Boolean = False
                '================================================================
                If strNewVals(3) <> strOldVals(3) Then blnModifyZJDM = True
                If strNewVals(7) <> strOldVals(7) Then blnModifySSDW = True
                If strNewVals(9) <> strOldVals(9) Then blnModifySSFZ = True
                '================================================================
                If strNewVals(5) <> strOldVals(5) Then blnModifyRYZT = True
                If strNewVals(10) <> strOldVals(10) Then blnModifySFZB = True
                If strNewVals(11) <> strOldVals(11) Then blnModifySJLD = True
                '================================================================
                
                If strNewVals(21) <> strOldVals(21) Then blnModifyTDBH = True
                
                '================================================================

                '需要向[人事_B_人事异动]写信息？
                Dim blnNeedWrite As Boolean = False
                blnNeedWrite = blnModifyZJDM Or blnModifySSDW Or blnModifySSFZ Or blnModifyRYZT Or blnModifySFZB
                
                'Dim strBzxx As String = ""
                ''人员状态变化
                'If strBzxx = "" Then
                '    strBzxx = strOldVals(6) + "→" + strNewVals(6)
                'Else
                '    strBzxx = strBzxx + "," + strOldVals(6) + "→" + strNewVals(6)
                'End If
                ''编外/编内变化
                'Dim strTempA As String = ""
                'Dim strTempB As String = ""
                'If strOldVals(10) = "1" Then
                '    strTempA = "编内人员"
                'Else
                '    strTempA = "编外人员"
                'End If
                'If strNewVals(10) = "1" Then
                '    strTempB = "编内人员"
                'Else
                '    strTempB = "编外人员"
                'End If
                'If strBzxx = "" Then
                '    strBzxx = strTempA + "→" + strTempB
                'Else
                '    strBzxx = strBzxx + "," + strTempA + "→" + strTempB
                'End If
                

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算新的GUID
                    Dim strNewId As String = objPulicParameters.getNewGuid()

                    '加入新记录
                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_人事_助理架构 (" + vbCr
                    strSQL = strSQL + "   唯一标识," + vbCr
                    strSQL = strSQL + "   人员代码," + vbCr
                    strSQL = strSQL + "   人员状态," + vbCr
                    strSQL = strSQL + "   是否占编," + vbCr
                    strSQL = strSQL + "   职级代码," + vbCr
                    strSQL = strSQL + "   所属单位," + vbCr
                    strSQL = strSQL + "   生效时间," + vbCr
                    strSQL = strSQL + "   失效时间," + vbCr
                    
                    strSQL = strSQL + "   标准序列," + vbCr
                    strSQL = strSQL + "   是否兼职," + vbCr
                    strSQL = strSQL + "   变动原因 " + vbCr
                    
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   @wybs," + vbCr
                    strSQL = strSQL + "   @rydm," + vbCr
                    strSQL = strSQL + "   @ryzt," + vbCr
                    strSQL = strSQL + "   @sfzb," + vbCr
                    strSQL = strSQL + "   @zjdm," + vbCr
                    strSQL = strSQL + "   @ssdw," + vbCr
                    strSQL = strSQL + "   @kssj," + vbCr
                    strSQL = strSQL + "   null," + vbCr
                    
                    strSQL = strSQL + "   1," + vbCr
                    strSQL = strSQL + "   @sfjz," + vbCr
                    strSQL = strSQL + "   @bdyy " + vbCr
                    
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@wybs", strNewId)
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@ryzt", objPulicParameters.getObjectValue(strNewVals(5), 0))
                    objSqlCommand.Parameters.AddWithValue("@sfzb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                    objSqlCommand.Parameters.AddWithValue("@zjdm", strNewVals(3))
                    objSqlCommand.Parameters.AddWithValue("@ssdw", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                    
                    objSqlCommand.Parameters.AddWithValue("@sfjz", objPulicParameters.getObjectValue(strNewVals(20), 0))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                    
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '
                    ''写对应的直管团队数据
                    'Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
                    'Dim strZBBS As String = ""
                    'Dim i, intCount As Integer
                    'strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_ZGTD), "")
                    'If Not (objDataSet_TDZH Is Nothing) Then
                    '    If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                    '        With objDataSet_TDZH.Tables(strTable)
                    '            .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                    '            intCount = .DefaultView.Count
                    '            For i = 0 To intCount - 1 Step 1
                    '                strSQL = ""
                    '                strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                    '                strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                    '                objSqlCommand.Parameters.Clear()
                    '                objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                    '                objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                    '                objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                    '                objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                    '                objSqlCommand.CommandText = strSQL
                    '                objSqlCommand.ExecuteNonQuery()
                    '            Next
                    '        End With
                    '    End If
                    'End If
                    '

                    '
                    ''写对应的协管团队数据
                    'strZBBS = objPulicParameters.getObjectValue(objNewData(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_GUANLIJIAGOU_XGTD), "")
                    'If Not (objDataSet_TDZH Is Nothing) Then
                    '    If Not (objDataSet_TDZH.Tables(strTable) Is Nothing) Then
                    '        With objDataSet_TDZH.Tables(strTable)
                    '            .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + "= '" + strZBBS + "'"
                    '            intCount = .DefaultView.Count
                    '            For i = 0 To intCount - 1 Step 1
                    '                strSQL = ""
                    '                strSQL = strSQL + " insert into 地产_B_人事_团队组合 (组合标识,组别标识,所属单位,团队编号)" + vbCr
                    '                strSQL = strSQL + " values (@zhbs, @zbbs, @ssdw, @tdbh)" + vbCr
                    '                objSqlCommand.Parameters.Clear()
                    '                objSqlCommand.Parameters.AddWithValue("@zhbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZHBS))
                    '                objSqlCommand.Parameters.AddWithValue("@zbbs", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS))
                    '                objSqlCommand.Parameters.AddWithValue("@ssdw", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_SSDW))
                    '                objSqlCommand.Parameters.AddWithValue("@tdbh", .DefaultView.Item(i).Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_TDBH))
                    '                objSqlCommand.CommandText = strSQL
                    '                objSqlCommand.ExecuteNonQuery()
                    '            Next
                    '        End With
                    '    End If
                    'End If
                    '

                   
                    If strNewVals(20) <> "1" Then
                        '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                        strSQL = ""
                        strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                        strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                        strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@zzdm", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", "")
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                   

                    '标记strWYBS的“失效时间”
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_人事_助理架构 set" + vbCr
                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                    objSqlCommand.Parameters.AddWithValue("@wybs", strOldVals(0))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    If blnNeedWrite = True Then
                        Dim intGWSX As Integer = 1

                        '让以前[人事_B_人事异动]失效
                        strSQL = ""
                        strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                        strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        strSQL = strSQL + " and   开始时间 <= @jssj" + vbCr
                        strSQL = strSQL + " and   终止时间 is null" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@rydm", strOldVals(1))
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                        '写新的[人事_B_人事异动]记录
                        strSQL = ""
                        strSQL = strSQL + " insert into 人事_B_人事异动 (" + vbCr
                        strSQL = strSQL + "   唯一标识,人员代码,开始时间,终止时间," + vbCr
                        strSQL = strSQL + "   关联标识,变动原因,任职单位,任职级别," + vbCr
                        strSQL = strSQL + "   所属分组,原属分组,原任单位,原任级别," + vbCr
                        strSQL = strSQL + "   备注信息,岗位属性," + vbCr
                        
                        strSQL = strSQL + "   本次占编,上次占编,原岗属性,职工属性,原职属性,原属团队,现属团队" + vbCr
                        
                        strSQL = strSQL + " ) values (" + vbCr
                        strSQL = strSQL + "   newid(), @rydm, @kssj, null," + vbCr
                        strSQL = strSQL + "   @glbs,   @bdyy, @rzdw, @rzjb," + vbCr
                        strSQL = strSQL + "   @ssfz,   @rsfz, @rrdw, @rrjb," + vbCr
                        strSQL = strSQL + "   @bzxx,   @gwsx," + vbCr
                        
                        strSQL = strSQL + "   @bczb,   @sczb, @ygsx, @zgsx, @yzsx, @ystd, @xstd" + vbCr
                        
                        strSQL = strSQL + " )" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@glbs", strNewId)
                        objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                        objSqlCommand.Parameters.AddWithValue("@rzdw", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rzjb", strNewVals(4))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rsfz", strOldVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rrdw", strOldVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rrjb", strOldVals(4))
                        objSqlCommand.Parameters.AddWithValue("@bzxx", "")
                        objSqlCommand.Parameters.AddWithValue("@gwsx", intGWSX)
                        
                        objSqlCommand.Parameters.AddWithValue("@ygsx", intGWSX)
                        objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@sczb", objPulicParameters.getObjectValue(strOldVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strNewVals(5), Integer)))
                        objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(CType(strOldVals(5), Integer)))
                        objSqlCommand.Parameters.AddWithValue("@xstd", objPulicParameters.getObjectValue(strNewVals(21), 0))
                        objSqlCommand.Parameters.AddWithValue("@ystd", objPulicParameters.getObjectValue(strOldVals(21), 0))
                        
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)

            '返回
            doAdjust_RenyuanJiagou2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 对单个人员进行[内部调整处理]
        ' 适用于[管理架构]中的人员
        ' 基于现有事务处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objBDSJ              ：调整时间
        '     objOldData           ：调整前数据
        '     objNewData           ：调整后数据
        '     blnUseInNewData      ：True-变动原因从objNewData中获取,False-过程内默认
        '     objDataSet_TDZH      ：团队组合缓存数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doAdjust_RenyuanJiagou3( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objBDSJ As System.DateTime, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Data.DataRow, _
            ByVal blnUseInNewData As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            '初始化
            doAdjust_RenyuanJiagou3 = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定事务！"
                    GoTo errProc
                End If
                If objOldData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整前的数据]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doAdjust_RenyuanJiagou]没有指定[调整后的数据]！"
                    GoTo errProc
                End If
                objSqlConnection = objSqlTransaction.Connection




                '获取新旧数据
                Dim strNewVals(23) As String

                strNewVals(0) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_WYBS), "")
                strNewVals(1) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYDM), "")
                strNewVals(2) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYXM), "")
                strNewVals(3) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZJDM), "")
                strNewVals(4) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZJMC), "")
                strNewVals(5) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYZT), "")
                strNewVals(6) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYZTMC), "")
                strNewVals(7) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_DWDM), "")
                strNewVals(8) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_DWMC), "")
                strNewVals(9) = ""
                strNewVals(10) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFZB), "")
                strNewVals(11) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLD), "")
                strNewVals(12) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLDMC), "")
                strNewVals(13) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_BDRQ), "")
                strNewVals(14) = ""
                strNewVals(15) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYDM), "")
                strNewVals(16) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYMC), "")
                strNewVals(17) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYLX), "")
                strNewVals(18) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWDM), "")
                strNewVals(19) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWMC), "")
                strNewVals(20) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFJZ), "")
                strNewVals(21) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_TDBH), "")

                strNewVals(22) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGTD), "")
                strNewVals(23) = objPulicParameters.getObjectValue(objNewData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_XGTD), "")

                Dim strOldVals(23) As String
                strOldVals(0) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YWYBS), "")
                strOldVals(1) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYDM), "")
                strOldVals(2) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYXM), "")
                strOldVals(3) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YZJDM), "")
                strOldVals(4) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YZJMC), "")
                strOldVals(5) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YRYZT), "")
                strOldVals(6) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YRYZTMC), "")
                strOldVals(7) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YDWDM), "")
                strOldVals(8) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YDWMC), "")
                strOldVals(9) = ""
                strOldVals(10) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YSFZB), "")
                strOldVals(11) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLD), "")
                strOldVals(12) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SJLDMC), "")
                strOldVals(13) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_BDRQ), "")
                strOldVals(14) = ""
                strOldVals(15) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYDM), "")
                strOldVals(16) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YYMC), "")
                strOldVals(17) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_RYLX), "")
                strOldVals(18) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWDM), "")
                strOldVals(19) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_ZGDWMC), "")
                strOldVals(20) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_SFJZ), "")
                strOldVals(21) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YTDBH), "")

                strOldVals(22) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YZGTD), "")
                strOldVals(23) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TIAOZHENG_RENYUANXINXI_YXGTD), "")


                '统一设置变动原因代码
                Dim strBDYY As String = ""
                If blnUseInNewData = True Then
                    strBDYY = strNewVals(15)
                Else
                    strBDYY = Josco.JsKernal.Common.jsoaConfiguration.RS_NBTZ_CODE
                End If

                '检查变化
                Dim blnModifyAll As Boolean = False
                Dim blnModifyZJDM As Boolean = False
                Dim blnModifyRYZT As Boolean = False
                Dim blnModifySSDW As Boolean = False
                Dim blnModifySSFZ As Boolean = False
                Dim blnModifySFZB As Boolean = False
                Dim blnModifySJLD As Boolean = False
                Dim blnModifyTDBH As Boolean = False
                '================================================================
                If strNewVals(3) <> strOldVals(3) Then blnModifyZJDM = True
                If strNewVals(7) <> strOldVals(7) Then blnModifySSDW = True
                If strNewVals(9) <> strOldVals(9) Then blnModifySSFZ = True
                '================================================================
                If strNewVals(5) <> strOldVals(5) Then blnModifyRYZT = True
                If strNewVals(10) <> strOldVals(10) Then blnModifySFZB = True
                If strNewVals(11) <> strOldVals(11) Then blnModifySJLD = True
                '================================================================

                If strNewVals(21) <> strOldVals(21) Then blnModifyTDBH = True

                '================================================================

                '需要向[人事_B_人事异动]写信息？
                Dim blnNeedWrite As Boolean = False
                blnNeedWrite = blnModifyZJDM Or blnModifySSDW Or blnModifySSFZ Or blnModifyRYZT Or blnModifySFZB Or blnModifyTDBH

                'Dim strBzxx As String = ""
                ''人员状态变化
                'If strBzxx = "" Then
                '    strBzxx = strOldVals(6) + "→" + strNewVals(6)
                'Else
                '    strBzxx = strBzxx + "," + strOldVals(6) + "→" + strNewVals(6)
                'End If
                ''编外/编内变化
                'Dim strTempA As String = ""
                'Dim strTempB As String = ""
                'If strOldVals(10) = "1" Then
                '    strTempA = "编内人员"
                'Else
                '    strTempA = "编外人员"
                'End If
                'If strNewVals(10) = "1" Then
                '    strTempB = "编内人员"
                'Else
                '    strTempB = "编外人员"
                'End If
                'If strBzxx = "" Then
                '    strBzxx = strTempA + "→" + strTempB
                'Else
                '    strBzxx = strBzxx + "," + strTempA + "→" + strTempB
                'End If


                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算新的GUID
                    Dim strNewId As String = objPulicParameters.getNewGuid()

                    Dim strZBBS As String = ""
                    '写对应的直管团队数据
                    strZBBS = strNewVals(22)
                    If strZBBS <> "" Then
                        strSQL = ""
                        strSQL = strSQL + " insert into 地产_B_人事_团队组合 select * from 地产_B_人事_团队组合_审批 where 组别标识=@zbbs" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()


                        strSQL = ""
                        strSQL = strSQL + " delete 地产_B_人事_团队组合_审批 where 组别标识=@zbbs" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If

                    '写对应的协管团队数据
                    strZBBS = ""
                    strZBBS = strNewVals(23)
                    If strZBBS <> "" Then
                        strSQL = ""
                        strSQL = strSQL + " insert into 地产_B_人事_团队组合 select * from 地产_B_人事_团队组合_审批 where 组别标识=@zbbs" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " delete 地产_B_人事_团队组合_审批 where 组别标识=@zbbs" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If

                    '加入新记录
                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_人事_管理架构 (" + vbCr
                    strSQL = strSQL + "   唯一标识," + vbCr
                    strSQL = strSQL + "   人员代码," + vbCr
                    strSQL = strSQL + "   人员状态," + vbCr
                    strSQL = strSQL + "   是否占编," + vbCr
                    strSQL = strSQL + "   职级代码," + vbCr
                    strSQL = strSQL + "   所属单位," + vbCr
                    strSQL = strSQL + "   所属分组," + vbCr

                    strSQL = strSQL + "   直管单位," + vbCr

                    strSQL = strSQL + "   上级领导," + vbCr
                    strSQL = strSQL + "   生效时间," + vbCr
                    strSQL = strSQL + "   失效时间," + vbCr

                    strSQL = strSQL + "   标准序列," + vbCr
                    strSQL = strSQL + "   团队编号," + vbCr
                    strSQL = strSQL + "   直管团队," + vbCr
                    strSQL = strSQL + "   协管团队," + vbCr
                    strSQL = strSQL + "   变动原因 " + vbCr

                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   @wybs," + vbCr
                    strSQL = strSQL + "   @rydm," + vbCr
                    strSQL = strSQL + "   @ryzt," + vbCr
                    strSQL = strSQL + "   @sfzb," + vbCr
                    strSQL = strSQL + "   @zjdm," + vbCr
                    strSQL = strSQL + "   @ssdw," + vbCr
                    strSQL = strSQL + "   @ssfz," + vbCr

                    strSQL = strSQL + "   @zgdw," + vbCr

                    strSQL = strSQL + "   @sjld," + vbCr
                    strSQL = strSQL + "   @kssj," + vbCr
                    strSQL = strSQL + "   null," + vbCr

                    strSQL = strSQL + "   1," + vbCr
                    strSQL = strSQL + "   @tdbh," + vbCr
                    strSQL = strSQL + "   @zgtd," + vbCr
                    strSQL = strSQL + "   @xgtd," + vbCr
                    strSQL = strSQL + "   @bdyy " + vbCr

                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@wybs", strNewId)
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@ryzt", objPulicParameters.getObjectValue(strNewVals(5), 0))
                    objSqlCommand.Parameters.AddWithValue("@sfzb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                    objSqlCommand.Parameters.AddWithValue("@zjdm", strNewVals(3))
                    objSqlCommand.Parameters.AddWithValue("@ssdw", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))

                    objSqlCommand.Parameters.AddWithValue("@zgdw", strNewVals(18))

                    objSqlCommand.Parameters.AddWithValue("@sjld", strNewVals(11))
                    objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)

                    objSqlCommand.Parameters.AddWithValue("@tdbh", objPulicParameters.getObjectValue(strNewVals(21), 0))
                    objSqlCommand.Parameters.AddWithValue("@zgtd", strNewVals(22))
                    objSqlCommand.Parameters.AddWithValue("@xgtd", strNewVals(23))
                    objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)

                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()


                    '自动更新[公共_B_人员]中的[组织代码]、[所属分组]
                    strSQL = ""
                    strSQL = strSQL + " update 公共_B_人员 set " + vbCr
                    strSQL = strSQL + "   组织代码 = @zzdm," + vbCr
                    strSQL = strSQL + "   所属分组 = @ssfz " + vbCr
                    strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                    objSqlCommand.Parameters.AddWithValue("@zzdm", strNewVals(7))
                    objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()


                    '标记strWYBS的“失效时间”
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_人事_管理架构 set" + vbCr
                    strSQL = strSQL + "   失效时间 = dateadd(ss,-1,@jssj)" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @wybs" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                    objSqlCommand.Parameters.AddWithValue("@wybs", strOldVals(0))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    If blnNeedWrite = True Then
                        Dim intGWSX As Integer = 1

                        '让以前[人事_B_人事异动]失效
                        strSQL = ""
                        strSQL = strSQL + " update 人事_B_人事异动 set" + vbCr
                        strSQL = strSQL + "   终止时间 = dateadd(ss,-1,@jssj)" + vbCr
                        strSQL = strSQL + " where 人员代码 = @rydm" + vbCr
                        strSQL = strSQL + " and   开始时间 <= @jssj" + vbCr
                        strSQL = strSQL + " and   终止时间 is null" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@rydm", strOldVals(1))
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                        '写新的[人事_B_人事异动]记录
                        strSQL = ""
                        strSQL = strSQL + " insert into 人事_B_人事异动 (" + vbCr
                        strSQL = strSQL + "   唯一标识,人员代码,开始时间,终止时间," + vbCr
                        strSQL = strSQL + "   关联标识,变动原因,任职单位,任职级别," + vbCr
                        strSQL = strSQL + "   所属分组,原属分组,原任单位,原任级别," + vbCr
                        strSQL = strSQL + "   备注信息,岗位属性," + vbCr

                        strSQL = strSQL + "   原岗属性,本次占编,上次占编,职工属性,原职属性,原属团队,现属团队" + vbCr

                        strSQL = strSQL + " ) values (" + vbCr
                        strSQL = strSQL + "   newid(), @rydm, @kssj, null," + vbCr
                        strSQL = strSQL + "   @glbs,   @bdyy, @rzdw, @rzjb," + vbCr
                        strSQL = strSQL + "   @ssfz,   @rsfz, @rrdw, @rrjb," + vbCr
                        strSQL = strSQL + "   @bzxx,   @gwsx," + vbCr

                        strSQL = strSQL + "   @ygsx,   @bczb, @sczb, @zgsx, @yzsx, @ystd, @xstd" + vbCr

                        strSQL = strSQL + " )" + vbCr
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@rydm", strNewVals(1))
                        objSqlCommand.Parameters.AddWithValue("@kssj", objBDSJ)
                        objSqlCommand.Parameters.AddWithValue("@glbs", strNewId)
                        objSqlCommand.Parameters.AddWithValue("@bdyy", strBDYY)
                        objSqlCommand.Parameters.AddWithValue("@rzdw", strNewVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rzjb", strNewVals(4))
                        objSqlCommand.Parameters.AddWithValue("@ssfz", strNewVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rsfz", strOldVals(9))
                        objSqlCommand.Parameters.AddWithValue("@rrdw", strOldVals(7))
                        objSqlCommand.Parameters.AddWithValue("@rrjb", strOldVals(4))
                        objSqlCommand.Parameters.AddWithValue("@bzxx", "")
                        objSqlCommand.Parameters.AddWithValue("@gwsx", intGWSX)

                        objSqlCommand.Parameters.AddWithValue("@ygsx", intGWSX)
                        objSqlCommand.Parameters.AddWithValue("@bczb", objPulicParameters.getObjectValue(strNewVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@sczb", objPulicParameters.getObjectValue(strOldVals(10), 0))
                        objSqlCommand.Parameters.AddWithValue("@zgsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(objPulicParameters.getObjectValue(strNewVals(5), 0)))
                        objSqlCommand.Parameters.AddWithValue("@yzsx", Josco.JSOA.Common.Data.estateRenshiXingyeData.getRYZTtoZGSXCode(objPulicParameters.getObjectValue(strOldVals(5), 0)))
                        objSqlCommand.Parameters.AddWithValue("@xstd", objPulicParameters.getObjectValue(strNewVals(21), 0))
                        objSqlCommand.Parameters.AddWithValue("@ystd", objPulicParameters.getObjectValue(strOldVals(21), 0))

                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)

            '返回
            doAdjust_RenyuanJiagou3 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查人员代码
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   : 人员代码
        '     strSFZHM                  : 身份证号码
        '     strRYXM                   : 人员姓名
        '     intReturn                 : 0-通过；1-有ID，身份证号码不同；2-无ID，身份证号码相同；3-有ID,身份证号码相同；
        '     intLXTable                : 0-入职；1-实习生
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doCheckRydmData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strSFZHM As String, _
            ByVal strRYXM As String, _
            ByRef intReturn As Integer, _
            ByVal intLXTable As Integer) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            '初始化
            doCheckRydmData = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取数据
                Try

                    strSQL = ""
                    strSQL = strSQL + "  select * from  公共_B_人员  where 人员代码='" + strRYDM + "' or 身份证号='" + strSFZHM + "' or 人员名称='" + strRYXM + "'" + vbCr

                    If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    With objDataSet
                        If .Tables(0).Rows.Count < 1 Then
                            intReturn = 0
                        Else
                            If strSFZHM = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item("身份证号"), "") Then
                                '1-身份证号码相同
                                intReturn = 1
                            Else
                                '2-ID相同
                                If strRYDM = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item("人员代码"), "") Then
                                    intReturn = 2
                                Else
                                    '3-人员名称相同
                                    If strRYXM = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item("人员名称"), "") Then
                                        intReturn = 3
                                    End If
                                End If
                            End If
                        End If
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

            doCheckRydmData = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查人员代码
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     objenumEditType           : 编辑类型
        '     strRYDM                   ：人员代码
        '     strSFZHM                  : 身份证号码

         ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function doSaveSFZHM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strSFZHM As String, _
            ByVal intLXTable As Integer) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            '初始化
            doSaveSFZHM = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If


                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                Dim strTable_Delete As String = ""

                '获取数据
                Try


                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL


                        strSQL = ""
                        strSQL = strSQL + "  update 公共_B_人员 set 身份证号='" + strSFZHM + "' where 人员代码='" + strRYDM + "'"

                        '设置参数
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.ExecuteNonQuery()

                    End With

                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)


            doSaveSFZHM = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        ' 根据用户Id获取用户信息数据集
        '     strErrMsg      ：如果错误，则返回错误信息
        '     strUserId      ：用户标识
        '     strPassword    ：用户密码
        '     strOptions     ：获取数据选项ABCD
        '                      A=1 获取人员单表数据
        '                      B=1 获取人员的组织机构单表数据
        '                      C=1 获取人员的上岗单表数据
        '                      D=1 获取人员的完全连接的表数据
        '     objCustomerData：用户信息数据集
        ' 返回
        '     True           ：成功
        '     False          ：失败
        '----------------------------------------------------------------
        Public Function getRenyuanData( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strOptions As String, _
            ByRef objCustomerData As Josco.JsKernal.Common.Data.CustomerData) As Boolean

            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objTempCustomerData As Josco.JsKernal.Common.Data.CustomerData
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim objDataTable As System.Data.DataTable

            '初始化
            getRenyuanData = False
            objCustomerData = Nothing
            strErrMsg = ""

            Try
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strOptions.Length > 0 Then strOptions = strOptions.Trim()

                '检查
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strOptions = "" Then strOptions = "0001"

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Dim strSQL As String
                Try
                    '创建数据集
                    objTempCustomerData = New Josco.JsKernal.Common.Data.CustomerData

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '检索全部连接的人员信息
                        If strOptions.Substring(3, 1) = "1" Then
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " select a.*," + vbCr
                            strSQL = strSQL + "   b.组织名称,b.组织别名," + vbCr
                            strSQL = strSQL + "   岗位列表 = dbo.GetGWMCByRydm(a.人员代码,@separate)," + vbCr
                            strSQL = strSQL + "   c.级别名称,c.行政级别," + vbCr
                            strSQL = strSQL + "   秘书名称 = d.人员名称," + vbCr
                            strSQL = strSQL + "   其他由转送名称 = e.人员名称," + vbCr
                            strSQL = strSQL + "   是否申请 = @charfalse" + vbCr
                            strSQL = strSQL + " from " + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   select * from 公共_B_人员 " + vbCr
                            strSQL = strSQL + "   where 人员代码 = @rydm" + vbCr
                            strSQL = strSQL + " ) a " + vbCr
                            strSQL = strSQL + " left join 公共_B_组织机构 b on a.组织代码   = b.组织代码 " + vbCr
                            strSQL = strSQL + " left join 公共_B_行政级别 c on a.级别代码   = c.级别代码 " + vbCr
                            strSQL = strSQL + " left join 公共_B_人员     d on a.秘书代码   = d.人员代码 " + vbCr
                            strSQL = strSQL + " left join 公共_B_人员     e on a.其他由转送 = e.人员代码 " + vbCr

                            '设置参数
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                            objSqlCommand.Parameters.AddWithValue("@separate", Josco.JsKernal.Common.Utilities.PulicParameters.CharSeparate)
                            objSqlCommand.Parameters.AddWithValue("@charfalse", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                            .SelectCommand = objSqlCommand

                            '执行操作
                            With objTempCustomerData
                                objDataTable = Nothing
                                objDataTable = .createDataTables(strErrMsg, Josco.JsKernal.Common.Data.CustomerData.enumTableType.GG_B_RENYUAN_FULLJOIN)
                                If Not (objDataTable Is Nothing) Then
                                    strErrMsg = .appendDataTable(objDataTable)
                                    If strErrMsg <> "" Then
                                        GoTo errProc
                                    End If
                                Else
                                    GoTo errProc
                                End If
                                objDataTable = Nothing
                            End With
                            .Fill(objTempCustomerData.Tables(Josco.JsKernal.Common.Data.CustomerData.TABLE_GG_B_RENYUAN_FULLJOIN))
                        End If

                        '检索人员的上岗信息
                        If strOptions.Substring(2, 1) = "1" Then
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " select a.* " + vbCr
                            strSQL = strSQL + " from 公共_B_上岗 a " + vbCr
                            strSQL = strSQL + " where 人员代码 = @rydm " + vbCr
                            strSQL = strSQL + " order by a.岗位代码"

                            '设置参数
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                            .SelectCommand = objSqlCommand

                            '执行操作
                            With objTempCustomerData
                                objDataTable = Nothing
                                objDataTable = .createDataTables(strErrMsg, Josco.JsKernal.Common.Data.CustomerData.enumTableType.GG_B_SHANGGANG)
                                If Not (objDataTable Is Nothing) Then
                                    strErrMsg = .appendDataTable(objDataTable)
                                    If strErrMsg <> "" Then
                                        GoTo errProc
                                    End If
                                Else
                                    GoTo errProc
                                End If
                                objDataTable = Nothing
                            End With
                            .Fill(objTempCustomerData.Tables(Josco.JsKernal.Common.Data.CustomerData.TABLE_GG_B_SHANGGANG))
                        End If

                        '检索人员的组织机构单表信息
                        If strOptions.Substring(1, 1) = "1" Then
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " select a.* " + vbCr
                            strSQL = strSQL + " from 公共_B_组织机构 a " + vbCr
                            strSQL = strSQL + " left join " + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   select 组织代码 " + vbCr
                            strSQL = strSQL + "   from 公共_B_人员 " + vbCr
                            strSQL = strSQL + "   where 人员代码 = @rydm"
                            strSQL = strSQL + " ) b on a.组织代码 = b.组织代码 " + vbCr
                            strSQL = strSQL + " where b.组织代码 is not null " + vbCr

                            '设置参数
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                            .SelectCommand = objSqlCommand

                            '执行操作
                            With objTempCustomerData
                                objDataTable = Nothing
                                objDataTable = .createDataTables(strErrMsg, Josco.JsKernal.Common.Data.CustomerData.enumTableType.GG_B_ZUZHIJIGOU)
                                If Not (objDataTable Is Nothing) Then
                                    strErrMsg = .appendDataTable(objDataTable)
                                    If strErrMsg <> "" Then
                                        GoTo errProc
                                    End If
                                Else
                                    GoTo errProc
                                End If
                                objDataTable = Nothing
                            End With
                            .Fill(objTempCustomerData.Tables(Josco.JsKernal.Common.Data.CustomerData.TABLE_GG_B_ZUZHIJIGOU))
                        End If

                        '检索人员单表信息
                        If strOptions.Substring(0, 1) = "1" Then
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " select a.* " + vbCr
                            strSQL = strSQL + " from 公共_B_人员 a " + vbCr
                            strSQL = strSQL + " where a.人员代码 = @rydm " + vbCr

                            '设置参数
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                            .SelectCommand = objSqlCommand

                            '执行操作
                            With objTempCustomerData
                                objDataTable = Nothing
                                objDataTable = .createDataTables(strErrMsg, Josco.JsKernal.Common.Data.CustomerData.enumTableType.GG_B_RENYUAN)
                                If Not (objDataTable Is Nothing) Then
                                    strErrMsg = .appendDataTable(objDataTable)
                                    If strErrMsg <> "" Then
                                        GoTo errProc
                                    End If
                                Else
                                    GoTo errProc
                                End If
                                objDataTable = Nothing
                            End With
                            .Fill(objTempCustomerData.Tables(Josco.JsKernal.Common.Data.CustomerData.TABLE_GG_B_RENYUAN))
                        End If
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempCustomerData.Tables.Count < 1 Then
                    Josco.JsKernal.Common.Data.CustomerData.SafeRelease(objTempCustomerData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataTable)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objCustomerData = objTempCustomerData
            getRenyuanData = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataTable)
            Josco.JsKernal.Common.Data.CustomerData.SafeRelease(objTempCustomerData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查人员代码
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   : 人员代码
        '     strZZDM                   : 组织代码
        '     strZJDM                   : 职级代码
        '     strTDBH                   : 团队编号
        '     strSJLD                   : 返回的上级领导名称
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function getSJLD( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strZZDM As String, _
            ByVal strZJDM As String, _
            ByVal strTDBH As String, _
            ByRef strSJLD As String) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            '初始化
            getSJLD = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取数据
                Try

                    strSQL = ""
                    strSQL = strSQL + " select dbo.uf_rs_printTz_TDZG('" + strRYDM + "','" + strZZDM + "','" + strZJDM + "',convert(int,'" + strTDBH + "'))" + vbCr

                    If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    With objDataSet
                        strSJLD = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), "")
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

            getSJLD = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算strZBBS审批中的团队组合数据
        ' 适用管理模式二
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strZBBS                   ：组别标识
        '     objBufDataSet             ：缓存数据集
        '     objRetDataSet             ：信息数据集
        '     blnOption                 : 重载
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改记录
        '     LJ 2011-07-19 创建
        '----------------------------------------------------------------
        Public Function getDataSet_TDZH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strZBBS As String, _
            ByVal objBufDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData, _
            ByVal blnOption As Boolean) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_TDZH = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                '========================================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_TDZH]未指定[连接用户]！"
                    GoTo errProc
                End If
                '========================================================================================================================================
                If strZBBS Is Nothing Then strZBBS = ""
                strZBBS = strZBBS.Trim
                '========================================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateRenshiXingyeData(Josco.JSOA.Common.Data.estateRenshiXingyeData.enumTableType.DC_B_RS_TDZH)
                    If strZBBS = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '先从数据库中检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,b.组织名称 as 单位名称" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select *" + vbCr
                        strSQL = strSQL + "     from 地产_B_人事_团队组合_审批" + vbCr
                        strSQL = strSQL + "     where 组别标识 = @zbbs" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构 b on a.所属单位=b.组织代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.单位名称,a.团队编号" + vbCr
                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@zbbs", strZBBS)
                        .SelectCommand = objSqlCommand
                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateRenshiXingyeData.TABLE_DC_B_RS_TDZH))
                    End With

                    '如果数据不存在！
                    If objTempDataSet.Tables(strTable).Rows.Count < 1 Then
                        '从缓存中检索
                        If Not (objBufDataSet Is Nothing) Then
                            If Not (objBufDataSet.Tables(strTable) Is Nothing) Then
                                Dim objDataRow As System.Data.DataRow = Nothing
                                Dim i, j, intRows, intCols As Integer
                                Dim strOldFilter As String = ""
                                With objBufDataSet.Tables(strTable)
                                    strOldFilter = .DefaultView.RowFilter
                                    .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_TDZH_ZBBS + " = '" + strZBBS + "'"
                                    If .DefaultView.Count > 0 Then
                                        intCols = .Columns.Count
                                        intRows = .DefaultView.Count
                                        For i = 0 To intRows - 1 Step 1
                                            With objTempDataSet.Tables(strTable)
                                                objDataRow = .NewRow
                                            End With
                                            For j = 0 To intCols - 1 Step 1
                                                objDataRow.Item(j) = .DefaultView.Item(i).Item(j)
                                            Next
                                            With objTempDataSet.Tables(strTable)
                                                .Rows.Add(objDataRow)
                                            End With
                                        Next
                                    End If
                                    .DefaultView.RowFilter = strOldFilter
                                End With
                            End If
                        End If
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_TDZH = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function


        '----------------------------------------------------------------
        ' 检查调整或者离职时间是否有效
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   : 人员代码
        '     strZZDM                   : 组织代码（用于区域行助的辨识）
        '     strRYLX                   : 人员类型 1-业务人员，0-行政助理
        '     strSPSJ                   : 审批时间
        '     blnSJ                     : 有效-true;无效-false
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function checkBDSJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strZZDM As String, _
            ByVal strRYLX As String, _
            ByVal strSPSJ As String, _
            ByRef blnSJ As Boolean) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim intDatediffTime As Integer

            '初始化
            checkBDSJ = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getPrintRyxxData]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取数据
                Try

                    strSQL = ""
                    If strRYLX = "1" Then
                        strSQL = strSQL + " select  datediff(dd,生效时间,convert(datetime,'" + strSPSJ + "')) as '生效时间'  from 地产_B_人事_管理架构 where 失效时间 is null and 人员代码='" + strRYDM + "'" + vbCr
                    Else
                        strSQL = strSQL + " select  datediff(dd,生效时间,convert(datetime,'" + strSPSJ + "')) as '生效时间'  from 地产_B_人事_助理架构 where 失效时间 is null and 人员代码='" + strRYDM + "' and 所属单位='" + strZZDM + "'" + vbCr
                    End If
                    If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    With objDataSet
                        intDatediffTime = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0)
                    End With
                    If intDatediffTime < 1 Then
                        blnSJ = False
                    Else
                        blnSJ = True
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

            checkBDSJ = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查流程人员是否在流程中
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   : 人员代码
        '     blnSJ                     : 有-true;无-false
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        '----------------------------------------------------------------
        Public Function checkFlowRy( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByRef blnSJ As Boolean) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateRenshiXingyeData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim intDatediffTime As Integer

            '初始化
            checkFlowRy = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[checkFlowRy]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取数据
                Try

                    strSQL = ""
                    
                    strSQL = strSQL + " select  a.人员代码  from 地产_B_人事_调整审批_人员信息 a " + vbCr
                    strSQL = strSQL + " left join" + vbCr
                    strSQL = strSQL + "  地产_B_人事_调整审批 b on a.文件标识=b.文件标识 " + vbCr
                    strSQL = strSQL + "  where a.审批日期 is null and b.办理状态='正在办理' and " + vbCr
                    strSQL = strSQL + "  a.人员代码='" + strRYDM + "'" + vbCr

                    If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                        GoTo errProc
                    End If
                    With objDataSet
                        intDatediffTime = objPulicParameters.getObjectValue(.Tables(0).Rows.Count, 0)
                    End With
                    If intDatediffTime < 1 Then
                        blnSJ = False
                    Else
                        blnSJ = True
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

            checkFlowRy = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateRenshiXingyeData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Exit Function

        End Function
    
    End Class

End Namespace
