'----------------------------------------------------------------
' Copyright (C) 2006-2016 Josco Software Corporation
' All rights reserved.
'
' This source code is intended only as a supplement to Microsoft
' Development Tools and/or on-line documentation. See these other
' materials for detailed information regarding Microsoft code samples.
'
' THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY 
' OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT 
' LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR 
' FITNESS FOR A PARTICULAR PURPOSE.
'----------------------------------------------------------------
Option Strict On
Option Explicit On 

Imports Microsoft.VisualBasic

Imports System
Imports System.Data
Imports System.Data.SqlTypes
Imports System.Data.SqlClient

Imports Josco.JsKernal.Common
Imports Josco.JsKernal.Common.Data
Imports Josco.JsKernal.SystemFramework

Namespace Josco.JSOA.DataAccess

    '----------------------------------------------------------------
    ' 命名空间：Josco.JSOA.DataAccess
    ' 类名    ：dacEstateErshou
    '
    ' 功能描述：
    '     提供对二手业务相关的数据层操作
    '
    ' 更改记录：
    '     zengxianglin 2009-05-13 更改
    '     zengxianglin 2009-05-17 更改
    '     zengxianglin 2009-05-18 更改
    '     zengxianglin 2009-05-19 更改
    '     zengxianglin 2009-05-21 更改
    '     zengxianglin 2009-05-26 更改
    '     zengxianglin 2009-12-26 更改
    '     zengxianglin 2010-01-06 更改
    '     zengxianglin 2010-01-18 更改
    '     zengxianglin 2010-04-27 更改
    '     zengxianglin 2010-12-25 更改
    '     zengxianglin 2011-01-04 更改
    '     zengxianglin 2011-01-09 更改
    '     zengxianglin 2011-01-18 更改
    '     zengxianglin 2011-03-22 更改
    '----------------------------------------------------------------

    Public Class dacEstateErshou
        Implements IDisposable

        Private m_objSqlDataAdapter As System.Data.SqlClient.SqlDataAdapter








        '----------------------------------------------------------------
        ' 构造函数
        '----------------------------------------------------------------
        Public Sub New()
            MyBase.New()
            m_objSqlDataAdapter = New System.Data.SqlClient.SqlDataAdapter
        End Sub

        '----------------------------------------------------------------
        ' 虚拟析构函数
        '----------------------------------------------------------------
        Public Sub Dispose() Implements IDisposable.Dispose
            Dispose(True)
            GC.SuppressFinalize(True)
        End Sub

        '----------------------------------------------------------------
        ' 析构函数重载
        '----------------------------------------------------------------
        Protected Overridable Sub Dispose(ByVal disposing As Boolean)
            If (Not disposing) Then
                Exit Sub
            End If
            If Not m_objSqlDataAdapter Is Nothing Then
                m_objSqlDataAdapter.Dispose()
                m_objSqlDataAdapter = Nothing
            End If
        End Sub

        '----------------------------------------------------------------
        ' 安全释放本身资源
        '----------------------------------------------------------------
        Public Shared Sub SafeRelease(ByRef obj As Josco.JSOA.DataAccess.dacEstateErshou)
            Try
                If Not (obj Is Nothing) Then
                    obj.Dispose()
                End If
            Catch ex As Exception
            End Try
            obj = Nothing
        End Sub










        '----------------------------------------------------------------
        ' 将objDataTable中的选定列导出到Excel的当前活动Sheet并自动写标题行
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataTable           ：要导出的数据表
        '     objFields              ：要导出的列
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strDateFormat          ：日期格式字符串
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改
        '     zengxianglin 2011-01-03 创建
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataTable As System.Data.DataTable, _
            ByVal objFields As System.Collections.Specialized.NameValueCollection, _
            ByVal strExcelFile As String, _
            ByVal strDateFormat As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataTable, objFields, strExcelFile, strDateFormat)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将数据从DataSet导出到Excel
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataTable           ：要导出的数据
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strSheetName           ：数据导出到strSheetName
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataTable As System.Data.DataTable, _
            ByVal strExcelFile As String, _
            ByVal strSheetName As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataTable, strExcelFile, strSheetName)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将数据从DataSet导出到Excel
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataSet             ：要导出的数据集
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strMacroName           ：宏名列表
        '     strMacroValue          ：宏值列表
        '     strDateFormat          ：日期格式字符串
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataSet As System.Data.DataSet, _
            ByVal strExcelFile As String, _
            Optional ByVal strMacroName As String = "", _
            Optional ByVal strMacroValue As String = "", _
            Optional ByVal strDateFormat As String = "") As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataSet, strExcelFile, strMacroName, strMacroValue, strDateFormat)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将数据从DataSet导出到Excel
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataSet             ：要导出的数据集
        '     strExcelFile           ：导出到WEB服务器中的Excel文件路径
        '     strColorFieldName      ：用来确定行颜色的字段名
        '     objColors              ：字段值对应的颜色集合
        '     strMacroName           ：宏名列表
        '     strMacroValue          ：宏值列表
        '     strDateFormat          ：日期格式字符串
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doExportToExcel( _
            ByRef strErrMsg As String, _
            ByVal objDataSet As System.Data.DataSet, _
            ByVal strExcelFile As String, _
            ByVal strColorFieldName As String, _
            ByVal objColors As System.Collections.Specialized.ListDictionary, _
            Optional ByVal strMacroName As String = "", _
            Optional ByVal strMacroValue As String = "", _
            Optional ByVal strDateFormat As String = "") As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExportToExcel = .doExport(strErrMsg, objDataSet, strExcelFile, strColorFieldName, objColors, strMacroName, strMacroValue, strDateFormat)
            End With
        End Function

        '----------------------------------------------------------------
        ' 将strSrcFile中的strSrcSheet复制到strDesFile中的strDesSheet
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strSrcFile             ：源文件的完整路径
        '     strSrcSheet            ：源文件的sheet名
        '     strDesFile             ：目标文件的完整路径
        '     strDesSheet            ：目标文件的sheet名
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2009-05-18 创建
        '----------------------------------------------------------------
        Public Function doExcelAddCopy( _
            ByRef strErrMsg As String, _
            ByVal strSrcFile As String, _
            ByVal strSrcSheet As String, _
            ByVal strDesFile As String, _
            ByVal strDesSheet As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExcelAddCopy = .doSheetAddCopy(strErrMsg, strSrcFile, strSrcSheet, strDesFile, strDesSheet)
            End With
        End Function

        '----------------------------------------------------------------
        ' 删除strSrcFile中的strSrcSheet
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strSrcFile             ：源文件的完整路径
        '     strSrcSheet            ：源文件的sheet名
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2009-05-18 创建
        '----------------------------------------------------------------
        Public Function doExcelSheetDelete( _
            ByRef strErrMsg As String, _
            ByVal strSrcFile As String, _
            ByVal strSrcSheet As String) As Boolean
            With New Josco.JsKernal.DataAccess.dacExcel
                doExcelSheetDelete = .doSheetDelete(strErrMsg, strSrcFile, strSrcSheet)
            End With
        End Function










        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”的搜索SQL
        '----------------------------------------------------------------
        Public Function getSearchSQL_QBJY() As String

            Dim strSQL As String = ""

            strSQL = strSQL + " select a.*" + vbCr
            strSQL = strSQL + " from" + vbCr
            strSQL = strSQL + " (" + vbCr
            strSQL = strSQL + "   select *" + vbCr
            strSQL = strSQL + "   from 地产_V_全部交易" + vbCr
            strSQL = strSQL + "   where 交易状态 & 0x3 = 1" + vbCr  '已审+正常
            strSQL = strSQL + " ) a" + vbCr

            getSearchSQL_QBJY = strSQL

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_V_全部交易”完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData      ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*" + vbCr
                        strSQL = strSQL + "   from 地产_V_全部交易 a " + vbCr
                        strSQL = strSQL + "   where a.交易编号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.交易日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_JYXX = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的确认书号是否存在？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function isQrshExist( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isQrshExist = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 交易编号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '存在
                            blnIS = True
                        End If
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isQrshExist = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     objestateErshouData      ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*" + vbCr
                        strSQL = strSQL + "   from 地产_V_全部交易 a " + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.交易日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_JYXX = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function
















        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书买卖”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_MM = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_MM]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_MM)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书买卖 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                   '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                        '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_MM))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_MM = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_确认书买卖”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_MM = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_MM)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书买卖 a " + vbCr
                        strSQL = strSQL + "   where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_MM))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_MM = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_物业买卖”完全数据的数据集
        ' 以“房屋地址”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_WUYE_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_WUYE_MM = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_WUYE_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_WUYE_MM)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "   物业信息 = '房源编号：'+isnull(a.房源编号,'')+'；<br>地址：'+isnull(a.房屋地址,'')+'；房产证：'+isnull(a.房产证号,'')+'；<br>楼盘：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼盘,'')+'，栋别：'+isnull(a.楼栋,'')+'，单元：'+isnull(a.单元,'')+'；<br>行政区域：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.所在区域名称,'')+'，建筑面积：'+cast(isnull(a.面积,0.0) as varchar(20))+'平方米，建成时间：'+case when a.建成时间 is null then '' else convert(varchar(10),a.建成时间,120) end+'，楼龄：'+cast(isnull(a.楼龄,0) as varchar(10))+'年；<br>空间类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.空间类型,'')+'，房屋性质：'+isnull(a.房屋性质,'')+'；<br>楼高共'" + vbCr
                        strSQL = strSQL + "            +CAST(isnull(a.楼高,0) as varchar(10))+'层，本层有'+cast(isnull(a.电梯数量,0) as varchar(10))+'条梯，本层有'+CAST(isnull(a.楼层户数,0) as varchar(10))+'户，属楼盘第'+CAST(isnull(a.楼盘期数,1) as varchar(10))+'期；<br>朝向：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.座向,'')+'；<br>物业属性：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.物业性质名称,'')+'；<br>装修档次：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.装修档次,'')+'，装修年限：'+isnull(a.装修年限,'')+'；<br>噪音影响：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.噪音影响,'')+'，家具设备：'+isnull(a.家具设备,'')+'；<br>楼宇交通：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼宇交通,'')+'，间隔：'+isnull(a.房屋间隔,'')+'；<br>景观类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.景观类型,'')+'；<br>拥有上述景观的房间：'+CAST(isnull(a.景观房数,0) as varchar(10))+'个，所在楼层：第'+CAST(isnull(a.楼层,0) as varchar(10))+'层，卧室数量：'+CAST(isnull(a.卧室数量,0) as varchar(10))+'个，阳台数量：'+CAST(isnull(a.阳台数量,0) as varchar(10))+'个'" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*," + vbCr
                        strSQL = strSQL + "       间隔名称     = dbo.uf_estate_gg_getWyjgmc(a.间隔)," + vbCr
                        strSQL = strSQL + "       物业性质名称 = dbo.uf_estate_gg_getWyxzmc(a.物业性质)," + vbCr
                        strSQL = strSQL + "       所在区域名称 = dbo.uf_estate_gg_getQyhfmc(a.所在区域) " + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_物业买卖 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.房屋地址" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_MM))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_WUYE_MM = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同分配比例”完全数据的数据集
        ' 以“人员代码”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_FPBL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_FPBL = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_FPBL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_FPBL)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     人员名称     = dbo.uf_gg_getRyzmByRydm(a.人员代码)," + vbCr
                        strSQL = strSQL + "     单位名称     = dbo.uf_gg_getZzmcByZzdm(a.单位代码)," + vbCr
                        strSQL = strSQL + "     人员职级名称 = dbo.uf_estate_rs_getZjmc(a.人员职级)," + vbCr
                        strSQL = strSQL + "     直管标记名称 = case when a.直管标记   = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_ZG + "'" + vbCr
                        strSQL = strSQL + "                         when a.直管标记   = 0 then '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_XG + "'" + vbCr
                        strSQL = strSQL + "                         else                       '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_WX + "' end," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志&1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY + "'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志&1 = 0 then '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY + "'" + vbCr
                        strSQL = strSQL + "                         else                       '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_WX + "' end" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.单位代码,a.人员职级" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_FPBL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书买卖”中的新的“确认书号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getNewQRSH_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strQRSH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewQRSH_MM = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewQRSH_MM]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书买卖", 13, "MD" + Now.Year.ToString + "-", True, strQRSH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书买卖", 8, "MD" + Right(Now.Year.ToString, 2), True, strQRSH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewQRSH_MM = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的确认书号是否已签署合同？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function isQianHetong( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isQianHetong = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已签合同
                            blnIS = True
                        End If
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isQianHetong = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业买卖”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_MM = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_MM]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_WUYE_MM]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业买卖"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业买卖", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_QRSH
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_MJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JYJE, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_HYMJ
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_HYMJ
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0.0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_MM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业买卖”的数据类型的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_MM = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_MM]未传入新的数据！"
                    GoTo errProc
                End If

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业买卖"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业买卖", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_MJ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_HYMJ, _
                             Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JYJE
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LL
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LP, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FYBH
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LP, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LD, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FYBH
                            'zengxianglin 2010-12-25
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_MM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_确认书买卖”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_QRS_MM = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_MM]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_QRS_MM]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_确认书买卖"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_确认书买卖", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZTMC
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_QRSH
                            If strValue = "" Then
                                'zengxianglin 2008-11-27
                                If Me.getNewQRSH_MM(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                                'zengxianglin 2008-11-27
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DJRDM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DJRMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_KYBH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJJG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJYH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YZQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YZLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SHYX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SYWY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_MJQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_KHLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFZZHM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFZZHM
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_KYBH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCDZ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJJG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJYH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YZQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YZLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SHYX, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SYWY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_MJQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_KHLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFZZHM, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFZZHM
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DJRQ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJYRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJLRQ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZT
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                            'zengxianglin 2010-12-27
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKFSYD
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-27

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLRQYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLZKYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKFSYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SFZFYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKTGYD
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZJG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZMJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DLFZK, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                Dim strKeyValue As String = ""

                '检查“确认书号”约束
                Dim strNewQRSH As String = ""
                strNewQRSH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_QRSH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_二手_确认书买卖 where 确认书号 = @qrsh"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_WYBS), "")
                        strSQL = "select * from 地产_B_二手_确认书买卖 where 确认书号 = @qrsh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewQRSH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_QRS_MM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书买卖”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_QRS_MM = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_MM]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_MM]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_QRS_MM]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_确认书买卖 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJLRQ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLRQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLZKYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKTGYD
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZJG, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                                        'zengxianglin 2010-12-17
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                                        'zengxianglin 2010-12-17
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_确认书买卖 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JHJLRQ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLRQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JLZKYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_FKTGYD
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZJG, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                                        'zengxianglin 2010-12-17
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_AJNX
                                        'zengxianglin 2010-12-17
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_QRS_MM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_物业买卖”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_WYXX      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_WUYE_MM( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String = ""

            '初始化
            doSaveData_ES_WUYE_MM = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_MM]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_WYXX Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_MM]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_物业买卖" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_WYXX.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_MM).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_物业买卖 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,物业编码,房屋地址,房产证号,房产证地址,面积,交易金额,座向,楼层,楼龄,间隔,物业性质,所在区域,备注信息," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   房源编号,楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔,景观类型," + vbCr
                            strSQL = strSQL + "   景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @wybm, @fwdz, @fczh, @fczdz, @mj, @jyje, @zx, @lc, @ll, @jg, @wyxz, @szqy, @bzxx," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   @fybh,@lp,@ld,@dy,@jcsj,@kjlx,@fwxz,@zxdc,@zxnx,@zyyx,@jjsb,@lyjt,@fwjg,@jglx," + vbCr
                            strSQL = strSQL + "   @jgfs,@lg,@wssl,@ytsl,@hymj,@dtsl,@lchs,@lpqs" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@wybm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYBM))
                            objSqlCommand.Parameters.AddWithValue("@fwdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWDZ))
                            objSqlCommand.Parameters.AddWithValue("@fczh", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FCZH))
                            objSqlCommand.Parameters.AddWithValue("@fczdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FCZDZ))
                            objSqlCommand.Parameters.AddWithValue("@mj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_MJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@jyje", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JYJE), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZX))
                            objSqlCommand.Parameters.AddWithValue("@lc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LC), 0))
                            objSqlCommand.Parameters.AddWithValue("@ll", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LL), 0))
                            objSqlCommand.Parameters.AddWithValue("@jg", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JG))
                            objSqlCommand.Parameters.AddWithValue("@wyxz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZ))
                            objSqlCommand.Parameters.AddWithValue("@szqy", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQY))
                            objSqlCommand.Parameters.AddWithValue("@bzxx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_BZXX))
                            'zengxianglin 2010-12-15
                            objSqlCommand.Parameters.AddWithValue("@fybh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FYBH), ""))
                            objSqlCommand.Parameters.AddWithValue("@lp", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LP), ""))
                            objSqlCommand.Parameters.AddWithValue("@ld", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LD), ""))
                            objSqlCommand.Parameters.AddWithValue("@dy", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DY), ""))
                            strValue = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JCSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@jcsj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strValue, System.DateTime))
                            End If
                            objSqlCommand.Parameters.AddWithValue("@kjlx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_KJLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwxz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWXZ), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxdc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZXDC), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxnx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZXNX), ""))
                            objSqlCommand.Parameters.AddWithValue("@zyyx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZYYX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jjsb", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JJSB), ""))
                            objSqlCommand.Parameters.AddWithValue("@lyjt", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LYJT), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwjg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWJG), ""))
                            objSqlCommand.Parameters.AddWithValue("@jglx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jgfs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG), 0))
                            objSqlCommand.Parameters.AddWithValue("@wssl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@ytsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@hymj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_HYMJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@dtsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@lchs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lpqs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS), 0))
                            'zengxianglin 2010-12-15
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_WUYE_MM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同分配比例”的数据(现有事务)-私佣
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_YWRY      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 更改
        '     zengxianglin 2010-01-06 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_FPBL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG_FPBL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_FPBL]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_YWRY Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_FPBL]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同分配比例" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    strSQL = strSQL + " and   状态标志 & 1 = 1" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_YWRY.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同分配比例 (" + vbCr
                            'zengxianglin 2008-10-14
                            'strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,分配比例,人员职级,直管标记,状态标志" + vbCr
                            'zengxinglin 2010-01-06
                            'strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,所属分组,分配比例,人员职级,直管标记,状态标志" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,团队编号,所属分组,分配比例,人员职级,直管标记,状态标志" + vbCr
                            'zengxinglin 2010-01-06
                            'zengxianglin 2008-10-14
                            strSQL = strSQL + " ) values (" + vbCr
                            'zengxianglin 2008-10-14
                            'strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            'zengxinglin 2010-01-06
                            'strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @ssfz, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @tdbh, @ssfz, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            'zengxinglin 2010-01-06
                            'zengxianglin 2008-10-14
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@rydm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM))
                            objSqlCommand.Parameters.AddWithValue("@dwdm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM))
                            'zengxinglin 2010-01-06
                            objSqlCommand.Parameters.AddWithValue("@tdbh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH), 0))
                            'zengxinglin 2010-01-06
                            'zengxianglin 2008-10-14
                            objSqlCommand.Parameters.AddWithValue("@ssfz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ))
                            'zengxianglin 2008-10-14
                            objSqlCommand.Parameters.AddWithValue("@fpbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@ryzj", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ))
                            objSqlCommand.Parameters.AddWithValue("@zgbj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ), 0))
                            objSqlCommand.Parameters.AddWithValue("@ztbz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ), 0))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_FPBL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书买卖”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(返回保存后的新值)
        '     objOldData             ：记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_WYXX        ：物业信息数据集
        '     objDataSet_YWRY        ：业务人员数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_QRS_MM = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_MM]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_MM]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '检查主记录
                If Me.doVerifyData_ES_QRS_MM(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                
                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存主记录
                    If Me.doSaveData_ES_QRS_MM(strErrMsg, objSqlTransaction, objOldData, objNewData, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If

                    '获取唯一标识
                    Dim strWYBS As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_WYBS)
                    Dim strQRSH As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_QRSH)

                    '保存“地产_B_二手_物业买卖”数据
                    If Me.doSaveData_ES_WUYE_MM(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“地产_B_二手_交易合同分配比例”数据
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_YWRY) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_QRS_MM = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_确认书买卖”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_ES_QRS_MM = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_QRS_MM]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_二手_确认书买卖 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strQRSH As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strQRSH = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_MM_QRSH), "")
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Try
                    '删除“地产_B_二手_物业买卖”
                    strSQL = "delete from 地产_B_二手_物业买卖 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书审核签名”
                    strSQL = "delete from 地产_B_二手_确认书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同”
                    strSQL = "delete from 地产_B_二手_交易合同 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同分配比例”
                    strSQL = "delete from 地产_B_二手_交易合同分配比例 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案计划”
                    strSQL = "delete from 地产_B_二手_交易合同办案计划 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = "delete from 地产_B_二手_交易合同办案记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书”
                    strSQL = "delete from 地产_B_二手_交易合同结算书 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书明细表”
                    strSQL = "delete from 地产_B_二手_交易合同结算书明细表 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书业绩”
                    strSQL = "delete from 地产_B_二手_交易合同结算书业绩 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同结算书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同折扣审核”
                    strSQL = "delete from 地产_B_二手_交易合同折扣审核 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手应收应付”
                    strSQL = "delete from 地产_B_财务_二手应收应付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手实收实付”
                    strSQL = "delete from 地产_B_财务_二手实收实付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书变更记录”
                    strSQL = "delete from 地产_B_二手_确认书变更记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除主记录
                    strSQL = "delete from 地产_B_二手_确认书买卖 where 唯一标识 = '" + strWYBS + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_QRS_MM = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“唯一标识”获取“确认书号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlConnection     ：现有连接
        '     strWYBS              ：唯一标识
        '     strQRSH              ：(返回)确认书号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getQrshByWybs( _
            ByRef strErrMsg As String, _
            ByVal objSqlConnection As System.Data.SqlClient.SqlConnection, _
            ByVal strWYBS As String, _
            ByRef strQRSH As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getQrshByWybs = False
            strQRSH = ""

            Try
                '检查
                If objSqlConnection Is Nothing Then
                    strErrMsg = "错误：[getQrshByWybs]连接未打开！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim()

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 交易编号 from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 唯一标识 = '" + strWYBS + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strQRSH = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "")
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getQrshByWybs = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' “地产_B_二手_确认书买卖”挞定处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doTading_ES_QRS_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doTading_ES_QRS_MM = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doTading_ES_QRS_MM]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取“确认书号”
                Dim strQRSH As String = ""
                If Me.getQrshByWybs(strErrMsg, objSqlConnection, strWYBS, strQRSH) = False Then
                    GoTo errProc
                End If
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取“用户真名”
                Dim strUserZM As String = ""
                If objdacCustomer.getRyzmByRydm(strErrMsg, objSqlConnection, strUserId, strUserZM) = False Then
                    GoTo errProc
                End If
                If strUserZM = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_确认书买卖 set" + vbCr
                    strSQL = strSQL + "   订购状态 = 订购状态 & 13 + 2" + vbCr
                    strSQL = strSQL + " where 唯一标识 = '" + strWYBS + "'" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_二手_确认书变更记录 (" + vbCr
                    strSQL = strSQL + "   唯一标识,确认书号,变更类型,变更人码,变更人名,变更日期" + vbCr
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   newid(),@qrsh,@bglx,@bgrdm,@bgrmc,@bgrq" + vbCr
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.Parameters.AddWithValue("@bglx", Josco.JSOA.Common.Data.estateErshouData.BGLX_TADING_QRS)
                    objSqlCommand.Parameters.AddWithValue("@bgrdm", strUserId)
                    objSqlCommand.Parameters.AddWithValue("@bgrmc", strUserZM)
                    objSqlCommand.Parameters.AddWithValue("@bgrq", Now)
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doTading_ES_QRS_MM = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*" + vbCr
                        strSQL = strSQL + "   from 地产_V_全部交易 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                   '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "     )" + vbCr                                    '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            'zengxianglin 2008-11-06
                            'strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.交易编号 = b.确认书号" + vbCr
                            'zengxianglin 2008-11-06
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.交易日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_JYXX = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function














        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书租赁”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_ZL = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_ZL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书租赁 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or     单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                            '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_ZL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_ZL = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_物业租赁”完全数据的数据集
        ' 以“房屋地址”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_WUYE_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_WUYE_ZL = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_WUYE_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_WUYE_ZL)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "   物业信息 = '房源编号：'+isnull(a.房源编号,'')+'；<br>地址：'+isnull(a.房屋地址,'')+'；房产证：'+isnull(a.房产证号,'')+'；<br>楼盘：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼盘,'')+'，栋别：'+isnull(a.楼栋,'')+'，单元：'+isnull(a.单元,'')+'；<br>行政区域：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.所在区域名称,'')+'，建筑面积：'+cast(isnull(a.面积,0.0) as varchar(20))+'平方米，建成时间：'+case when a.建成时间 is null then '' else convert(varchar(10),a.建成时间,120) end+'，楼龄：'+cast(isnull(a.楼龄,0) as varchar(10))+'年；<br>空间类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.空间类型,'')+'，房屋性质：'+isnull(a.房屋性质,'')+'；<br>楼高共'" + vbCr
                        strSQL = strSQL + "            +CAST(isnull(a.楼高,0) as varchar(10))+'层，本层有'+cast(isnull(a.电梯数量,0) as varchar(10))+'条梯，本层有'+CAST(isnull(a.楼层户数,0) as varchar(10))+'户，属楼盘第'+CAST(isnull(a.楼盘期数,1) as varchar(10))+'期；<br>朝向：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.座向,'')+'；<br>物业属性：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.物业性质名称,'')+'；<br>装修档次：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.装修档次,'')+'，装修年限：'+isnull(a.装修年限,'')+'；<br>噪音影响：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.噪音影响,'')+'，家具设备：'+isnull(a.家具设备,'')+'；<br>楼宇交通：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼宇交通,'')+'，间隔：'+isnull(a.房屋间隔,'')+'；<br>景观类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.景观类型,'')+'；<br>拥有上述景观的房间：'+CAST(isnull(a.景观房数,0) as varchar(10))+'个，所在楼层：第'+CAST(isnull(a.楼层,0) as varchar(10))+'层，卧室数量：'+CAST(isnull(a.卧室数量,0) as varchar(10))+'个，阳台数量：'+CAST(isnull(a.阳台数量,0) as varchar(10))+'个'" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*," + vbCr
                        strSQL = strSQL + "       间隔名称     = dbo.uf_estate_gg_getWyjgmc(a.间隔)," + vbCr
                        strSQL = strSQL + "       物业性质名称 = dbo.uf_estate_gg_getWyxzmc(a.物业性质)," + vbCr
                        strSQL = strSQL + "       所在区域名称 = dbo.uf_estate_gg_getQyhfmc(a.所在区域) " + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_物业租赁 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.房屋地址" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_ZL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_WUYE_ZL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_确认书租赁”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_ZL = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_ZL)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书租赁 a " + vbCr
                        strSQL = strSQL + "   where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_ZL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_ZL = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_确认书租赁”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_ES_QRS_ZL = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_QRS_ZL]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_二手_确认书租赁 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strQRSH As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strQRSH = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_QRSH), "")
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Try
                    '删除“地产_B_二手_物业租赁”
                    strSQL = "delete from 地产_B_二手_物业租赁 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_租赁期限”
                    strSQL = "delete from 地产_B_二手_租赁期限 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书审核签名”
                    strSQL = "delete from 地产_B_二手_确认书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同”
                    strSQL = "delete from 地产_B_二手_交易合同 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同分配比例”
                    strSQL = "delete from 地产_B_二手_交易合同分配比例 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案计划”
                    strSQL = "delete from 地产_B_二手_交易合同办案计划 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = "delete from 地产_B_二手_交易合同办案记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书”
                    strSQL = "delete from 地产_B_二手_交易合同结算书 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书明细表”
                    strSQL = "delete from 地产_B_二手_交易合同结算书明细表 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书业绩”
                    strSQL = "delete from 地产_B_二手_交易合同结算书业绩 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同结算书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同折扣审核”
                    strSQL = "delete from 地产_B_二手_交易合同折扣审核 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手应收应付”
                    strSQL = "delete from 地产_B_财务_二手应收应付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手实收实付”
                    strSQL = "delete from 地产_B_财务_二手实收实付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书变更记录”
                    strSQL = "delete from 地产_B_二手_确认书变更记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除主记录
                    strSQL = "delete from 地产_B_二手_确认书租赁 where 唯一标识 = '" + strWYBS + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_QRS_ZL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' “地产_B_二手_确认书租赁”挞定处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doTading_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doTading_ES_QRS_ZL = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doTading_ES_QRS_ZL]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取“确认书号”
                Dim strQRSH As String = ""
                If Me.getQrshByWybs(strErrMsg, objSqlConnection, strWYBS, strQRSH) = False Then
                    GoTo errProc
                End If
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取“用户真名”
                Dim strUserZM As String = ""
                If objdacCustomer.getRyzmByRydm(strErrMsg, objSqlConnection, strUserId, strUserZM) = False Then
                    GoTo errProc
                End If
                If strUserZM = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_确认书租赁 set" + vbCr
                    strSQL = strSQL + "   订购状态 = 订购状态 & 13 + 2" + vbCr
                    strSQL = strSQL + " where 唯一标识 = '" + strWYBS + "'" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_二手_确认书变更记录 (" + vbCr
                    strSQL = strSQL + "   唯一标识,确认书号,变更类型,变更人码,变更人名,变更日期" + vbCr
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   newid(),@qrsh,@bglx,@bgrdm,@bgrmc,@bgrq" + vbCr
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.Parameters.AddWithValue("@bglx", Josco.JSOA.Common.Data.estateErshouData.BGLX_TADING_QRS)
                    objSqlCommand.Parameters.AddWithValue("@bgrdm", strUserId)
                    objSqlCommand.Parameters.AddWithValue("@bgrmc", strUserZM)
                    objSqlCommand.Parameters.AddWithValue("@bgrq", Now)
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doTading_ES_QRS_ZL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业租赁”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_ZL = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_ZL]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_WUYE_ZL]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业租赁"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业租赁", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_QRSH
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_MJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YZJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_HYMJ
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_HYMJ
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0.0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_ZL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业租赁”的数据类型的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_ZL = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_ZL]未传入新的数据！"
                    GoTo errProc
                End If

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业租赁"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业租赁", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_MJ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_HYMJ, _
                             Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YZJ
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LL
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LP, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZ
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LP, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LD, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZ
                            'zengxianglin 2010-12-25
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_ZL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书租赁”中的新的“确认书号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getNewQRSH_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strQRSH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewQRSH_ZL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewQRSH_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书租赁", 13, "ZD" + Now.Year.ToString + "-", True, strQRSH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书租赁", 8, "ZD" + Right(Now.Year.ToString, 2), True, strQRSH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewQRSH_ZL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_确认书租赁”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_QRS_ZL = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_ZL]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_QRS_ZL]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_确认书租赁"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_确认书租赁", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZTMC
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_QRSH
                            If strValue = "" Then
                                'zengxianglin 2008-11-27
                                If Me.getNewQRSH_ZL(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                                'zengxianglin 2008-11-27
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DJRDM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DJRMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YZQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YZLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_MJQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_KHLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFZZHM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFZZHM
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCDZ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YZQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YZLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_MJQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_KHLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFZZHM, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFZZHM
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DJRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJYRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJLRQ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZT
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_FZFSYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SFZFYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZJTGYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JZR
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYS
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZZJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYYZJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZMJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DLFZK, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLBZJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZNJBL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_NDZBL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                            'zengxianglin 2010-12-17
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                            'zengxianglin 2010-12-17
                            If strValue = "" Then strValue = "0.0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                Dim strKeyValue As String = ""

                '检查“确认书号”约束
                Dim strNewQRSH As String = ""
                strNewQRSH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_QRSH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_二手_确认书租赁 where 确认书号 = @qrsh"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_WYBS), "")
                        strSQL = "select * from 地产_B_二手_确认书租赁 where 确认书号 = @qrsh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewQRSH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_QRS_ZL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_物业租赁”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_WYXX      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_WUYE_ZL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_WUYE_ZL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_ZL]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_WYXX Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_ZL]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_物业租赁" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_WYXX.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_ZL).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_物业租赁 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,物业编码,房屋地址,房产证号,房产证地址,面积,月租金,座向,楼层,楼龄,间隔,物业性质,所在区域,备注信息," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   房源编号,楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔,景观类型," + vbCr
                            strSQL = strSQL + "   景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @wybm, @fwdz, @fczh, @fczdz, @mj, @yzj, @zx, @lc, @ll, @jg, @wyxz, @szqy, @bzxx," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   @fybh,@lp,@ld,@dy,@jcsj,@kjlx,@fwxz,@zxdc,@zxnx,@zyyx,@jjsb,@lyjt,@fwjg,@jglx," + vbCr
                            strSQL = strSQL + "   @jgfs,@lg,@wssl,@ytsl,@hymj,@dtsl,@lchs,@lpqs" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@wybm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYBM))
                            objSqlCommand.Parameters.AddWithValue("@fwdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWDZ))
                            objSqlCommand.Parameters.AddWithValue("@fczh", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FCZH))
                            objSqlCommand.Parameters.AddWithValue("@fczdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FCZDZ))
                            objSqlCommand.Parameters.AddWithValue("@mj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_MJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@yzj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YZJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZX))
                            objSqlCommand.Parameters.AddWithValue("@lc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LC), 0))
                            objSqlCommand.Parameters.AddWithValue("@ll", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LL), 0))
                            objSqlCommand.Parameters.AddWithValue("@jg", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JG))
                            objSqlCommand.Parameters.AddWithValue("@wyxz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZ))
                            objSqlCommand.Parameters.AddWithValue("@szqy", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQY))
                            objSqlCommand.Parameters.AddWithValue("@bzxx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_BZXX))
                            'zengxianglin 2010-12-15
                            objSqlCommand.Parameters.AddWithValue("@fybh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FYBH), ""))
                            objSqlCommand.Parameters.AddWithValue("@lp", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LP), ""))
                            objSqlCommand.Parameters.AddWithValue("@ld", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LD), ""))
                            objSqlCommand.Parameters.AddWithValue("@dy", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DY), ""))
                            strValue = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JCSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@jcsj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strValue, System.DateTime))
                            End If
                            objSqlCommand.Parameters.AddWithValue("@kjlx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_KJLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwxz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWXZ), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxdc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZXDC), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxnx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZXNX), ""))
                            objSqlCommand.Parameters.AddWithValue("@zyyx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZYYX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jjsb", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JJSB), ""))
                            objSqlCommand.Parameters.AddWithValue("@lyjt", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LYJT), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwjg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWJG), ""))
                            objSqlCommand.Parameters.AddWithValue("@jglx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jgfs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG), 0))
                            objSqlCommand.Parameters.AddWithValue("@wssl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@ytsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@hymj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_HYMJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@dtsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@lchs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lpqs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS), 0))
                            'zengxianglin 2010-12-15
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_WUYE_ZL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书租赁”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_QRS_ZL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_ZL]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_ZL]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_QRS_ZL]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_确认书租赁 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJLRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                                        'zengxianglin 2010-12-27
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                                        'zengxianglin 2010-12-27
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_FZFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZJTGYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JZR, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYS
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYYZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLBZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZNJBL, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_NDZBL, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                                        'zengxianglin 2010-12-27
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                                        'zengxianglin 2010-12-27
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_确认书租赁 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JHJLRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                                        'zengxianglin 2010-12-27
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLKS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLJS
                                        'zengxianglin 2010-12-27
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_FZFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZJTGYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JZR, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZQYS
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYYZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZLBZJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_ZNJBL, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_NDZBL, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                                        'zengxianglin 2010-12-27
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_AJNX
                                        'zengxianglin 2010-12-27
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_QRS_ZL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书租赁”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(返回保存后的新值)
        '     objOldData             ：记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_WYXX        ：物业信息数据集
        '     objDataSet_YWRY        ：业务人员数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_QRS_ZL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_ZL]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_ZL]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '检查主记录
                If Me.doVerifyData_ES_QRS_ZL(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存主记录
                    If Me.doSaveData_ES_QRS_ZL(strErrMsg, objSqlTransaction, objOldData, objNewData, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If

                    '获取唯一标识
                    Dim strWYBS As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_WYBS)
                    Dim strQRSH As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_ZL_QRSH)

                    '保存“地产_B_二手_物业租赁”数据
                    If Me.doSaveData_ES_WUYE_ZL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“地产_B_二手_交易合同分配比例”数据
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_YWRY) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_QRS_ZL = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同”完全数据的数据集
        ' 以“合同日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     合同状态名称=case when a.合同状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.合同状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.合同状态&2 = 2 then '完成'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_交易合同 a " + vbCr
                        strSQL = strSQL + "   where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.合同日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_交易合同”中的新的买卖“合同编号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strHTBH              ：合同编号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getNewHTBH_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strHTBH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewHTBH_MM = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewHTBH_MM]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 13, "MH" + Now.Year.ToString + "-", True, strHTBH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 8, "MH" + Right(Now.Year.ToString, 2), True, strHTBH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewHTBH_MM = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_交易合同”中的新的租赁“合同编号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strHTBH              ：合同编号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getNewHTBH_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strHTBH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewHTBH_ZL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewHTBH_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 13, "ZH" + Now.Year.ToString + "-", True, strHTBH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 8, "ZH" + Right(Now.Year.ToString, 2), True, strHTBH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewHTBH_ZL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易合同”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strYWLX              ：业务类型
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2010-12-28 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strYWLX As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_HETONG = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_HETONG]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select
                If strYWLX Is Nothing Then strYWLX = ""
                strYWLX = strYWLX.Trim
                'zengxianglin 2008-11-27
                'If strYWLX = "" Then
                '    strErrMsg = "错误：[doVerifyData_ES_HETONG]未指定[业务类型]！"
                '    GoTo errProc
                'End If
                Select Case strYWLX
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                    Case Else
                        strErrMsg = "错误：[doVerifyData_ES_HETONG]未指定[业务类型]！"
                        GoTo errProc
                End Select
                'zengxianglin 2008-11-27

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_交易合同"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_交易合同", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZTMC
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTBH
                            'zengxianglin 2008-11-27
                            '自动赋值
                            If strValue = "" Then
                                Select Case strYWLX
                                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                                        If Me.getNewHTBH_MM(strErrMsg, strUserId, strPassword, strValue) = False Then
                                            GoTo errProc
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                                        If Me.getNewHTBH_ZL(strErrMsg, strUserId, strPassword, strValue) = False Then
                                            GoTo errProc
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                                        If Me.getNewHTBH_QT(strErrMsg, strUserId, strPassword, strValue) = False Then
                                            GoTo errProc
                                        End If
                                End Select
                            End If
                            'zengxianglin 2008-11-27

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FKFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRDM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_QRSH
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                            'zengxianglin 2008-11-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_AJFH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HZJE
                            'zengxianglin 2010-12-28
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HZJE
                            'zengxianglin 2010-12-28
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]输入无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2008-11-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_TJRQ
                            'zengxianglin 2008-11-22
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_TJRQ
                            'zengxianglin 2008-11-22
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]输入无效的日期！"
                                GoTo errProc
                            End If

                            'zengxianglin 2008-11-22
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JARQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JCRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HZRQ
                            'zengxianglin 2010-12-28
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JCRQ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HZRQ
                            'zengxianglin 2010-12-28
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]输入无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2008-11-22

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZT
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]输入无效的数字！"
                                GoTo errProc
                            End If

                            'zengxianglin 2010-12-28
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTBZ
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]输入无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-28

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                Dim strKeyValue As String = ""

                '检查“确认书号”约束
                Dim strNewQRSH As String = ""
                strNewQRSH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_QRSH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_二手_交易合同 where 确认书号 = @qrsh"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_WYBS), "")
                        strSQL = "select * from 地产_B_二手_交易合同 where 确认书号 = @qrsh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewQRSH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '检查“合同编号”约束
                Dim strNewHTBH As String = ""
                strNewHTBH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTBH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_二手_交易合同 where 合同编号 = @htbh"
                        objListDictionary.Add("@htbh", strNewHTBH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_WYBS), "")
                        strSQL = "select * from 地产_B_二手_交易合同 where 合同编号 = @htbh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@htbh", strNewHTBH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewHTBH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_HETONG]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZTMC
                                        '显示列

                                        'zengxianglin 2008-11-25
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_AJFH
                                        Dim dblDefVal As Double = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), dblDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                        'zengxianglin 2008-11-25

                                        'zengxianglin 2008-11-22
                                        'Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTRQ, _
                                        '    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRQ
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_TJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JARQ
                                        'zengxianglin 2008-11-22
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZT
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If

                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZTMC
                                        '显示列

                                        'zengxianglin 2008-11-25
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_AJFH
                                        Dim dblDefVal As Double = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), dblDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                        'zengxianglin 2008-11-25

                                        'zengxianglin 2008-11-22
                                        'Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTRQ, _
                                        '    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRQ
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_TJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JARQ
                                        'zengxianglin 2008-11-22
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If

                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_HTZT
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If

                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strYWLX                ：业务类型
        '     objNewDataHT           ：合同记录新值(返回保存后的新值)
        '     objOldDataHT           ：合同记录旧值
        '     objNewDataQRS          ：确认书记录新值(返回保存后的新值)
        '     objOldDataQRS          ：确认书记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_WYXX        ：物业信息数据集
        '     objDataSet_YWRY        ：业务人员数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改
        '     zengxianglin 2008-11-17 增加对“其他”业务的支持
        '     zengxianglin 2011-01-05 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strYWLX As String, _
            ByRef objNewDataHT As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldDataHT As System.Data.DataRow, _
            ByRef objNewDataQRS As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldDataQRS As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewDataHT Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objNewDataQRS Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objOldDataQRS Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定确认书的原始数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strYWLX Is Nothing Then strYWLX = ""
                strYWLX = strYWLX.Trim
                Select Case strYWLX
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                    Case Else
                        strErrMsg = "错误：[doSaveData_ES_HETONG]不支持的业务类型！"
                        GoTo errProc
                End Select

                '检查合同主记录
                If Me.doVerifyData_ES_HETONG(strErrMsg, strUserId, strPassword, strYWLX, objOldDataHT, objNewDataHT, objenumEditType) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2010-01-05
                '检查确认书主记录
                Select Case strYWLX
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                        If Me.doVerifyData_ES_QRS_MM(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                        If Me.doVerifyData_ES_QRS_ZL(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                        If Me.doVerifyData_ES_QRS_QT(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                End Select
                'zengxianglin 2010-01-05

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存合同主记录
                    If Me.doSaveData_ES_HETONG(strErrMsg, objSqlTransaction, objOldDataHT, objNewDataHT, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If
                    '获取唯一标识
                    Dim strQRSH As String = objNewDataHT(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_QRSH)

                    '保存确认书记录(现有确认书,然后签合同)
                    Select Case strYWLX
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                            If Me.doSaveData_ES_QRS_MM( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                            If Me.doSaveData_ES_QRS_ZL( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                            If Me.doSaveData_ES_QRS_QT( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                    End Select

                    '保存物业数据
                    Select Case strYWLX
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                            '保存“地产_B_二手_物业买卖”数据
                            If Me.doSaveData_ES_WUYE_MM(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                            '保存“地产_B_二手_物业租赁”数据
                            If Me.doSaveData_ES_WUYE_ZL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                            '保存“地产_B_二手_物业其他”数据
                            If Me.doSaveData_ES_WUYE_QT(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                    End Select

                    '保存“地产_B_二手_交易合同分配比例”数据
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_YWRY) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_HETONG = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易合同”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_HETONG]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_二手_交易合同 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strQRSH As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strQRSH = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_QRSH), "")
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Try
                    '删除“地产_B_二手_交易合同审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同分配比例”-公佣部分
                    strSQL = "delete from 地产_B_二手_交易合同分配比例 where 确认书号 = '" + strQRSH + "' and 状态标志 & 1 = 0"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案计划”
                    strSQL = "delete from 地产_B_二手_交易合同办案计划 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = "delete from 地产_B_二手_交易合同办案记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书”
                    strSQL = "delete from 地产_B_二手_交易合同结算书 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书明细表”
                    strSQL = "delete from 地产_B_二手_交易合同结算书明细表 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书业绩”
                    strSQL = "delete from 地产_B_二手_交易合同结算书业绩 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同结算书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同折扣审核”
                    strSQL = "delete from 地产_B_二手_交易合同折扣审核 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_租赁期限”
                    strSQL = "delete from 地产_B_二手_租赁期限 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同”
                    strSQL = "delete from 地产_B_二手_交易合同 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_HETONG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_租赁期限”完全数据的数据集
        ' 以“开始日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_ZulinQixian( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_ZulinQixian = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_ZulinQixian]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_ZULINQIXIAN)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     缴租方式名称 = case when a.缴租方式=1 then '非自然月' else '自然月' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_租赁期限 a " + vbCr
                        strSQL = strSQL + "   where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.开始日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_ZULINQIXIAN))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_ZulinQixian = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_租赁期限”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_ZLQX      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_ZulinQixian( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_ZLQX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_ZulinQixian = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_ZulinQixian]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_ZLQX Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_ZulinQixian]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_租赁期限" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_ZLQX.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_ZULINQIXIAN).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_租赁期限 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,开始日期,终止日期,月租金额,缴租日,缴租方式,月租总额,租期月数" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @ksrq, @zzrq, @yzje, @jzr, @jzfs, @yzze, @zqys" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@ksrq", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_KSRQ))
                            objSqlCommand.Parameters.AddWithValue("@zzrq", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_ZZRQ))
                            objSqlCommand.Parameters.AddWithValue("@yzje", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_YZJE))
                            objSqlCommand.Parameters.AddWithValue("@jzr", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_JZR))
                            objSqlCommand.Parameters.AddWithValue("@jzfs", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_JZFS))
                            objSqlCommand.Parameters.AddWithValue("@yzze", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_YZZE))
                            objSqlCommand.Parameters.AddWithValue("@zqys", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_ZULINQIXIAN_ZQYS))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With

                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_ZulinQixian = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strYWLX                ：业务类型
        '     objNewDataHT           ：合同记录新值(返回保存后的新值)
        '     objOldDataHT           ：合同记录旧值
        '     objNewDataQRS          ：确认书记录新值(返回保存后的新值)
        '     objOldDataQRS          ：确认书记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_WYXX        ：物业信息数据集
        '     objDataSet_YWRY        ：业务人员数据集
        '     objDataSet_ZLQX        ：租赁期限数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改
        '     zengxianglin 2008-11-17 增加对“其他”业务的支持
        '     zengxianglin 2011-01-05 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strYWLX As String, _
            ByRef objNewDataHT As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldDataHT As System.Data.DataRow, _
            ByRef objNewDataQRS As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldDataQRS As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_ZLQX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewDataHT Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objNewDataQRS Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objOldDataQRS Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG]没有指定确认书的原始数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strYWLX Is Nothing Then strYWLX = ""
                strYWLX = strYWLX.Trim
                Select Case strYWLX
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                    Case Else
                        strErrMsg = "错误：[doSaveData_ES_HETONG]不支持的业务类型！"
                        GoTo errProc
                End Select

                '检查合同主记录
                If Me.doVerifyData_ES_HETONG(strErrMsg, strUserId, strPassword, strYWLX, objOldDataHT, objNewDataHT, objenumEditType) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2010-01-05
                '检查确认书主记录
                Select Case strYWLX
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                        If Me.doVerifyData_ES_QRS_MM(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                        If Me.doVerifyData_ES_QRS_ZL(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                    Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                        If Me.doVerifyData_ES_QRS_QT(strErrMsg, strUserId, strPassword, objOldDataQRS, objNewDataQRS, Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                            GoTo errProc
                        End If
                End Select
                'zengxianglin 2010-01-05

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存合同主记录
                    If Me.doSaveData_ES_HETONG(strErrMsg, objSqlTransaction, objOldDataHT, objNewDataHT, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If
                    '获取唯一标识
                    Dim strQRSH As String = objNewDataHT(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_QRSH)

                    '保存确认书记录
                    Select Case strYWLX
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                            If Me.doSaveData_ES_QRS_MM( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                            If Me.doSaveData_ES_QRS_ZL( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                            If Me.doSaveData_ES_QRS_QT( _
                                strErrMsg, objSqlTransaction, _
                                objOldDataQRS, objNewDataQRS, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eUpdate) = False Then
                                GoTo rollDatabase
                            End If
                    End Select

                    '保存物业信息
                    Select Case strYWLX
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                            '保存“地产_B_二手_物业买卖”数据
                            If Me.doSaveData_ES_WUYE_MM(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                            '保存“地产_B_二手_物业租赁”数据
                            If Me.doSaveData_ES_WUYE_ZL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                            '保存“地产_B_二手_物业其他”数据
                            If Me.doSaveData_ES_WUYE_QT(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                                GoTo rollDatabase
                            End If
                    End Select

                    '保存“地产_B_二手_租赁期限”数据
                    If Me.doSaveData_ES_ZulinQixian(strErrMsg, objSqlTransaction, strQRSH, objDataSet_ZLQX) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“地产_B_二手_交易合同分配比例”数据
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_YWRY) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_HETONG = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据时间段、月租金、计租方法计算该段时间的总租金、租期（月）
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strKSRQ                ：开始日期
        '     strZZRQ                ：终止日期
        '     dblYZJ                 ：月租金
        '     intJZFF                ：计租方法(0-自然月 1非自然月)
        '     dblZZJ                 ：总租金
        '     dblZZQ                 ：租期
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function getZujinAndZuqi( _
            ByRef strErrMsg As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal dblYZJ As Double, _
            ByVal intJZFF As Integer, _
            ByRef dblZZJ As Double, _
            ByRef dblZZQ As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            getZujinAndZuqi = False
            strErrMsg = ""
            dblZZJ = 0
            dblZZQ = 0

            Try
                '检查
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    Exit Try
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    Exit Try
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    Exit Try
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    Exit Try
                End If
                Select Case intJZFF
                    Case 0, 1
                    Case Else
                        Exit Try
                End Select
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                Dim objSegS As System.DateTime
                If objKSRQ > objZZRQ Then
                    objSegS = objKSRQ
                    objKSRQ = objZZRQ
                    objZZRQ = objSegS
                End If

                '计算
                Dim objMonS As System.DateTime
                Dim objMonE As System.DateTime
                Dim objSegE As System.DateTime
                Dim intRDays As Integer = 0
                Dim intTDays As Integer = 0
                Dim strSegE As String = ""
                objSegS = objKSRQ
                Select Case intJZFF
                    Case 0 '自然月
                        Do While objSegS < objZZRQ
                            '获取月末日期
                            strSegE = objSegS.ToString("yyyy-MM") + "-01"
                            objMonS = CType(strSegE, System.DateTime)
                            objMonE = objMonS.AddMonths(1).AddDays(-1)
                            objSegE = objMonE

                            '比较
                            If objSegE > objZZRQ Then
                                objSegE = objZZRQ
                            End If

                            '计算实际天数
                            intRDays = System.Math.Abs(objSegE.Subtract(objSegS).Days())

                            '计算本月完整天数
                            intTDays = System.Math.Abs(objMonE.Subtract(objMonS).Days())

                            '计算数据
                            dblZZJ = dblZZJ + intRDays / intTDays * dblYZJ
                            dblZZQ = dblZZQ + intRDays / intTDays

                            '下一月
                            objSegS = objSegE.AddDays(1)
                        Loop

                    Case 1 '非自然月
                        Do While objSegS < objZZRQ
                            '获取段末日期
                            objMonS = objSegS
                            objMonE = objSegS.AddMonths(1).AddDays(-1)
                            objSegE = objMonE

                            '比较
                            If objSegE > objZZRQ Then
                                objSegE = objZZRQ
                            End If

                            '计算实际天数
                            intRDays = System.Math.Abs(objSegE.Subtract(objSegS).Days())

                            '计算本月完整天数
                            intTDays = System.Math.Abs(objMonE.Subtract(objMonS).Days())

                            '计算数据
                            dblZZJ = dblZZJ + intRDays / intTDays * dblYZJ
                            dblZZQ = dblZZQ + intRDays / intTDays

                            '下一段
                            objSegS = objSegE.AddDays(1)
                        Loop
                End Select

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)

            getZujinAndZuqi = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的合同是否已审核？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function isHetongYiShen( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isHetongYiShen = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   合同状态 & 1 = 1" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已审
                            blnIS = True
                        End If
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isHetongYiShen = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的合同是否已完成？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function isHetongComplete( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isHetongComplete = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   合同状态 & 2 = 2" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已完成
                            blnIS = True
                        End If
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isHetongComplete = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定人员在当前时间点的职级代码、职级名称
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     strZJDM              ：返回职级代码
        '     strZJMC              ：返回职级名称
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getZjdmAndZjmc( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByRef strZJDM As String, _
            ByRef strZJMC As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getZjdmAndZjmc = False
            strZJDM = ""
            strZJMC = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getZjdmAndZjmc]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select a.*,b.职级名称" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select a.*" + vbCr
                strSQL = strSQL + "   from" + vbCr
                strSQL = strSQL + "   (" + vbCr
                strSQL = strSQL + "     select 职级代码" + vbCr
                strSQL = strSQL + "     from dbo.uf_estate_rs_getValidGuanliJiagou('" + Now.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + "     where 人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "     union" + vbCr
                strSQL = strSQL + "     select 职级代码" + vbCr
                strSQL = strSQL + "     from dbo.uf_estate_rs_getValidZhuliJiagou('" + Now.ToString("yyyy-MM-dd HH:mm:ss") + "')" + vbCr
                strSQL = strSQL + "     where 人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "   ) a" + vbCr
                strSQL = strSQL + "   group by a.职级代码" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 地产_B_人事_职级定义 b on a.职级代码 = b.职级代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        strZJDM = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("职级代码"), "")
                        strZJMC = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("职级名称"), "")
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getZjdmAndZjmc = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定私佣分配信息自动计算公佣分配数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     objDataSet_SY        ：私佣分配信息
        '     objDataSet_GY        ：返回公佣分配数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 更改
        '     zengxianglin 2008-11-18 更改
        '     zengxianglin 2009-05-26 更改
        '     zengxianglin 2010-01-06 重新设计
        '----------------------------------------------------------------
        Public Function getGongyongInfo( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal objDataSet_SY As Josco.JSOA.Common.Data.estateErshouData, _
            ByRef objDataSet_GY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL
            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getGongyongInfo = False
            objDataSet_GY = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getGongyongInfo]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_SY Is Nothing Then
                    strErrMsg = "错误：[getGongyongInfo]未指定[私佣分配信息]！"
                    GoTo errProc
                End If
                If objDataSet_SY Is Nothing Then
                    strErrMsg = "错误：[getGongyongInfo]未指定[私佣分配信息]！"
                    GoTo errProc
                End If
                If objDataSet_SY.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[getGongyongInfo]未指定[私佣分配信息]！"
                    GoTo errProc
                End If
                If objDataSet_SY.Tables(strTable).Rows.Count < 1 Then
                    strErrMsg = "错误：[getGongyongInfo]未指定[私佣分配信息]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算合同日期
                Dim strHTRQ As String = ""
                If Me.getHtrqByQrsh(strErrMsg, objSqlConnection, strQRSH, strHTRQ) = False Then
                    GoTo errProc
                End If
                If strHTRQ = "" Then
                    strErrMsg = "错误：[getGongyongInfo]无法获取[合同日期]！"
                    GoTo errProc
                End If

                '计算执行的管理模式
                Dim intBZXL As Integer = 0
                If objdacEstateRenshiXingye.getBZXL_RSJG(strErrMsg, strUserId, strPassword, strHTRQ, intBZXL) = False Then
                    GoTo errProc
                End If
                Select Case intBZXL
                    Case 1, 2
                    Case Else
                        strErrMsg = "错误：[getGongyongInfo]无法判断签合同时执行的人事管理模式！"
                        GoTo errProc
                End Select

                '获取数据
                Dim i, intCount, intValue As Integer
                Dim blnIs As Boolean = False
                Dim dblFPBL As Double = 0.0
                Dim strRYDM As String = ""
                Dim strDWDM As String = ""
                Dim strSSFZ As String = ""
                Dim strZJDM As String = ""
                Dim intTDBH As Integer
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_FPBL)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     唯一标识     = newid()," + vbCr
                        strSQL = strSQL + "     确认书号     = @qrsh," + vbCr
                        strSQL = strSQL + "     人员代码     = a.人员代码," + vbCr
                        strSQL = strSQL + "     人员职级     = a.人员职级," + vbCr
                        strSQL = strSQL + "     单位代码     = a.单位代码," + vbCr
                        strSQL = strSQL + "     团队编号     = a.团队编号," + vbCr
                        strSQL = strSQL + "     所属分组     = a.所属分组," + vbCr
                        strSQL = strSQL + "     分配比例     = a.分配比例," + vbCr
                        strSQL = strSQL + "     直管标记     = a.直管标记," + vbCr
                        strSQL = strSQL + "     状态标志     = @ztbz," + vbCr
                        strSQL = strSQL + "     状态标志名称 = @ztbzmc," + vbCr
                        strSQL = strSQL + "     直管标记名称 = dbo.uf_estate_es_getZGBJName(a.直管标记)," + vbCr
                        strSQL = strSQL + "     人员名称     = dbo.uf_gg_getRyzmByRydm(a.人员代码)," + vbCr
                        strSQL = strSQL + "     单位名称     = dbo.uf_gg_getZzmcByZzdm(a.单位代码)," + vbCr
                        strSQL = strSQL + "     人员职级名称 = dbo.uf_estate_rs_getZjmc(a.人员职级)" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select" + vbCr
                        strSQL = strSQL + "       a.人员代码,a.人员职级,a.单位代码,a.团队编号,a.所属分组,a.直管标记,分配比例=sum(a.分配比例)" + vbCr
                        strSQL = strSQL + "     from" + vbCr
                        strSQL = strSQL + "     (" + vbCr
                        With objDataSet_SY.Tables(strTable)
                            intCount = .Rows.Count
                            For i = 0 To intCount - 1 Step 1
                                strRYDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM), "")
                                strDWDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM), "")
                                strSSFZ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ), "")
                                strZJDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ), "")
                                intTDBH = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH), 0)
                                dblFPBL = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL), 0.0)
                                Select Case intBZXL
                                    Case 1
                                        If i = 0 Then
                                            strSQL = strSQL + "       select a.人员代码,a.人员职级,单位代码=a.所属单位,团队编号=" + intTDBH.ToString + ",所属分组='" + strSSFZ + "',直管标记=0,分配比例=" + dblFPBL.ToString("#.0000") + vbCr
                                            strSQL = strSQL + "       from dbo.uf_estate_rs_getRelateManager01('" + strRYDM + "','" + strDWDM + "',@jcsj) a " + vbCr
                                        Else
                                            strSQL = strSQL + "       union all" + vbCr
                                            strSQL = strSQL + "       select a.人员代码,a.人员职级,单位代码=a.所属单位,团队编号=" + intTDBH.ToString + ",所属分组='" + strSSFZ + "',直管标记=0,分配比例=" + dblFPBL.ToString("#.0000") + vbCr
                                            strSQL = strSQL + "       from dbo.uf_estate_rs_getRelateManager01('" + strRYDM + "','" + strDWDM + "',@jcsj) a " + vbCr
                                        End If
                                    Case 2
                                        If i = 0 Then
                                            strSQL = strSQL + "       select a.人员代码,a.人员职级,a.单位代码,a.团队编号,a.所属分组,a.直管标记,分配比例=" + dblFPBL.ToString("#.0000") + vbCr
                                            strSQL = strSQL + "       from dbo.uf_estate_rs_getRelaRSJG_X2(@jcsj,'" + strRYDM + "','" + strDWDM + "'," + intTDBH.ToString + ",'" + strSSFZ + "','" + strZJDM + "') a " + vbCr
                                        Else
                                            strSQL = strSQL + "       union all" + vbCr
                                            strSQL = strSQL + "       select a.人员代码,a.人员职级,a.单位代码,a.团队编号,a.所属分组,a.直管标记,分配比例=" + dblFPBL.ToString("#.0000") + vbCr
                                            strSQL = strSQL + "       from dbo.uf_estate_rs_getRelaRSJG_X2(@jcsj,'" + strRYDM + "','" + strDWDM + "'," + intTDBH.ToString + ",'" + strSSFZ + "','" + strZJDM + "') a " + vbCr
                                        End If
                                End Select
                            Next
                        End With
                        strSQL = strSQL + "     ) a" + vbCr
                        strSQL = strSQL + "     group by a.人员代码,a.人员职级,a.单位代码,a.团队编号,a.所属分组,a.直管标记" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.单位代码,a.团队编号,a.所属分组,a.人员职级" + vbCr

                        '设置参数
                        intValue = 0
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strHTRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@ztbz", intValue)
                        objSqlCommand.Parameters.AddWithValue("@ztbzmc", Josco.JSOA.Common.Data.estateErshouData.getYejiStatusName(0))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                Else
                    '自动判断直管
                    Select Case intBZXL
                        Case 1
                            With objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                                intCount = .Rows.Count
                                For i = 0 To intCount - 1 Step 1
                                    strRYDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM), "")
                                    strDWDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM), "")
                                    If Me.IsZhiguan(strErrMsg, strUserId, strPassword, strRYDM, strDWDM, strHTRQ, blnIs) = True Then
                                        If blnIs = True Then
                                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ) = 1
                                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC) = Josco.JSOA.Common.Data.estateErshouData.getZhiguanStatusName(1)
                                        Else
                                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ) = 0
                                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC) = Josco.JSOA.Common.Data.estateErshouData.getZhiguanStatusName(0)
                                        End If
                                    End If
                                Next
                            End With
                        Case 2
                            '不用处理！
                    End Select
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet_GY = objTempestateErshouData
            getGongyongInfo = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同分配比例”的数据(现有事务)-公佣
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_YWRY      ：要保存的数据
        '     blnUnused            ：接口重载
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 更改
        '     zengxianglin 2010-01-06 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_FPBL( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal blnUnused As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG_FPBL = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_FPBL]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_YWRY Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_FPBL]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同分配比例" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    strSQL = strSQL + " and   状态标志 & 1 = 0" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_YWRY.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同分配比例 (" + vbCr
                            'zengxianglin 2008-10-14
                            'strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,分配比例,人员职级,直管标记,状态标志" + vbCr
                            'zengxianglin 2010-01-06
                            'strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,所属分组,分配比例,人员职级,直管标记,状态标志" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,人员代码,单位代码,团队编号,所属分组,分配比例,人员职级,直管标记,状态标志" + vbCr
                            'zengxianglin 2010-01-06
                            'zengxianglin 2008-10-14
                            strSQL = strSQL + " ) values (" + vbCr
                            'zengxianglin 2008-10-14
                            'strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            'zengxianglin 2010-01-06
                            'strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @ssfz, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @rydm, @dwdm, @tdbh, @ssfz, @fpbl, @ryzj, @zgbj, @ztbz" + vbCr
                            'zengxianglin 2010-01-06
                            'zengxianglin 2008-10-14
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@rydm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM))
                            objSqlCommand.Parameters.AddWithValue("@dwdm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM))
                            'zengxianglin 2010-01-06
                            objSqlCommand.Parameters.AddWithValue("@tdbh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH), 0))
                            'zengxianglin 2010-01-06
                            'zengxianglin 2008-10-14
                            objSqlCommand.Parameters.AddWithValue("@ssfz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ))
                            'zengxianglin 2008-10-14
                            objSqlCommand.Parameters.AddWithValue("@fpbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@ryzj", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ))
                            objSqlCommand.Parameters.AddWithValue("@zgbj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ), 0))
                            objSqlCommand.Parameters.AddWithValue("@ztbz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ), 0))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_FPBL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同分配比例”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strQRSH                ：确认书号
        '     objDataSet_SYBL        ：私佣信息数据集
        '     objDataSet_GYBL        ：公佣信息数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_FPBL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal objDataSet_SYBL As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_GYBL As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_HETONG_FPBL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_FPBL]未传入[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If
                'zengxianglin 2008-11-22
                '检查
                If objDataSet_SYBL Is Nothing And objDataSet_GYBL Is Nothing Then
                    Exit Try
                End If
                'zengxianglin 2008-11-22

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存“地产_B_二手_交易合同分配比例”数据-私佣
                    'zengxianglin 2008-11-22
                    'If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_SYBL) = False Then
                    '    GoTo rollDatabase
                    'End If
                    If Not (objDataSet_SYBL Is Nothing) Then
                        If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_SYBL) = False Then
                            GoTo rollDatabase
                        End If
                    End If
                    'zengxianglin 2008-11-22

                    '保存“地产_B_二手_交易合同分配比例”数据-公佣
                    'zengxianglin 2008-11-22
                    'If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_GYBL, True) = False Then
                    '    GoTo rollDatabase
                    'End If
                    If Not (objDataSet_GYBL Is Nothing) Then
                        If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_GYBL, True) = False Then
                            GoTo rollDatabase
                        End If
                    End If
                    'zengxianglin 2008-11-22
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_HETONG_FPBL = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易合同分配比例”私佣比例和=1？
        '     strErrMsg              ：如果错误，则返回错误信息
        '     objDataSet_SYBL        ：私佣信息数据集
        '     blnValid               ：判断结果
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doVerify_ES_HETONG_FPBL( _
            ByRef strErrMsg As String, _
            ByVal objDataSet_SYBL As Josco.JSOA.Common.Data.estateErshouData, _
            ByRef blnValid As Boolean) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim strSQL As String

            doVerify_ES_HETONG_FPBL = False
            strErrMsg = ""
            blnValid = False

            Try
                '检查
                If objDataSet_SYBL Is Nothing Then
                    strErrMsg = "错误：[doVerify_ES_HETONG_FPBL]没有数据！"
                    GoTo errProc
                End If
                If objDataSet_SYBL.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doVerify_ES_HETONG_FPBL]没有数据！"
                    GoTo errProc
                End If
                If objDataSet_SYBL.Tables(strTable).Rows.Count < 1 Then
                    strErrMsg = "错误：[doVerify_ES_HETONG_FPBL]没有数据！"
                    GoTo errProc
                End If

                '检查
                Dim dblValue As Double = 0.0
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                With objDataSet_SYBL.Tables(strTable)
                    intCount = .Rows.Count
                    dblValue = 0
                    For i = 0 To intCount - 1 Step 1
                        dblValue += objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL), 0.0)
                    Next
                End With
                If System.Math.Abs(dblValue - 1.0) > 0.01 Then
                    blnValid = False
                Else
                    blnValid = True
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)

            doVerify_ES_HETONG_FPBL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 如果给定“确认书号”，则根据“确认书号”获取“地产_V_全部合同”完全数据的数据集
        ' 否则计算所有满足条件strWhere的数据
        ' 以“合同日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：是否限制查看
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        If strQRSH <> "" Then
                            strSQL = strSQL + "   select a.*" + vbCr
                            strSQL = strSQL + "   from" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select a.*" + vbCr
                            strSQL = strSQL + "     from 地产_V_全部合同 a " + vbCr
                            strSQL = strSQL + "     where 交易编号 = '" + strQRSH + "'" + vbCr
                            strSQL = strSQL + "   ) a" + vbCr
                        Else
                            strSQL = strSQL + "   select a.*" + vbCr
                            strSQL = strSQL + "   from 地产_V_全部合同 a " + vbCr
                        End If
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                   '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )"                                               '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.交易编号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.合同日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_JYXX = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同审核签名”完全数据的数据集
        ' 以“审核日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_SHQK( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_SHQK = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_SHQK]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_SHENHE)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志   = 6  then '审核签名'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志   = 14 then '审定签名'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志&1 = 1  then '取消签名'" + vbCr
                        strSQL = strSQL + "                         else                        '没有签名' end" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同审核签名 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.审核日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_SHENHE))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_SHQK = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 合同审核处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：确认书号
        '     strSHRDM             ：审核人代码
        '     objSHLX              ：审核类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doShenHe_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strSHRDM As String, _
            ByVal objSHLX As Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doShenHe_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strSHRDM Is Nothing Then strSHRDM = ""
                strSHRDM = strSHRDM.Trim
                If strSHRDM = "" Then
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doShenHe_ES_HETONG]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取人员名称
                Dim strSHRMC As String = ""
                If objdacCustomer.getRymcByRydm(strErrMsg, objSqlConnection, strSHRDM, strSHRMC) = False Then
                    GoTo errProc
                End If
                If strSHRMC = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intValue As Integer = 0
                Try
                    Select Case objSHLX
                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Quxiao
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                            strSQL = strSQL + "   合同状态 = 合同状态 & 0xFE" + vbCr
                            strSQL = strSQL + " from 地产_B_二手_交易合同" + vbCr
                            strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                            strSQL = strSQL + " and 确认书号 in (" + vbCr
                            strSQL = strSQL + "   select 确认书号" + vbCr
                            strSQL = strSQL + "   from 地产_B_二手_交易合同审核签名" + vbCr
                            strSQL = strSQL + "   where 确认书号 = @qrsh" + vbCr
                            strSQL = strSQL + "   and   审核人码 = @shrdm" + vbCr
                            strSQL = strSQL + "   and   状态标志 & 0xF = 14" + vbCr
                            strSQL = strSQL + "   group by 确认书号" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.ExecuteNonQuery()

                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同审核签名 set " + vbCr
                            strSQL = strSQL + "   状态标志 = 状态标志 & 0xFE + 1" + vbCr
                            strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                            strSQL = strSQL + " and   审核人码 = @shrdm" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.ExecuteNonQuery()

                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Shenhe
                            intValue = 6
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同审核签名(" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,审核人码,审核人名,审核日期,状态标志" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @shrdm, @shrmc, @shrq, @ztbz" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.Parameters.AddWithValue("@shrmc", strSHRMC)
                            objSqlCommand.Parameters.AddWithValue("@shrq", Now)
                            objSqlCommand.Parameters.AddWithValue("@ztbz", intValue)
                            objSqlCommand.ExecuteNonQuery()

                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Shending
                            intValue = 14
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同审核签名(" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,审核人码,审核人名,审核日期,状态标志" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @shrdm, @shrmc, @shrq, @ztbz" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.Parameters.AddWithValue("@shrmc", strSHRMC)
                            objSqlCommand.Parameters.AddWithValue("@shrq", Now)
                            objSqlCommand.Parameters.AddWithValue("@ztbz", intValue)
                            objSqlCommand.ExecuteNonQuery()

                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                            strSQL = strSQL + "   合同状态 = 合同状态 & 0xFE + 1" + vbCr
                            strSQL = strSQL + " where 确认书号 = @qrsh"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doShenHe_ES_HETONG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同办案计划”完全数据的数据集
        ' 以“计划开始”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_BAJH = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_BANANJIHUA)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     提醒标志名称 = case when a.提醒标志 = 1 then @true else @false end," + vbCr
                        strSQL = strSQL + "     经办人员名称 = dbo.uf_gg_getRyzmByRydm(a.经办人员)," + vbCr
                        strSQL = strSQL + "     经办分行名称 = dbo.uf_gg_getZzmcByZzdm(a.经办分行) " + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同办案计划 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.计划开始" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_BANANJIHUA))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”、“计划标识”获取“地产_B_二手_交易合同办案记录”完全数据的数据集
        ' 以“办理日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strJHBS                    ：办理计划对应的唯一标识
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_BLJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strJHBS As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_BLJL = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_BLJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strJHBS Is Nothing Then strJHBS = ""
                strJHBS = strJHBS.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_BANLIJILU)
                    If strQRSH = "" Then
                        Exit Try
                    End If
                    If strJHBS = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     经办人员名称 = dbo.uf_gg_getRyzmByRydm(a.经办人员)," + vbCr
                        strSQL = strSQL + "     经办分行名称 = dbo.uf_gg_getZzmcByZzdm(a.经办分行) " + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同办案记录 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "     and   a.计划标识 = @jhbs" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.办理日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        objSqlCommand.Parameters.AddWithValue("@jhbs", strJHBS)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_BANLIJILU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_BLJL = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易合同办案计划”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_HETONG_BAJH = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_BAJH]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_HETONG_BAJH]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_交易合同办案计划"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_交易合同办案计划", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBRYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBDWMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZMC
                            '显示列
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHKS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHJS
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJKS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJJS
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_KBTS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_BWTS
                            If strValue <> "" Then
                                If objPulicParameters.isIntegerString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_QRSH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_GZNR, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBRY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBDW
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_HETONG_BAJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同办案计划”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_BAJH]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_HETONG_BAJH]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '检查数据
                If Me.doVerifyData_ES_HETONG_BAJH(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intDefaultInt As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZMC
                                        '显示列
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHKS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHJS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJKS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJJS
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZ, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_KBTS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_BWTS
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefaultInt)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同办案计划 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr

                        Case Else
                            '获取主键
                            strOldKey = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_WYBS), "")

                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZMC
                                        '显示列
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField + " = @A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField + " = @A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHKS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHJS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJKS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJJS
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZ, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_KBTS, _
                                                Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_BWTS
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefaultInt)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, Integer))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同办案计划 set " + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    End Select

                    '执行SQL
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易合同办案计划”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDeleteData_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '删除数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同办案记录 " + vbCr
                    strSQL = strSQL + " where 计划标识 = @oldkey" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案计划”
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同办案计划 " + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDeleteData_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易合同办案记录”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_HETONG_BLJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_HETONG_BLJL = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_BLJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_BLJL]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_HETONG_BLJL]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_交易合同办案记录"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_交易合同办案记录", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBRYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBDWMC
                            '显示列
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_BLRQ
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_QRSH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JHBS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_BLQK, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBRY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBDW
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_HETONG_BLJL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同办案记录”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_BLJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_ES_HETONG_BLJL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_BLJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_BLJL]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_HETONG_BLJL]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '检查数据
                If Me.doVerifyData_ES_HETONG_BLJL(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '保存数据
                Dim intDefaultInt As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = ""
                    Dim strFields As String = ""
                    Dim strValues As String = ""
                    Dim strField As String = ""
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                            Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBDWMC
                                        '显示列
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_BLRQ
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同办案记录 (" + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   " + strValues + vbCr
                            strSQL = strSQL + " )" + vbCr

                        Case Else
                            '获取主键
                            strOldKey = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_WYBS), "")

                            '计算字段列表、字段值
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            strFields = ""
                            strValues = ""
                            For i = 0 To intCount - 1 Step 1
                                strField = objPulicParameters.getObjectValue(objNewData.GetKey(i), "")
                                strValue = objPulicParameters.getObjectValue(objNewData.Item(i), "")
                                Select Case strField
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_JBDWMC
                                        '显示列
                                    Case Else
                                        If strFields = "" Then
                                            strFields = strField + " = @A" + i.ToString()
                                        Else
                                            strFields = strFields + "," + strField + " = @A" + i.ToString()
                                        End If
                                        Select Case strField
                                            Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANLIJILU_BLRQ
                                                If strValue = "" Then
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                                Else
                                                    objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(strValue, System.DateTime))
                                                End If
                                            Case Else
                                                objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), strValue)
                                        End Select
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)

                            '准备SQL语句
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同办案记录 set " + vbCr
                            strSQL = strSQL + "   " + strFields + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    End Select

                    '执行SQL
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_BLJL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易合同办案记录”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_HETONG_BLJL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doDeleteData_ES_HETONG_BLJL = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_HETONG_BLJL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '删除数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同办案记录 " + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doDeleteData_ES_HETONG_BLJL = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 标记“地产_B_二手_交易合同办案计划”业务开始办理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        '     strKSRQ              ：开始日期
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doMarkBegin_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal strKSRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doMarkBegin_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doMarkBegin_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then strKSRQ = Now.ToString("yyyy-MM-dd")

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同办案计划 set" + vbCr
                    strSQL = strSQL + "   实际开始 = @ksrq" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    strSQL = strSQL + " and   实际开始 is null" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@ksrq", strKSRQ)
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doMarkBegin_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 标记“地产_B_二手_交易合同办案计划”业务办理完毕
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        '     strJSRQ              ：结束日期
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doMarkComplete_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal strJSRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doMarkComplete_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doMarkComplete_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If
                If strJSRQ Is Nothing Then strJSRQ = ""
                strJSRQ = strJSRQ.Trim
                If strJSRQ = "" Then strJSRQ = Now.ToString("yyyy-MM-dd")

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同办案计划 set" + vbCr
                    strSQL = strSQL + "   实际结束 = @jsrq" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    strSQL = strSQL + " and   实际结束 is null" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jsrq", strJSRQ)
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doMarkComplete_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 标记“地产_B_二手_交易合同”办结
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doMarkComplete_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doMarkComplete_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doMarkComplete_ES_HETONG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strQRSH
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                    strSQL = strSQL + "   合同状态 = 合同状态 & 0xFD + 2" + vbCr
                    'zengxianglin 2008-12-03
                    'strSQL = strSQL + "  ,结案日期 = getdate()" + vbCr
                    strSQL = strSQL + "  ,结案日期 = @jarq" + vbCr
                    'zengxianglin 2008-12-03
                    strSQL = strSQL + " where 确认书号 = @oldkey" + vbCr
                    strSQL = strSQL + " and   合同状态 & 2 = 0" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    'zengxianglin 2008-12-03
                    objSqlCommand.Parameters.AddWithValue("@jarq", CType(Now.ToString("yyyy-MM-dd"), System.DateTime))
                    'zengxianglin 2008-12-03
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doMarkComplete_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 关闭“地产_B_二手_交易合同办案计划”指定业务的提醒
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doClearTixing_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doClearTixing_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doClearTixing_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同办案计划 set" + vbCr
                    strSQL = strSQL + "   提醒标志 = 0" + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doClearTixing_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 打开“地产_B_二手_交易合同办案计划”指定业务的提醒
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strWYBS              ：唯一标识
        '     intKBTS              ：开办天数
        '     intBWTS              ：办完天数
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSetupTixing_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String, _
            ByVal intKBTS As Integer, _
            ByVal intBWTS As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSetupTixing_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSetupTixing_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strWYBS Is Nothing Then strWYBS = ""
                If strWYBS = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strWYBS
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同办案计划 set" + vbCr
                    strSQL = strSQL + "   提醒标志 = 1," + vbCr
                    strSQL = strSQL + "   开办天数 = @kbts," + vbCr
                    strSQL = strSQL + "   办完天数 = @bwts " + vbCr
                    strSQL = strSQL + " where 唯一标识 = @oldkey" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@kbts", intKBTS)
                    objSqlCommand.Parameters.AddWithValue("@bwts", intBWTS)
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSetupTixing_ES_HETONG_BAJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定strQRSH的指定审核类型intSHLX的折扣审核签名
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     intSHLX              ：审核类型
        '     strSHQM              ：返回折扣审核签名
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHetongZhekouSHQM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal intSHLX As Integer, _
            ByRef strSHQM As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getHetongZhekouSHQM = False
            strSHQM = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getHetongZhekouSHQM]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select 审核人名 from 地产_B_二手_交易合同折扣审核" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   审核类型 =  " + intSHLX.ToString + vbCr
                strSQL = strSQL + " group by 审核人名" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                Dim strValue As String = ""
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        With objDataSet.Tables(0)
                            Dim intCount As Integer = .Rows.Count
                            Dim i As Integer = 0
                            For i = 0 To intCount - 1 Step 1
                                strValue = objPulicParameters.getObjectValue(.Rows(i).Item("审核人名"), "")
                                If strSHQM = "" Then
                                    strSHQM = strValue
                                Else
                                    strSHQM = strSHQM + objPulicParameters.CharSeparate + strValue
                                End If
                            Next
                        End With
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHetongZhekouSHQM = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定审核类型的上限、下限折扣
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     intSHLX              ：审核类型
        '     dblZKSX              ：返回折扣上限
        '     dblZKXX              ：返回折扣下限
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHetongZhekouSXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intSHLX As Integer, _
            ByRef dblZKSX As Double, _
            ByRef dblZKXX As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getHetongZhekouSXX = False
            dblZKSX = 1.0
            dblZKXX = 1.0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getHetongZhekouSXX]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select 折扣上限,折扣下限 from 地产_B_二手_交易合同折扣审核配置" + vbCr
                strSQL = strSQL + " where  审核类型 =  " + intSHLX.ToString + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                Dim strValue As String = ""
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        With objDataSet.Tables(0)
                            dblZKSX = objPulicParameters.getObjectValue(.Rows(0).Item("折扣上限"), 0.0)
                            dblZKXX = objPulicParameters.getObjectValue(.Rows(0).Item("折扣下限"), 0.0)
                        End With
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHetongZhekouSXX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取指定折扣的需要的折扣审核最高级别
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     dblZK                ：指定折扣
        '     intSHLX              ：返回折扣审核最高级别(0,1,2,4)
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHetongZhekouSHJB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal dblZK As Double, _
            ByRef intSHLX As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getHetongZhekouSHJB = False
            intSHLX = 1

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getHetongZhekouSHJB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If dblZK = 1.0 Then
                    intSHLX = 0 '不需要审核
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select max(审核类型) from 地产_B_二手_交易合同折扣审核配置" + vbCr
                strSQL = strSQL + " where (折扣上限 >= " + dblZK.ToString + ")" + vbCr
                strSQL = strSQL + " or    (" + dblZK.ToString + " between 折扣上限 and 折扣下限)" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                Dim strValue As String = ""
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        With objDataSet.Tables(0)
                            intSHLX = objPulicParameters.getObjectValue(.Rows(0).Item(0), 0)
                        End With
                    End If
                Else
                    intSHLX = 4 '最高审核级别
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHetongZhekouSHJB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取合同结算中介费总额
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     dblSum               ：结算中介费总额
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHetongJiesuanSum( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef dblSum As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getHetongJiesuanSum = False
            dblSum = 0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getHetongJiesuanSum]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select sum(中介费额) from 地产_B_二手_交易合同结算书" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                Dim strValue As String = ""
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        With objDataSet.Tables(0)
                            dblSum = objPulicParameters.getObjectValue(.Rows(0).Item(0), 0.0)
                        End With
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHetongJiesuanSum = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function













        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同结算书”完全数据的数据集
        ' 以“结算日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志 & 1 = 1 then @true else @false end," + vbCr
                        strSQL = strSQL + "     结算类型名称 = case when a.结算类型 & 1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF + "'" + vbCr
                        strSQL = strSQL + "                         when a.结算类型 & 2 = 2 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF + "'" + vbCr
                        strSQL = strSQL + "                         else                         '' end," + vbCr
                        strSQL = strSQL + "     结算单位名称 = dbo.uf_gg_getZzmcByZzdm(a.结算单位)," + vbCr
                        strSQL = strSQL + "     经办人员名称 = dbo.uf_gg_getRyzmByRydm(a.经办人员) " + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.结算日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“结算书号”获取“地产_B_二手_交易合同结算书”完全数据的数据集
        ' 以“结算日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJSSH                    ：结算书号
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU)
                    If strJSSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志 & 1 = 1 then @true else @false end," + vbCr
                        strSQL = strSQL + "     结算类型名称 = case when a.结算类型 & 1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF + "'" + vbCr
                        strSQL = strSQL + "                         when a.结算类型 & 2 = 2 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF + "'" + vbCr
                        strSQL = strSQL + "                         else                         '' end," + vbCr
                        strSQL = strSQL + "     结算单位名称 = dbo.uf_gg_getZzmcByZzdm(a.结算单位)," + vbCr
                        strSQL = strSQL + "     经办人员名称 = dbo.uf_gg_getRyzmByRydm(a.经办人员) " + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书 a " + vbCr
                        strSQL = strSQL + "     where a.结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.结算日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“结算书号”获取“地产_B_二手_交易合同结算书明细表”完全数据的数据集
        ' 以“税费代码”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJSSH                    ：结算书号
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS_MX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS_MX = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS_MX]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU_MINGXI)
                    If strJSSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select 唯一标识='',确认书号='',结算书号=@jssh,结算对象='',结算金额=0.0,结算摘要=''," + vbCr
                        strSQL = strSQL + "     a.税费代码," + vbCr
                        strSQL = strSQL + "     税费名称 = dbo.uf_estate_gg_getSfmc(a.税费代码)," + vbCr
                        strSQL = strSQL + "     结算额甲 = b.结算金额," + vbCr
                        strSQL = strSQL + "     结算额乙 = c.结算金额" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 税费代码" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书明细表" + vbCr
                        strSQL = strSQL + "     where 结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "     group by 税费代码" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + "   left join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 税费代码,结算金额=sum(结算金额)" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书明细表" + vbCr
                        strSQL = strSQL + "     where 结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "     and   结算对象 = @jf" + vbCr
                        strSQL = strSQL + "     group by 税费代码" + vbCr
                        strSQL = strSQL + "   ) b on a.税费代码 = b.税费代码" + vbCr
                        strSQL = strSQL + "   left join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 税费代码,结算金额=sum(结算金额)" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书明细表" + vbCr
                        strSQL = strSQL + "     where 结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "     and   结算对象 = @yf" + vbCr
                        strSQL = strSQL + "     group by 税费代码" + vbCr
                        strSQL = strSQL + "   ) c on a.税费代码 = c.税费代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.税费代码" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jf", Josco.JSOA.Common.Data.estateCaiwuData.SFDX_J)
                        objSqlCommand.Parameters.AddWithValue("@yf", Josco.JSOA.Common.Data.estateCaiwuData.SFDX_Y)
                        objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_MINGXI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS_MX = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“结算书号”获取“地产_B_二手_交易合同结算书业绩”完全数据的数据集
        ' 以“状态标志 desc,单位代码,人员职级”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJSSH                    ：结算书号
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS_YEJI( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS_YEJI = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS_YEJI]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU_YEJI)
                    If strJSSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     人员名称     = dbo.uf_gg_getRyzmByRydm(a.人员代码)," + vbCr
                        strSQL = strSQL + "     单位名称     = dbo.uf_gg_getZzmcByZzdm(a.单位代码)," + vbCr
                        strSQL = strSQL + "     人员职级名称 = dbo.uf_estate_rs_getZjmc(a.人员职级)," + vbCr
                        strSQL = strSQL + "     业绩来源名称 = case when a.业绩来源 & 1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF + "'" + vbCr
                        strSQL = strSQL + "                         when a.业绩来源 & 2 = 2 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF + "'" + vbCr
                        strSQL = strSQL + "                         else '' end," + vbCr
                        strSQL = strSQL + "     直管标记名称 = case when a.直管标记     = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_ZG + "'" + vbCr
                        strSQL = strSQL + "                         when a.直管标记     = 0 then '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_XG + "'" + vbCr
                        strSQL = strSQL + "                         else '" + Josco.JSOA.Common.Data.estateErshouData.ZGBJ_WX + "' end," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志 & 1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY + "'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志 & 1 = 0 then '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY + "'" + vbCr
                        strSQL = strSQL + "                         else '" + Josco.JSOA.Common.Data.estateErshouData.YJBJ_WX + "' end" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select *" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书业绩" + vbCr
                        strSQL = strSQL + "     where 结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.状态标志 desc,a.单位代码,a.人员职级" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_YEJI))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS_YEJI = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“确认书号”获取“合同编号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlConnection     ：现有连接
        '     strQRSH              ：确认书号
        '     strHTBH              ：(返回)合同编号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHtbhByQrsh( _
            ByRef strErrMsg As String, _
            ByVal objSqlConnection As System.Data.SqlClient.SqlConnection, _
            ByVal strQRSH As String, _
            ByRef strHTBH As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getHtbhByQrsh = False
            strHTBH = ""

            Try
                '检查
                If objSqlConnection Is Nothing Then
                    strErrMsg = "错误：[getHtbhByQrsh]连接未打开！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 合同编号 from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strHTBH = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "")
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHtbhByQrsh = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_交易合同结算书”中的新的“结算书号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strHTBH              ：合同编号
        '     strJSSH              ：结算书号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        '----------------------------------------------------------------
        Public Function getNewJSSH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strHTBH As String, _
            ByRef strJSSH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewJSSH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewJSSH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strHTBH Is Nothing Then strHTBH = ""
                strHTBH = strHTBH.Trim
                If strHTBH = "" Then
                    strErrMsg = "错误：[getNewJSSH]未指定[合同编号]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "结算书号", "地产_B_二手_交易合同结算书", 16, strHTBH + "-", True, strJSSH) = False Then
                '    GoTo errProc
                'End If
                Dim intLen As Integer = strHTBH.Length
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "结算书号", "地产_B_二手_交易合同结算书", intLen + 2, strHTBH, True, strJSSH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewJSSH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易合同结算书”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2009-12-26 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_HETONG_JSS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_JSS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_JSS]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_HETONG_JSS]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_交易合同结算书"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_交易合同结算书", objDataSet) = False Then
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0

                '检查确认书号
                Dim strQRSH As String = ""
                strQRSH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_QRSH)
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_JSS]没有指定[确认书号]！"
                    GoTo errProc
                End If
                Dim strHTBH As String = ""
                If Me.getHtbhByQrsh(strErrMsg, objSqlConnection, strQRSH, strHTBH) = False Then
                    GoTo errProc
                End If
                If strHTBH = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_HETONG_JSS]指定的[" + strQRSH + "]还未签合同！"
                    GoTo errProc
                End If

                '检查其他
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDWMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLXMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZMC
                            '显示列
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSSH
                            '自动列
                            If strValue = "" Then
                                If Me.getNewJSSH(strErrMsg, strUserId, strPassword, strHTBH, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSRQ
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                GoTo errProc
                            End If

                            'zengxianglin 2009-12-26
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JYRQ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2009-12-26

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLX
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZ
                            If strValue <> "" Then
                                If objPulicParameters.isIntegerString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZJFE, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEY
                            If strValue <> "" Then
                                If objPulicParameters.isIntegerString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_QRSH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDW
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_HETONG_JSS = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同结算书”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录
        '     zengxianglin 2009-12-26 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG_JSS = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_HETONG_JSS]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim intDefaultValue As Integer = 0
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLXMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLXMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JYRQ
                                        'zengxianglin 2009-12-26
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JYRQ
                                        'zengxianglin 2009-12-26
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefaultValue)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZJFE, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEY, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEY
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(intDefaultValue, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLXMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同结算书 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSDWMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JBRYMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLXMC, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JYRQ
                                        'zengxianglin 2009-12-26
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JYRQ
                                        'zengxianglin 2009-12-26
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZTBZ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefaultValue)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZJFE, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSEY, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_SSEY
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(intDefaultValue, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_JSS = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同结算书明细表”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     strJSSH              ：结算书号
        '     objDataSet_JSMX      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_JSS_MX( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal strJSSH As String, _
            ByVal objDataSet_JSMX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG_JSS_MX = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_MX]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_JSMX Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_MX]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_MX]未指定[确认书号]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim
                If strJSSH = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_MX]未指定[结算书号]！"
                    GoTo errProc
                End If

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同结算书明细表" + vbCr
                    strSQL = strSQL + " where 结算书号 = @jssh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim dblJSEJ As Double = 0.0
                    Dim dblJSEY As Double = 0.0
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_JSMX.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_MINGXI).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            dblJSEJ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_MINGXI_JSEJ), 0.0)
                            dblJSEY = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_MINGXI_JSEY), 0.0)

                            If dblJSEJ <> 0.0 Then
                                strSQL = ""
                                strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书明细表 (" + vbCr
                                strSQL = strSQL + "   唯一标识,确认书号,结算书号,税费代码,结算对象,结算金额,结算摘要" + vbCr
                                strSQL = strSQL + " ) values (" + vbCr
                                strSQL = strSQL + "   newid(), @qrsh, @jssh, @sfdm, @jsdx, @jsje, @jszy" + vbCr
                                strSQL = strSQL + " )" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                                objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                                objSqlCommand.Parameters.AddWithValue("@sfdm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_MINGXI_SFDM))
                                objSqlCommand.Parameters.AddWithValue("@jsdx", Josco.JSOA.Common.Data.estateCaiwuData.SFDX_J)
                                objSqlCommand.Parameters.AddWithValue("@jsje", dblJSEJ)
                                objSqlCommand.Parameters.AddWithValue("@jszy", " ")
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If

                            If dblJSEY <> 0.0 Then
                                strSQL = ""
                                strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书明细表 (" + vbCr
                                strSQL = strSQL + "   唯一标识,确认书号,结算书号,税费代码,结算对象,结算金额,结算摘要" + vbCr
                                strSQL = strSQL + " ) values (" + vbCr
                                strSQL = strSQL + "   newid(), @qrsh, @jssh, @sfdm, @jsdx, @jsje, @jszy" + vbCr
                                strSQL = strSQL + " )" + vbCr
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                                objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                                objSqlCommand.Parameters.AddWithValue("@sfdm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_MINGXI_SFDM))
                                objSqlCommand.Parameters.AddWithValue("@jsdx", Josco.JSOA.Common.Data.estateCaiwuData.SFDX_Y)
                                objSqlCommand.Parameters.AddWithValue("@jsje", dblJSEY)
                                objSqlCommand.Parameters.AddWithValue("@jszy", " ")
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.ExecuteNonQuery()
                            End If
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_JSS_MX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同结算书业绩”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     strJSSH              ：结算书号
        '     objDataSet_Yeji      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 更改
        '     zengxianglin 2010-01-06 重新设计
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_JSS_YEJI( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal strJSSH As String, _
            ByVal objDataSet_Yeji As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable_YEJI As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_YEJI
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_HETONG_JSS_YEJI = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_YEJI]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_Yeji Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_YEJI]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_YEJI]未指定[确认书号]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim
                If strJSSH = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS_YEJI]未指定[结算书号]！"
                    GoTo errProc
                End If

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同结算书业绩" + vbCr
                    strSQL = strSQL + " where 结算书号 = @jssh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_Yeji.Tables(strTable_YEJI).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书业绩 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,结算书号,业绩来源,人员代码,单位代码,人员职级,直管标记,状态标志," + vbCr
                            strSQL = strSQL + "   考核业绩,私佣基数,公佣基数,本次总额,本次计提,本次保留,分配比例,所属分组,团队编号" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @jssh, @yjly, @rydm, @dwdm, @ryzj, @zgbj, @ztbz," + vbCr
                            strSQL = strSQL + "   @khyj, @syjs, @gyjs, @bcze, @bcjt, @bcbl, @fpbl, @ssfz, @tdbh" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@yjly", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLY), 0))
                            objSqlCommand.Parameters.AddWithValue("@rydm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYDM), ""))
                            objSqlCommand.Parameters.AddWithValue("@dwdm", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWDM), ""))
                            objSqlCommand.Parameters.AddWithValue("@tdbh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_TDBH), 0))
                            objSqlCommand.Parameters.AddWithValue("@ssfz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SSFZ), ""))
                            objSqlCommand.Parameters.AddWithValue("@ryzj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ), ""))
                            objSqlCommand.Parameters.AddWithValue("@zgbj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ), 0))
                            objSqlCommand.Parameters.AddWithValue("@ztbz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ), 0))
                            objSqlCommand.Parameters.AddWithValue("@khyj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@syjs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@gyjs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@bcze", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@bcjt", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@bcbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@fpbl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL), 0.0))
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_JSS_YEJI = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同结算书”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(返回保存后的新值)
        '     objOldData             ：记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_JSMX        ：结算明细数据集
        '     objDataSet_YEJI        ：结算业绩数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_JSMX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YEJI As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_HETONG_JSS = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_JSS]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '检查主记录
                If Me.doVerifyData_ES_HETONG_JSS(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存主记录
                    If Me.doSaveData_ES_HETONG_JSS(strErrMsg, objSqlTransaction, objOldData, objNewData, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If

                    '获取键值
                    Dim strQRSH As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_QRSH)
                    Dim strJSSH As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSSH)

                    '保存“地产_B_二手_交易合同结算书明细表”数据
                    If Me.doSaveData_ES_HETONG_JSS_MX(strErrMsg, objSqlTransaction, strQRSH, strJSSH, objDataSet_JSMX) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“地产_B_二手_交易合同结算书业绩”数据
                    If Me.doSaveData_ES_HETONG_JSS_YEJI(strErrMsg, objSqlTransaction, strQRSH, strJSSH, objDataSet_YEJI) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_HETONG_JSS = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易合同结算书”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_ES_HETONG_JSS = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_HETONG_JSS]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_二手_交易合同结算书 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strJSSH As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strJSSH = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSSH), "")
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    '删除“地产_B_二手_交易合同结算书明细表”
                    strSQL = "delete from 地产_B_二手_交易合同结算书明细表 where 结算书号 = '" + strJSSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书业绩”
                    strSQL = "delete from 地产_B_二手_交易合同结算书业绩 where 结算书号 = '" + strJSSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同结算书审核签名 where 结算书号 = '" + strJSSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书”
                    strSQL = "delete from 地产_B_二手_交易合同结算书 where 结算书号 = '" + strJSSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_HETONG_JSS = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“确认书号”获取“代理费折扣”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     dblHTZK              ：(返回)代理费折扣
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHtzkByQrsh( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef dblHTZK As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getHtzkByQrsh = False
            dblHTZK = 1.0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[getHtzkByQrsh]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 代理费折扣 from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 交易编号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    dblHTZK = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), 1.0)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHtzkByQrsh = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“职级代码”、“直管标记”、“业绩标记”获取“直接计提”、“保留计提”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strZJDM              ：职级代码
        '     intZGBJ              ：直管标记
        '     intYJBJ              ：业绩标记
        '     dblZJJT              ：(返回)直接计提
        '     dblBLJT              ：(返回)保留计提
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getYongjinBili( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strZJDM As String, _
            ByVal intZGBJ As Integer, _
            ByVal intYJBJ As Integer, _
            ByRef dblZJJT As Double, _
            ByRef dblBLJT As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getYongjinBili = False
            dblZJJT = 0.0
            dblBLJT = 0.0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[getYongjinBili]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strZJDM Is Nothing Then strZJDM = ""
                strZJDM = strZJDM.Trim
                If strZJDM = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 直接计提,保留计提 from 地产_B_人事_佣金计提标准" + vbCr
                strSQL = strSQL + " where 适用方法 & 1 = 1" + vbCr '公佣计提方法
                strSQL = strSQL + " and   职级代码 = '" + strZJDM + "'" + vbCr
                strSQL = strSQL + " and   直管标记 =  " + intZGBJ.ToString + vbCr
                strSQL = strSQL + " and   业绩标记 =  " + intYJBJ.ToString + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    dblZJJT = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("直接计提"), 0.0)
                    dblBLJT = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("保留计提"), 0.0)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getYongjinBili = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”、“合同折扣”、“中介费额”、“结算类型”计算
        ' 私佣、公佣、考核业绩等数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     dblHTZK              ：代理费折扣
        '     dblZJFE              ：中介费额
        '     intJSLX              ：结算类型
        '     objDataSet_Yeji      ：返回业绩数据集
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2009-05-13 更改
        '     zengxianglin 2010-01-06 重新设计
        '----------------------------------------------------------------
        Public Function doComputeYeji( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal dblHTZK As Double, _
            ByVal dblZJFE As Double, _
            ByVal intJSLX As Integer, _
            ByRef objDataSet_Yeji As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable_YEJI As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_YEJI
            Dim strTable_FPBL As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objDataSet As Josco.JSOA.Common.Data.estateErshouData
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doComputeYeji = False
            dblHTZK = 1.0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doComputeYeji]没有指定[连接用户]！"
                    GoTo errProc
                End If
                Select Case intJSLX
                    Case 1, 2
                    Case Else
                        strErrMsg = "错误：[doComputeYeji]无效的[结算类型]！"
                        GoTo errProc
                End Select
                If dblZJFE <= 0.0 Then
                    strErrMsg = "错误：[doComputeYeji]无效的[中介费]！"
                    GoTo errProc
                End If

                '初始化数据集
                objDataSet_Yeji = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU_YEJI)
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取业绩分配数据
                If Me.getDataSet_ES_HETONG_FPBL(strErrMsg, strUserId, strPassword, strQRSH, "", objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(strTable_FPBL) Is Nothing Then
                    strErrMsg = "错误：无法获取[业绩分配比例]数据！"
                    GoTo errProc
                End If
                With objDataSet.Tables(strTable_FPBL)
                    If .Rows.Count < 1 Then
                        strErrMsg = "错误：没有定义[业绩分配比例]数据！"
                        GoTo errProc
                    End If
                End With

                '插入到objDataSet_Yeji
                Dim objDataRow As System.Data.DataRow = Nothing
                Dim strFNameA As String = ""
                Dim strFNameB As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                With objDataSet.Tables(strTable_FPBL)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            objDataRow = .NewRow
                        End With
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_WYBS
                        objDataRow.Item(strFNameA) = ""
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_QRSH
                        objDataRow.Item(strFNameA) = strQRSH
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_JSSH
                        objDataRow.Item(strFNameA) = ""
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLY
                        objDataRow.Item(strFNameA) = intJSLX
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLYMC
                        objDataRow.Item(strFNameA) = Josco.JSOA.Common.Data.estateErshouData.getJiesuanLeixingStatusName(intJSLX)
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ
                        objDataRow.Item(strFNameA) = 0.0
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SSFZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_TDBH
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        '*******************************************************************************************************************
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            .Rows.Add(objDataRow)
                        End With
                    Next
                End With

                '根据类型计算：考核业绩、私佣基数、公佣基数
                Dim dblMinZK As Double = Josco.JsKernal.Common.jsoaConfiguration.ES_YJJTZK_MIN
                Dim dblNewHTZK As Double = 0.0
                Dim intYJBJ As Integer = 0
                Dim intZGBJ As Integer = 0
                Dim strZJDM As String = ""
                Dim dblFPBL As Double = 0.0
                Dim dblKHYJ As Double = 0.0
                Dim dblGYJS As Double = 0.0
                Dim dblSYJS As Double = 0.0
                Dim dblBCZE As Double = 0.0
                Dim dblBCJT As Double = 0.0
                Dim dblBCBL As Double = 0.0
                Dim dblJTBL As Double = 0.0
                Dim dblBLBL As Double = 0.0
                With objDataSet_Yeji.Tables(strTable_YEJI)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        '获取数据
                        strZJDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ), "")
                        intYJBJ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ), 0)
                        intZGBJ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ), 0)
                        dblFPBL = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL), 0.0)

                        '折扣调整
                        If dblHTZK < dblMinZK Then
                            dblNewHTZK = dblMinZK
                        Else
                            dblNewHTZK = dblHTZK
                        End If

                        '计算
                        dblGYJS = 0.0
                        dblSYJS = 0.0
                        dblBCZE = 0.0
                        dblBCJT = 0.0
                        dblBCBL = 0.0
                        dblJTBL = 0.0
                        dblBLBL = 0.0
                        Select Case Josco.JSOA.Common.Data.estateErshouData.getJiesuanLeixingStatusName(intJSLX)
                            Case Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF
                                dblKHYJ = dblZJFE * dblFPBL / dblHTZK
                                Select Case Josco.JSOA.Common.Data.estateErshouData.getYejiStatusName(intYJBJ)
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY
                                        dblSYJS = dblZJFE * dblFPBL / dblNewHTZK
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY
                                        dblGYJS = dblZJFE * dblFPBL / dblNewHTZK
                                        '计提比例计算
                                        If Me.getYongjinBili(strErrMsg, strUserId, strPassword, strZJDM, intZGBJ, intYJBJ, dblJTBL, dblBLBL) = False Then
                                            GoTo errProc
                                        End If
                                        '佣金计算
                                        dblBCJT = dblGYJS * dblJTBL
                                        dblBCBL = dblGYJS * dblBLBL
                                        dblBCZE = dblBCJT + dblBCBL
                                    Case Else
                                End Select

                            Case Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF
                                dblKHYJ = dblZJFE * dblFPBL
                                Select Case Josco.JSOA.Common.Data.estateErshouData.getYejiStatusName(intYJBJ)
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY
                                        dblSYJS = dblZJFE * dblFPBL
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY
                                        dblGYJS = dblZJFE * dblFPBL
                                        '计提比例计算
                                        If Me.getYongjinBili(strErrMsg, strUserId, strPassword, strZJDM, intZGBJ, intYJBJ, dblJTBL, dblBLBL) = False Then
                                            GoTo errProc
                                        End If
                                        '佣金计算
                                        dblBCJT = dblGYJS * dblJTBL
                                        dblBCBL = dblGYJS * dblBLBL
                                        dblBCZE = dblBCJT + dblBCBL
                                    Case Else
                                End Select
                        End Select

                        '返回
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ) = dblKHYJ
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS) = dblGYJS
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS) = dblSYJS
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT) = dblBCJT
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL) = dblBCBL
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE) = dblBCZE
                    Next
                    .DefaultView.Sort = "状态标志 desc,单位代码,人员职级"
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doComputeYeji = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_Yeji)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”、“合同折扣”、“中介费额”、“结算类型”计算
        ' 私佣、公佣、考核业绩等数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     dblHTZK              ：代理费折扣
        '     dblZJFE              ：中介费额
        '     intJSLX              ：结算类型
        '     objDataSet_SYBL      ：私佣分配数据
        '     objDataSet_GYBL      ：公佣分配数据
        '     objDataSet_Yeji      ：返回业绩数据集
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2009-05-19 创建
        '     zengxianglin 2010-01-06 重新设计
        '----------------------------------------------------------------
        Public Function doComputeYeji( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal dblHTZK As Double, _
            ByVal dblZJFE As Double, _
            ByVal intJSLX As Integer, _
            ByVal objDataSet_SYBL As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_GYBL As Josco.JSOA.Common.Data.estateErshouData, _
            ByRef objDataSet_Yeji As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable_YEJI As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_YEJI
            Dim strTable_FPBL As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doComputeYeji = False
            dblHTZK = 1.0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doComputeYeji]没有指定[连接用户]！"
                    GoTo errProc
                End If
                Select Case intJSLX
                    Case 1, 2
                    Case Else
                        strErrMsg = "错误：[doComputeYeji]无效的[结算类型]！"
                        GoTo errProc
                End Select
                If dblZJFE <= 0.0 Then
                    strErrMsg = "错误：[doComputeYeji]无效的[中介费]！"
                    GoTo errProc
                End If
                '================================================================================================================
                If objDataSet_SYBL Is Nothing Then
                    Exit Try
                End If
                If objDataSet_SYBL.Tables(strTable_FPBL) Is Nothing Then
                    Exit Try
                End If
                If objDataSet_SYBL.Tables(strTable_FPBL).Rows.Count < 1 Then
                    Exit Try
                End If
                '================================================================================================================
                If objDataSet_GYBL Is Nothing Then
                    Exit Try
                End If
                If objDataSet_GYBL.Tables(strTable_FPBL) Is Nothing Then
                    Exit Try
                End If
                If objDataSet_GYBL.Tables(strTable_FPBL).Rows.Count < 1 Then
                    Exit Try
                End If

                '初始化数据集
                objDataSet_Yeji = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU_YEJI)
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '插入到objDataSet_Yeji
                Dim objDataRow As System.Data.DataRow = Nothing
                Dim strFNameA As String = ""
                Dim strFNameB As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                '================================================================================================================
                With objDataSet_SYBL.Tables(strTable_FPBL)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            objDataRow = .NewRow
                        End With
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_WYBS
                        objDataRow.Item(strFNameA) = ""
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_QRSH
                        objDataRow.Item(strFNameA) = strQRSH
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_JSSH
                        objDataRow.Item(strFNameA) = ""
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLY
                        objDataRow.Item(strFNameA) = intJSLX
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLYMC
                        objDataRow.Item(strFNameA) = Josco.JSOA.Common.Data.estateErshouData.getJiesuanLeixingStatusName(intJSLX)
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ
                        objDataRow.Item(strFNameA) = 0.0
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SSFZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_TDBH
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        '*******************************************************************************************************************
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            .Rows.Add(objDataRow)
                        End With
                    Next
                End With
                '================================================================================================================
                With objDataSet_GYBL.Tables(strTable_FPBL)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            objDataRow = .NewRow
                        End With
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_WYBS
                        objDataRow.Item(strFNameA) = ""
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_QRSH
                        objDataRow.Item(strFNameA) = strQRSH
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_JSSH
                        objDataRow.Item(strFNameA) = ""
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLY
                        objDataRow.Item(strFNameA) = intJSLX
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_YJLYMC
                        objDataRow.Item(strFNameA) = Josco.JSOA.Common.Data.estateErshouData.getJiesuanLeixingStatusName(intJSLX)
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS
                        objDataRow.Item(strFNameA) = 0.0
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ
                        objDataRow.Item(strFNameA) = 0.0
                        '*******************************************************************************************************************
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_DWMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SSFZ
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_TDBH
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYDM
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        strFNameA = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYMC
                        strFNameB = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYMC
                        objDataRow.Item(strFNameA) = .Rows(i).Item(strFNameB)
                        '*******************************************************************************************************************
                        With objDataSet_Yeji.Tables(strTable_YEJI)
                            .Rows.Add(objDataRow)
                        End With
                    Next
                End With

                '根据类型计算：考核业绩、私佣基数、公佣基数
                Dim dblMinZK As Double = Josco.JsKernal.Common.jsoaConfiguration.ES_YJJTZK_MIN
                Dim dblNewHTZK As Double = 0.0
                Dim intYJBJ As Integer = 0
                Dim intZGBJ As Integer = 0
                Dim strZJDM As String = ""
                Dim dblFPBL As Double = 0.0
                Dim dblKHYJ As Double = 0.0
                Dim dblGYJS As Double = 0.0
                Dim dblSYJS As Double = 0.0
                Dim dblBCZE As Double = 0.0
                Dim dblBCJT As Double = 0.0
                Dim dblBCBL As Double = 0.0
                Dim dblJTBL As Double = 0.0
                Dim dblBLBL As Double = 0.0
                With objDataSet_Yeji.Tables(strTable_YEJI)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        '获取数据
                        strZJDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_RYZJ), "")
                        intYJBJ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZTBZ), 0)
                        intZGBJ = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_ZGBJ), 0)
                        dblFPBL = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_FPBL), 0.0)

                        '折扣调整
                        If dblHTZK < dblMinZK Then
                            dblNewHTZK = dblMinZK
                        Else
                            dblNewHTZK = dblHTZK
                        End If

                        '计算
                        dblGYJS = 0.0
                        dblSYJS = 0.0
                        dblBCZE = 0.0
                        dblBCJT = 0.0
                        dblBCBL = 0.0
                        dblJTBL = 0.0
                        dblBLBL = 0.0
                        Select Case Josco.JSOA.Common.Data.estateErshouData.getJiesuanLeixingStatusName(intJSLX)
                            Case Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF
                                dblKHYJ = dblZJFE * dblFPBL / dblHTZK
                                Select Case Josco.JSOA.Common.Data.estateErshouData.getYejiStatusName(intYJBJ)
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY
                                        dblSYJS = dblZJFE * dblFPBL / dblNewHTZK
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY
                                        dblGYJS = dblZJFE * dblFPBL / dblNewHTZK
                                        '计提比例计算
                                        If Me.getYongjinBili(strErrMsg, strUserId, strPassword, strZJDM, intZGBJ, intYJBJ, dblJTBL, dblBLBL) = False Then
                                            GoTo errProc
                                        End If
                                        '佣金计算
                                        dblBCJT = dblGYJS * dblJTBL
                                        dblBCBL = dblGYJS * dblBLBL
                                        dblBCZE = dblBCJT + dblBCBL
                                    Case Else
                                End Select

                            Case Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF
                                dblKHYJ = dblZJFE * dblFPBL
                                Select Case Josco.JSOA.Common.Data.estateErshouData.getYejiStatusName(intYJBJ)
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_SY
                                        dblSYJS = dblZJFE * dblFPBL
                                    Case Josco.JSOA.Common.Data.estateErshouData.YJBJ_GY
                                        dblGYJS = dblZJFE * dblFPBL
                                        '计提比例计算
                                        If Me.getYongjinBili(strErrMsg, strUserId, strPassword, strZJDM, intZGBJ, intYJBJ, dblJTBL, dblBLBL) = False Then
                                            GoTo errProc
                                        End If
                                        '佣金计算
                                        dblBCJT = dblGYJS * dblJTBL
                                        dblBCBL = dblGYJS * dblBLBL
                                        dblBCZE = dblBCJT + dblBCBL
                                    Case Else
                                End Select
                        End Select

                        '返回
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_KHYJ) = dblKHYJ
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_GYJS) = dblGYJS
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_SYJS) = dblSYJS
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCJT) = dblBCJT
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCBL) = dblBCBL
                        .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_YEJI_BCZE) = dblBCZE
                    Next
                    .DefaultView.Sort = "状态标志 desc,单位代码,人员职级"
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doComputeYeji = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_Yeji)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function












        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_交易合同折扣审核”完全数据的数据集
        ' 以“审核日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_ZKSH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_ZKSH = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_ZKSH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_ZHEKOUSHENHE)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     审核类型名称 = case when a.审核类型&1 = 1 then @yjsh" + vbCr
                        strSQL = strSQL + "                         when a.审核类型&2 = 2 then @ejsh" + vbCr
                        strSQL = strSQL + "                         when a.审核类型&4 = 4 then @sjsh" + vbCr
                        strSQL = strSQL + "                         else ' ' end" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同折扣审核 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.审核日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@yjsh", "一级审核")
                        objSqlCommand.Parameters.AddWithValue("@ejsh", "二级审核")
                        objSqlCommand.Parameters.AddWithValue("@sjsh", "三级审核")
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_ZHEKOUSHENHE))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_ZKSH = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 合同折扣审核处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：确认书号
        '     strSHRDM             ：审核人代码
        '     objSHLX              ：审核类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doZhekouShenHe_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strSHRDM As String, _
            ByVal objSHLX As Josco.JSOA.Common.Data.estateErshouData.enumZhekouShenheType) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doZhekouShenHe_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strSHRDM Is Nothing Then strSHRDM = ""
                strSHRDM = strSHRDM.Trim
                If strSHRDM = "" Then
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doZhekouShenHe_ES_HETONG]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取人员名称
                Dim strSHRMC As String = ""
                If objdacCustomer.getRymcByRydm(strErrMsg, objSqlConnection, strSHRDM, strSHRMC) = False Then
                    GoTo errProc
                End If
                If strSHRMC = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intValue As Integer = 0
                Try
                    Select Case objSHLX
                        Case Josco.JSOA.Common.Data.estateErshouData.enumZhekouShenheType.YJ, _
                            Josco.JSOA.Common.Data.estateErshouData.enumZhekouShenheType.EJ, _
                            Josco.JSOA.Common.Data.estateErshouData.enumZhekouShenheType.SJ
                            intValue = objSHLX
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同折扣审核(" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,审核人码,审核人名,审核日期,审核类型" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @shrdm, @shrmc, @shrq, @shlx" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.Parameters.AddWithValue("@shrmc", strSHRMC)
                            objSqlCommand.Parameters.AddWithValue("@shrq", Now)
                            objSqlCommand.Parameters.AddWithValue("@shlx", intValue)
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doZhekouShenHe_ES_HETONG = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function












        '----------------------------------------------------------------
        ' 获取“地产_B_二手_交易合同结算书”完全数据的数据集
        ' 以“结算日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJSSH                    ：结算书号
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：权限控制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志 & 1 = 1 then @true else @false end," + vbCr
                        strSQL = strSQL + "     结算类型名称 = case when a.结算类型 & 1 = 1 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_ZJF + "'" + vbCr
                        strSQL = strSQL + "                         when a.结算类型 & 2 = 2 then '" + Josco.JSOA.Common.Data.estateErshouData.JSLX_LSF + "'" + vbCr
                        strSQL = strSQL + "                         else                         '' end," + vbCr
                        strSQL = strSQL + "     结算单位名称 = dbo.uf_gg_getZzmcByZzdm(a.结算单位)," + vbCr
                        strSQL = strSQL + "     经办人员名称 = dbo.uf_gg_getRyzmByRydm(a.经办人员) " + vbCr
                        If strJSSH <> "" Then
                            strSQL = strSQL + "   from" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select * from 地产_B_二手_交易合同结算书" + vbCr
                            strSQL = strSQL + "     where 结算书号 = '" + strJSSH + "'" + vbCr
                            strSQL = strSQL + "   ) a" + vbCr
                        Else
                            strSQL = strSQL + "   from 地产_B_二手_交易合同结算书 a" + vbCr
                        End If
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or     单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                            '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.结算日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@true", Josco.JsKernal.Common.Utilities.PulicParameters.CharTrue)
                        objSqlCommand.Parameters.AddWithValue("@false", Josco.JsKernal.Common.Utilities.PulicParameters.CharFalse)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS = True
            Exit Function

errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 结算书审核处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：确认书号
        '     strJSSH              ：结算书号
        '     strSHRDM             ：审核人代码
        '     objSHLX              ：审核类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function doShenHe_ES_HETONG_JSS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strJSSH As String, _
            ByVal strSHRDM As String, _
            ByVal objSHLX As Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doShenHe_ES_HETONG_JSS = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim
                If strJSSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strSHRDM Is Nothing Then strSHRDM = ""
                strSHRDM = strSHRDM.Trim
                If strSHRDM = "" Then
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doShenHe_ES_HETONG_JSS]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取人员名称
                Dim strSHRMC As String = ""
                If objdacCustomer.getRymcByRydm(strErrMsg, objSqlConnection, strSHRDM, strSHRMC) = False Then
                    GoTo errProc
                End If
                If strSHRMC = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intDefaultValue As Integer = 0
                Dim intValue As Integer = 0
                Try
                    Select Case objSHLX
                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Quxiao
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同结算书 set" + vbCr
                            strSQL = strSQL + "   状态标志 = 状态标志 & 0xFE" + vbCr
                            strSQL = strSQL + " from 地产_B_二手_交易合同结算书" + vbCr
                            strSQL = strSQL + " where 结算书号 = @jssh" + vbCr
                            strSQL = strSQL + " and 结算书号 in (" + vbCr
                            strSQL = strSQL + "   select 结算书号" + vbCr
                            strSQL = strSQL + "   from 地产_B_二手_交易合同结算书审核签名" + vbCr
                            strSQL = strSQL + "   where 结算书号 = @jssh" + vbCr
                            strSQL = strSQL + "   and   审核人码 = @shrdm" + vbCr
                            strSQL = strSQL + "   and   状态标志 & 0xF = 14" + vbCr
                            strSQL = strSQL + "   group by 结算书号" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.ExecuteNonQuery()

                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同结算书审核签名 set " + vbCr
                            strSQL = strSQL + "   状态标志 = 状态标志 & 0xFE + 1" + vbCr
                            strSQL = strSQL + " where 结算书号 = @jssh" + vbCr
                            strSQL = strSQL + " and   审核人码 = @shrdm" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.ExecuteNonQuery()

                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Shenhe
                            intValue = 6
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书审核签名(" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,结算书号,审核人码,审核人名,审核日期,状态标志" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @jssh, @shrdm, @shrmc, @shrq, @ztbz" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.Parameters.AddWithValue("@shrmc", strSHRMC)
                            objSqlCommand.Parameters.AddWithValue("@shrq", Now)
                            objSqlCommand.Parameters.AddWithValue("@ztbz", intValue)
                            objSqlCommand.ExecuteNonQuery()

                        Case Josco.JSOA.Common.Data.estateErshouData.enumShenheStatus.Shending
                            intValue = 14
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书审核签名(" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,结算书号,审核人码,审核人名,审核日期,状态标志" + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @jssh, @shrdm, @shrmc, @shrq, @ztbz" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@shrdm", strSHRDM)
                            objSqlCommand.Parameters.AddWithValue("@shrmc", strSHRMC)
                            objSqlCommand.Parameters.AddWithValue("@shrq", Now)
                            objSqlCommand.Parameters.AddWithValue("@ztbz", intValue)
                            objSqlCommand.ExecuteNonQuery()

                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易合同结算书 set" + vbCr
                            strSQL = strSQL + "   状态标志 = 状态标志 & 0xFE + 1" + vbCr
                            strSQL = strSQL + " where 结算书号 = @jssh"
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.ExecuteNonQuery()

                            '写入“地产_B_财务_二手实收实付”
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_财务_二手实收实付 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,票据号码,税费代码," + vbCr
                            strSQL = strSQL + "   收付对象,收付标志,发生日期,发生金额," + vbCr
                            strSQL = strSQL + "   摘要说明,客户名称,经办人员,经办分行," + vbCr
                            strSQL = strSQL + "   审核标志" + vbCr
                            strSQL = strSQL + " )" + vbCr
                            strSQL = strSQL + " select 唯一标识=newid(),a.确认书号,票据号码=a.结算书号,a.税费代码," + vbCr
                            strSQL = strSQL + "   收付对象=a.结算对象,收付标志=@sfbz,发生日期=b.结算日期,发生金额=a.结算金额," + vbCr
                            strSQL = strSQL + "   摘要说明=b.备注信息," + vbCr
                            strSQL = strSQL + "   客户名称=case when a.结算对象 = @jf then c.业主名称 else c.客户名称 end," + vbCr
                            strSQL = strSQL + "   b.经办人员,经办分行=b.结算单位,审核标志=@shbz" + vbCr
                            strSQL = strSQL + " from" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   select * from 地产_B_二手_交易合同结算书明细表" + vbCr
                            strSQL = strSQL + "   where 结算书号 = @jssh" + vbCr
                            strSQL = strSQL + " ) a" + vbCr
                            strSQL = strSQL + " left join" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   select * from 地产_B_二手_交易合同结算书" + vbCr
                            strSQL = strSQL + "   where 确认书号 = @qrsh" + vbCr
                            strSQL = strSQL + " ) b on a.结算书号 = b.结算书号" + vbCr
                            strSQL = strSQL + " left join" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   select 交易编号,业主名称,客户名称 from 地产_V_全部合同" + vbCr
                            strSQL = strSQL + "   where 交易编号 = @qrsh" + vbCr
                            strSQL = strSQL + " ) c on a.确认书号 = c.交易编号" + vbCr
                            strSQL = strSQL + " where b.结算书号 is not null" + vbCr
                            strSQL = strSQL + " and   c.交易编号 is not null" + vbCr
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@sfbz", Josco.JSOA.Common.Data.estateCaiwuData.SFBZ_F)
                            objSqlCommand.Parameters.AddWithValue("@jf", Josco.JSOA.Common.Data.estateCaiwuData.SFDX_J)
                            objSqlCommand.Parameters.AddWithValue("@shbz", intDefaultValue)
                            objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doShenHe_ES_HETONG_JSS = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“结算书号”获取“地产_B_二手_交易合同结算书审核签名”完全数据的数据集
        ' 以“审核日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strJSSH                    ：结算书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_HETONG_JSS_SHQK( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_HETONG_JSS_SHQK = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_HETONG_JSS_SHQK]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_JIESUANSHU_SHENHE)
                    If strJSSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     状态标志名称 = case when a.状态标志   = 6  then '审核签名'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志   = 14 then '审定签名'" + vbCr
                        strSQL = strSQL + "                         when a.状态标志&1 = 1  then '取消签名'" + vbCr
                        strSQL = strSQL + "                         else                        '没有签名' end" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书审核签名 a " + vbCr
                        strSQL = strSQL + "     where a.结算书号 = @jssh" + vbCr
                        strSQL = strSQL + "   ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.审核日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@jssh", strJSSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU_SHENHE))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_HETONG_JSS_SHQK = True
            Exit Function

errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的结算书是否已审核？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strJSSH              ：结算书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function isJiesuanshuYiShen( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isJiesuanshuYiShen = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isJiesuanshuYiShen]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim
                If strJSSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同结算书" + vbCr
                strSQL = strSQL + " where 结算书号 = '" + strJSSH + "'" + vbCr
                strSQL = strSQL + " and   状态标志 & 1 = 1" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已审
                            blnIS = True
                        End If
                    End If
                End If

            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isJiesuanshuYiShen = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“确认书号”获取“合同日期”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlConnection     ：现有连接
        '     strQRSH              ：确认书号
        '     strHTBH              ：(返回)合同编号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        '----------------------------------------------------------------
        Public Function getHtrqByQrsh( _
            ByRef strErrMsg As String, _
            ByVal objSqlConnection As System.Data.SqlClient.SqlConnection, _
            ByVal strQRSH As String, _
            ByRef strHTRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getHtrqByQrsh = False
            strHTRQ = ""

            Try
                '检查
                If objSqlConnection Is Nothing Then
                    strErrMsg = "错误：[getHtrqByQrsh]连接未打开！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 合同日期 from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strHTRQ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd")
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHtrqByQrsh = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“确认书号”获取“合同日期”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：人员代码
        '     strQRSH              ：确认书号
        '     strHTBH              ：(返回)合同编号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-10-14 创建
        '----------------------------------------------------------------
        Public Function getHtrqByQrsh( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef strHTRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getHtrqByQrsh = False
            strHTRQ = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[getHtrqByQrsh]中没有指定[用户标识]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 合同日期 from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strHTRQ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd")
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getHtrqByQrsh = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据[人员代码]、[指定时间]计算业务人员的所属单位、职级、所属分组信息
        ' 适用于[管理架构]中的人员
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：人员代码
        '     strRYDM              ：确认书号
        '     strJCSJ              ：指定时间
        '     objRYJGXX            ：(返回)业务人员的所属单位、职级、所属分组信息
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-10-14 创建
        '     zengxianglin 2010-01-06 更新
        '----------------------------------------------------------------
        Public Function getRYJGXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strJCSJ As String, _
            ByRef objRYJGXX As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getRYJGXX = False
            objRYJGXX = Nothing

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[getRYJGXX]中没有指定[用户标识]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    strErrMsg = "错误：[getRYJGXX]中没有指定[人员代码]！"
                    GoTo errProc
                End If
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    strErrMsg = "错误：[getRYJGXX]中没有指定[检测时间]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    strErrMsg = "错误：[getRYJGXX]中指定无效的[检测时间]！"
                    GoTo errProc
                End If

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select a.*," + vbCr
                strSQL = strSQL + "   b.组织名称 as 所属单位名称," + vbCr
                strSQL = strSQL + "   c.职级名称 as 职级名称" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select a.*" + vbCr
                strSQL = strSQL + "   from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "') a" + vbCr
                strSQL = strSQL + "   where a.人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                strSQL = strSQL + " left join 公共_B_组织机构      b on a.所属单位 = b.组织代码" + vbCr
                strSQL = strSQL + " left join 地产_B_人事_职级定义 c on a.职级代码 = c.职级代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet Is Nothing Then
                    Exit Try
                End If
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If
                If objDataSet.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If

                '返回信息
                Dim strValue As String = ""
                objRYJGXX = New System.Collections.Specialized.NameValueCollection
                With objDataSet.Tables(0).Rows(0)
                    strValue = objPulicParameters.getObjectValue(.Item("所属单位"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM, strValue)

                    strValue = objPulicParameters.getObjectValue(.Item("所属单位名称"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC, strValue)

                    strValue = objPulicParameters.getObjectValue(.Item("所属分组"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ, strValue)

                    'zengxianglin 2010-01-06
                    strValue = objPulicParameters.getObjectValue(.Item("团队编号"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH, strValue)
                    'zengxianglin 2010-01-06

                    strValue = objPulicParameters.getObjectValue(.Item("职级代码"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ, strValue)

                    strValue = objPulicParameters.getObjectValue(.Item("职级名称"), "")
                    objRYJGXX.Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC, strValue)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getRYJGXX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function












        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书其他”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_QT = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_QT]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_QT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书其他 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            'zengxianglin 2008-12-06
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or     单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                            '不是行政助理
                            End If
                            'zengxianglin 2008-12-06
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_QT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_确认书其他”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_QT = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_QT)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书其他 a " + vbCr
                        strSQL = strSQL + "   where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_QT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据“确认书号”获取“地产_B_二手_物业其他”完全数据的数据集
        ' 以“房屋地址”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strQRSH                    ：确认书号
        '     strWhere                   ：搜索字符串
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_WUYE_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strWhere As String, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_WUYE_QT = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_WUYE_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_WUYE_QT)
                    If strQRSH = "" Then
                        Exit Try
                    End If

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "   物业信息 = '房源编号：'+isnull(a.房源编号,'')+'；<br>地址：'+isnull(a.房屋地址,'')+'；房产证：'+isnull(a.房产证号,'')+'；<br>楼盘：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼盘,'')+'，栋别：'+isnull(a.楼栋,'')+'，单元：'+isnull(a.单元,'')+'；<br>行政区域：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.所在区域名称,'')+'，建筑面积：'+cast(isnull(a.面积,0.0) as varchar(20))+'平方米，建成时间：'+case when a.建成时间 is null then '' else convert(varchar(10),a.建成时间,120) end+'，楼龄：'+cast(isnull(a.楼龄,0) as varchar(10))+'年；<br>空间类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.空间类型,'')+'，房屋性质：'+isnull(a.房屋性质,'')+'；<br>楼高共'" + vbCr
                        strSQL = strSQL + "            +CAST(isnull(a.楼高,0) as varchar(10))+'层，本层有'+cast(isnull(a.电梯数量,0) as varchar(10))+'条梯，本层有'+CAST(isnull(a.楼层户数,0) as varchar(10))+'户，属楼盘第'+CAST(isnull(a.楼盘期数,1) as varchar(10))+'期；<br>朝向：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.座向,'')+'；<br>物业属性：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.物业性质名称,'')+'；<br>装修档次：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.装修档次,'')+'，装修年限：'+isnull(a.装修年限,'')+'；<br>噪音影响：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.噪音影响,'')+'，家具设备：'+isnull(a.家具设备,'')+'；<br>楼宇交通：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.楼宇交通,'')+'，间隔：'+isnull(a.房屋间隔,'')+'；<br>景观类型：'" + vbCr
                        strSQL = strSQL + "            +isnull(a.景观类型,'')+'；<br>拥有上述景观的房间：'+CAST(isnull(a.景观房数,0) as varchar(10))+'个，所在楼层：第'+CAST(isnull(a.楼层,0) as varchar(10))+'层，卧室数量：'+CAST(isnull(a.卧室数量,0) as varchar(10))+'个，阳台数量：'+CAST(isnull(a.阳台数量,0) as varchar(10))+'个'" + vbCr
                        strSQL = strSQL + "   from" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select a.*," + vbCr
                        strSQL = strSQL + "       间隔名称     = dbo.uf_estate_gg_getWyjgmc(a.间隔)," + vbCr
                        strSQL = strSQL + "       物业性质名称 = dbo.uf_estate_gg_getWyxzmc(a.物业性质)," + vbCr
                        strSQL = strSQL + "       所在区域名称 = dbo.uf_estate_gg_getQyhfmc(a.所在区域) " + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_物业其他 a " + vbCr
                        strSQL = strSQL + "     where a.确认书号 = @qrsh" + vbCr
                        strSQL = strSQL + "  ) a" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.房屋地址" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_QT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_WUYE_QT = True
            Exit Function
errProc:
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书其他”中的新的“确认书号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getNewQRSH_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strQRSH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewQRSH_QT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewQRSH_QT]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书其他", 13, "QD" + Now.Year.ToString + "-", True, strQRSH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "确认书号", "地产_B_二手_确认书其他", 8, "QD" + Right(Now.Year.ToString, 2), True, strQRSH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewQRSH_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业其他”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_QT = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_QT]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_WUYE_QT]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业其他"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业其他", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYBS
                            '自动列
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_QRSH
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_MJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JYJE, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_HYMJ
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_HYMJ
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0.0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_物业其他”的数据类型的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objNewData           ：新数据
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_WUYE_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_WUYE_QT = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_WUYE_QT]未传入新的数据！"
                    GoTo errProc
                End If

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_物业其他"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_物业其他", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQYMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXX
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_MJ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_HYMJ, _
                             Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JYJE
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数值！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JCSJ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strValue + "]是无效的日期！"
                                    GoTo errProc
                                End If
                            End If
                            'zengxianglin 2010-12-25

                            'zengxianglin 2010-12-25
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LL
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-25

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS
                            'zengxianglin 2010-12-25
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strValue + "]是无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LP, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FYBH
                            'zengxianglin 2010-12-25
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LP, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LD, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FYBH
                            'zengxianglin 2010-12-25
                            If strValue = "" Then
                                strErrMsg = "错误：没有输入[" + strField + "]！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_WUYE_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_确认书其他”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objListDictionary As System.Collections.Specialized.ListDictionary = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_QRS_QT = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_QRS_QT]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_QRS_QT]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_确认书其他"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_确认书其他", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZTMC
                            '显示列

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_QRSH
                            If strValue = "" Then
                                'zengxianglin 2008-11-27
                                If Me.getNewQRSH_QT(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                                'zengxianglin 2008-11-27
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DJRDM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DJRMC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_KYBH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCDZ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJJG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJYH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YZQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YZLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SHYX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SYWY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFLXDH, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_MJQC, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_KHLY, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFZZHM, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFZZHM
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_KYBH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCDZ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJJG, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJYH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YZQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YZLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SHYX, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SYWY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFLXDH, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_MJQC, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_KHLY, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFZZHM, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFZZHM
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DJRQ
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isDatetimeString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJYRQ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJLRQ
                            If strValue <> "" Then
                                If objPulicParameters.isDatetimeString(strValue) = False Then
                                    strErrMsg = "错误：[" + strField + "]没有输入无效的日期！"
                                    GoTo errProc
                                End If
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZT
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-27
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKFSYD
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If
                            'zengxianglin 2010-12-27

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFZJLX, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLRQYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLZKYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKFSYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SFZFYD, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKTGYD
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If

                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZJG, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZMJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DLFZK, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                            'zengxianglin 2010-12-27
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                            'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                            'zengxianglin 2010-12-27
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字[" + strValue + "]！"
                                GoTo errProc
                            End If

                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                Dim strKeyValue As String = ""

                '检查“确认书号”约束
                Dim strNewQRSH As String = ""
                strNewQRSH = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_QRSH)
                objListDictionary = New System.Collections.Specialized.ListDictionary
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = "select * from 地产_B_二手_确认书其他 where 确认书号 = @qrsh"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                    Case Else
                        strKeyValue = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_WYBS), "")
                        strSQL = "select * from 地产_B_二手_确认书其他 where 确认书号 = @qrsh and 唯一标识 <> @oldkey"
                        objListDictionary.Add("@qrsh", strNewQRSH)
                        objListDictionary.Add("@oldkey", strKeyValue)
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objListDictionary, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewQRSH + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
                objListDictionary.Clear()

                '释放资源
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objListDictionary)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书其他”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '     zengxianglin 2010-12-27 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_QRS_QT = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_QT]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_QT]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_QRS_QT]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew

                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_确认书其他 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJLRQ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLRQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLZKYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKTGYD
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZJG, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                                        'zengxianglin 2010-12-17
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                                        'zengxianglin 2010-12-17
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZTMC
                                        '显示列
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_确认书其他 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZTMC
                                        '显示列
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DJRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJYRQ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JHJLRQ
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), System.DBNull.Value)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.DateTime))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DGZT, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFZJLX, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLRQYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JLZKYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKFSYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SFZFYD, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_FKTGYD
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0, Integer))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZJG, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JYZMJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_JFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_YFDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_DLFZK, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                                        'zengxianglin 2010-12-17
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_CCF, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_SSYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_HZYJ, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJCS, _
                                        'Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_AJNX
                                        'zengxianglin 2010-12-17
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(0.0, Double))
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_物业其他”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     strQRSH              ：确认书号
        '     objDataSet_WYXX      ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '     zengxianglin 2010-12-25 更改
        '----------------------------------------------------------------
        Public Function doSaveData_ES_WUYE_QT( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal strQRSH As String, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand
            Dim strSQL As String

            '初始化
            doSaveData_ES_WUYE_QT = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_QT]未传入现有事务！"
                    GoTo errProc
                End If
                If objDataSet_WYXX Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_WUYE_QT]未传入新的数据！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除原有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_物业其他" + vbCr
                    strSQL = strSQL + " where 确认书号 = @qrsh" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim strValue As String = ""
                    Dim intCount As Integer = 0
                    Dim i As Integer = 0
                    With objDataSet_WYXX.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_WUYE_QT).DefaultView
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_物业其他 (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,物业编码,房屋地址,房产证号,房产证地址,面积,交易金额,座向,楼层,楼龄,间隔,物业性质,所在区域,备注信息," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   房源编号,楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔,景观类型," + vbCr
                            strSQL = strSQL + "   景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " ) values (" + vbCr
                            strSQL = strSQL + "   newid(), @qrsh, @wybm, @fwdz, @fczh, @fczdz, @mj, @jyje, @zx, @lc, @ll, @jg, @wyxz, @szqy, @bzxx," + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + "   @fybh,@lp,@ld,@dy,@jcsj,@kjlx,@fwxz,@zxdc,@zxnx,@zyyx,@jjsb,@lyjt,@fwjg,@jglx," + vbCr
                            strSQL = strSQL + "   @jgfs,@lg,@wssl,@ytsl,@hymj,@dtsl,@lchs,@lpqs" + vbCr
                            'zengxianglin 2010-12-15
                            strSQL = strSQL + " )" + vbCr
                            objSqlCommand.Parameters.Clear()
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@wybm", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYBM))
                            objSqlCommand.Parameters.AddWithValue("@fwdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWDZ))
                            objSqlCommand.Parameters.AddWithValue("@fczh", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FCZH))
                            objSqlCommand.Parameters.AddWithValue("@fczdz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FCZDZ))
                            objSqlCommand.Parameters.AddWithValue("@mj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_MJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@jyje", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JYJE), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@zx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZX))
                            objSqlCommand.Parameters.AddWithValue("@lc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LC), 0))
                            objSqlCommand.Parameters.AddWithValue("@ll", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LL), 0))
                            objSqlCommand.Parameters.AddWithValue("@jg", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JG))
                            objSqlCommand.Parameters.AddWithValue("@wyxz", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZ))
                            objSqlCommand.Parameters.AddWithValue("@szqy", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQY))
                            objSqlCommand.Parameters.AddWithValue("@bzxx", .Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_BZXX))
                            'zengxianglin 2010-12-15
                            objSqlCommand.Parameters.AddWithValue("@fybh", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FYBH), ""))
                            objSqlCommand.Parameters.AddWithValue("@lp", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LP), ""))
                            objSqlCommand.Parameters.AddWithValue("@ld", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LD), ""))
                            objSqlCommand.Parameters.AddWithValue("@dy", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DY), ""))
                            strValue = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JCSJ), "")
                            If strValue = "" Then
                                objSqlCommand.Parameters.AddWithValue("@jcsj", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strValue, System.DateTime))
                            End If
                            objSqlCommand.Parameters.AddWithValue("@kjlx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_KJLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwxz", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWXZ), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxdc", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZXDC), ""))
                            objSqlCommand.Parameters.AddWithValue("@zxnx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZXNX), ""))
                            objSqlCommand.Parameters.AddWithValue("@zyyx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZYYX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jjsb", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JJSB), ""))
                            objSqlCommand.Parameters.AddWithValue("@lyjt", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LYJT), ""))
                            objSqlCommand.Parameters.AddWithValue("@fwjg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWJG), ""))
                            objSqlCommand.Parameters.AddWithValue("@jglx", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGLX), ""))
                            objSqlCommand.Parameters.AddWithValue("@jgfs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lg", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG), 0))
                            objSqlCommand.Parameters.AddWithValue("@wssl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@ytsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@hymj", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_HYMJ), 0.0))
                            objSqlCommand.Parameters.AddWithValue("@dtsl", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL), 0))
                            objSqlCommand.Parameters.AddWithValue("@lchs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS), 0))
                            objSqlCommand.Parameters.AddWithValue("@lpqs", objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS), 0))
                            'zengxianglin 2010-12-15
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_WUYE_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_确认书其他”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     objNewData             ：记录新值(返回保存后的新值)
        '     objOldData             ：记录旧值
        '     objenumEditType        ：编辑类型
        '     objDataSet_WYXX        ：物业信息数据集
        '     objDataSet_YWRY        ：业务人员数据集
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function doSaveData_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType, _
            ByVal objDataSet_WYXX As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objDataSet_YWRY As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_QRS_QT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_QT]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_QRS_QT]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '检查主记录
                If Me.doVerifyData_ES_QRS_QT(strErrMsg, strUserId, strPassword, objOldData, objNewData, objenumEditType) = False Then
                    GoTo errProc
                End If

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If


                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    '保存主记录
                    If Me.doSaveData_ES_QRS_QT(strErrMsg, objSqlTransaction, objOldData, objNewData, objenumEditType) = False Then
                        GoTo rollDatabase
                    End If

                    '获取唯一标识
                    Dim strWYBS As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_WYBS)
                    Dim strQRSH As String = objNewData(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_QRSH)

                    '保存“地产_B_二手_物业其他”数据
                    If Me.doSaveData_ES_WUYE_QT(strErrMsg, objSqlTransaction, strQRSH, objDataSet_WYXX) = False Then
                        GoTo rollDatabase
                    End If

                    '保存“地产_B_二手_交易合同分配比例”数据
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_YWRY) = False Then
                        GoTo rollDatabase
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_QRS_QT = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_确认书其他”记录及相关记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objDataSet_MAIN As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doDeleteData_ES_QRS_QT = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_QRS_QT]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取主记录内容
                strSQL = "select * from 地产_B_二手_确认书其他 where 唯一标识 = '" + strWYBS + "'"
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet_MAIN) = False Then
                    GoTo errProc
                End If
                Dim strQRSH As String = ""
                With objDataSet_MAIN.Tables(0)
                    If .Rows.Count < 1 Then
                        Exit Try
                    End If
                    strQRSH = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_QUERENSHU_QT_QRSH), "")
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Try
                    '删除“地产_B_二手_物业其他”
                    strSQL = "delete from 地产_B_二手_物业其他 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书审核签名”
                    strSQL = "delete from 地产_B_二手_确认书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同”
                    strSQL = "delete from 地产_B_二手_交易合同 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同分配比例”
                    strSQL = "delete from 地产_B_二手_交易合同分配比例 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案计划”
                    strSQL = "delete from 地产_B_二手_交易合同办案计划 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同办案记录”
                    strSQL = "delete from 地产_B_二手_交易合同办案记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书”
                    strSQL = "delete from 地产_B_二手_交易合同结算书 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书明细表”
                    strSQL = "delete from 地产_B_二手_交易合同结算书明细表 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书业绩”
                    strSQL = "delete from 地产_B_二手_交易合同结算书业绩 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同结算书审核签名”
                    strSQL = "delete from 地产_B_二手_交易合同结算书审核签名 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_交易合同折扣审核”
                    strSQL = "delete from 地产_B_二手_交易合同折扣审核 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手应收应付”
                    strSQL = "delete from 地产_B_财务_二手应收应付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_财务_二手实收实付”
                    strSQL = "delete from 地产_B_财务_二手实收实付 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除“地产_B_二手_确认书变更记录”
                    strSQL = "delete from 地产_B_二手_确认书变更记录 where 确认书号 = '" + strQRSH + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    '删除主记录
                    strSQL = "delete from 地产_B_二手_确认书其他 where 唯一标识 = '" + strWYBS + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_MAIN)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' “地产_B_二手_确认书其他”挞定处理
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function doTading_ES_QRS_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim strSQL As String = ""

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            doTading_ES_QRS_QT = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doTading_ES_QRS_QT]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取“确认书号”
                Dim strQRSH As String = ""
                If Me.getQrshByWybs(strErrMsg, objSqlConnection, strWYBS, strQRSH) = False Then
                    GoTo errProc
                End If
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取“用户真名”
                Dim strUserZM As String = ""
                If objdacCustomer.getRyzmByRydm(strErrMsg, objSqlConnection, strUserId, strUserZM) = False Then
                    GoTo errProc
                End If
                If strUserZM = "" Then
                    Exit Try
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_确认书其他 set" + vbCr
                    strSQL = strSQL + "   订购状态 = 订购状态 & 13 + 2" + vbCr
                    strSQL = strSQL + " where 唯一标识 = '" + strWYBS + "'" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()

                    strSQL = ""
                    strSQL = strSQL + " insert into 地产_B_二手_确认书变更记录 (" + vbCr
                    strSQL = strSQL + "   唯一标识,确认书号,变更类型,变更人码,变更人名,变更日期" + vbCr
                    strSQL = strSQL + " ) values (" + vbCr
                    strSQL = strSQL + "   newid(),@qrsh,@bglx,@bgrdm,@bgrmc,@bgrq" + vbCr
                    strSQL = strSQL + " )" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.Parameters.AddWithValue("@bglx", Josco.JSOA.Common.Data.estateErshouData.BGLX_TADING_QRS)
                    objSqlCommand.Parameters.AddWithValue("@bgrdm", strUserId)
                    objSqlCommand.Parameters.AddWithValue("@bgrmc", strUserZM)
                    objSqlCommand.Parameters.AddWithValue("@bgrq", Now)
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doTading_ES_QRS_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_交易合同”中的新的其他业务的“合同编号”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strHTBH              ：合同编号
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getNewHTBH_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByRef strHTBH As String) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getNewHTBH_QT = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getNewHTBH_QT]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                'zengxianglin 2009-01-07
                'If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 13, "QH" + Now.Year.ToString + "-", True, strHTBH) = False Then
                '    GoTo errProc
                'End If
                If objdacCommon.getNewCode(strErrMsg, objSqlConnection, "合同编号", "地产_B_二手_交易合同", 8, "QH" + Right(Now.Year.ToString, 2), True, strHTBH) = False Then
                    GoTo errProc
                End If
                'zengxianglin 2009-01-07
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getNewHTBH_QT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算交易的客户名称
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strJYBH              ：交易编号
        '     strSFDX              ：甲/乙
        '     strKHMC              ：客户名称(返回)
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-17 创建
        '----------------------------------------------------------------
        Public Function getKHMC( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJYBH As String, _
            ByVal strSFDX As String, _
            ByRef strKHMC As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getKHMC = False
            strErrMsg = ""
            strKHMC = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getKHMC]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJYBH Is Nothing Then strJYBH = ""
                strJYBH = strJYBH.Trim
                If strJYBH = "" Then
                    Exit Try
                End If
                If strSFDX Is Nothing Then strSFDX = ""
                strSFDX = strSFDX.Trim
                Select Case strSFDX
                    Case "甲", "乙"
                    Case Else
                        Exit Try
                End Select

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select * from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 交易编号 = '" + strJYBH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If
                If objDataSet.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If
                Select Case strSFDX
                    Case "甲"
                        strKHMC = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("业主名称"), "")
                    Case "乙"
                        strKHMC = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("客户名称"), "")
                End Select
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getKHMC = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算交易的业务类型
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strJYBH              ：交易编号
        '     strYWLX              ：业务类型(返回)
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function getYWLX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJYBH As String, _
            ByRef strYWLX As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getYWLX = False
            strErrMsg = ""
            strYWLX = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getYWLX]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strJYBH Is Nothing Then strJYBH = ""
                strJYBH = strJYBH.Trim
                If strJYBH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select * from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 交易编号 = '" + strJYBH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If
                If objDataSet.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If
                strYWLX = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item("交易类型"), "")
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getYWLX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断指定人员是否为指定单位的直管？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strRYDM              ：人员代码
        '     strDWDM              ：单位代码
        '     strJCSJ              ：检测时间
        '     blnIS                ：是否(返回)
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function IsZhiguan( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByVal strDWDM As String, _
            ByVal strJCSJ As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            IsZhiguan = False
            strErrMsg = ""
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[IsZhiguan]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If
                If strDWDM Is Nothing Then strDWDM = ""
                strDWDM = strDWDM.Trim
                If strDWDM = "" Then
                    Exit Try
                End If
                If strJCSJ Is Nothing Then strJCSJ = ""
                strJCSJ = strJCSJ.Trim
                If strJCSJ = "" Then
                    Exit Try
                End If
                If objPulicParameters.isDatetimeString(strJCSJ) = False Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select * from dbo.uf_estate_rs_getValidGuanliJiagou('" + strJCSJ + "')" + vbCr
                strSQL = strSQL + " where 人员代码 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + " and   直管单位 = '" + strDWDM + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If
                If objDataSet.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If
                blnIS = True
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            IsZhiguan = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同办案计划”的数据
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     objDataSet           ：要保存的数据
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function doSaveData_ES_HETONG_BAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_BANANJIHUA
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doSaveData_ES_HETONG_BAJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doSaveData_ES_HETONG_BAJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet Is Nothing Then
                    Exit Try
                End If
                If objDataSet.Tables(strTable) Is Nothing Then
                    Exit Try
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction()

                '保存数据
                Dim intDefaultInt As Integer = 0
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除现有
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同办案计划" + vbCr
                    strSQL = strSQL + " where 确认书号=@qrsh" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.ExecuteNonQuery()

                    With objDataSet.Tables(strTable).DefaultView
                        Dim strWYBS As String = ""
                        Dim strJHKS As String = ""
                        Dim strJHJS As String = ""
                        Dim strGZNR As String = ""
                        Dim strJBRY As String = ""
                        Dim strJBDW As String = ""
                        Dim strSJKS As String = ""
                        Dim strSJJS As String = ""
                        Dim strTXBZ As String = ""
                        Dim strKBTS As String = ""
                        Dim strBWTS As String = ""
                        Dim intDefVal As Integer
                        Dim intCount As Integer
                        Dim i As Integer
                        intCount = .Count
                        For i = 0 To intCount - 1 Step 1
                            '计算数据
                            strWYBS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_WYBS), "")
                            strJHKS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHKS), "", "yyyy-MM-dd")
                            strJHJS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JHJS), "", "yyyy-MM-dd")
                            strGZNR = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_GZNR), "")
                            strJBRY = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBRY), "")
                            strJBDW = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_JBDW), "")
                            strSJKS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJKS), "", "yyyy-MM-dd")
                            strSJJS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_SJJS), "", "yyyy-MM-dd")
                            strTXBZ = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_TXBZ), "")
                            strKBTS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_KBTS), "")
                            strBWTS = objPulicParameters.getObjectValue(.Item(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_BANANJIHUA_BWTS), "")

                            '批量加入
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易合同办案计划" + vbCr
                            strSQL = strSQL + " (" + vbCr
                            strSQL = strSQL + "   唯一标识,确认书号,计划开始,计划结束," + vbCr
                            strSQL = strSQL + "   工作内容,经办人员,经办分行,实际开始," + vbCr
                            strSQL = strSQL + "   实际结束,提醒标志,开办天数,办完天数 " + vbCr
                            strSQL = strSQL + " ) values (" + vbCr
                            If strWYBS <> "" Then
                                strSQL = strSQL + "   '" + strWYBS + "'," + vbCr
                            Else
                                strSQL = strSQL + "   newid()," + vbCr
                            End If
                            strSQL = strSQL + "   @qrsh,@jhks,@jhjs," + vbCr
                            strSQL = strSQL + "   @gznr,@jbry,@jbdw,@sjks," + vbCr
                            strSQL = strSQL + "   @sjjs,@txbz,@kbts,@bwts" + vbCr
                            strSQL = strSQL + " )" + vbCr

                            objSqlCommand.Parameters.Clear()
                            '==========================================================================
                            objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                            objSqlCommand.Parameters.AddWithValue("@gznr", strGZNR)
                            objSqlCommand.Parameters.AddWithValue("@jbry", strJBRY)
                            objSqlCommand.Parameters.AddWithValue("@jbdw", strJBDW)
                            '==========================================================================
                            If strJHKS = "" Then
                                objSqlCommand.Parameters.AddWithValue("@jhks", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@jhks", CType(strJHKS, System.DateTime))
                            End If
                            '==========================================================================
                            If strJHJS = "" Then
                                objSqlCommand.Parameters.AddWithValue("@jhjs", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@jhjs", CType(strJHJS, System.DateTime))
                            End If
                            '==========================================================================
                            If strSJKS = "" Then
                                objSqlCommand.Parameters.AddWithValue("@sjks", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@sjks", CType(strSJKS, System.DateTime))
                            End If
                            '==========================================================================
                            If strSJJS = "" Then
                                objSqlCommand.Parameters.AddWithValue("@sjjs", System.DBNull.Value)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@sjjs", CType(strSJJS, System.DateTime))
                            End If
                            '==========================================================================
                            If strTXBZ = "" Then
                                intDefVal = 0
                                objSqlCommand.Parameters.AddWithValue("@txbz", intDefVal)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@txbz", CType(strTXBZ, Integer))
                            End If
                            '==========================================================================
                            If strKBTS = "" Then
                                intDefVal = 1
                                objSqlCommand.Parameters.AddWithValue("@kbts", intDefVal)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@kbts", CType(strKBTS, Integer))
                            End If
                            '==========================================================================
                            If strBWTS = "" Then
                                intDefVal = 1
                                objSqlCommand.Parameters.AddWithValue("@bwts", intDefVal)
                            Else
                                objSqlCommand.Parameters.AddWithValue("@bwts", CType(strBWTS, Integer))
                            End If
                            '==========================================================================
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                        Next
                    End With
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_HETONG_BAJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员的开办提醒的业务数目
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   ：人员代码
        '     intYWSM                   ：业务数目(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改描述
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function getCount_KBTX( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByRef intYWSM As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getCount_KBTX = False
            strErrMsg = ""
            intYWSM = 0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select a.确认书号" + vbCr
                strSQL = strSQL + "   from" + vbCr
                strSQL = strSQL + "   (" + vbCr
                strSQL = strSQL + "     select 确认书号" + vbCr
                strSQL = strSQL + "     from 地产_B_二手_交易合同办案计划" + vbCr
                strSQL = strSQL + "     where 经办人员='" + strRYDM + "'" + vbCr
                strSQL = strSQL + "     and   提醒标志=1" + vbCr
                strSQL = strSQL + "     and   实际开始 is null" + vbCr
                strSQL = strSQL + "     and   dateadd(dd,-开办天数,计划开始)<=getdate()" + vbCr
                strSQL = strSQL + "     group by 确认书号" + vbCr
                strSQL = strSQL + "   ) a" + vbCr
                strSQL = strSQL + "   left join 地产_V_全部交易 b on a.确认书号=b.交易编号" + vbCr
                strSQL = strSQL + "   where b.交易编号 is not null" + vbCr
                strSQL = strSQL + "   and   b.合同状态 & 2 <> 2" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    intYWSM = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getCount_KBTX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算指定人员的办完提醒的业务数目
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strRYDM                   ：人员代码
        '     intYWSM                   ：业务数目(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改描述
        '     zengxianglin 2008-11-18 创建
        '----------------------------------------------------------------
        Public Function getCount_BWTX( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strRYDM As String, _
            ByRef intYWSM As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getCount_BWTX = False
            strErrMsg = ""
            intYWSM = 0

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strRYDM Is Nothing Then strRYDM = ""
                strRYDM = strRYDM.Trim
                If strRYDM = "" Then
                    Exit Try
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select a.确认书号" + vbCr
                strSQL = strSQL + "   from" + vbCr
                strSQL = strSQL + "   (" + vbCr
                strSQL = strSQL + "     select 确认书号" + vbCr
                strSQL = strSQL + "     from 地产_B_二手_交易合同办案计划" + vbCr
                strSQL = strSQL + "     where 经办人员 = '" + strRYDM + "'" + vbCr
                strSQL = strSQL + "     and   提醒标志=1" + vbCr
                strSQL = strSQL + "     and   实际结束 is null" + vbCr
                strSQL = strSQL + "     and   dateadd(dd,-办完天数,计划结束)<=getdate()" + vbCr
                strSQL = strSQL + "     group by 确认书号" + vbCr
                strSQL = strSQL + "   ) a" + vbCr
                strSQL = strSQL + "   left join 地产_V_全部交易 b on a.确认书号=b.交易编号" + vbCr
                strSQL = strSQL + "   where b.交易编号 is not null" + vbCr
                strSQL = strSQL + "   and   b.合同状态 & 2 <> 2" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    intYWSM = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item(0), 0)
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getCount_BWTX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的合同是否有人审核？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '----------------------------------------------------------------
        Public Function isHetongDoneShenhe( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isHetongDoneShenhe = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isHetongDoneShenhe]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同审核签名" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   状态标志 & 6 = 6" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已审
                            blnIS = True
                        End If
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isHetongDoneShenhe = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的合同是否有做办案计划？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '----------------------------------------------------------------
        Public Function isHetongDoneBAJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isHetongDoneBAJH = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isHetongDoneBAJH]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同办案计划" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已做
                            blnIS = True
                        End If
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isHetongDoneBAJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的合同是否有做业绩分配方案？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     blnIS_SY             ：返回是否做私俑
        '     blnIS_GY             ：返回是否做公俑
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '----------------------------------------------------------------
        Public Function isHetongDoneFPBL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef blnIS_SY As Boolean, _
            ByRef blnIS_GY As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isHetongDoneFPBL = False
            blnIS_SY = False
            blnIS_GY = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isHetongDoneFPBL]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同分配比例" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   状态标志 & 1 = 1" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已做私佣
                            blnIS_SY = True
                        End If
                    End If
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同分配比例" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                strSQL = strSQL + " and   状态标志 & 1 = 0" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已做公佣
                            blnIS_GY = True
                        End If
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isHetongDoneFPBL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定的结算书是否有做业绩分配？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strJSSH              ：结算书号
        '     blnIS                ：返回是否
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-22 创建
        '----------------------------------------------------------------
        Public Function isJssDoneYJFP( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSSH As String, _
            ByRef blnIS As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isJssDoneYJFP = False
            blnIS = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isJssDoneYJFP]未指定要获取信息的用户！"
                    GoTo errProc
                End If
                If strJSSH Is Nothing Then strJSSH = ""
                strJSSH = strJSSH.Trim
                If strJSSH = "" Then
                    Exit Try
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同结算书业绩" + vbCr
                strSQL = strSQL + " where 结算书号 = '" + strJSSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            '已做
                            blnIS = True
                        End If
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isJssDoneYJFP = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 计算中介部二手代理结算情况表（各分行）的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-24 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLJSQKB_GFH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLJSQKB_GFH = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GFH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GFH]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GFH]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLJSQKB_GFH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESDLJSQKB_GFH @ksrq,@zzrq"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLJSQKB_GFH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLJSQKB_GFH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 更改“地产_B_二手_交易合同”指定记录的[按揭返还]字段
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：确认书号
        '     dblAJFH              ：按揭返还额
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-25 创建
        '----------------------------------------------------------------
        Public Function doUpdateData_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal dblAJFH As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doUpdateData_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doUpdateData_ES_HETONG]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = "update 地产_B_二手_交易合同 set 按揭返还=@ajfh where 确认书号 = @qrsh"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@qrsh", strQRSH)
                    objSqlCommand.Parameters.AddWithValue("@ajfh", dblAJFH)
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doUpdateData_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手代理结算情况表（各业务）的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-26 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLJSQKB_GYW( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLJSQKB_GYW = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GYW]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GYW]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GYW]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLJSQKB_GYW)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESDLJSQKB_GYW @ksrq,@zzrq"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLJSQKB_GYW))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLJSQKB_GYW = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手代理接案情况表（各分行）的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-26 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLJAQKB_GFH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLJAQKB_GFH = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJAQKB_GFH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJAQKB_GFH]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJAQKB_GFH]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLJAQKB_GFH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESDLJAQKB_GFH @ksrq,@zzrq"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLJAQKB_GFH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLJAQKB_GFH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手代理结案情况表（各分行）的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-26 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLWCQKB_GFH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLWCQKB_GFH = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLWCQKB_GFH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLWCQKB_GFH]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLWCQKB_GFH]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLWCQKB_GFH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESDLWCQKB_GFH @ksrq,@zzrq"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLWCQKB_GFH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLWCQKB_GFH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 获取[地产_B_二手_交易年度计划]数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索条件
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYNDJH = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYNDJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_JYNDJH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_B_二手_交易年度计划 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.计划年度,a.计划类型" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYNDJH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_ES_JYNDJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取[地产_B_二手_交易年度计划]数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     intJHND                    ：计划年度
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intJHND As Integer, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYNDJH = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYNDJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_JYNDJH)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_B_二手_交易年度计划 a" + vbCr
                        strSQL = strSQL + " where a.计划年度 = " + intJHND.ToString + vbCr
                        strSQL = strSQL + " order by a.计划年度,a.计划类型" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYNDJH))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYNDJH
                If objTempDataSet.Tables(strTable).Rows.Count < 1 Then
                    '创建默认数据集
                    Dim objDataRow As System.Data.DataRow = Nothing
                    Dim intCount As Integer = 3
                    Dim i As Integer
                    With objTempDataSet.Tables(strTable)
                        For i = 0 To intCount - 1 Step 1
                            objDataRow = .NewRow()
                            objDataRow.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND) = intJHND
                            Select Case i
                                Case 0
                                    objDataRow.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX) = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                                Case 1
                                    objDataRow.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX) = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                                Case 2
                                    objDataRow.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX) = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                            End Select
                            .Rows.Add(objDataRow)
                        Next
                    End With
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_ES_JYNDJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 检查“地产_B_二手_交易年度计划”的数据的合法性
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function doVerifyData_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objOldData As System.Data.DataRow, _
            ByRef objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim intLen As Integer = 0
            Dim strSQL As String = ""

            doVerifyData_ES_JYNDJH = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doVerifyData_ES_JYNDJH]未指定[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doVerifyData_ES_JYNDJH]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doVerifyData_ES_JYNDJH]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取表结构定义
                strSQL = "select top 0 * from 地产_B_二手_交易年度计划"
                If objdacCommon.getDataSetWithSchemaBySQL(strErrMsg, strUserId, strPassword, strSQL, "地产_B_二手_交易年度计划", objDataSet) = False Then
                    GoTo errProc
                End If

                '检查数据长度
                Dim intCount As Integer = 0
                Dim strValue As String = ""
                Dim strField As String = ""
                Dim i As Integer = 0
                intCount = objNewData.Count
                For i = 0 To intCount - 1 Step 1
                    strField = objNewData.GetKey(i).Trim
                    strValue = objNewData.Item(i).Trim
                    Select Case strField
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS
                            '自动赋值
                            If strValue = "" Then
                                If objdacCommon.getNewGUID(strErrMsg, strUserId, strPassword, strValue) = False Then
                                    GoTo errProc
                                End If
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            With objDataSet.Tables(0).Columns(strField)
                                intLen = objPulicParameters.getStringLength(strValue)
                                If intLen > .MaxLength Then
                                    strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                    GoTo errProc
                                End If
                            End With
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND
                            If strValue = "" Then
                                strErrMsg = "错误：[" + strField + "]没有输入内容！"
                                GoTo errProc
                            End If
                            If objPulicParameters.isIntegerString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If
                        Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHDLF, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHHTE, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHZS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHTS, _
                            Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHMJ
                            If strValue = "" Then strValue = "0"
                            If objPulicParameters.isFloatString(strValue) = False Then
                                strErrMsg = "错误：[" + strField + "]没有输入无效的数字！"
                                GoTo errProc
                            End If
                        Case Else
                            If strValue <> "" Then
                                With objDataSet.Tables(0).Columns(strField)
                                    intLen = objPulicParameters.getStringLength(strValue)
                                    If intLen > .MaxLength Then
                                        strErrMsg = "错误：[" + strField + "]长度不能超过[" + .MaxLength.ToString() + "]，实际有[" + intLen.ToString() + "]！"
                                        GoTo errProc
                                    End If
                                End With
                            End If
                    End Select
                    objNewData(strField) = strValue
                Next
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)

                '检查[计划年度]+[计划类型]约束
                Dim strNewVals(3) As String
                Dim strOldVals(3) As String
                strNewVals(0) = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS)
                strNewVals(1) = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND)
                strNewVals(2) = objNewData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX)
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                        strSQL = ""
                        strSQL = strSQL + " select * from 地产_B_二手_交易年度计划" + vbCr
                        strSQL = strSQL + " where 计划年度 =  " + strNewVals(1) + " " + vbCr
                        strSQL = strSQL + " and   计划类型 = '" + strNewVals(2) + "'" + vbCr
                    Case Else
                        strOldVals(0) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS), "")
                        strOldVals(1) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND), "")
                        strOldVals(2) = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHLX), "")
                        strSQL = ""
                        strSQL = strSQL + " select * from 地产_B_二手_交易年度计划" + vbCr
                        strSQL = strSQL + " where 计划年度 =   " + strNewVals(1) + " " + vbCr
                        strSQL = strSQL + " and   计划类型 =  '" + strNewVals(2) + "'" + vbCr
                        strSQL = strSQL + " and   唯一标识 <> '" + strNewVals(0) + "'" + vbCr
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strErrMsg = "错误：[" + strNewVals(1) + "]+[" + strNewVals(2) + "]已经存在！"
                    GoTo errProc
                End If
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doVerifyData_ES_JYNDJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易年度计划”的数据(现有事务)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     objSqlTransaction    ：现有事务
        '     objOldData           ：旧数据
        '     objNewData           ：新数据
        '     objenumEditType      ：编辑类型
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function doSaveData_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal objSqlTransaction As System.Data.SqlClient.SqlTransaction, _
            ByVal objOldData As System.Data.DataRow, _
            ByVal objNewData As System.Collections.Specialized.NameValueCollection, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            '初始化
            doSaveData_ES_JYNDJH = False
            strErrMsg = ""

            Try
                '检查
                If objSqlTransaction Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_JYNDJH]未传入现有事务！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_JYNDJH]未传入新的数据！"
                    GoTo errProc
                End If
                Select Case objenumEditType
                    Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                        Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                    Case Else
                        If objOldData Is Nothing Then
                            strErrMsg = "错误：[doSaveData_ES_JYNDJH]未传入旧的数据！"
                            GoTo errProc
                        End If
                End Select

                '获取连接
                objSqlConnection = objSqlTransaction.Connection

                '保存数据
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strFileds As String = ""
                    Dim strValues As String = ""
                    Dim strField As String
                    Dim intCount As Integer
                    Dim i As Integer = 0
                    Select Case objenumEditType
                        Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i)
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i)
                                        End If
                                        If strValues = "" Then
                                            strValues = "@A" + i.ToString()
                                        Else
                                            strValues = strValues + "," + "@A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " insert into 地产_B_二手_交易年度计划 (" + strFileds + ")"
                            strSQL = strSQL + " values (" + strValues + ")"
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHHTE, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHZS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHTS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHMJ
                                        Dim dblDefVal As Double = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), dblDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()

                        Case Else
                            '获取原“唯一标识”
                            Dim strOldWYBS As String
                            strOldWYBS = objPulicParameters.getObjectValue(objOldData.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS), "")
                            '计算更新字段列表
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Else
                                        If strFileds = "" Then
                                            strFileds = objNewData.GetKey(i) + " = @A" + i.ToString()
                                        Else
                                            strFileds = strFileds + "," + objNewData.GetKey(i) + " = @A" + i.ToString()
                                        End If
                                End Select
                            Next
                            '准备SQL
                            strSQL = ""
                            strSQL = strSQL + " update 地产_B_二手_交易年度计划 set " + vbCr
                            strSQL = strSQL + "   " + strFileds + vbCr
                            strSQL = strSQL + " where 唯一标识 = @oldwybs" + vbCr
                            '准备参数
                            objSqlCommand.Parameters.Clear()
                            intCount = objNewData.Count
                            For i = 0 To intCount - 1 Step 1
                                Select Case objNewData.GetKey(i)
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHDLF, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHHTE, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHZS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHTS, _
                                        Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHMJ
                                        Dim dblDefVal As Double = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), dblDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Double))
                                        End If
                                    Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND
                                        Dim intDefVal As Integer = 0
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), intDefVal)
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), CType(objNewData.Item(i), System.Int32))
                                        End If
                                    Case Else
                                        If objNewData.Item(i) = "" Then
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), " ")
                                        Else
                                            objSqlCommand.Parameters.AddWithValue("@A" + i.ToString(), objNewData.Item(i))
                                        End If
                                End Select
                            Next
                            objSqlCommand.Parameters.AddWithValue("@oldwybs", strOldWYBS)
                            '执行SQL
                            objSqlCommand.CommandText = strSQL
                            objSqlCommand.ExecuteNonQuery()
                    End Select
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doSaveData_ES_JYNDJH = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易年度计划”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     intJHND                ：计划年度
        '     objDataSet             ：计划新值
        '     objenumEditType        ：编辑模式
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function doSaveData_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intJHND As Integer, _
            ByVal objNewData As Josco.JSOA.Common.Data.estateErshouData, _
            ByVal objenumEditType As Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYNDJH
            Dim objNewVals As New System.Collections.Specialized.NameValueCollection
            Dim objOldVals As System.Data.DataRow = Nothing
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objOldData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_JYNDJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_JYNDJH]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objNewData Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_JYNDJH]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If intJHND <= 0 Then
                    strErrMsg = "错误：[doSaveData_ES_JYNDJH]指定无效的[计划年度]！"
                    GoTo errProc
                End If

                '计算原数据
                If Me.getDataSet_ES_JYNDJH(strErrMsg, strUserId, strPassword, intJHND, objOldData) = False Then
                    GoTo errProc
                End If

                '执行检查
                Dim strValue As String = ""
                Dim strWYBS As String = ""
                Dim intRows As Integer
                Dim intCols As Integer
                Dim i As Integer
                Dim j As Integer
                With objNewData.Tables(strTable)
                    intCols = .Columns.Count
                    intRows = .Rows.Count
                    For i = 0 To intRows - 1 Step 1
                        strWYBS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS), "")
                        '准备新数据
                        objNewVals.Clear()
                        For j = 0 To intCols - 1 Step 1
                            strValue = objPulicParameters.getObjectValue(.Rows(i).Item(j), "")
                            objNewVals.Add(.Columns(j).ColumnName, strValue)
                        Next
                        '准备原数据
                        Select Case objenumEditType
                            Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                                Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                                objOldVals = Nothing
                            Case Else
                                With objOldData.Tables(strTable)
                                    .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS + " = '" + strWYBS + "'"
                                    objOldVals = .DefaultView.Item(0).Row
                                End With
                        End Select
                        '检查
                        If Me.doVerifyData_ES_JYNDJH(strErrMsg, strUserId, strPassword, objOldVals, objNewVals, objenumEditType) = False Then
                            GoTo errProc
                        End If
                        '回写数据
                        For j = 0 To intCols - 1 Step 1
                            Select Case .Columns(j).ColumnName
                                Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHND
                                    .Rows(i).Item(j) = CType(objNewVals(.Columns(j).ColumnName), Integer)
                                Case Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHDLF, _
                                    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHHTE, _
                                    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHZS, _
                                    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHTS, _
                                    Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_JHMJ
                                    .Rows(i).Item(j) = CType(objNewVals(.Columns(j).ColumnName), Double)
                                Case Else
                                    .Rows(i).Item(j) = objNewVals(.Columns(j).ColumnName)
                            End Select
                        Next
                    Next
                End With

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    With objNewData.Tables(strTable)
                        intCols = .Columns.Count
                        intRows = .Rows.Count
                        For i = 0 To intRows - 1 Step 1
                            strWYBS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS), "")
                            '准备新数据
                            objNewVals.Clear()
                            For j = 0 To intCols - 1 Step 1
                                strValue = objPulicParameters.getObjectValue(.Rows(i).Item(j), "")
                                objNewVals.Add(.Columns(j).ColumnName, strValue)
                            Next
                            '准备原数据
                            Select Case objenumEditType
                                Case Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eAddNew, _
                                    Josco.JsKernal.Common.Utilities.PulicParameters.enumEditType.eCpyNew
                                    objOldVals = Nothing
                                Case Else
                                    With objOldData.Tables(strTable)
                                        .DefaultView.RowFilter = Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYNDJH_WYBS + " = '" + strWYBS + "'"
                                        objOldVals = .DefaultView.Item(0).Row
                                    End With
                            End Select
                            '保存
                            If Me.doSaveData_ES_JYNDJH(strErrMsg, objSqlTransaction, objOldVals, objNewVals, objenumEditType) = False Then
                                GoTo rollDatabase
                            End If
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objNewVals)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objOldData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_JYNDJH = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objNewVals)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objOldData)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易年度计划”记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strWYBS              ：要删除的唯一标识
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWYBS As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doDeleteData_ES_JYNDJH = False
            strErrMsg = ""

            Try
                '检查
                If strWYBS Is Nothing Then strWYBS = ""
                strWYBS = strWYBS.Trim
                If strWYBS = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_JYNDJH]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = "delete from 地产_B_二手_交易年度计划 where 唯一标识 = '" + strWYBS + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_JYNDJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 删除“地产_B_二手_交易年度计划”记录
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     intJHND              ：要删除的计划年度
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function doDeleteData_ES_JYNDJH( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intJHND As Integer) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doDeleteData_ES_JYNDJH = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doDeleteData_ES_JYNDJH]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = "delete from 地产_B_二手_交易年度计划 where 计划年度 = " + intJHND.ToString
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doDeleteData_ES_JYNDJH = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断指定年度的[地产_B_二手_交易年度计划]是否存在？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     intJHND              ：计划年度
        '     blnHas               ：是否存在(返回)
        ' 返回
        '     True                 ：合法
        '     False                ：不合法或其他程序错误
        ' 更改记录
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function isJyndjhExisted( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intJHND As Integer, _
            ByRef blnHas As Boolean) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isJyndjhExisted = False
            strErrMsg = ""
            blnHas = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isJyndjhExisted]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select * from 地产_B_二手_交易年度计划" + vbCr
                strSQL = strSQL + " where 计划年度 = " + intJHND.ToString + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If
                If objDataSet.Tables.Count < 1 Then
                    Exit Try
                End If
                If objDataSet.Tables(0).Rows.Count < 1 Then
                    Exit Try
                End If
                blnHas = True
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isJyndjhExisted = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手代理结算情况表（各月度）的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     intND                      ：年度
        '     intYD                      ：月度
        '     intYJZR                    ：月截止日
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLJSQKB_GYD( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intND As Integer, _
            ByVal intYD As Integer, _
            ByVal intYJZR As Integer, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLJSQKB_GYD = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLJSQKB_GYD]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLJSQKB_GYD)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESDLJSQKB_GYD @nd,@yd,@yjzr"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@nd", intND)
                        objSqlCommand.Parameters.AddWithValue("@yd", intYD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLJSQKB_GYD))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLJSQKB_GYD = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(接案)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_JA( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_JA = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_JA)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_JA @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_JA))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_JA = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(接案)的数据(未审合同)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2009-02-24 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_JA_WS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_JA_WS = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_WS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_WS]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_WS]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_WS]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_WS]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_JA_WS)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_JA_WS @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_JA_WS))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_JA_WS = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(结案)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_WC( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_WC = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_WC]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_WC]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_WC]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_WC]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_WC]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_WC)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_WC @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_WC))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_WC = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(已接未结案)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-11-28 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_YJWJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_YJWJ = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJ]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJ]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJ]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJ]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_YJWJ)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_YJWJ @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_YJWJ))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_YJWJ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(私佣)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_SY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_SY = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_SY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESJYQD_SY @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_SY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_SY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(公佣)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_GY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_GY = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_GY)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESJYQD_GY @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_GY))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_GY = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function












        '----------------------------------------------------------------
        ' 计算中介部二手计佣清单(公佣补发)的数据
        ' 重新计算指定月底时应补发的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     intND                      ：年度
        '     intYD                      ：月度
        '     intYJZR                    ：月截止日
        '     blnNew                     ：接口重载
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_GYBF( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intND As Integer, _
            ByVal intYD As Integer, _
            ByVal intYJZR As Integer, _
            ByVal blnNew As Boolean, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_GYBF = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GYBF]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_JYHTJSSYJBF)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESJYQD_GYBF @nd,@yd,@yjzr"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@nd", intND)
                        objSqlCommand.Parameters.AddWithValue("@yd", intYD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYHTJSSYJBF))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_GYBF = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手计佣清单(公佣补发)的数据
        ' 获取现有数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     intND                      ：年度
        '     intYD                      ：月度
        '     intYJZR                    ：月截止日
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_GYBF( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intND As Integer, _
            ByVal intYD As Integer, _
            ByVal intYJZR As Integer, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_GYBF = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GYBF]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_JYHTJSSYJBF)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*,实际补发=a.补发金额,b.人员名称" + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_交易合同结算书业绩补发 a" + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员 b on a.人员代码=b.人员代码" + vbCr
                        strSQL = strSQL + "   where 补发月度 = @nd*100+@yd" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        strSQL = strSQL + " order by a.人员名称"
                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@nd", intND)
                        objSqlCommand.Parameters.AddWithValue("@yd", intYD)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYHTJSSYJBF))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_GYBF = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 判断给定年度、月度的公佣补发[地产_B_二手_交易合同结算书业绩补发]数据是否存在？
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     intND                ：年度
        '     intYD                ：月度
        '     intMode              ：0-等于,1-大于
        '     blnHas               ：返回是否存在
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function isGYBFExisted( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intND As Integer, _
            ByVal intYD As Integer, _
            ByVal intMode As Integer, _
            ByRef blnHas As Boolean) As Boolean

            Dim objSqlConnection As System.Data.SqlClient.SqlConnection
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            isGYBFExisted = False
            blnHas = False

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[isGYBFExisted]未指定要获取信息的用户！"
                    GoTo errProc
                End If

                '获取数据库连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算
                Select Case intMode
                    Case 0
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同结算书业绩补发" + vbCr
                        strSQL = strSQL + " where 补发月度 = " + intND.ToString + "*100+" + intYD.ToString + vbCr
                    Case 1
                        strSQL = ""
                        strSQL = strSQL + " select count(*) from 地产_B_二手_交易合同结算书业绩补发" + vbCr
                        strSQL = strSQL + " where 补发月度 > " + intND.ToString + "*100+" + intYD.ToString + vbCr
                    Case Else
                        strErrMsg = "错误：[isGYBFExisted]无效的接口参数！"
                        GoTo errProc
                End Select
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                If objDataSet.Tables.Count > 0 Then
                    If objDataSet.Tables(0).Rows.Count > 0 Then
                        Dim intCount As Integer = 0
                        intCount = CType(objDataSet.Tables(0).Rows(0).Item(0), Integer)
                        If intCount > 0 Then
                            blnHas = True
                        End If
                    End If
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            isGYBFExisted = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_交易合同结算书业绩补发”数据记录(整个事务完成)
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     intND                  ：年度
        '     intYD                  ：月度
        '     objDataSet_YJBF        ：要保存的数据
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        '----------------------------------------------------------------
        Public Function doSaveData_ES_JYHTJSSYJBF( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intND As Integer, _
            ByVal intYD As Integer, _
            ByVal objDataSet_YJBF As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim strTable As String = Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_JYHTJSSYJBF
            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String

            doSaveData_ES_JYHTJSSYJBF = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_JYHTJSSYJBF]未传入[连接用户]！"
                    GoTo errProc
                End If
                If objDataSet_YJBF Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_JYHTJSSYJBF]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If objDataSet_YJBF.Tables(strTable) Is Nothing Then
                    strErrMsg = "错误：[doSaveData_ES_JYHTJSSYJBF]没有指定要保存的数据！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '执行事务
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '删除现有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_交易合同结算书业绩补发" + vbCr
                    strSQL = strSQL + " where 补发月度 = @nd*100+@yd" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@nd", intND)
                    objSqlCommand.Parameters.AddWithValue("@yd", intYD)
                    objSqlCommand.ExecuteNonQuery()

                    '保存数据
                    Dim strWYBS As String = ""
                    Dim strRYDM As String = ""
                    Dim intBFYD As Integer
                    Dim dblBFJE As Double
                    Dim intCount As Integer
                    Dim i As Integer
                    With objDataSet_YJBF.Tables(strTable)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            strWYBS = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYHTJSSYJBF_WYBS), "")
                            strRYDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYHTJSSYJBF_RYDM), "")
                            intBFYD = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYHTJSSYJBF_BFYD), 0)
                            dblBFJE = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_JYHTJSSYJBF_SJBF), 0.0)
                            If dblBFJE <> 0 Then
                                strSQL = ""
                                strSQL = strSQL + " insert into 地产_B_二手_交易合同结算书业绩补发" + vbCr
                                strSQL = strSQL + " (" + vbCr
                                strSQL = strSQL + "   唯一标识,人员代码,补发月度,补发金额" + vbCr
                                strSQL = strSQL + " ) values (" + vbCr
                                strSQL = strSQL + "   @wybs,@rydm,@bfyd,@bfje" + vbCr
                                strSQL = strSQL + " )" + vbCr
                                objSqlCommand.CommandText = strSQL
                                objSqlCommand.Parameters.Clear()
                                objSqlCommand.Parameters.AddWithValue("@wybs", strWYBS)
                                objSqlCommand.Parameters.AddWithValue("@rydm", strRYDM)
                                objSqlCommand.Parameters.AddWithValue("@bfyd", intBFYD)
                                objSqlCommand.Parameters.AddWithValue("@bfje", dblBFJE)
                                objSqlCommand.ExecuteNonQuery()
                            End If
                        Next
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_JYHTJSSYJBF = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function










        '----------------------------------------------------------------
        ' 计算中介部二手代理区域情况表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intType                    ：统计类型：0-接案，1-结案，2-已接未结案
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESDLQYQKB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intType As Integer, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESDLQYQKB = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLQYQKB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLQYQKB]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESDLQYQKB]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Select Case intType
                    Case 0, 1, 2
                    Case Else
                        strErrMsg = "错误：[getDataSet_BB_ESDLQYQKB]无效的类型[" + intType.ToString + "]！"
                        GoTo errProc
                End Select
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESDLQYQKB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        Select Case intType
                            Case 0
                                strSQL = "exec dbo.up_estate_es_getESDLQYQKB_JA   @ksrq,@zzrq"
                            Case 1
                                strSQL = "exec dbo.up_estate_es_getESDLQYQKB_WC   @ksrq,@zzrq"
                            Case 2
                                strSQL = "exec dbo.up_estate_es_getESDLQYQKB_YJWJ @ksrq,@zzrq"
                        End Select

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESDLQYQKB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESDLQYQKB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手区域业绩排行榜的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intType                    ：统计类型：0-接案，1-结案，2-已接未结案
        '     objDataSet                 ：信息数据集
        '                                  0-排序:面积
        '                                  1-排序:套数
        '                                  2-排序:宗数
        '                                  3-排序:代理费
        '                                  4-排序:按揭返还
        '                                  5-排序:交易金额
        '                                  6-排序:实结代理费
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '     zengxianglin 2009-05-21 更改
        '     zengxianglin 2009-06-15 更改
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESPHBQYYJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intType As Integer, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESPHBQYYJ = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBQYYJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBQYYJ]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBQYYJ]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Select Case intType
                    Case 0, 1, 2, 3
                        'zengxianglin 2009-06-15
                        'Case 0, 1, 2
                        'zengxianglin 2009-06-15
                    Case Else
                        strErrMsg = "错误：[getDataSet_BB_ESPHBQYYJ]无效的类型[" + intType.ToString + "]！"
                        GoTo errProc
                End Select
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New System.Data.DataSet
                    '创建数据表
                    Dim objDataTable As System.Data.DataTable = Nothing
                    'zengxianglin 2009-05-21
                    'Dim intCount As Integer = 6
                    Dim intCount As Integer = 7
                    'zengxianglin 2009-05-21
                    Dim i As Integer
                    For i = 0 To intCount - 1 Step 1
                        objDataTable = New System.Data.DataTable
                        With objDataTable.Columns
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_SZQY, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_QYMC, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_MJ, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_TS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_ZS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_DLF, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_JYJE, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_AJFH, GetType(System.Double))
                            'zengxianglin 2009-05-21
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBQYYJ_SJDLF, GetType(System.Double))
                            'zengxianglin 2009-05-21
                        End With
                        objTempDataSet.Tables.Add(objDataTable)
                    Next

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        Dim strTempTable As String = "T_" + objPulicParameters.getNewGuid()
                        strTempTable = strTempTable.Replace("-", "_")

                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select * into " + strTempTable + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getPHB_PQ(@ksrq,@zzrq,@type)" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@type", intType)
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 面积 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 套数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 宗数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 按揭返还 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 交易金额 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        'zengxianglin 2009-05-21
                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 实结代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(6))
                        'zengxianglin 2009-05-21

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strTempTable + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 7 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESPHBQYYJ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手部门业绩排行榜的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intType                    ：统计类型：0-接案，1-结案，2-已接未结案
        '     objDataSet                 ：信息数据集
        '                                  0-排序:面积
        '                                  1-排序:套数
        '                                  2-排序:宗数
        '                                  3-排序:代理费
        '                                  4-排序:按揭返还
        '                                  5-排序:交易金额
        '                                  6-排序:实结代理费
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '     zengxianglin 2009-05-21 更改
        '     zengxianglin 2009-06-15 更改
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESPHBBMYJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intType As Integer, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESPHBBMYJ = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBBMYJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBBMYJ]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBBMYJ]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Select Case intType
                    Case 0, 1, 2, 3
                        'zengxianglin 2009-06-15
                        'Case 0, 1, 2
                        'zengxianglin 2009-06-15
                    Case Else
                        strErrMsg = "错误：[getDataSet_BB_ESPHBBMYJ]无效的类型[" + intType.ToString + "]！"
                        GoTo errProc
                End Select
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New System.Data.DataSet
                    '创建数据表
                    Dim objDataTable As System.Data.DataTable = Nothing
                    'zengxianglin 2009-05-21
                    'Dim intCount As Integer = 6
                    Dim intCount As Integer = 7
                    'zengxianglin 2009-05-21
                    Dim i As Integer
                    For i = 0 To intCount - 1 Step 1
                        objDataTable = New System.Data.DataTable
                        With objDataTable.Columns
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_DWDM, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_DWMC, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_MJ, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_TS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_ZS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_DLF, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_JYJE, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_AJFH, GetType(System.Double))
                            'zengxianglin 2009-05-21
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBBMYJ_SJDLF, GetType(System.Double))
                            'zengxianglin 2009-05-21
                        End With
                        objTempDataSet.Tables.Add(objDataTable)
                    Next

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        Dim strTempTable As String = "T_" + objPulicParameters.getNewGuid()
                        strTempTable = strTempTable.Replace("-", "_")

                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select * into " + strTempTable + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getPHB_DW(@ksrq,@zzrq,@type)" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@type", intType)
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 面积 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 套数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 宗数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 按揭返还 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 交易金额 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        'zengxianglin 2009-05-21
                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 实结代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(6))
                        'zengxianglin 2009-05-21

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strTempTable + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 7 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESPHBBMYJ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手人员业绩排行榜的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     intType                    ：统计类型：0-接案，1-结案，2-已接未结案
        '     objDataSet                 ：信息数据集
        '                                  0-排序:面积
        '                                  1-排序:套数
        '                                  2-排序:宗数
        '                                  3-排序:代理费
        '                                  4-排序:按揭返还
        '                                  5-排序:交易金额
        '                                  6-排序:实结代理费
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '     zengxianglin 2009-05-21 更改
        '     zengxianglin 2009-06-15 更改
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESPHBRYYJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal intType As Integer, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESPHBRYYJ = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBRYYJ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBRYYJ]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESPHBRYYJ]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Select Case intType
                    Case 0, 1, 2, 3
                        'zengxianglin 2009-06-15
                        'Case 0, 1, 2
                        'zengxianglin 2009-06-15
                    Case Else
                        strErrMsg = "错误：[getDataSet_BB_ESPHBRYYJ]无效的类型[" + intType.ToString + "]！"
                        GoTo errProc
                End Select
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New System.Data.DataSet
                    '创建数据表
                    Dim objDataTable As System.Data.DataTable = Nothing
                    'zengxianglin 2009-05-21
                    'Dim intCount As Integer = 6
                    Dim intCount As Integer = 7
                    'zengxianglin 2009-05-21
                    Dim i As Integer
                    For i = 0 To intCount - 1 Step 1
                        objDataTable = New System.Data.DataTable
                        With objDataTable.Columns
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_RYDM, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_RYMC, GetType(System.String))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_MJ, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_TS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_ZS, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_DLF, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_JYJE, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_AJFH, GetType(System.Double))
                            'zengxianglin 2009-05-21
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_PHBRYYJ_SJDLF, GetType(System.Double))
                            'zengxianglin 2009-05-21
                        End With
                        objTempDataSet.Tables.Add(objDataTable)
                    Next

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        Dim strTempTable As String = "T_" + objPulicParameters.getNewGuid()
                        strTempTable = strTempTable.Replace("-", "_")

                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select * into " + strTempTable + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getPHB_RY(@ksrq,@zzrq,@type)" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@type", intType)
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 面积 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 套数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 宗数 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 按揭返还 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 交易金额 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        'zengxianglin 2009-05-21
                        strSQL = ""
                        strSQL = strSQL + " select *" + vbCr
                        strSQL = strSQL + " from " + strTempTable + vbCr
                        strSQL = strSQL + " order by 实结代理费 desc" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(6))
                        'zengxianglin 2009-05-21

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strTempTable + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 7 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESPHBRYYJ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业绩年度对比的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     intKSND                    ：开始年度
        '     intZZND                    ：终止年度
        '     intYJZR                    ：月截止日
        '     intType                    ：统计类型：0-接案，1-结案
        '     strYWLX                    ：业务类型：二手.买卖|二手.租赁|二手.其他
        '     strBMDM                    ：统计部门
        '     objDataSet                 ：信息数据集
        '                                  0-排序:面积
        '                                  1-排序:套数
        '                                  2-排序:宗数
        '                                  3-排序:代理费
        '                                  4-排序:按揭返还
        '                                  5-排序:交易金额
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-01 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESNDDB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal intKSND As Integer, _
            ByVal intZZND As Integer, _
            ByVal intYJZR As Integer, _
            ByVal intType As Integer, _
            ByVal strYWLX As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESNDDB = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESNDDB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                Select Case intType
                    Case 0, 1
                    Case Else
                        strErrMsg = "错误：[getDataSet_BB_ESNDDB]无效的类型[" + intType.ToString + "]！"
                        GoTo errProc
                End Select
                Dim intValue As Integer
                If intKSND > intZZND Then
                    intValue = intZZND
                    intZZND = intKSND
                    intKSND = intValue
                End If
                If strYWLX Is Nothing Then strYWLX = ""
                strYWLX = strYWLX.Trim
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New System.Data.DataSet
                    '创建数据表
                    Dim objDataTable As System.Data.DataTable = Nothing
                    Dim intCount As Integer = 6
                    Dim i As Integer
                    For i = 0 To intCount - 1 Step 1
                        objDataTable = New System.Data.DataTable
                        With objDataTable.Columns
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_TJND, GetType(System.Int32))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M01, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M02, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M03, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M04, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M05, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M06, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M07, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M08, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M09, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M10, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M11, GetType(System.Double))
                            .Add(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_VT_ES_BB_NDDB_M12, GetType(System.Double))
                        End With
                        objTempDataSet.Tables.Add(objDataTable)
                    Next

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        Dim strTempTable As String = "T_" + objPulicParameters.getNewGuid()
                        strTempTable = strTempTable.Replace("-", "_")

                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select * into " + strTempTable + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB01(@ywlx,@bmdm,@ksnd,@zznd,@yjzr,@type)" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ywlx", strYWLX)
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        objSqlCommand.Parameters.AddWithValue("@type", intType)
                        objSqlCommand.ExecuteNonQuery()

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 面积 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 面积 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 套数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 套数 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 宗数 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 宗数 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 代理费 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 代理费 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(3))

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 按揭返还 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 按揭返还 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(4))

                        strSQL = ""
                        strSQL = strSQL + " select a.统计年度," + vbCr
                        strSQL = strSQL + "   [1月] =isnull(b.[1月], 0)," + vbCr
                        strSQL = strSQL + "   [2月] =isnull(b.[2月], 0)," + vbCr
                        strSQL = strSQL + "   [3月] =isnull(b.[3月], 0)," + vbCr
                        strSQL = strSQL + "   [4月] =isnull(b.[4月], 0)," + vbCr
                        strSQL = strSQL + "   [5月] =isnull(b.[5月], 0)," + vbCr
                        strSQL = strSQL + "   [6月] =isnull(b.[6月], 0)," + vbCr
                        strSQL = strSQL + "   [7月] =isnull(b.[7月], 0)," + vbCr
                        strSQL = strSQL + "   [8月] =isnull(b.[8月], 0)," + vbCr
                        strSQL = strSQL + "   [9月] =isnull(b.[9月], 0)," + vbCr
                        strSQL = strSQL + "   [10月]=isnull(b.[10月],0)," + vbCr
                        strSQL = strSQL + "   [11月]=isnull(b.[11月],0)," + vbCr
                        strSQL = strSQL + "   [12月]=isnull(b.[12月],0) " + vbCr
                        strSQL = strSQL + " from dbo.uf_estate_rs_getHTZB02(@ksnd,@zznd) a" + vbCr
                        strSQL = strSQL + " left join" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select " + vbCr
                        strSQL = strSQL + "     统计年度," + vbCr
                        strSQL = strSQL + "     [1月] =sum(case when 统计月度=1  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [2月] =sum(case when 统计月度=2  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [3月] =sum(case when 统计月度=3  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [4月] =sum(case when 统计月度=4  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [5月] =sum(case when 统计月度=5  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [6月] =sum(case when 统计月度=6  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [7月] =sum(case when 统计月度=7  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [8月] =sum(case when 统计月度=8  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [9月] =sum(case when 统计月度=9  then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [10月]=sum(case when 统计月度=10 then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [11月]=sum(case when 统计月度=11 then 交易金额 else 0 end)," + vbCr
                        strSQL = strSQL + "     [12月]=sum(case when 统计月度=12 then 交易金额 else 0 end) " + vbCr
                        strSQL = strSQL + "   from " + strTempTable + vbCr
                        strSQL = strSQL + "   group by 统计年度" + vbCr
                        strSQL = strSQL + " ) b on a.统计年度=b.统计年度" + vbCr
                        strSQL = strSQL + " order by a.统计年度" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksnd", intKSND)
                        objSqlCommand.Parameters.AddWithValue("@zznd", intZZND)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(5))

                        strSQL = ""
                        strSQL = strSQL + " drop table " + strTempTable + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 6 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESNDDB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手佣金分配表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：统计部门
        '     dblLVBL                    ：律师费提佣比例
        '     objDataSet                 ：信息数据集
        '                                  0-佣金数据
        '                                  1-私佣计提区段数据
        '                                  2-公佣计提数据
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2008-12-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYJFPB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByVal dblLVBL As Double, _
            ByRef objDataSet As System.Data.DataSet) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYJFPB = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYJFPB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYJFPB]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYJFPB]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYJFPB]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYJFPB]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_YJFPB)
                    Dim objDataTable As System.Data.DataTable = Nothing
                    '创建[私佣计提区段]数据表
                    objDataTable = New System.Data.DataTable
                    With objDataTable.Columns
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_QJZX, GetType(System.Double))
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_QJZD, GetType(System.Double))
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_ZJJT, GetType(System.Double))
                    End With
                    objTempDataSet.Tables.Add(objDataTable)
                    '创建[公佣计提]数据表
                    objDataTable = New System.Data.DataTable
                    With objDataTable.Columns
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_ZJDM, GetType(System.String))
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_ZGBJ, GetType(System.Int32))
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_ZJJT, GetType(System.Double))
                        .Add(Josco.JSOA.Common.Data.estateRenshiXingyeData.FIELD_DC_B_RS_YONGJINJITIBIAOZHUN_BLJT, GetType(System.Double))
                    End With
                    objTempDataSet.Tables.Add(objDataTable)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        strSQL = ""
                        strSQL = strSQL + " exec dbo.up_estate_es_getESYJFAFPB @ksrq,@zzrq,@bmdm,@lvbl" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        objSqlCommand.Parameters.AddWithValue("@lvbl", dblLVBL)
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(0))

                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   区间最小,区间最大,直接计提" + vbCr
                        strSQL = strSQL + " from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + " where 业绩标记 & 1 = 1" + vbCr
                        strSQL = strSQL + " group by 区间最小,区间最大,直接计提" + vbCr
                        strSQL = strSQL + " order by 区间最小,区间最大" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(1))

                        strSQL = ""
                        strSQL = strSQL + " select" + vbCr
                        strSQL = strSQL + "   职级代码,直管标记,直接计提,保留计提" + vbCr
                        strSQL = strSQL + " from 地产_B_人事_佣金计提标准" + vbCr
                        strSQL = strSQL + " where 业绩标记 & 1 = 0" + vbCr
                        strSQL = strSQL + " group by 职级代码,直管标记,直接计提,保留计提" + vbCr
                        strSQL = strSQL + " order by 职级代码" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                        .SelectCommand = objSqlCommand
                        .Fill(objTempDataSet.Tables(2))
                    End With
                    '检查
                    If objTempDataSet.Tables.Count < 3 Then
                        Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYJFPB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 更改“地产_B_二手_交易合同”的[统计日期]
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：[确认书号]
        '     strTJRQ              ：[统计日期]
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录：
        '     zengxianglin 2009-02-24 创建
        '----------------------------------------------------------------
        Public Function doUpdateData_ES_HETONG_TJRQ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strTJRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doUpdateData_ES_HETONG_TJRQ = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doUpdateData_ES_HETONG_TJRQ]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strTJRQ Is Nothing Then strTJRQ = ""
                strTJRQ = strTJRQ.Trim
                If strTJRQ = "" Then
                    strErrMsg = "错误：[doUpdateData_ES_HETONG_TJRQ]无效的[统计日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strTJRQ) = False Then
                    strErrMsg = "错误：[doUpdateData_ES_HETONG_TJRQ]无效的[统计日期]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                    strSQL = strSQL + "   统计日期 = '" + strTJRQ + "'" + vbCr
                    strSQL = strSQL + " where 确认书号 =  '" + strQRSH + "'" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doUpdateData_ES_HETONG_TJRQ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算[地产_B_二手_交易合同]的[统计日期]
        '     strErrMsg                 ：如果错误，则返回错误信息
        '     strUserId                 ：用户标识
        '     strPassword               ：用户密码
        '     strQRSH                   ：确认书号
        '     strTJRQ                   ：统计日期(返回)
        ' 返回
        '     True                      ：成功
        '     False                     ：失败
        ' 更改描述
        '     zengxianglin 2009-02-24 创建
        '----------------------------------------------------------------
        Public Function getES_HETONG_TJRQ( _
            ByVal strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef strTJRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet = Nothing
            Dim strSQL As String = ""

            getES_HETONG_TJRQ = False
            strErrMsg = ""
            strTJRQ = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getES_HETONG_TJRQ]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If

                '计算
                strSQL = ""
                strSQL = strSQL + " select 统计日期" + vbCr
                strSQL = strSQL + " from 地产_B_二手_交易合同" + vbCr
                strSQL = strSQL + " where 确认书号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回
                With objDataSet
                    If .Tables.Count < 1 Then
                        Exit Try
                    End If
                    If .Tables(0).Rows.Count < 1 Then
                        Exit Try
                    End If
                    strTJRQ = objPulicParameters.getObjectValue(.Tables(0).Rows(0).Item("统计日期"), "", "yyyy-MM-dd")
                End With
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getES_HETONG_TJRQ = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 更改“地产_B_二手_交易合同”的[备注信息]
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strQRSH              ：[确认书号]
        '     strBZXX              ：[备注信息]
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录：
        '     zengxianglin 2009-02-24 创建
        '----------------------------------------------------------------
        Public Function doUpdateData_ES_HETONG_BZXX( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strBZXX As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doUpdateData_ES_HETONG_BZXX = False
            strErrMsg = ""

            Try
                '检查
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    '不用处理
                    Exit Try
                End If
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doUpdateData_ES_HETONG_BZXX]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strBZXX Is Nothing Then strBZXX = ""
                strBZXX = strBZXX.Trim
                If strBZXX = "" Then
                    '不用处理
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                    strSQL = strSQL + "   备注信息 = 备注信息 + '；' + '" + strBZXX + "'" + vbCr
                    strSQL = strSQL + " where 确认书号 =  '" + strQRSH + "'" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doUpdateData_ES_HETONG_BZXX = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function











        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书买卖_打印”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_MM_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_MM_PRN = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_MM_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_MM_PRN)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end," + vbCr
                        strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型)," + vbCr
                        strSQL = strSQL + "     交楼日期约定名称 = dbo.uf_estate_es_getJlrqydmc(a.交楼日期约定)," + vbCr
                        strSQL = strSQL + "     交楼状况约定名称 = dbo.uf_estate_es_getJlzkydmc(a.交楼状况约定)," + vbCr
                        strSQL = strSQL + "     付款方式约定名称 = dbo.uf_estate_es_getFkfsydmc(a.付款方式约定)," + vbCr
                        strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(a.税费支付约定)," + vbCr
                        strSQL = strSQL + "     房款托管约定名称 = dbo.uf_estate_es_getTgfkydmc(a.房款托管约定) " + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书买卖 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                   '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_MM_PRN))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_MM_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书租赁_打印”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_ZL_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_ZL_PRN = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_ZL_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_ZL_PRN)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end," + vbCr
                        strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型)," + vbCr
                        strSQL = strSQL + "     付租方式约定名称 = dbo.uf_estate_es_getFzfsydmc(a.付租方式约定)," + vbCr
                        strSQL = strSQL + "     租期约定名称     = dbo.uf_estate_es_getZqydmc(a.租期约定)," + vbCr
                        strSQL = strSQL + "     租金托管约定名称 = dbo.uf_estate_es_getZjtgydmc(a.租金托管约定)," + vbCr
                        strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(a.税费支付约定) " + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书租赁 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or     单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                            '不是行政助理
                            End If
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_ZL_PRN))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_ZL_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_确认书其他_打印”完全数据的数据集
        ' 以“订购日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     blnControl                 ：进行查看限制
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-17 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_QRS_QT_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal blnControl As Boolean, _
            ByRef objestateErshouData As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempestateErshouData As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_QRS_QT_PRN = False
            objestateErshouData = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_QRS_QT_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempestateErshouData = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_QUERENSHU_QT_PRN)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     订购状态名称=case when a.订购状态&3 = 0 then '未审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&3 = 1 then '已审'" + vbCr
                        strSQL = strSQL + "                       when a.订购状态&2 = 2 then '挞定'" + vbCr
                        strSQL = strSQL + "                       else '' end," + vbCr
                        strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型)," + vbCr
                        strSQL = strSQL + "     交楼日期约定名称 = dbo.uf_estate_es_getJlrqydmc(a.交楼日期约定)," + vbCr
                        strSQL = strSQL + "     交楼状况约定名称 = dbo.uf_estate_es_getJlzkydmc(a.交楼状况约定)," + vbCr
                        strSQL = strSQL + "     付款方式约定名称 = dbo.uf_estate_es_getFkfsydmc(a.付款方式约定)," + vbCr
                        strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(a.税费支付约定)," + vbCr
                        strSQL = strSQL + "     房款托管约定名称 = dbo.uf_estate_es_getTgfkydmc(a.房款托管约定) " + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_确认书其他 a " + vbCr
                        If blnControl = True Then
                            strSQL = strSQL + "   left join" + vbCr
                            strSQL = strSQL + "   (" + vbCr
                            strSQL = strSQL + "     select 确认书号" + vbCr
                            strSQL = strSQL + "     from 地产_B_二手_交易合同分配比例" + vbCr
                            strSQL = strSQL + "     where 状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "     and   (人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "     or     单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + " )" + vbCr                                            '不是行政助理
                            End If
                            strSQL = strSQL + "     group by 确认书号" + vbCr
                            strSQL = strSQL + "   ) b on a.确认书号 = b.确认书号" + vbCr
                            strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        End If
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.订购日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempestateErshouData.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_QUERENSHU_QT_PRN))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempestateErshouData.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objestateErshouData = objTempestateErshouData
            getDataSet_ES_QRS_QT_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempestateErshouData)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function












        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”中[二手.买卖]类型完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-18 创建
        '     zengxianglin 2011-01-03 更改
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_MM( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_MM = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM]未指定[连接用户]！"
                    GoTo errProc
                End If
                'zengxianglin 2011-01-03
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim
                'zengxianglin 2011-01-03

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Dim strYWLX As String = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_MM
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI_MM)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        'zengxianglin 2011-01-03
                        'strSQL = ""
                        'strSQL = strSQL + " select a.*" + vbCr
                        'strSQL = strSQL + " from" + vbCr
                        'strSQL = strSQL + " (" + vbCr
                        'strSQL = strSQL + "   select a.*," + vbCr
                        'strSQL = strSQL + "     b.计划交楼日期," + vbCr
                        'strSQL = strSQL + "     交楼日期约定名称 = dbo.uf_estate_es_getJlrqydmc(b.交楼日期约定)," + vbCr
                        'strSQL = strSQL + "     交楼状况约定名称 = dbo.uf_estate_es_getJlzkydmc(b.交楼状况约定)," + vbCr
                        'strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(b.税费支付约定)," + vbCr
                        'strSQL = strSQL + "     房款托管约定名称 = dbo.uf_estate_es_getTgfkydmc(b.房款托管约定)," + vbCr
                        'strSQL = strSQL + "     合同类型名称     = dbo.uf_estate_es_getHTLXMC_MM(a.合同类型)," + vbCr
                        'strSQL = strSQL + "     付款方式名称     = dbo.uf_estate_gg_getFkfsmbmc(a.付款方式)," + vbCr
                        'strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        'strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型) " + vbCr
                        'strSQL = strSQL + "   from" + vbCr
                        'strSQL = strSQL + "   (" + vbCr
                        'strSQL = strSQL + "     select a.*" + vbCr
                        'strSQL = strSQL + "     from" + vbCr
                        'strSQL = strSQL + "     (" + vbCr
                        'strSQL = strSQL + "       select * from 地产_V_全部交易" + vbCr
                        'strSQL = strSQL + "       where 交易类型 = '" + strYWLX + "'" + vbCr           '买卖
                        'strSQL = strSQL + "     ) a" + vbCr
                        'If blnControl = True Then
                        '    strSQL = strSQL + "     left join" + vbCr
                        '    strSQL = strSQL + "     (" + vbCr
                        '    strSQL = strSQL + "       select 确认书号" + vbCr
                        '    strSQL = strSQL + "       from 地产_B_二手_交易合同分配比例" + vbCr
                        '    strSQL = strSQL + "       where 状态标志 & 1 = 1" + vbCr                   '私佣
                        '    strSQL = strSQL + "       and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                        '    If strBMLIST <> "" Then
                        '        strSQL = strSQL + "       or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                        '    Else
                        '        strSQL = strSQL + "       )" + vbCr                                    '不是行政助理
                        '    End If
                        '    strSQL = strSQL + "       group by 确认书号" + vbCr
                        '    strSQL = strSQL + "     ) b on a.交易编号 = b.确认书号" + vbCr
                        '    strSQL = strSQL + "     where b.确认书号 is not null" + vbCr
                        'End If
                        'strSQL = strSQL + "   ) a" + vbCr
                        'strSQL = strSQL + "   left join 地产_B_二手_确认书买卖 b on a.交易编号=b.确认书号" + vbCr
                        'strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        'strSQL = strSQL + " ) a" + vbCr
                        'If strWhere <> "" Then
                        '    strSQL = strSQL + " where " + strWhere + vbCr
                        'End If
                        'strSQL = strSQL + " order by a.交易日期" + vbCr
                        '***********************************************************************************************************************************************************************
                        strTempWhere = ""
                        strSQL = ""
                        strSQL = strSQL + "  select a.*" + vbCr
                        strSQL = strSQL + "  from" + vbCr
                        strSQL = strSQL + "  (" + vbCr
                        strSQL = strSQL + "    select a.*," + vbCr
                        strSQL = strSQL + "      b.合同编号,b.合同类型,b.合同日期,b.结案日期,b.统计日期,b.按揭返还,b.合同状态,b.付款方式," + vbCr
                        strSQL = strSQL + "      b.合同标志,b.解除日期,b.坏账金额,b.坏账日期,b.合同唯一标识,b.合同备注信息," + vbCr
                        strSQL = strSQL + "      b.合同状态名称,b.合同类型名称,b.付款方式名称,b.合同解除,b.坏账合同" + vbCr
                        strSQL = strSQL + "    from" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        case when a.交楼日期约定=0 then '收到房款当天' when a.交楼日期约定=1 then '自行交接' when a.交楼日期约定=2 then '其他约定' else '' end as 交楼日期约定名称," + vbCr
                        strSQL = strSQL + "        case when a.交楼状况约定=0 then '吉屋按现状' when a.交楼状况约定=1 then '详见交付清单' when a.交楼状况约定=2 then '带租约交付' else '' end as 交楼状况约定名称," + vbCr
                        strSQL = strSQL + "        case when a.税费支付约定=0 then '各付各税' when a.税费支付约定=1 then '甲方包税' when a.税费支付约定=2 then '乙方包税' when a.税费支付约定=3 then '其他' else '' end as 税费支付约定名称," + vbCr
                        strSQL = strSQL + "        case when a.房款托管约定=0 then '不托管房款' when a.房款托管约定=1 then '托管房款' else '' end as 房款托管约定名称," + vbCr
                        strSQL = strSQL + "        case when a.付款方式约定=0 then '一次性付款' when a.付款方式约定=1 then '亿城按揭' when a.付款方式约定=2 then '其他按揭' else '' end as 付款方式约定名称," + vbCr
                        strSQL = strSQL + "        case when a.甲方证件类型=0 then '身份证' when a.甲方证件类型=1 then '护照' when a.甲方证件类型=2 then '营业执照' else '' end as 甲方证件类型名称," + vbCr
                        strSQL = strSQL + "        case when a.乙方证件类型=0 then '身份证' when a.乙方证件类型=1 then '护照' when a.乙方证件类型=2 then '营业执照' else '' end as 乙方证件类型名称," + vbCr
                        strSQL = strSQL + "        '二手.买卖'  as 交易类型," + vbCr
                        strSQL = strSQL + "        a.确认书号   as 交易编号," + vbCr
                        strSQL = strSQL + "        a.订购日期   as 交易日期," + vbCr
                        strSQL = strSQL + "        a.订购状态   as 交易状态," + vbCr
                        strSQL = strSQL + "        a.甲方名称   as 业主名称," + vbCr
                        strSQL = strSQL + "        a.乙方名称   as 客户名称," + vbCr
                        strSQL = strSQL + "        a.房屋地址   as 物业地址," + vbCr
                        strSQL = strSQL + "        a.交易总价格 as 交易价格," + vbCr
                        strSQL = strSQL + "        a.交易总面积 as 交易面积," + vbCr
                        strSQL = strSQL + "        cast(0.0 as money)      as 交易月租金," + vbCr
                        strSQL = strSQL + "        cast(null as datetime)  as 租赁开始," + vbCr
                        strSQL = strSQL + "        cast(null as datetime)  as 租赁结束," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 水电煤气," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 电话费," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 管理费," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 租赁发票" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_确认书买卖 a" + vbCr
                        If strQueryDG <> "" Then
                            strSQL = strSQL + "     where " + strQueryDG + vbCr
                        End If
                        strSQL = strSQL + "    ) a" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    left join" + vbCr
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        a.唯一标识 as 合同唯一标识," + vbCr
                        strSQL = strSQL + "        a.备注信息 as 合同备注信息," + vbCr
                        strSQL = strSQL + "        b.模版名称 as 付款方式名称," + vbCr
                        strSQL = strSQL + "        case when a.合同类型 & 0x1 = 0x1 then '现楼买卖' when a.合同类型 & 0x2 = 0x2 then '合同转让' when a.合同类型 & 0x4 = 0x4 then '楼花转让' else '其他买卖' end as 合同类型名称," + vbCr
                        strSQL = strSQL + "        case when a.合同状态 & 3 = 0 then '未审' when a.合同状态 & 3 = 1 then '已审' when a.合同状态 & 2 = 2 then '完成' else '' end as 合同状态名称," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x1 = 0x1 then '√' else '×' end as 合同解除," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x2 = 0x2 then '√' else '×' end as 坏账合同" + vbCr
                        strSQL = strSQL + "      from 地产_B_二手_交易合同 a" + vbCr
                        strSQL = strSQL + "      left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                        If strQueryHT <> "" Then
                            strSQL = strSQL + "      where " + strQueryHT + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "b.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + " and b.确认书号 is not null" + vbCr
                            End If
                        End If
                        strSQL = strSQL + "    ) b on a.交易编号 = b.确认书号" + vbCr
                        '***********************************************************************************************************************************************************************
                        If strQueryRY <> "" And blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf strQueryRY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        Else
                        End If
                        '***********************************************************************************************************************************************************************
                        If strQueryDY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_物业买卖 a" + vbCr
                            strSQL = strSQL + "      where " + strQueryDY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) d on a.交易编号 = d.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "d.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                            End If
                        End If
                        '***********************************************************************************************************************************************************************
                        If strTempWhere <> "" Then
                            strSQL = strSQL + "    where " + strTempWhere + vbCr
                        End If
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "  ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "  where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "  order by a.交易日期" + vbCr
                        'zengxianglin 2011-01-03

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI_MM))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_ES_JYXX_MM = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”中[二手.其他]类型完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-18 创建
        '     zengxianglin 2011-01-04 更改
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_QT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_QT = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT]未指定[连接用户]！"
                    GoTo errProc
                End If
                'zengxianglin 2011-01-04
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim
                'zengxianglin 2011-01-04

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Dim strYWLX As String = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_QT
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI_QT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        'zengxianglin 2010-01-04
                        '准备SQL
                        'strSQL = ""
                        'strSQL = strSQL + " select a.*" + vbCr
                        'strSQL = strSQL + " from" + vbCr
                        'strSQL = strSQL + " (" + vbCr
                        'strSQL = strSQL + "   select a.*," + vbCr
                        'strSQL = strSQL + "     b.计划交楼日期," + vbCr
                        'strSQL = strSQL + "     交楼日期约定名称 = dbo.uf_estate_es_getJlrqydmc(b.交楼日期约定)," + vbCr
                        'strSQL = strSQL + "     交楼状况约定名称 = dbo.uf_estate_es_getJlzkydmc(b.交楼状况约定)," + vbCr
                        'strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(b.税费支付约定)," + vbCr
                        'strSQL = strSQL + "     房款托管约定名称 = dbo.uf_estate_es_getTgfkydmc(b.房款托管约定)," + vbCr
                        'strSQL = strSQL + "     合同类型名称     = dbo.uf_estate_es_getHTLXMC_QT(a.合同类型)," + vbCr
                        'strSQL = strSQL + "     付款方式名称     = dbo.uf_estate_gg_getFkfsmbmc(a.付款方式)," + vbCr
                        'strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        'strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型) " + vbCr
                        'strSQL = strSQL + "   from" + vbCr
                        'strSQL = strSQL + "   (" + vbCr
                        'strSQL = strSQL + "     select a.*" + vbCr
                        'strSQL = strSQL + "     from" + vbCr
                        'strSQL = strSQL + "     (" + vbCr
                        'strSQL = strSQL + "       select * from 地产_V_全部交易" + vbCr
                        'strSQL = strSQL + "       where 交易类型 = '" + strYWLX + "'" + vbCr           '其他
                        'strSQL = strSQL + "     ) a" + vbCr
                        'If blnControl = True Then
                        '    strSQL = strSQL + "     left join" + vbCr
                        '    strSQL = strSQL + "     (" + vbCr
                        '    strSQL = strSQL + "       select 确认书号" + vbCr
                        '    strSQL = strSQL + "       from 地产_B_二手_交易合同分配比例" + vbCr
                        '    strSQL = strSQL + "       where 状态标志 & 1 = 1" + vbCr                   '私佣
                        '    strSQL = strSQL + "       and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                        '    If strBMLIST <> "" Then
                        '        strSQL = strSQL + "       or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                        '    Else
                        '        strSQL = strSQL + "       )" + vbCr                                    '不是行政助理
                        '    End If
                        '    strSQL = strSQL + "       group by 确认书号" + vbCr
                        '    strSQL = strSQL + "     ) b on a.交易编号 = b.确认书号" + vbCr
                        '    strSQL = strSQL + "     where b.确认书号 is not null" + vbCr
                        'End If
                        'strSQL = strSQL + "   ) a" + vbCr
                        'strSQL = strSQL + "   left join 地产_B_二手_确认书其他 b on a.交易编号=b.确认书号" + vbCr
                        'strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        'strSQL = strSQL + " ) a" + vbCr
                        'If strWhere <> "" Then
                        '    strSQL = strSQL + " where " + strWhere + vbCr
                        'End If
                        'strSQL = strSQL + " order by a.交易日期" + vbCr
                        '***********************************************************************************************************************************************************************
                        strTempWhere = ""
                        strSQL = ""
                        strSQL = strSQL + "  select a.*" + vbCr
                        strSQL = strSQL + "  from" + vbCr
                        strSQL = strSQL + "  (" + vbCr
                        strSQL = strSQL + "    select a.*," + vbCr
                        strSQL = strSQL + "      b.合同编号,b.合同类型,b.合同日期,b.结案日期,b.统计日期,b.按揭返还,b.合同状态,b.付款方式," + vbCr
                        strSQL = strSQL + "      b.合同标志,b.解除日期,b.坏账金额,b.坏账日期,b.合同唯一标识,b.合同备注信息," + vbCr
                        strSQL = strSQL + "      b.合同状态名称,b.合同类型名称,b.付款方式名称,b.合同解除,b.坏账合同" + vbCr
                        strSQL = strSQL + "    from" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        case when a.交楼日期约定=0 then '收到房款当天' when a.交楼日期约定=1 then '自行交接' when a.交楼日期约定=2 then '其他约定' else '' end as 交楼日期约定名称," + vbCr
                        strSQL = strSQL + "        case when a.交楼状况约定=0 then '吉屋按现状' when a.交楼状况约定=1 then '详见交付清单' when a.交楼状况约定=2 then '带租约交付' else '' end as 交楼状况约定名称," + vbCr
                        strSQL = strSQL + "        case when a.税费支付约定=0 then '各付各税' when a.税费支付约定=1 then '甲方包税' when a.税费支付约定=2 then '乙方包税' when a.税费支付约定=3 then '其他' else '' end as 税费支付约定名称," + vbCr
                        strSQL = strSQL + "        case when a.房款托管约定=0 then '不托管房款' when a.房款托管约定=1 then '托管房款' else '' end as 房款托管约定名称," + vbCr
                        strSQL = strSQL + "        case when a.付款方式约定=0 then '一次性付款' when a.付款方式约定=1 then '亿城按揭' when a.付款方式约定=2 then '其他按揭' else '' end as 付款方式约定名称," + vbCr
                        strSQL = strSQL + "        case when a.甲方证件类型=0 then '身份证' when a.甲方证件类型=1 then '护照' when a.甲方证件类型=2 then '营业执照' else '' end as 甲方证件类型名称," + vbCr
                        strSQL = strSQL + "        case when a.乙方证件类型=0 then '身份证' when a.乙方证件类型=1 then '护照' when a.乙方证件类型=2 then '营业执照' else '' end as 乙方证件类型名称," + vbCr
                        strSQL = strSQL + "        '二手.其他'  as 交易类型," + vbCr
                        strSQL = strSQL + "        a.确认书号   as 交易编号," + vbCr
                        strSQL = strSQL + "        a.订购日期   as 交易日期," + vbCr
                        strSQL = strSQL + "        a.订购状态   as 交易状态," + vbCr
                        strSQL = strSQL + "        a.甲方名称   as 业主名称," + vbCr
                        strSQL = strSQL + "        a.乙方名称   as 客户名称," + vbCr
                        strSQL = strSQL + "        a.房屋地址   as 物业地址," + vbCr
                        strSQL = strSQL + "        a.交易总价格 as 交易价格," + vbCr
                        strSQL = strSQL + "        a.交易总面积 as 交易面积," + vbCr
                        strSQL = strSQL + "        cast(0.0 as money)      as 交易月租金," + vbCr
                        strSQL = strSQL + "        cast(null as datetime)  as 租赁开始," + vbCr
                        strSQL = strSQL + "        cast(null as datetime)  as 租赁结束," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 水电煤气," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 电话费," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 管理费," + vbCr
                        strSQL = strSQL + "        cast('' as varchar(20)) as 租赁发票" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_确认书其他 a" + vbCr
                        If strQueryDG <> "" Then
                            strSQL = strSQL + "     where " + strQueryDG + vbCr
                        End If
                        strSQL = strSQL + "    ) a" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    left join" + vbCr
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        a.唯一标识 as 合同唯一标识," + vbCr
                        strSQL = strSQL + "        a.备注信息 as 合同备注信息," + vbCr
                        strSQL = strSQL + "        b.模版名称 as 付款方式名称," + vbCr
                        strSQL = strSQL + "        case when a.合同类型 & 0x1 = 0x1 then '代办过户' when a.合同类型 & 0x2 = 0x2 then '代办按揭' else '其他代办' end as 合同类型名称," + vbCr
                        strSQL = strSQL + "        case when a.合同状态 & 3 = 0 then '未审' when a.合同状态 & 3 = 1 then '已审' when a.合同状态 & 2 = 2 then '完成' else '' end as 合同状态名称," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x1 = 0x1 then '√' else '×' end as 合同解除," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x2 = 0x2 then '√' else '×' end as 坏账合同" + vbCr
                        strSQL = strSQL + "      from 地产_B_二手_交易合同 a" + vbCr
                        strSQL = strSQL + "      left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                        If strQueryHT <> "" Then
                            strSQL = strSQL + "      where " + strQueryHT + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "b.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + " and b.确认书号 is not null" + vbCr
                            End If
                        End If
                        strSQL = strSQL + "    ) b on a.交易编号 = b.确认书号" + vbCr
                        '***********************************************************************************************************************************************************************
                        If strQueryRY <> "" And blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf strQueryRY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        Else
                        End If
                        '***********************************************************************************************************************************************************************
                        If strQueryDY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_物业其他 a" + vbCr
                            strSQL = strSQL + "      where " + strQueryDY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) d on a.交易编号 = d.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "d.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                            End If
                        End If
                        '***********************************************************************************************************************************************************************
                        If strTempWhere <> "" Then
                            strSQL = strSQL + "    where " + strTempWhere + vbCr
                        End If
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "  ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "  where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "  order by a.交易日期" + vbCr
                        'zengxianglin 2010-01-04

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI_QT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_ES_JYXX_QT = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_V_全部交易”中[二手.租赁]类型完全数据的数据集
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2009-05-18 创建
        '     zengxianglin 2011-01-05 更改
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_ZL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objTempRetDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_ZL = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL]未指定[连接用户]！"
                    GoTo errProc
                End If
                'zengxianglin 2011-01-05
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim
                'zengxianglin 2011-01-05

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '获取数据
                Dim strYWLX As String = Josco.JSOA.Common.Data.estateErshouData.YWLX_ES_ZL
                Try
                    '创建数据集
                    objTempRetDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_V_QUANBUJIAOYI_ZL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        'zengxianglin 2011-01-05
                        'strSQL = ""
                        'strSQL = strSQL + " select a.*" + vbCr
                        'strSQL = strSQL + " from" + vbCr
                        'strSQL = strSQL + " (" + vbCr
                        'strSQL = strSQL + "   select a.*," + vbCr
                        'strSQL = strSQL + "     b.租赁保证金," + vbCr
                        'strSQL = strSQL + "     b.滞纳金比例," + vbCr
                        'strSQL = strSQL + "     b.年递增比例," + vbCr
                        'strSQL = strSQL + "     b.租期月数," + vbCr
                        'strSQL = strSQL + "     b.缴租日," + vbCr
                        'strSQL = strSQL + "     b.计划交楼日期," + vbCr
                        'strSQL = strSQL + "     交楼状况说明     = b.交楼状况说明," + vbCr
                        'strSQL = strSQL + "     付租方式约定名称 = dbo.uf_estate_es_getFzfsydmc(b.付租方式约定)," + vbCr
                        'strSQL = strSQL + "     税费支付约定名称 = dbo.uf_estate_es_getSfzfydmc(b.税费支付约定)," + vbCr
                        'strSQL = strSQL + "     租金托管约定名称 = dbo.uf_estate_es_getZjtgydmc(b.租金托管约定)," + vbCr
                        'strSQL = strSQL + "     合同类型名称     = dbo.uf_estate_es_getHTLXMC_ZL(a.合同类型)," + vbCr
                        'strSQL = strSQL + "     付款方式名称     = dbo.uf_estate_gg_getFkfsmbmc(a.付款方式)," + vbCr
                        'strSQL = strSQL + "     甲方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.甲方证件类型)," + vbCr
                        'strSQL = strSQL + "     乙方证件类型名称 = dbo.uf_estate_es_getZjlxmc(a.乙方证件类型) " + vbCr
                        'strSQL = strSQL + "   from" + vbCr
                        'strSQL = strSQL + "   (" + vbCr
                        'strSQL = strSQL + "     select a.*" + vbCr
                        'strSQL = strSQL + "     from" + vbCr
                        'strSQL = strSQL + "     (" + vbCr
                        'strSQL = strSQL + "       select * from 地产_V_全部交易" + vbCr
                        'strSQL = strSQL + "       where 交易类型 = '" + strYWLX + "'" + vbCr            '租赁
                        'strSQL = strSQL + "     ) a" + vbCr
                        'If blnControl = True Then
                        '    strSQL = strSQL + "     left join" + vbCr
                        '    strSQL = strSQL + "     (" + vbCr
                        '    strSQL = strSQL + "       select 确认书号" + vbCr
                        '    strSQL = strSQL + "       from 地产_B_二手_交易合同分配比例" + vbCr
                        '    strSQL = strSQL + "       where 状态标志 & 1 = 1" + vbCr                   '私佣
                        '    strSQL = strSQL + "       and   (人员代码 in (" + strRYLIST + ")" + vbCr   '是下属
                        '    If strBMLIST <> "" Then
                        '        strSQL = strSQL + "       or 单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                        '    Else
                        '        strSQL = strSQL + "       )" + vbCr                                    '不是行政助理
                        '    End If
                        '    strSQL = strSQL + "       group by 确认书号" + vbCr
                        '    strSQL = strSQL + "     ) b on a.交易编号 = b.确认书号" + vbCr
                        '    strSQL = strSQL + "     where b.确认书号 is not null" + vbCr
                        'End If
                        'strSQL = strSQL + "   ) a" + vbCr
                        'strSQL = strSQL + "   left join 地产_B_二手_确认书租赁 b on a.交易编号=b.确认书号" + vbCr
                        'strSQL = strSQL + "   where b.确认书号 is not null" + vbCr
                        'strSQL = strSQL + " ) a" + vbCr
                        'If strWhere <> "" Then
                        '    strSQL = strSQL + " where " + strWhere + vbCr
                        'End If
                        'strSQL = strSQL + " order by a.交易日期" + vbCr
                        strTempWhere = ""
                        strSQL = ""
                        strSQL = strSQL + "  select a.*" + vbCr
                        strSQL = strSQL + "  from" + vbCr
                        strSQL = strSQL + "  (" + vbCr
                        strSQL = strSQL + "    select a.*," + vbCr
                        strSQL = strSQL + "      b.合同编号,b.合同类型,b.合同日期,b.结案日期,b.统计日期,b.按揭返还,b.合同状态,b.付款方式," + vbCr
                        strSQL = strSQL + "      b.合同标志,b.解除日期,b.坏账金额,b.坏账日期,b.合同唯一标识,b.合同备注信息," + vbCr
                        strSQL = strSQL + "      b.合同状态名称,b.合同类型名称,b.付款方式名称,b.合同解除,b.坏账合同" + vbCr
                        strSQL = strSQL + "    from" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        case when a.付租方式约定=0 then '月缴' when a.付租方式约定=1 then '季缴' when a.付租方式约定=2 then '半年缴' when a.付租方式约定=3 then '年缴' else '' end as 付租方式约定名称," + vbCr
                        strSQL = strSQL + "        case when a.税费支付约定=0 then '各付各税' when a.税费支付约定=1 then '甲方包税' when a.税费支付约定=2 then '乙方包税' when a.税费支付约定=3 then '其他' else '' end as 税费支付约定名称," + vbCr
                        strSQL = strSQL + "        case when a.租金托管约定=0 then '不托管租金' when a.租金托管约定=1 then '托管租金' else '' end as 租金托管约定名称," + vbCr
                        strSQL = strSQL + "        case when a.租期约定=0 then '指定月数' when a.租期约定=1 then '可与出租方约定' else '' end as 租期约定名称," + vbCr
                        strSQL = strSQL + "        case when a.甲方证件类型=0 then '身份证' when a.甲方证件类型=1 then '护照' when a.甲方证件类型=2 then '营业执照' else '' end as 甲方证件类型名称," + vbCr
                        strSQL = strSQL + "        case when a.乙方证件类型=0 then '身份证' when a.乙方证件类型=1 then '护照' when a.乙方证件类型=2 then '营业执照' else '' end as 乙方证件类型名称," + vbCr
                        strSQL = strSQL + "        '二手.租赁'  as 交易类型," + vbCr
                        strSQL = strSQL + "        a.确认书号   as 交易编号," + vbCr
                        strSQL = strSQL + "        a.订购日期   as 交易日期," + vbCr
                        strSQL = strSQL + "        a.订购状态   as 交易状态," + vbCr
                        strSQL = strSQL + "        a.甲方名称   as 业主名称," + vbCr
                        strSQL = strSQL + "        a.乙方名称   as 客户名称," + vbCr
                        strSQL = strSQL + "        a.房屋地址   as 物业地址," + vbCr
                        strSQL = strSQL + "        a.交易总租金 as 交易价格," + vbCr
                        strSQL = strSQL + "        a.交易总面积 as 交易面积 " + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_确认书租赁 a" + vbCr
                        If strQueryDG <> "" Then
                            strSQL = strSQL + "     where " + strQueryDG + vbCr
                        End If
                        strSQL = strSQL + "    ) a" + vbCr
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "    left join" + vbCr
                        strSQL = strSQL + "    (" + vbCr
                        strSQL = strSQL + "      select a.*," + vbCr
                        strSQL = strSQL + "        a.唯一标识 as 合同唯一标识," + vbCr
                        strSQL = strSQL + "        a.备注信息 as 合同备注信息," + vbCr
                        strSQL = strSQL + "        b.模版名称 as 付款方式名称," + vbCr
                        strSQL = strSQL + "        '租赁合同' as 合同类型名称," + vbCr
                        strSQL = strSQL + "        case when a.合同状态 & 3 = 0 then '未审' when a.合同状态 & 3 = 1 then '已审' when a.合同状态 & 2 = 2 then '完成' else '' end as 合同状态名称," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x1 = 0x1 then '√' else '×' end as 合同解除," + vbCr
                        strSQL = strSQL + "        case when a.合同标志 & 0x2 = 0x2 then '√' else '×' end as 坏账合同" + vbCr
                        strSQL = strSQL + "      from 地产_B_二手_交易合同 a" + vbCr
                        strSQL = strSQL + "      left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                        If strQueryHT <> "" Then
                            strSQL = strSQL + "      where " + strQueryHT + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "b.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + " and b.确认书号 is not null" + vbCr
                            End If
                        End If
                        strSQL = strSQL + "    ) b on a.交易编号 = b.确认书号" + vbCr
                        '***********************************************************************************************************************************************************************
                        If strQueryRY <> "" And blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf blnControl = True Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                            strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                            If strBMLIST <> "" Then
                                strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                            Else
                                strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                            End If
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        ElseIf strQueryRY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from" + vbCr
                            strSQL = strSQL + "      (" + vbCr
                            strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                            strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                            strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                            strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                            strSQL = strSQL + "      ) a" + vbCr
                            strSQL = strSQL + "      where " + strQueryRY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) c on a.交易编号 = c.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "c.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                            End If
                        Else
                        End If
                        '***********************************************************************************************************************************************************************
                        If strQueryDY <> "" Then
                            strSQL = strSQL + "    left join" + vbCr
                            strSQL = strSQL + "    (" + vbCr
                            strSQL = strSQL + "      select a.确认书号" + vbCr
                            strSQL = strSQL + "      from 地产_B_二手_物业租赁 a" + vbCr
                            strSQL = strSQL + "      where " + strQueryDY + vbCr
                            strSQL = strSQL + "      group by a.确认书号" + vbCr
                            strSQL = strSQL + "    ) d on a.交易编号 = d.确认书号" + vbCr
                            If strTempWhere = "" Then
                                strTempWhere = "d.确认书号 is not null" + vbCr
                            Else
                                strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                            End If
                        End If
                        '***********************************************************************************************************************************************************************
                        If strTempWhere <> "" Then
                            strSQL = strSQL + "    where " + strTempWhere + vbCr
                        End If
                        '***********************************************************************************************************************************************************************
                        strSQL = strSQL + "  ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + "  where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + "  order by a.交易日期" + vbCr
                        'zengxianglin 2011-01-05

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempRetDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI_ZL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempRetDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempRetDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempRetDataSet
            getDataSet_ES_JYXX_ZL = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempRetDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 自动调整合同的分配比例数据以及合同涉及的结算书的业绩数据
        ' 以[合同日期]时的管理架构数据为基准
        '     strErrMsg              ：如果错误，则返回错误信息
        '     strUserId              ：用户标识
        '     strPassword            ：用户密码
        '     strQRSH                ：确认书号
        '     strBZXX                ：备注信息
        ' 返回
        '     True                   ：成功
        '     False                  ：失败
        ' 更改
        '     zengxianglin 2009-05-19 创建
        '     zengxianglin 2010-01-06 重新设计
        '----------------------------------------------------------------
        Public Function doUpdate_ES_HETONG_FPBL_JSYJ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal strBZXX As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strWhere As String = ""
            Dim strSQL As String = ""

            Dim objDataSet_YEJI As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objDataSet_GYBL As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objDataSet_SYBL As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objDataSet_JSS As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objDataSet_GY As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objDataSet_HT As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objYejiList As New System.Collections.Specialized.ListDictionary
            Dim objDataSet_GLJG As System.Data.DataSet = Nothing

            doUpdate_ES_HETONG_FPBL_JSYJ = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ]未传入[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim
                If strQRSH = "" Then
                    Exit Try
                End If
                If strBZXX Is Nothing Then strBZXX = ""
                strBZXX = strBZXX.Trim

                '计算合同数据
                If Me.getDataSet_ES_JYXX(strErrMsg, strUserId, strPassword, strQRSH, "", objDataSet_HT) = False Then
                    GoTo errProc
                End If
                Dim dblHTZK As Double = 0.0
                Dim strHTRQ As String = ""
                With objDataSet_HT.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_V_QUANBUJIAOYI)
                    If .Rows.Count < 1 Then
                        strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ][" + strQRSH + "]对应的合同数据不存在！"
                        GoTo errProc
                    End If
                    strHTRQ = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_V_QUANBUJIAOYI_HTRQ), "", "yyyy-MM-dd")
                    dblHTZK = objPulicParameters.getObjectValue(.Rows(0).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_V_QUANBUJIAOYI_DLFZK), 1.0)
                End With
                Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_HT)
                If strHTRQ = "" Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ][" + strQRSH + "]没有[合同日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strHTRQ) = False Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ][" + strQRSH + "]无效的[合同日期]！"
                    GoTo errProc
                End If
                If dblHTZK < 0 Then dblHTZK = 0

                '计算合同[私佣分配比例]数据
                strWhere = "a." + Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ + " & 1 = 1"
                If Me.getDataSet_ES_HETONG_FPBL(strErrMsg, strUserId, strPassword, strQRSH, strWhere, objDataSet_SYBL) = False Then
                    GoTo errProc
                End If
                '如果没有[私佣分配比例]数据，则不计算
                With objDataSet_SYBL.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                    If .Rows.Count < 1 Then
                        strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ][" + strQRSH + "]没有业务员的分配数据！"
                        GoTo errProc
                    End If
                End With

                '空[公佣分配比例]数据
                objDataSet_GYBL = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_HETONG_FPBL)

                '计算[strHTRQ]时的[管理架构]数据
                strSQL = ""
                strSQL = strSQL + " select a.人员代码,a.职级代码,a.所属单位,a.所属分组,a.团队编号" + vbCr
                strSQL = strSQL + " from dbo.uf_estate_rs_getValidGuanliJiagou('" + strHTRQ + "') a"
                strSQL = strSQL + " order by a.人员代码" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet_GLJG) = False Then
                    GoTo errProc
                End If
                If objDataSet_GLJG.Tables(0) Is Nothing Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_FPBL_JSYJ]无法获取[" + strHTRQ + "]时[管理架构]数据！"
                    GoTo errProc
                End If

                '调整[私佣分配比例]中人员数据与[管理架构]数据一致
                Dim blnFound As Boolean = False
                Dim strZJDM As String = ""
                Dim strBMDM As String = ""
                Dim strSSFZ As String = ""
                Dim strRYDM As String = ""
                Dim intTDBH As Integer
                Dim intCount As Integer
                Dim i As Integer
                With objDataSet_SYBL.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strRYDM = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM), "")
                        '按[strRYDM]定位[管理架构]数据
                        strWhere = "人员代码 = '" + strRYDM + "'"
                        With objDataSet_GLJG.Tables(0)
                            .DefaultView.RowFilter = strWhere
                            blnFound = False
                            If .DefaultView.Count > 0 Then
                                strBMDM = objPulicParameters.getObjectValue(.DefaultView.Item(0).Item("所属单位"), "")
                                strZJDM = objPulicParameters.getObjectValue(.DefaultView.Item(0).Item("职级代码"), "")
                                strSSFZ = objPulicParameters.getObjectValue(.DefaultView.Item(0).Item("所属分组"), "")
                                intTDBH = objPulicParameters.getObjectValue(.DefaultView.Item(0).Item("团队编号"), 0)
                                blnFound = True
                            End If
                        End With
                        '更新[私佣分配比例]的数据
                        If blnFound = True Then
                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM) = strBMDM
                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ) = strZJDM
                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ) = strSSFZ
                            .Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH) = intTDBH
                        End If
                    Next
                End With
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_GLJG)

                '重新计算[公佣分配比例]
                If Me.getGongyongInfo(strErrMsg, strUserId, strPassword, strQRSH, objDataSet_SYBL, objDataSet_GY) = False Then
                    GoTo errProc
                End If
                Dim objDataRow As System.Data.DataRow = Nothing
                With objDataSet_GY.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        With objDataSet_GYBL.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                            objDataRow = .NewRow()
                        End With
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_WYBS) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_WYBS)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_QRSH) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_QRSH)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWDM)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_DWMC)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_TDBH)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_FPBL)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYDM)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYMC) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYMC)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJ)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_RYZJMC)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJ)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZGBJMC)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZ)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZMC) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_ZTBZMC)
                        objDataRow(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ) = .Rows(i)(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_FPBL_SSFZ)
                        With objDataSet_GYBL.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_FPBL)
                            .Rows.Add(objDataRow)
                        End With
                    Next
                End With
                Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_GY)

                '计算本合同的结算书数据
                If Me.getDataSet_ES_HETONG_JSS(strErrMsg, strUserId, strPassword, strQRSH, "", objDataSet_JSS) = False Then
                    GoTo errProc
                End If

                '计算相关结算书的业绩分配
                Dim strJSSH As String = ""
                Dim intJSLX As Integer
                Dim dblZJFE As Double
                With objDataSet_JSS.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU)
                    intCount = .Rows.Count
                    For i = 0 To intCount - 1 Step 1
                        strJSSH = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSSH), "")
                        intJSLX = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSLX), 0)
                        dblZJFE = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_ZJFE), 0.0)
                        If Me.doComputeYeji(strErrMsg, strUserId, strPassword, strQRSH, dblHTZK, dblZJFE, intJSLX, objDataSet_SYBL, objDataSet_GYBL, objDataSet_YEJI) = False Then
                            GoTo errProc
                        End If
                        objYejiList.Add(strJSSH, objDataSet_YEJI)
                        objDataSet_YEJI = Nothing
                    Next
                End With

                '获取连接事务
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction

                '事务处理
                Try
                    objSqlCommand.Transaction = objSqlTransaction

                    '保存[私佣分配比例]
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_SYBL) = False Then
                        GoTo rollDatabase
                    End If

                    '保存[公佣分配比例]
                    If Me.doSaveData_ES_HETONG_FPBL(strErrMsg, objSqlTransaction, strQRSH, objDataSet_GYBL, True) = False Then
                        GoTo rollDatabase
                    End If

                    '逐个保存[结算书的业绩分配]
                    With objDataSet_JSS.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_HETONG_JIESUANSHU)
                        intCount = .Rows.Count
                        For i = 0 To intCount - 1 Step 1
                            '计算[结算书号]
                            strJSSH = objPulicParameters.getObjectValue(.Rows(i).Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_HETONG_JIESUANSHU_JSSH), "")

                            '计算[结算书业绩分配新数据]
                            objDataSet_YEJI = CType(objYejiList.Item(strJSSH), Josco.JSOA.Common.Data.estateErshouData)

                            '保存[结算书业绩分配新数据]
                            If Me.doSaveData_ES_HETONG_JSS_YEJI(strErrMsg, objSqlTransaction, strQRSH, strJSSH, objDataSet_YEJI) = False Then
                                GoTo rollDatabase
                            End If
                            objDataSet_YEJI = Nothing
                        Next
                    End With

                    '写备注信息
                    If strBZXX <> "" Then
                        strSQL = ""
                        strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                        strSQL = strSQL + "   备注信息 = 备注信息 + '；' + '" + strBZXX + "'" + vbCr
                        strSQL = strSQL + " where 确认书号 =  '" + strQRSH + "'" + vbCr
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.ExecuteNonQuery()
                    End If
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo rollDatabase
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_GLJG)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objYejiList)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_YEJI)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_GYBL)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_SYBL)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_JSS)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_GY)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_HT)

            doUpdate_ES_HETONG_FPBL_JSYJ = True
            Exit Function
rollDatabase:
            objSqlTransaction.Rollback()
            GoTo errProc
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet_GLJG)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objYejiList)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_YEJI)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_GYBL)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_SYBL)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_JSS)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_GY)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objDataSet_HT)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(接案)(各种状态)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2009-05-21 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_JA_ALL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_JA_ALL = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_ALL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_ALL]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_ALL]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_ALL]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA_ALL]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_JA_ALL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_JA_ALL @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_JA_ALL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_JA_ALL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(接案)(各种状态)的数据
        ' 按[总计][片区][分行][明细]分级汇总
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2009-05-21 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_JA1_ALL( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_JA1_ALL = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_ALL]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_ALL]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_ALL]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_ALL]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_ALL]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_JA1_ALL)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_JA1_ALL @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_JA1_ALL))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_JA1_ALL = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(接案)(已审合同)的数据
        ' 按[总计][片区][分行][明细]分级汇总
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2009-05-21 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_JA1_YS( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_JA1_YS = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_YS]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_YS]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_YS]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_YS]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_JA1_YS]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_JA1_YS)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_JA1_YS @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_JA1_YS))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_JA1_YS = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务代理清单(已接未结完)的数据
        ' 按[总计][片区][分行][明细]分级汇总
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strKSRQ                    ：开始日期
        '     strZZRQ                    ：终止日期
        '     strBMDM                    ：部门代码
        '     objDataSet                 ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2009-05-21 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESYWDLQD_YJWJW( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByVal strBMDM As String, _
            ByRef objDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESYWDLQD_YJWJW = False
            objDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJW]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If strKSRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJW]未指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJW]无效的[开始日期]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If strZZRQ = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJW]未指定[终止日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESYWDLQD_YJWJW]无效的[终止日期]！"
                    GoTo errProc
                End If
                Dim objKSRQ As System.DateTime = CType(strKSRQ, System.DateTime)
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                If objKSRQ > objZZRQ Then
                    strKSRQ = objZZRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objKSRQ.ToString("yyyy-MM-dd")
                Else
                    strKSRQ = objKSRQ.ToString("yyyy-MM-dd")
                    strZZRQ = objZZRQ.ToString("yyyy-MM-dd")
                End If
                If strBMDM Is Nothing Then strBMDM = ""
                strBMDM = strBMDM.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESYWDLQD_YJWJW)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = "exec dbo.up_estate_es_getESYWDLQD_YJWJW @ksrq,@zzrq,@bmdm"

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                        objSqlCommand.Parameters.AddWithValue("@bmdm", strBMDM)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESYWDLQD_YJWJW))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objDataSet = objTempDataSet
            getDataSet_BB_ESYWDLQD_YJWJW = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 更改“地产_B_二手_交易合同结算书”的[计佣日期]
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strJSID              ：唯一标识
        '     strJYRQ              ：计佣日期
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改记录
        '     zengxianglin 2009-12-26 创建
        '----------------------------------------------------------------
        Public Function doUpdate_ES_HETONG_JSS_JYRQ( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strJSID As String, _
            ByVal strJYRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            doUpdate_ES_HETONG_JSS_JYRQ = False
            strErrMsg = ""

            Try
                '检查
                '====================================================================================================================
                If strJSID Is Nothing Then strJSID = ""
                strJSID = strJSID.Trim
                If strJSID = "" Then
                    '不用处理
                    Exit Try
                End If
                '====================================================================================================================
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_JSS_JYRQ]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                '====================================================================================================================
                If strJYRQ Is Nothing Then strJYRQ = ""
                strJYRQ = strJYRQ.Trim
                If strJYRQ = "" Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_JSS_JYRQ]没有指定[计佣日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strJYRQ) = False Then
                    strErrMsg = "错误：[doUpdate_ES_HETONG_JSS_JYRQ]无效的[计佣日期][" + strJYRQ + "]！"
                    GoTo errProc
                End If
                '====================================================================================================================

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    strSQL = " update 地产_B_二手_交易合同结算书 set 计佣日期 = '" + strJYRQ + "' where 唯一标识 = '" + strJSID + "'"
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doUpdate_ES_HETONG_JSS_JYRQ = True
            Exit Function

errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“确认书号”获取“订购日期”
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：人员代码
        '     strQRSH              ：确认书号
        '     strDGRQ              ：(返回)订购日期
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改描述
        '     zengxianglin 2010-01-13 创建
        '----------------------------------------------------------------
        Public Function getDgrqByQrsh( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByRef strDGRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objDataSet As System.Data.DataSet
            Dim strSQL As String

            getDgrqByQrsh = False
            strDGRQ = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[getDgrqByQrsh]中没有指定[用户标识]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strQRSH Is Nothing Then strQRSH = ""
                strQRSH = strQRSH.Trim()

                '获取信息
                strSQL = ""
                strSQL = strSQL + " select 交易日期 from 地产_V_全部交易" + vbCr
                strSQL = strSQL + " where 交易编号 = '" + strQRSH + "'" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, strUserId, strPassword, strSQL, objDataSet) = False Then
                    GoTo errProc
                End If

                '返回信息
                If objDataSet.Tables(0).Rows.Count > 0 Then
                    strDGRQ = objPulicParameters.getObjectValue(objDataSet.Tables(0).Rows(0).Item(0), "", "yyyy-MM-dd")
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getDgrqByQrsh = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(私佣)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     intTJND                    ：统计年度
        '     intTJYD                    ：统计月度
        '     intYJZR                    ：月截止日
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2010-01-18 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_SY_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal intTJND As Integer, _
            ByVal intTJYD As Integer, _
            ByVal intYJZR As Integer, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_SY_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]未指定[操作人员]！"
                    GoTo errProc
                End If

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_SY_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESJYQD_SY(@tjnd,@tjyd,@yjzr,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.经办人员名称,a.计佣标准,a.经办单位名称,a.团队编号,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@tjnd", intTJND)
                        objSqlCommand.Parameters.AddWithValue("@tjyd", intTJYD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_SY_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_SY_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(公佣)的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     intTJND                    ：统计年度
        '     intTJYD                    ：统计月度
        '     intYJZR                    ：月截止日
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2010-01-18 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_GY_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal intTJND As Integer, _
            ByVal intTJYD As Integer, _
            ByVal intYJZR As Integer, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_GY_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]未指定[操作人员]！"
                    GoTo errProc
                End If

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_GY_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESJYQD_GY(@tjnd,@tjyd,@yjzr,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.经办人员名称,a.计佣标准,a.直管标记,a.经办单位名称,a.团队编号,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@tjnd", intTJND)
                        objSqlCommand.Parameters.AddWithValue("@tjyd", intTJYD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_GY_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_GY_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务佣金分配表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     intTJND                    ：统计年度
        '     intTJYD                    ：统计月度
        '     intYJZR                    ：月截止日
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2010-01-20 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_YJFPB_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal intTJND As Integer, _
            ByVal intTJYD As Integer, _
            ByVal intYJZR As Integer, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_YJFPB_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]未指定[操作人员]！"
                    GoTo errProc
                End If

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_YJFPB_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESYJFAFPB(@tjnd,@tjyd,@yjzr,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.经办人员名称,a.计佣标准,a.直管标记,a.经办单位名称,a.团队编号,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@tjnd", intTJND)
                        objSqlCommand.Parameters.AddWithValue("@tjyd", intTJYD)
                        objSqlCommand.Parameters.AddWithValue("@yjzr", intYJZR)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_YJFPB_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_YJFPB_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(私佣)的数据(按自然月计算)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     strKSRQ                    ：开始日期(月初日期)
        '     strZZRQ                    ：终止日期(月末日期)
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改描述
        '     zengxianglin 2010-04-27 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_SY_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_SY_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]未指定[操作人员]！"
                    GoTo errProc
                End If
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]无效的开始日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                strKSRQ = objPulicParameters.getObjectValue(strKSRQ, "", "yyyy-MM-dd")
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_SY_X2]无效的结束日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                strZZRQ = objPulicParameters.getObjectValue(strZZRQ, "", "yyyy-MM-dd")

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_SY_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESJYQD_SY_ZRY(@ksrq,@zzrq,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.月末职级,a.经办人员,a.计佣标准,a.经办单位,a.团队编号,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", strKSRQ)
                        objSqlCommand.Parameters.AddWithValue("@zzrq", strZZRQ)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_SY_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_SY_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务计佣清单(公佣)的数据(按自然月计算)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     strKSRQ                    ：开始日期(月初日期)
        '     strZZRQ                    ：终止日期(月末日期)
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-04-27 创建
        '     zengxianglin 2011-01-18 更改
        '----------------------------------------------------------------
        Public Function getDataSet_BB_ESJYQD_GY_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_ESJYQD_GY_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]未指定[操作人员]！"
                    GoTo errProc
                End If
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]无效的开始日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                strKSRQ = objPulicParameters.getObjectValue(strKSRQ, "", "yyyy-MM-dd")
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_ESJYQD_GY_X2]无效的结束日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                strZZRQ = objPulicParameters.getObjectValue(strZZRQ, "", "yyyy-MM-dd")

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_ESJYQD_GY_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESJYQD_GY_ZRY(@ksrq,@zzrq,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.月末职级,a.经办人员,a.计佣标准,a.计佣档级,a.计佣职级,a.经办单位,a.团队编号,a.直管标记,a.接案年月,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", strKSRQ)
                        objSqlCommand.Parameters.AddWithValue("@zzrq", strZZRQ)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_ESJYQD_GY_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_ESJYQD_GY_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手业务佣金分配表的数据(按自然月计算)
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strCzyId                   ：操作人员
        '     strKSRQ                    ：开始日期(月初日期)
        '     strZZRQ                    ：终止日期(月末日期)
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-04-27 创建
        '     zengxianglin 2011-01-18 更改
        '----------------------------------------------------------------
        Public Function getDataSet_BB_YJFPB_X2( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strCzyId As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_YJFPB_X2 = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strCzyId Is Nothing Then strCzyId = ""
                strCzyId = strCzyId.Trim
                If strCzyId = "" Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]未指定[操作人员]！"
                    GoTo errProc
                End If
                If strKSRQ Is Nothing Then strKSRQ = ""
                strKSRQ = strKSRQ.Trim
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]无效的开始日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                strKSRQ = objPulicParameters.getObjectValue(strKSRQ, "", "yyyy-MM-dd")
                If strZZRQ Is Nothing Then strZZRQ = ""
                strZZRQ = strZZRQ.Trim
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[getDataSet_BB_YJFPB_X2]无效的结束日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                strZZRQ = objPulicParameters.getObjectValue(strZZRQ, "", "yyyy-MM-dd")

                '是分行人员？
                Dim blnIS As Boolean = False
                If objdacCustomer.isFenghangRenyuan(strErrMsg, strUserId, strPassword, strCzyId, blnIS) = False Then
                    GoTo errProc
                End If
                Dim intCKXZ As Integer = 0
                If blnIS = True Then
                    intCKXZ = 1
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_YJFPB_X2)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.* from dbo.uf_estate_es_getESYJFAFPB_ZRY(@ksrq,@zzrq,@ckxz,@czry,@jcsj) a" + vbCr
                        strSQL = strSQL + " order by a.月末职级,a.经办人员,a.计佣标准,a.状态标志,a.计佣职级,a.计佣档级,a.经办单位,a.团队编号,a.直管标记,a.接案年月,a.显示级别,a.交易类型,a.计佣日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        objSqlCommand.Parameters.AddWithValue("@ksrq", strKSRQ)
                        objSqlCommand.Parameters.AddWithValue("@zzrq", strZZRQ)
                        objSqlCommand.Parameters.AddWithValue("@ckxz", intCKXZ)
                        objSqlCommand.Parameters.AddWithValue("@czry", strCzyId)
                        objSqlCommand.Parameters.AddWithValue("@jcsj", Now)
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_YJFPB_X2))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_YJFPB_X2 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 根据物业信息数据集计算[物业信息]的web格式(买卖)
        '     objWYSJ：[地产_B_二手_物业买卖]数据
        ' 更改
        '     zengxianglin 2010-12-27 创建
        '----------------------------------------------------------------
        Public Function getWYXX_MM(ByVal objWYSJ As System.Collections.Specialized.NameValueCollection) As String

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            Dim strWYXX As String = ""

            Try
                If objWYSJ Is Nothing Then
                    Exit Try
                End If

                strWYXX = "房源编号："
                strWYXX = strWYXX + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FYBH), "")
                strWYXX = strWYXX + "；<br>地址：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWDZ), "")
                strWYXX = strWYXX + "；房产证：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FCZH), "")
                strWYXX = strWYXX + "；<br>楼盘：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LP), "")
                strWYXX = strWYXX + "，栋别：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LD), "")
                strWYXX = strWYXX + "，单元：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DY), "")
                strWYXX = strWYXX + "；<br>行政区域：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_SZQYMC), "")
                strWYXX = strWYXX + "，建筑面积：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_MJ), 0.0).ToString("0.0000")
                strWYXX = strWYXX + "平方米，建成时间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JCSJ), "", "yyyy-MM-dd")
                strWYXX = strWYXX + "，楼龄：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LL), "")
                strWYXX = strWYXX + "年；<br>空间类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_KJLX), "")
                strWYXX = strWYXX + "，房屋性质：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWXZ), "")
                strWYXX = strWYXX + "；<br>楼高共" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LG), "")
                strWYXX = strWYXX + "层，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_DTSL), "")
                strWYXX = strWYXX + "条梯，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LCHS), "")
                strWYXX = strWYXX + "户，属楼盘第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LPQS), "")
                strWYXX = strWYXX + "期；<br>朝向：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZX), "")
                strWYXX = strWYXX + "；<br>物业属性：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WYXZMC), "")
                strWYXX = strWYXX + "；<br>装修档次：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZXDC), "")
                strWYXX = strWYXX + "，装修年限：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZXNX), "")
                strWYXX = strWYXX + "；<br>噪音影响：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_ZYYX), "")
                strWYXX = strWYXX + "，家具设备：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JJSB), "")
                strWYXX = strWYXX + "；<br>楼宇交通：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LYJT), "")
                strWYXX = strWYXX + "，间隔：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_FWJG), "")
                strWYXX = strWYXX + "；<br>景观类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGLX), "")
                strWYXX = strWYXX + "；<br>拥有上述景观的房间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_JGFS), "")
                strWYXX = strWYXX + "个，所在楼层：第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_LC), "")
                strWYXX = strWYXX + "层，卧室数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_WSSL), "")
                strWYXX = strWYXX + "个，阳台数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_MM_YTSL), "")
                strWYXX = strWYXX + "个"
            Catch ex As Exception
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            getWYXX_MM = strWYXX

        End Function

        '----------------------------------------------------------------
        ' 根据物业信息数据集计算[物业信息]的web格式(租赁)
        '     objWYSJ：[地产_B_二手_物业租赁]数据
        ' 更改
        '     zengxianglin 2010-12-27 创建
        '----------------------------------------------------------------
        Public Function getWYXX_ZL(ByVal objWYSJ As System.Collections.Specialized.NameValueCollection) As String

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            Dim strWYXX As String = ""

            Try
                If objWYSJ Is Nothing Then
                    Exit Try
                End If

                strWYXX = "房源编号："
                strWYXX = strWYXX + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FYBH), "")
                strWYXX = strWYXX + "；<br>地址：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWDZ), "")
                strWYXX = strWYXX + "；房产证：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FCZH), "")
                strWYXX = strWYXX + "；<br>楼盘：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LP), "")
                strWYXX = strWYXX + "，栋别：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LD), "")
                strWYXX = strWYXX + "，单元：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DY), "")
                strWYXX = strWYXX + "；<br>行政区域：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_SZQYMC), "")
                strWYXX = strWYXX + "，建筑面积：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_MJ), 0.0).ToString("0.0000")
                strWYXX = strWYXX + "平方米，建成时间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JCSJ), "", "yyyy-MM-dd")
                strWYXX = strWYXX + "，楼龄：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LL), "")
                strWYXX = strWYXX + "年；<br>空间类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_KJLX), "")
                strWYXX = strWYXX + "，房屋性质：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWXZ), "")
                strWYXX = strWYXX + "；<br>楼高共" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LG), "")
                strWYXX = strWYXX + "层，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_DTSL), "")
                strWYXX = strWYXX + "条梯，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LCHS), "")
                strWYXX = strWYXX + "户，属楼盘第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LPQS), "")
                strWYXX = strWYXX + "期；<br>朝向：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZX), "")
                strWYXX = strWYXX + "；<br>物业属性：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WYXZMC), "")
                strWYXX = strWYXX + "；<br>装修档次：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZXDC), "")
                strWYXX = strWYXX + "，装修年限：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZXNX), "")
                strWYXX = strWYXX + "；<br>噪音影响：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_ZYYX), "")
                strWYXX = strWYXX + "，家具设备：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JJSB), "")
                strWYXX = strWYXX + "；<br>楼宇交通：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LYJT), "")
                strWYXX = strWYXX + "，间隔：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_FWJG), "")
                strWYXX = strWYXX + "；<br>景观类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGLX), "")
                strWYXX = strWYXX + "；<br>拥有上述景观的房间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_JGFS), "")
                strWYXX = strWYXX + "个，所在楼层：第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_LC), "")
                strWYXX = strWYXX + "层，卧室数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_WSSL), "")
                strWYXX = strWYXX + "个，阳台数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_ZL_YTSL), "")
                strWYXX = strWYXX + "个"
            Catch ex As Exception
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            getWYXX_ZL = strWYXX

        End Function

        '----------------------------------------------------------------
        ' 根据物业信息数据集计算[物业信息]的web格式(其他)
        '     objWYSJ：[地产_B_二手_物业其他]数据
        ' 更改
        '     zengxianglin 2010-12-27 创建
        '----------------------------------------------------------------
        Public Function getWYXX_QT(ByVal objWYSJ As System.Collections.Specialized.NameValueCollection) As String

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters

            Dim strWYXX As String = ""

            Try
                If objWYSJ Is Nothing Then
                    Exit Try
                End If

                strWYXX = "房源编号："
                strWYXX = strWYXX + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FYBH), "")
                strWYXX = strWYXX + "；<br>地址：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWDZ), "")
                strWYXX = strWYXX + "；房产证：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FCZH), "")
                strWYXX = strWYXX + "；<br>楼盘：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LP), "")
                strWYXX = strWYXX + "，栋别：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LD), "")
                strWYXX = strWYXX + "，单元：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DY), "")
                strWYXX = strWYXX + "；<br>行政区域：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_SZQYMC), "")
                strWYXX = strWYXX + "，建筑面积：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_MJ), 0.0).ToString("0.0000")
                strWYXX = strWYXX + "平方米，建成时间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JCSJ), "", "yyyy-MM-dd")
                strWYXX = strWYXX + "，楼龄：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LL), "")
                strWYXX = strWYXX + "年；<br>空间类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_KJLX), "")
                strWYXX = strWYXX + "，房屋性质：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWXZ), "")
                strWYXX = strWYXX + "；<br>楼高共" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LG), "")
                strWYXX = strWYXX + "层，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_DTSL), "")
                strWYXX = strWYXX + "条梯，本层有" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LCHS), "")
                strWYXX = strWYXX + "户，属楼盘第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LPQS), "")
                strWYXX = strWYXX + "期；<br>朝向：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZX), "")
                strWYXX = strWYXX + "；<br>物业属性：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WYXZMC), "")
                strWYXX = strWYXX + "；<br>装修档次：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZXDC), "")
                strWYXX = strWYXX + "，装修年限：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZXNX), "")
                strWYXX = strWYXX + "；<br>噪音影响：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_ZYYX), "")
                strWYXX = strWYXX + "，家具设备：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JJSB), "")
                strWYXX = strWYXX + "；<br>楼宇交通：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LYJT), "")
                strWYXX = strWYXX + "，间隔：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_FWJG), "")
                strWYXX = strWYXX + "；<br>景观类型：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGLX), "")
                strWYXX = strWYXX + "；<br>拥有上述景观的房间：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_JGFS), "")
                strWYXX = strWYXX + "个，所在楼层：第" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_LC), "")
                strWYXX = strWYXX + "层，卧室数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_WSSL), "")
                strWYXX = strWYXX + "个，阳台数量：" + objPulicParameters.getObjectValue(objWYSJ.Item(Josco.JSOA.Common.Data.estateErshouData.FIELD_DC_B_ES_WUYE_QT_YTSL), "")
                strWYXX = strWYXX + "个"
            Catch ex As Exception
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            getWYXX_QT = strWYXX

        End Function

        '----------------------------------------------------------------
        ' 标记“地产_B_二手_交易合同”解除合同
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-30 创建
        '----------------------------------------------------------------
        Public Function doMarkJiechu_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doMarkJiechu_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doMarkJiechu_ES_HETONG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strQRSH
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                    strSQL = strSQL + "   合同标志 = 合同标志 & 0xEF + 1" + vbCr
                    strSQL = strSQL + "  ,解除日期 = @jcrq" + vbCr
                    strSQL = strSQL + " where 确认书号 = @oldkey" + vbCr
                    strSQL = strSQL + " and   合同标志 & 0x1 = 0" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.Parameters.AddWithValue("@jcrq", CType(Now.ToString("yyyy-MM-dd"), System.DateTime))
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doMarkJiechu_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 标记“地产_B_二手_交易合同”存在坏账
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：用户标识
        '     strPassword          ：用户密码
        '     strQRSH              ：确认书号
        '     dblHZJE              ：坏账金额
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2010-12-30 创建
        '----------------------------------------------------------------
        Public Function doMarkHuaizhang_ES_HETONG( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strQRSH As String, _
            ByVal dblHZJE As Double) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            doMarkHuaizhang_ES_HETONG = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[doMarkHuaizhang_ES_HETONG]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQRSH Is Nothing Then strQRSH = ""
                If strQRSH = "" Then
                    Exit Try
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '开始事务
                Try
                    objSqlTransaction = objSqlConnection.BeginTransaction()
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '处理
                Try
                    objSqlCommand = objSqlConnection.CreateCommand()
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.Transaction = objSqlTransaction
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '计算SQL
                    Dim strOldKey As String = strQRSH
                    strSQL = ""
                    strSQL = strSQL + " update 地产_B_二手_交易合同 set" + vbCr
                    strSQL = strSQL + "   合同标志 = 合同标志 & 0xDF + 2" + vbCr
                    strSQL = strSQL + "  ,坏账日期 = @hzrq" + vbCr
                    strSQL = strSQL + "  ,坏账金额 = @hzje" + vbCr
                    strSQL = strSQL + " where 确认书号 = @oldkey" + vbCr
                    strSQL = strSQL + " and   合同标志 & 0x2 = 0" + vbCr
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@oldkey", strOldKey)
                    objSqlCommand.Parameters.AddWithValue("@hzrq", CType(Now.ToString("yyyy-MM-dd"), System.DateTime))
                    objSqlCommand.Parameters.AddWithValue("@hzje", dblHZJE)
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            doMarkHuaizhang_ES_HETONG = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 买卖业务列表打印的数据集(1行最多显示4个单元9个业务员)
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2011-01-03 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_MM_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As System.Data.DataSet) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_MM_PRN = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '计算最大物业数目
                Dim intMaxNum_DY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_物业买卖 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_DY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_DY < 1 Then intMaxNum_DY = 1
                If intMaxNum_DY > 4 Then intMaxNum_DY = 4

                '计算最大私佣业务员数目
                Dim intMaxNum_RY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_交易合同分配比例 where 状态标志&0x1=0x1 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_MM_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_RY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_RY < 1 Then intMaxNum_RY = 1
                If intMaxNum_RY > 9 Then intMaxNum_RY = 9

                '将纵表转换为横表显示
                Dim strXH As String = ""
                '*******************************************************************************************************************************************************************
                '创建结果的横表
                '*******************************************************************************************************************************************************************
                strSQL = ""
                strSQL = strSQL + "create table #tempTable01 " + vbCr
                strSQL = strSQL + "(" + vbCr
                strSQL = strSQL + "系统用00   integer      NULL DEFAULT(0)," + vbCr
                '交易共性列
                strSQL = strSQL + "交易类型   varchar(20)  NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "交易编号   varchar(20)  null default('')," + vbCr
                strSQL = strSQL + "交易日期   datetime     null," + vbCr
                strSQL = strSQL + "交易状态   integer      null default(1)," + vbCr
                strSQL = strSQL + "业主名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "客户名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "物业地址   varchar(640) null default('')," + vbCr
                strSQL = strSQL + "交易价格   money        null default(0)," + vbCr
                strSQL = strSQL + "交易面积   money        null default(0)," + vbCr
                strSQL = strSQL + "交易月租金 money        null default(0)," + vbCr
                '买卖确认书实际列
                strSQL = strSQL + "唯一标识         varchar(36)          null default('')," + vbCr
                strSQL = strSQL + "确认书号         varchar(20)          null default('')," + vbCr
                strSQL = strSQL + "订购日期         datetime             null," + vbCr
                strSQL = strSQL + "订购状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "甲方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "甲方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "甲方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "甲方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "乙方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "乙方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "房屋地址         varchar(640)         null default('')," + vbCr
                strSQL = strSQL + "交易总价格       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "交易总面积       numeric(10,4)        null default(0)," + vbCr
                strSQL = strSQL + "甲方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "乙方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "代理费折扣       numeric(8,4)         null default(1)," + vbCr
                strSQL = strSQL + "计划交易日期     datetime             null," + vbCr
                strSQL = strSQL + "交楼日期约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "计划交楼日期     datetime             null," + vbCr
                strSQL = strSQL + "交楼状况约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "付款方式约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "税费支付约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "房款托管约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "登记人码         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记人名         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记日期         datetime             null," + vbCr
                strSQL = strSQL + "客源编号         varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册地址         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册费           money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "实收佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "合作佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭机构         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭银行         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭成数         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭年限         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "业主区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "售后意向         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "剩余物业         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "购买目的         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "备注信息         varchar(600)         null default('')," + vbCr
                '买卖确认书虚拟列
                strSQL = strSQL + "交楼日期约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "交楼状况约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "税费支付约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "房款托管约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "付款方式约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "甲方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "乙方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租赁开始         datetime             NULL," + vbCr
                strSQL = strSQL + "租赁结束         datetime             NULL," + vbCr
                strSQL = strSQL + "水电煤气         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "电话费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "管理费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租赁发票         varchar(20)          NULL DEFAULT('')," + vbCr
                '合同实际列
                strSQL = strSQL + "合同编号         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同类型         integer              null default(1)," + vbCr
                strSQL = strSQL + "合同日期         datetime             null," + vbCr
                strSQL = strSQL + "合同状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "付款方式         varchar(23)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "统计日期         datetime             null," + vbCr
                strSQL = strSQL + "结案日期         datetime             null," + vbCr
                strSQL = strSQL + "按揭返还         money                null default(0)," + vbCr
                strSQL = strSQL + "合同标志         integer              NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "解除日期         datetime             NULL," + vbCr
                strSQL = strSQL + "坏账金额         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "坏账日期         datetime             NULL," + vbCr
                '合同虚拟列
                strSQL = strSQL + "合同唯一标识     varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人码     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人名     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记日期     datetime             null," + vbCr
                strSQL = strSQL + "合同备注信息     varchar(120)         null default('')," + vbCr
                strSQL = strSQL + "合同类型名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同状态名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "付款方式名称     varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同解除         varchar(10)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "坏账合同         varchar(10)          NULL DEFAULT('')," + vbCr
                '买卖确认书物业列(纵变横)
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '物业虚拟列
                    strSQL = strSQL + "单元房屋地址" + strXH + "     varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "单元面积" + strXH + "         numeric(10,4)        null default(0)," + vbCr
                    strSQL = strSQL + "单元户型" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "物业性质名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "单元户型名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    '物业实际列
                    strSQL = strSQL + "房产证号" + strXH + "         varchar(120)         null default('')," + vbCr
                    strSQL = strSQL + "房产证地址" + strXH + "       varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "房源编号" + strXH + "         varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "座向" + strXH + "             varchar(8)           null default('')," + vbCr
                    strSQL = strSQL + "楼高" + strXH + "             integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层" + strXH + "             integer              null default(1)," + vbCr
                    strSQL = strSQL + "楼龄" + strXH + "             integer              null default(0)," + vbCr
                    strSQL = strSQL + "物业性质" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域" + strXH + "         varchar(11)          null default('')," + vbCr
                    strSQL = strSQL + "交易金额" + strXH + "         numeric(16,2)        null default(0)," + vbCr
                    strSQL = strSQL + "楼盘" + strXH + "             varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼栋" + strXH + "             varchar(24)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单元" + strXH + "             varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "建成时间" + strXH + "         datetime             NULL," + vbCr
                    strSQL = strSQL + "空间类型" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋性质" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修档次" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修年限" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "噪音影响" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "家具设备" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼宇交通" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋间隔" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观类型" + strXH + "         varchar(20)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观房数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "卧室数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "阳台数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "花园面积" + strXH + "         numeric(10,4)        NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "电梯数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层户数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼盘期数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                Next
                '买卖确认书业务员列(纵变横)
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '人员虚拟列
                    strSQL = strSQL + "人员名称" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位名称" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级名称" + strXH + "     varchar(80)          NULL DEFAULT('')," + vbCr
                    '人员实际列
                    strSQL = strSQL + "人员代码" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位代码" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "团队编号" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "所属分组" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级" + strXH + "         varchar(23)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "分配比例" + strXH + "         numeric(8,4)         NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "直管标记" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    If i = intMaxNum_RY - 1 Then
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)" + vbCr
                    Else
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)," + vbCr
                    End If
                Next
                strSQL = strSQL + ")" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strQueryDG][strQueryHT][strQueryDY][strQueryRY][权限控制]搜索[确认书]并写入结果表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "insert into #tempTable01 (" + vbCr
                strSQL = strSQL + "交易类型,交易编号,交易日期,交易状态,业主名称,客户名称,物业地址,交易价格,交易面积,交易月租金," + vbCr
                strSQL = strSQL + "唯一标识,确认书号,订购日期,订购状态," + vbCr
                strSQL = strSQL + "甲方名称,甲方证件类型,甲方证照号码,甲方代理人,甲方联系地址,甲方联系电话," + vbCr
                strSQL = strSQL + "乙方名称,乙方证件类型,乙方证照号码,乙方代理人,乙方联系地址,乙方联系电话," + vbCr
                strSQL = strSQL + "房屋地址,交易总价格,交易总面积,甲方代理费,乙方代理费,代理费折扣," + vbCr
                strSQL = strSQL + "计划交易日期,交楼日期约定,计划交楼日期,交楼状况约定,付款方式约定,税费支付约定,房款托管约定," + vbCr
                strSQL = strSQL + "登记人码,登记人名,登记日期,客源编号,查册地址,查册费,实收佣金,合作佣金,按揭机构,按揭银行,按揭成数,按揭年限," + vbCr
                strSQL = strSQL + "业主区码,业主区名,业主来源,业源其他,业主电邮,售后意向,剩余物业," + vbCr
                strSQL = strSQL + "买家区码,买家区名,客户来源,客源其他,客户电邮,购买目的," + vbCr
                strSQL = strSQL + "备注信息," + vbCr
                strSQL = strSQL + "租赁开始,租赁结束,水电煤气,电话费,管理费,租赁发票" + vbCr
                strSQL = strSQL + ")" + vbCr
                strSQL = strSQL + "select " + vbCr
                strSQL = strSQL + "'二手.买卖' as 交易类型,a.确认书号 as 交易编号,a.订购日期 as 交易日期,a.订购状态 as 交易状态,a.甲方名称 as 业主名称,a.乙方名称 as 客户名称,a.房屋地址 as 物业地址,a.交易总价格 as 交易价格,a.交易总面积 as 交易面积,cast(0.0 as money) as 交易月租金," + vbCr
                strSQL = strSQL + "a.唯一标识,a.确认书号,a.订购日期,a.订购状态," + vbCr
                strSQL = strSQL + "a.甲方名称,a.甲方证件类型,a.甲方证照号码,a.甲方代理人,a.甲方联系地址,a.甲方联系电话," + vbCr
                strSQL = strSQL + "a.乙方名称,a.乙方证件类型,a.乙方证照号码,a.乙方代理人,a.乙方联系地址,a.乙方联系电话," + vbCr
                strSQL = strSQL + "a.房屋地址,a.交易总价格,a.交易总面积,a.甲方代理费,a.乙方代理费,a.代理费折扣," + vbCr
                strSQL = strSQL + "a.计划交易日期,a.交楼日期约定,a.计划交楼日期,a.交楼状况约定,a.付款方式约定,a.税费支付约定,a.房款托管约定," + vbCr
                strSQL = strSQL + "a.登记人码,a.登记人名,a.登记日期,a.客源编号,a.查册地址,a.查册费,a.实收佣金,a.合作佣金,a.按揭机构,a.按揭银行,a.按揭成数,a.按揭年限," + vbCr
                strSQL = strSQL + "a.业主区码,a.业主区名,a.业主来源,a.业源其他,a.业主电邮,a.售后意向,a.剩余物业," + vbCr
                strSQL = strSQL + "a.买家区码,a.买家区名,a.客户来源,a.客源其他,a.客户电邮,a.购买目的," + vbCr
                strSQL = strSQL + "a.备注信息," + vbCr
                strSQL = strSQL + "cast(null as datetime)  as 租赁开始,cast(null as datetime)  as 租赁结束,cast('' as varchar(20)) as 水电煤气,cast('' as varchar(20)) as 电话费,cast('' as varchar(20)) as 管理费,cast('' as varchar(20)) as 租赁发票" + vbCr
                strTempWhere = ""
                If strQueryDG = "" Then
                    strSQL = strSQL + "from 地产_B_二手_确认书买卖 a" + vbCr
                Else
                    strSQL = strSQL + "from" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.* from 地产_B_二手_确认书买卖 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDG + vbCr
                    strSQL = strSQL + ") a" + vbCr
                End If
                If strQueryHT <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_交易合同 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryHT + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") b on a.确认书号=b.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "b.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and b.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryDY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_物业买卖 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDY + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") c on a.确认书号=c.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "c.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryRY <> "" And blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf strQueryRY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                Else
                End If
                If strTempWhere <> "" Then
                    strSQL = strSQL + "where " + strTempWhere + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '计算确认书虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  交楼日期约定名称 = case when 交楼日期约定=0 then '收到房款当天' when 交楼日期约定=1 then '自行交接' when 交楼日期约定=2 then '其他约定' else '' end," + vbCr
                strSQL = strSQL + "  交楼状况约定名称 = case when 交楼状况约定=0 then '吉屋按现状' when 交楼状况约定=1 then '详见交付清单' when 交楼状况约定=2 then '带租约交付' else '' end," + vbCr
                strSQL = strSQL + "  税费支付约定名称 = case when 税费支付约定=0 then '各付各税' when 税费支付约定=1 then '甲方包税' when 税费支付约定=2 then '乙方包税' when 税费支付约定=3 then '其他' else '' end," + vbCr
                strSQL = strSQL + "  房款托管约定名称 = case when 房款托管约定=0 then '不托管房款' when 房款托管约定=1 then '托管房款' else '' end," + vbCr
                strSQL = strSQL + "  付款方式约定名称 = case when 付款方式约定=0 then '一次性付款' when 付款方式约定=1 then '亿城按揭' when 付款方式约定=2 then '其他按揭' else '' end," + vbCr
                strSQL = strSQL + "  甲方证件类型名称 = case when 甲方证件类型=0 then '身份证' when 甲方证件类型=1 then '护照' when 甲方证件类型=2 then '营业执照' else '' end," + vbCr
                strSQL = strSQL + "  乙方证件类型名称 = case when 乙方证件类型=0 then '身份证' when 乙方证件类型=1 then '护照' when 乙方证件类型=2 then '营业执照' else '' end" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同实际列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同编号 = b.合同编号," + vbCr
                strSQL = strSQL + "  合同类型 = b.合同类型," + vbCr
                strSQL = strSQL + "  合同日期 = b.合同日期," + vbCr
                strSQL = strSQL + "  合同状态 = b.合同状态," + vbCr
                strSQL = strSQL + "  付款方式 = b.付款方式," + vbCr
                strSQL = strSQL + "  统计日期 = b.统计日期," + vbCr
                strSQL = strSQL + "  结案日期 = b.结案日期," + vbCr
                strSQL = strSQL + "  按揭返还 = b.按揭返还," + vbCr
                strSQL = strSQL + "  合同标志 = b.合同标志," + vbCr
                strSQL = strSQL + "  解除日期 = b.解除日期," + vbCr
                strSQL = strSQL + "  坏账金额 = b.坏账金额," + vbCr
                strSQL = strSQL + "  坏账日期 = b.坏账日期," + vbCr
                strSQL = strSQL + "  合同唯一标识 = b.唯一标识," + vbCr
                strSQL = strSQL + "  合同登记人码 = b.登记人码," + vbCr
                strSQL = strSQL + "  合同登记人名 = b.登记人名," + vbCr
                strSQL = strSQL + "  合同登记日期 = b.登记日期," + vbCr
                strSQL = strSQL + "  合同备注信息 = b.备注信息 " + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_二手_交易合同 b on a.交易编号=b.确认书号" + vbCr
                strSQL = strSQL + "where b.确认书号 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同类型名称 = case when 合同类型 & 0x1 = 0x1 then '现楼买卖' when 合同类型 & 0x2 = 0x2 then '合同转让' when 合同类型 & 0x4 = 0x4 then '楼花转让' else '其他买卖' end," + vbCr
                strSQL = strSQL + "  合同状态名称 = case when 合同状态 & 3 = 0 then '未审' when 合同状态 & 3 = 1 then '已审' when 合同状态 & 2 = 2 then '完成' else '' end," + vbCr
                strSQL = strSQL + "  合同解除     = case when 合同标志 & 0x1 = 0x1 then '√' else '×' end," + vbCr
                strSQL = strSQL + "  坏账合同     = case when 合同标志 & 0x2 = 0x2 then '√' else '×' end" + vbCr
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  付款方式名称 = b.模版名称" + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                strSQL = strSQL + "where b.模版代码 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strWhere]搜索
                '*******************************************************************************************************************************************************************
                If strWhere <> "" Then
                    strSQL = strSQL + "update #tempTable01 set 系统用00 = 1" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "where " + strWhere + vbCr
                    strSQL = strSQL + "delete #tempTable01 where isnull(系统用00,0)=0" + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '物业信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @qrsh varchar(20)" + vbCr
                strSQL = strSQL + "declare @nxh  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @d_fwdz  varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_mj    money" + vbCr
                strSQL = strSQL + "declare @d_fczh  varchar(120)" + vbCr
                strSQL = strSQL + "declare @d_fczdz varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_fybh  varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_zx    varchar(8)" + vbCr
                strSQL = strSQL + "declare @d_lc    integer" + vbCr
                strSQL = strSQL + "declare @d_ll    integer" + vbCr
                strSQL = strSQL + "declare @d_jg    varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_wyxz  varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_szqy  varchar(11)" + vbCr
                strSQL = strSQL + "declare @d_jyje  money" + vbCr
                strSQL = strSQL + "declare @d_lp    varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_ld    varchar(24)" + vbCr
                strSQL = strSQL + "declare @d_dy    varchar(16)" + vbCr
                strSQL = strSQL + "declare @d_jcsj  datetime" + vbCr
                strSQL = strSQL + "declare @d_kjlx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwxz  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxdc  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxnx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zyyx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jjsb  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_lyjt  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwjg  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jglx  varchar(20)" + vbCr
                strSQL = strSQL + "declare @d_jgfs  integer" + vbCr
                strSQL = strSQL + "declare @d_lg    integer" + vbCr
                strSQL = strSQL + "declare @d_wssl  integer" + vbCr
                strSQL = strSQL + "declare @d_ytsl  integer" + vbCr
                strSQL = strSQL + "declare @d_hymj  money" + vbCr
                strSQL = strSQL + "declare @d_dtsl  integer" + vbCr
                strSQL = strSQL + "declare @d_lchs  integer" + vbCr
                strSQL = strSQL + "declare @d_lpqs  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @r_rydm  varchar(16)" + vbCr
                strSQL = strSQL + "declare @r_dwdm  varchar(12)" + vbCr
                strSQL = strSQL + "declare @r_tdbh  integer" + vbCr
                strSQL = strSQL + "declare @r_ssfz  varchar(60)" + vbCr
                strSQL = strSQL + "declare @r_ryzj  varchar(23)" + vbCr
                strSQL = strSQL + "declare @r_fpbl  money" + vbCr
                strSQL = strSQL + "declare @r_zgbj  integer" + vbCr
                strSQL = strSQL + "declare @r_ztbz  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare cursor_temp00 CURSOR for" + vbCr
                strSQL = strSQL + "select 交易编号" + vbCr
                strSQL = strSQL + "from #tempTable01" + vbCr
                strSQL = strSQL + "order by 交易编号" + vbCr
                strSQL = strSQL + "open cursor_temp00" + vbCr
                strSQL = strSQL + "fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "begin" + vbCr
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  房屋地址,面积,房产证号,房产证地址,房源编号,座向,楼层,楼龄,间隔,物业性质,所在区域,交易金额," + vbCr
                strSQL = strSQL + "  楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔," + vbCr
                strSQL = strSQL + "  景观类型,景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_物业买卖" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  order by 房屋地址" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "  @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "  @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址000 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积000     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型000     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号000     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址000   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号000     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向000         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层000         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄000         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质000     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域000     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额000     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘000         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋000         = @d_ld," + vbCr
                strSQL = strSQL + "      单元000         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间000     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型000     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质000     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次000     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限000     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响000     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备000     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通000     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔000     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型000     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数000     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高000         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量000     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量000     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积000     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量000     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数000     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数000     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址001 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积001     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型001     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号001     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址001   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号001     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向001         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层001         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄001         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质001     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域001     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额001     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘001         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋001         = @d_ld," + vbCr
                strSQL = strSQL + "      单元001         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间001     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型001     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质001     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次001     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限001     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响001     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备001     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通001     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔001     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型001     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数001     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高001         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量001     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量001     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积001     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量001     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数001     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数001     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址002 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积002     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型002     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号002     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址002   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号002     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向002         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层002         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄002         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质002     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域002     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额002     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘002         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋002         = @d_ld," + vbCr
                strSQL = strSQL + "      单元002         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间002     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型002     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质002     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次002     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限002     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响002     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备002     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通002     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔002     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型002     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数002     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高002         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量002     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量002     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积002     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量002     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数002     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数002     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址003 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积003     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型003     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号003     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址003   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号003     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向003         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层003         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄003         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质003     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域003     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额003     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘003         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋003         = @d_ld," + vbCr
                strSQL = strSQL + "      单元003         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间003     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型003     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质003     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次003     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限003     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响003     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备003     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通003     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔003     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型003     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数003     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高003         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量003     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量003     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积003     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量003     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数003     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数003     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "    @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "    @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                '*******************************************************************************************************************************************************************
                '业务员信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  人员代码,单位代码,团队编号,所属分组,人员职级,分配比例,直管标记,状态标志" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_交易合同分配比例" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  and   状态标志 & 0x1 = 0x1" + vbCr
                strSQL = strSQL + "  order by 单位代码,团队编号,人员职级,人员代码" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码000 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码000 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号000 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组000 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级000 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例000 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记000 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志000 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码001 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码001 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号001 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组001 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级001 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例001 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记001 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志001 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码002 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码002 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号002 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组002 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级002 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例002 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记002 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志002 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码003 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码003 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号003 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组003 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级003 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例003 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记003 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志003 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 4" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码004 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码004 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号004 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组004 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级004 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例004 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记004 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志004 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 5" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码005 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码005 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号005 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组005 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级005 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例005 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记005 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志005 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 6" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码006 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码006 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号006 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组006 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级006 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例006 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记006 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志006 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 7" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码007 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码007 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号007 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组007 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级007 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例007 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记007 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志007 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 8" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码008 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码008 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号008 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组008 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级008 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例008 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记008 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志008 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "end" + vbCr
                strSQL = strSQL + "close cursor_temp00" + vbCr
                strSQL = strSQL + "deallocate cursor_temp00" + vbCr
                '*******************************************************************************************************************************************************************
                '计算物业的其他显示字段
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  物业性质名称" + strXH + " = b.性质名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业性质 b on a.物业性质" + strXH + "=b.性质代码" + vbCr
                    strSQL = strSQL + "where b.性质代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.物业性质" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  所在区域名称" + strXH + " = b.区域名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_区域划分 b on a.所在区域" + strXH + "=b.区域代码" + vbCr
                    strSQL = strSQL + "where b.区域代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.所在区域" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单元户型名称" + strXH + " = b.间隔名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业间隔 b on a.单元户型" + strXH + "=b.间隔代码" + vbCr
                    strSQL = strSQL + "where b.间隔代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单元户型" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '计算业务员的其他显示字段
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员名称" + strXH + " = b.人员名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_人员 b on a.人员代码" + strXH + "=b.人员代码" + vbCr
                    strSQL = strSQL + "where b.人员代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单位名称" + strXH + " = b.组织名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_组织机构 b on a.单位代码" + strXH + "=b.组织代码" + vbCr
                    strSQL = strSQL + "where b.组织代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单位代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员职级名称" + strXH + " = b.职级名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_人事_职级定义 b on a.人员职级" + strXH + "=b.职级代码" + vbCr
                    strSQL = strSQL + "where b.职级代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员职级" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '获取结果数据
                strSQL = strSQL + "select a.* from #tempTable01 a order by a.交易日期" + vbCr
                '*******************************************************************************************************************************************************************
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objRetDataSet) = False Then
                    GoTo errProc
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getDataSet_ES_JYXX_MM_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 其他代办业务列表打印的数据集(1行最多显示4个单元9个业务员)
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2011-01-04 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_QT_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As System.Data.DataSet) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_QT_PRN = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '计算最大物业数目
                Dim intMaxNum_DY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_物业其他 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_DY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_DY < 1 Then intMaxNum_DY = 1
                If intMaxNum_DY > 4 Then intMaxNum_DY = 4

                '计算最大私佣业务员数目
                Dim intMaxNum_RY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_交易合同分配比例 where 状态标志&0x1=0x1 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_QT_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_RY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_RY < 1 Then intMaxNum_RY = 1
                If intMaxNum_RY > 9 Then intMaxNum_RY = 9

                '将纵表转换为横表显示
                Dim strXH As String = ""
                '*******************************************************************************************************************************************************************
                '创建结果的横表
                '*******************************************************************************************************************************************************************
                strSQL = ""
                strSQL = strSQL + "create table #tempTable01 " + vbCr
                strSQL = strSQL + "(" + vbCr
                strSQL = strSQL + "系统用00   integer      NULL DEFAULT(0)," + vbCr
                '交易共性列
                strSQL = strSQL + "交易类型   varchar(20)  NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "交易编号   varchar(20)  null default('')," + vbCr
                strSQL = strSQL + "交易日期   datetime     null," + vbCr
                strSQL = strSQL + "交易状态   integer      null default(1)," + vbCr
                strSQL = strSQL + "业主名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "客户名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "物业地址   varchar(640) null default('')," + vbCr
                strSQL = strSQL + "交易价格   money        null default(0)," + vbCr
                strSQL = strSQL + "交易面积   money        null default(0)," + vbCr
                strSQL = strSQL + "交易月租金 money        null default(0)," + vbCr
                '其他确认书实际列
                strSQL = strSQL + "唯一标识         varchar(36)          null default('')," + vbCr
                strSQL = strSQL + "确认书号         varchar(20)          null default('')," + vbCr
                strSQL = strSQL + "订购日期         datetime             null," + vbCr
                strSQL = strSQL + "订购状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "甲方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "甲方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "甲方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "甲方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "乙方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "乙方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "房屋地址         varchar(640)         null default('')," + vbCr
                strSQL = strSQL + "交易总价格       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "交易总面积       numeric(10,4)        null default(0)," + vbCr
                strSQL = strSQL + "甲方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "乙方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "代理费折扣       numeric(8,4)         null default(1)," + vbCr
                strSQL = strSQL + "计划交易日期     datetime             null," + vbCr
                strSQL = strSQL + "交楼日期约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "计划交楼日期     datetime             null," + vbCr
                strSQL = strSQL + "交楼状况约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "付款方式约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "税费支付约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "房款托管约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "登记人码         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记人名         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记日期         datetime             null," + vbCr
                strSQL = strSQL + "客源编号         varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册地址         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册费           money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "实收佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "合作佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭机构         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭银行         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭成数         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭年限         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "业主区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "售后意向         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "剩余物业         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "购买目的         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "备注信息         varchar(600)         null default('')," + vbCr
                '其他确认书虚拟列
                strSQL = strSQL + "交楼日期约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "交楼状况约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "税费支付约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "房款托管约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "付款方式约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "甲方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "乙方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租赁开始         datetime             NULL," + vbCr
                strSQL = strSQL + "租赁结束         datetime             NULL," + vbCr
                strSQL = strSQL + "水电煤气         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "电话费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "管理费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租赁发票         varchar(20)          NULL DEFAULT('')," + vbCr
                '合同实际列
                strSQL = strSQL + "合同编号         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同类型         integer              null default(1)," + vbCr
                strSQL = strSQL + "合同日期         datetime             null," + vbCr
                strSQL = strSQL + "合同状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "付款方式         varchar(23)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "统计日期         datetime             null," + vbCr
                strSQL = strSQL + "结案日期         datetime             null," + vbCr
                strSQL = strSQL + "按揭返还         money                null default(0)," + vbCr
                strSQL = strSQL + "合同标志         integer              NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "解除日期         datetime             NULL," + vbCr
                strSQL = strSQL + "坏账金额         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "坏账日期         datetime             NULL," + vbCr
                '合同虚拟列
                strSQL = strSQL + "合同唯一标识     varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人码     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人名     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记日期     datetime             null," + vbCr
                strSQL = strSQL + "合同备注信息     varchar(120)         null default('')," + vbCr
                strSQL = strSQL + "合同类型名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同状态名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "付款方式名称     varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同解除         varchar(10)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "坏账合同         varchar(10)          NULL DEFAULT('')," + vbCr
                '其他确认书物业列(纵变横)
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '物业虚拟列
                    strSQL = strSQL + "单元房屋地址" + strXH + "     varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "单元面积" + strXH + "         numeric(10,4)        null default(0)," + vbCr
                    strSQL = strSQL + "单元户型" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "物业性质名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "单元户型名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    '物业实际列
                    strSQL = strSQL + "房产证号" + strXH + "         varchar(120)         null default('')," + vbCr
                    strSQL = strSQL + "房产证地址" + strXH + "       varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "房源编号" + strXH + "         varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "座向" + strXH + "             varchar(8)           null default('')," + vbCr
                    strSQL = strSQL + "楼高" + strXH + "             integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层" + strXH + "             integer              null default(1)," + vbCr
                    strSQL = strSQL + "楼龄" + strXH + "             integer              null default(0)," + vbCr
                    strSQL = strSQL + "物业性质" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域" + strXH + "         varchar(11)          null default('')," + vbCr
                    strSQL = strSQL + "交易金额" + strXH + "         numeric(16,2)        null default(0)," + vbCr
                    strSQL = strSQL + "楼盘" + strXH + "             varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼栋" + strXH + "             varchar(24)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单元" + strXH + "             varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "建成时间" + strXH + "         datetime             NULL," + vbCr
                    strSQL = strSQL + "空间类型" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋性质" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修档次" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修年限" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "噪音影响" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "家具设备" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼宇交通" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋间隔" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观类型" + strXH + "         varchar(20)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观房数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "卧室数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "阳台数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "花园面积" + strXH + "         numeric(10,4)        NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "电梯数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层户数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼盘期数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                Next
                '其他确认书业务员列(纵变横)
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '人员虚拟列
                    strSQL = strSQL + "人员名称" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位名称" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级名称" + strXH + "     varchar(80)          NULL DEFAULT('')," + vbCr
                    '人员实际列
                    strSQL = strSQL + "人员代码" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位代码" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "团队编号" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "所属分组" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级" + strXH + "         varchar(23)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "分配比例" + strXH + "         numeric(8,4)         NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "直管标记" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    If i = intMaxNum_RY - 1 Then
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)" + vbCr
                    Else
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)," + vbCr
                    End If
                Next
                strSQL = strSQL + ")" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strQueryDG][strQueryHT][strQueryDY][strQueryRY][权限控制]搜索[确认书]并写入结果表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "insert into #tempTable01 (" + vbCr
                strSQL = strSQL + "交易类型,交易编号,交易日期,交易状态,业主名称,客户名称,物业地址,交易价格,交易面积,交易月租金," + vbCr
                strSQL = strSQL + "唯一标识,确认书号,订购日期,订购状态," + vbCr
                strSQL = strSQL + "甲方名称,甲方证件类型,甲方证照号码,甲方代理人,甲方联系地址,甲方联系电话," + vbCr
                strSQL = strSQL + "乙方名称,乙方证件类型,乙方证照号码,乙方代理人,乙方联系地址,乙方联系电话," + vbCr
                strSQL = strSQL + "房屋地址,交易总价格,交易总面积,甲方代理费,乙方代理费,代理费折扣," + vbCr
                strSQL = strSQL + "计划交易日期,交楼日期约定,计划交楼日期,交楼状况约定,付款方式约定,税费支付约定,房款托管约定," + vbCr
                strSQL = strSQL + "登记人码,登记人名,登记日期,客源编号,查册地址,查册费,实收佣金,合作佣金,按揭机构,按揭银行,按揭成数,按揭年限," + vbCr
                strSQL = strSQL + "业主区码,业主区名,业主来源,业源其他,业主电邮,售后意向,剩余物业," + vbCr
                strSQL = strSQL + "买家区码,买家区名,客户来源,客源其他,客户电邮,购买目的," + vbCr
                strSQL = strSQL + "备注信息," + vbCr
                strSQL = strSQL + "租赁开始,租赁结束,水电煤气,电话费,管理费,租赁发票" + vbCr
                strSQL = strSQL + ")" + vbCr
                strSQL = strSQL + "select " + vbCr
                strSQL = strSQL + "'二手.其他' as 交易类型,a.确认书号 as 交易编号,a.订购日期 as 交易日期,a.订购状态 as 交易状态,a.甲方名称 as 业主名称,a.乙方名称 as 客户名称,a.房屋地址 as 物业地址,a.交易总价格 as 交易价格,a.交易总面积 as 交易面积,cast(0.0 as money) as 交易月租金," + vbCr
                strSQL = strSQL + "a.唯一标识,a.确认书号,a.订购日期,a.订购状态," + vbCr
                strSQL = strSQL + "a.甲方名称,a.甲方证件类型,a.甲方证照号码,a.甲方代理人,a.甲方联系地址,a.甲方联系电话," + vbCr
                strSQL = strSQL + "a.乙方名称,a.乙方证件类型,a.乙方证照号码,a.乙方代理人,a.乙方联系地址,a.乙方联系电话," + vbCr
                strSQL = strSQL + "a.房屋地址,a.交易总价格,a.交易总面积,a.甲方代理费,a.乙方代理费,a.代理费折扣," + vbCr
                strSQL = strSQL + "a.计划交易日期,a.交楼日期约定,a.计划交楼日期,a.交楼状况约定,a.付款方式约定,a.税费支付约定,a.房款托管约定," + vbCr
                strSQL = strSQL + "a.登记人码,a.登记人名,a.登记日期,a.客源编号,a.查册地址,a.查册费,a.实收佣金,a.合作佣金,a.按揭机构,a.按揭银行,a.按揭成数,a.按揭年限," + vbCr
                strSQL = strSQL + "a.业主区码,a.业主区名,a.业主来源,a.业源其他,a.业主电邮,a.售后意向,a.剩余物业," + vbCr
                strSQL = strSQL + "a.买家区码,a.买家区名,a.客户来源,a.客源其他,a.客户电邮,a.购买目的," + vbCr
                strSQL = strSQL + "a.备注信息," + vbCr
                strSQL = strSQL + "cast(null as datetime)  as 租赁开始,cast(null as datetime)  as 租赁结束,cast('' as varchar(20)) as 水电煤气,cast('' as varchar(20)) as 电话费,cast('' as varchar(20)) as 管理费,cast('' as varchar(20)) as 租赁发票" + vbCr
                strTempWhere = ""
                If strQueryDG = "" Then
                    strSQL = strSQL + "from 地产_B_二手_确认书其他 a" + vbCr
                Else
                    strSQL = strSQL + "from" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.* from 地产_B_二手_确认书其他 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDG + vbCr
                    strSQL = strSQL + ") a" + vbCr
                End If
                If strQueryHT <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_交易合同 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryHT + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") b on a.确认书号=b.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "b.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and b.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryDY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_物业其他 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDY + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") c on a.确认书号=c.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "c.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryRY <> "" And blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf strQueryRY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                Else
                End If
                If strTempWhere <> "" Then
                    strSQL = strSQL + " where " + strTempWhere + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '计算确认书虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  交楼日期约定名称 = case when 交楼日期约定=0 then '收到房款当天' when 交楼日期约定=1 then '自行交接' when 交楼日期约定=2 then '其他约定' else '' end," + vbCr
                strSQL = strSQL + "  交楼状况约定名称 = case when 交楼状况约定=0 then '吉屋按现状' when 交楼状况约定=1 then '详见交付清单' when 交楼状况约定=2 then '带租约交付' else '' end," + vbCr
                strSQL = strSQL + "  税费支付约定名称 = case when 税费支付约定=0 then '各付各税' when 税费支付约定=1 then '甲方包税' when 税费支付约定=2 then '乙方包税' when 税费支付约定=3 then '其他' else '' end," + vbCr
                strSQL = strSQL + "  房款托管约定名称 = case when 房款托管约定=0 then '不托管房款' when 房款托管约定=1 then '托管房款' else '' end," + vbCr
                strSQL = strSQL + "  付款方式约定名称 = case when 付款方式约定=0 then '一次性付款' when 付款方式约定=1 then '亿城按揭' when 付款方式约定=2 then '其他按揭' else '' end," + vbCr
                strSQL = strSQL + "  甲方证件类型名称 = case when 甲方证件类型=0 then '身份证' when 甲方证件类型=1 then '护照' when 甲方证件类型=2 then '营业执照' else '' end," + vbCr
                strSQL = strSQL + "  乙方证件类型名称 = case when 乙方证件类型=0 then '身份证' when 乙方证件类型=1 then '护照' when 乙方证件类型=2 then '营业执照' else '' end" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同实际列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同编号 = b.合同编号," + vbCr
                strSQL = strSQL + "  合同类型 = b.合同类型," + vbCr
                strSQL = strSQL + "  合同日期 = b.合同日期," + vbCr
                strSQL = strSQL + "  合同状态 = b.合同状态," + vbCr
                strSQL = strSQL + "  付款方式 = b.付款方式," + vbCr
                strSQL = strSQL + "  统计日期 = b.统计日期," + vbCr
                strSQL = strSQL + "  结案日期 = b.结案日期," + vbCr
                strSQL = strSQL + "  按揭返还 = b.按揭返还," + vbCr
                strSQL = strSQL + "  合同标志 = b.合同标志," + vbCr
                strSQL = strSQL + "  解除日期 = b.解除日期," + vbCr
                strSQL = strSQL + "  坏账金额 = b.坏账金额," + vbCr
                strSQL = strSQL + "  坏账日期 = b.坏账日期," + vbCr
                strSQL = strSQL + "  合同唯一标识 = b.唯一标识," + vbCr
                strSQL = strSQL + "  合同登记人码 = b.登记人码," + vbCr
                strSQL = strSQL + "  合同登记人名 = b.登记人名," + vbCr
                strSQL = strSQL + "  合同登记日期 = b.登记日期," + vbCr
                strSQL = strSQL + "  合同备注信息 = b.备注信息 " + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_二手_交易合同 b on a.交易编号=b.确认书号" + vbCr
                strSQL = strSQL + "where b.确认书号 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同类型名称 = case when 合同类型 & 0x1 = 0x1 then '代办过户' when 合同类型 & 0x2 = 0x2 then '代办按揭' else '其他代办' end," + vbCr
                strSQL = strSQL + "  合同状态名称 = case when 合同状态 & 3 = 0 then '未审' when 合同状态 & 3 = 1 then '已审' when 合同状态 & 2 = 2 then '完成' else '' end," + vbCr
                strSQL = strSQL + "  合同解除     = case when 合同标志 & 0x1 = 0x1 then '√' else '×' end," + vbCr
                strSQL = strSQL + "  坏账合同     = case when 合同标志 & 0x2 = 0x2 then '√' else '×' end" + vbCr
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  付款方式名称 = b.模版名称" + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                strSQL = strSQL + "where b.模版代码 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strWhere]搜索
                '*******************************************************************************************************************************************************************
                If strWhere <> "" Then
                    strSQL = strSQL + "update #tempTable01 set 系统用00 = 1" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "where " + strWhere + vbCr
                    strSQL = strSQL + "delete #tempTable01 where isnull(系统用00,0)=0" + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '物业信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @qrsh varchar(20)" + vbCr
                strSQL = strSQL + "declare @nxh  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @d_fwdz  varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_mj    money" + vbCr
                strSQL = strSQL + "declare @d_fczh  varchar(120)" + vbCr
                strSQL = strSQL + "declare @d_fczdz varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_fybh  varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_zx    varchar(8)" + vbCr
                strSQL = strSQL + "declare @d_lc    integer" + vbCr
                strSQL = strSQL + "declare @d_ll    integer" + vbCr
                strSQL = strSQL + "declare @d_jg    varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_wyxz  varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_szqy  varchar(11)" + vbCr
                strSQL = strSQL + "declare @d_jyje  money" + vbCr
                strSQL = strSQL + "declare @d_lp    varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_ld    varchar(24)" + vbCr
                strSQL = strSQL + "declare @d_dy    varchar(16)" + vbCr
                strSQL = strSQL + "declare @d_jcsj  datetime" + vbCr
                strSQL = strSQL + "declare @d_kjlx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwxz  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxdc  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxnx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zyyx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jjsb  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_lyjt  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwjg  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jglx  varchar(20)" + vbCr
                strSQL = strSQL + "declare @d_jgfs  integer" + vbCr
                strSQL = strSQL + "declare @d_lg    integer" + vbCr
                strSQL = strSQL + "declare @d_wssl  integer" + vbCr
                strSQL = strSQL + "declare @d_ytsl  integer" + vbCr
                strSQL = strSQL + "declare @d_hymj  money" + vbCr
                strSQL = strSQL + "declare @d_dtsl  integer" + vbCr
                strSQL = strSQL + "declare @d_lchs  integer" + vbCr
                strSQL = strSQL + "declare @d_lpqs  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @r_rydm  varchar(16)" + vbCr
                strSQL = strSQL + "declare @r_dwdm  varchar(12)" + vbCr
                strSQL = strSQL + "declare @r_tdbh  integer" + vbCr
                strSQL = strSQL + "declare @r_ssfz  varchar(60)" + vbCr
                strSQL = strSQL + "declare @r_ryzj  varchar(23)" + vbCr
                strSQL = strSQL + "declare @r_fpbl  money" + vbCr
                strSQL = strSQL + "declare @r_zgbj  integer" + vbCr
                strSQL = strSQL + "declare @r_ztbz  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare cursor_temp00 CURSOR for" + vbCr
                strSQL = strSQL + "select 交易编号" + vbCr
                strSQL = strSQL + "from #tempTable01" + vbCr
                strSQL = strSQL + "order by 交易编号" + vbCr
                strSQL = strSQL + "open cursor_temp00" + vbCr
                strSQL = strSQL + "fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "begin" + vbCr
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  房屋地址,面积,房产证号,房产证地址,房源编号,座向,楼层,楼龄,间隔,物业性质,所在区域,交易金额," + vbCr
                strSQL = strSQL + "  楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔," + vbCr
                strSQL = strSQL + "  景观类型,景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_物业其他" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  order by 房屋地址" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "  @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "  @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址000 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积000     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型000     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号000     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址000   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号000     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向000         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层000         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄000         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质000     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域000     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额000     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘000         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋000         = @d_ld," + vbCr
                strSQL = strSQL + "      单元000         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间000     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型000     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质000     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次000     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限000     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响000     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备000     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通000     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔000     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型000     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数000     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高000         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量000     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量000     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积000     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量000     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数000     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数000     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址001 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积001     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型001     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号001     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址001   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号001     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向001         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层001         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄001         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质001     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域001     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额001     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘001         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋001         = @d_ld," + vbCr
                strSQL = strSQL + "      单元001         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间001     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型001     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质001     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次001     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限001     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响001     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备001     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通001     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔001     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型001     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数001     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高001         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量001     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量001     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积001     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量001     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数001     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数001     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址002 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积002     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型002     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号002     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址002   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号002     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向002         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层002         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄002         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质002     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域002     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额002     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘002         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋002         = @d_ld," + vbCr
                strSQL = strSQL + "      单元002         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间002     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型002     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质002     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次002     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限002     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响002     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备002     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通002     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔002     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型002     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数002     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高002         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量002     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量002     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积002     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量002     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数002     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数002     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址003 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积003     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型003     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号003     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址003   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号003     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向003         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层003         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄003         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质003     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域003     = @d_szqy," + vbCr
                strSQL = strSQL + "      交易金额003     = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘003         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋003         = @d_ld," + vbCr
                strSQL = strSQL + "      单元003         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间003     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型003     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质003     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次003     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限003     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响003     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备003     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通003     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔003     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型003     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数003     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高003         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量003     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量003     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积003     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量003     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数003     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数003     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "    @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "    @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                '*******************************************************************************************************************************************************************
                '业务员信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  人员代码,单位代码,团队编号,所属分组,人员职级,分配比例,直管标记,状态标志" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_交易合同分配比例" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  and   状态标志 & 0x1 = 0x1" + vbCr
                strSQL = strSQL + "  order by 单位代码,团队编号,人员职级,人员代码" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码000 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码000 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号000 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组000 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级000 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例000 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记000 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志000 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码001 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码001 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号001 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组001 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级001 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例001 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记001 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志001 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码002 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码002 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号002 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组002 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级002 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例002 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记002 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志002 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码003 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码003 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号003 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组003 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级003 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例003 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记003 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志003 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 4" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码004 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码004 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号004 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组004 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级004 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例004 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记004 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志004 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 5" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码005 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码005 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号005 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组005 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级005 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例005 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记005 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志005 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 6" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码006 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码006 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号006 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组006 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级006 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例006 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记006 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志006 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 7" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码007 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码007 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号007 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组007 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级007 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例007 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记007 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志007 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 8" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码008 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码008 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号008 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组008 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级008 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例008 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记008 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志008 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "end" + vbCr
                strSQL = strSQL + "close cursor_temp00" + vbCr
                strSQL = strSQL + "deallocate cursor_temp00" + vbCr
                '*******************************************************************************************************************************************************************
                '计算物业的其他显示字段
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  物业性质名称" + strXH + " = b.性质名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业性质 b on a.物业性质" + strXH + "=b.性质代码" + vbCr
                    strSQL = strSQL + "where b.性质代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.物业性质" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  所在区域名称" + strXH + " = b.区域名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_区域划分 b on a.所在区域" + strXH + "=b.区域代码" + vbCr
                    strSQL = strSQL + "where b.区域代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.所在区域" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单元户型名称" + strXH + " = b.间隔名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业间隔 b on a.单元户型" + strXH + "=b.间隔代码" + vbCr
                    strSQL = strSQL + "where b.间隔代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单元户型" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '计算业务员的其他显示字段
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员名称" + strXH + " = b.人员名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_人员 b on a.人员代码" + strXH + "=b.人员代码" + vbCr
                    strSQL = strSQL + "where b.人员代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单位名称" + strXH + " = b.组织名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_组织机构 b on a.单位代码" + strXH + "=b.组织代码" + vbCr
                    strSQL = strSQL + "where b.组织代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单位代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员职级名称" + strXH + " = b.职级名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_人事_职级定义 b on a.人员职级" + strXH + "=b.职级代码" + vbCr
                    strSQL = strSQL + "where b.职级代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员职级" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '获取结果数据
                strSQL = strSQL + "select a.* from #tempTable01 a order by a.交易日期" + vbCr
                '*******************************************************************************************************************************************************************
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objRetDataSet) = False Then
                    GoTo errProc
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getDataSet_ES_JYXX_QT_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 租赁业务列表打印的数据集(1行最多显示4个单元9个业务员)
        ' 以“交易日期”排序
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     strQueryDG                 ：订购书搜索串
        '     strQueryHT                 ：合同搜索串
        '     strQueryDY                 ：物业搜索串
        '     strQueryRY                 ：业务员搜索串
        '     blnControl                 ：进行查看限制
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2011-01-05 创建
        '----------------------------------------------------------------
        Public Function getDataSet_ES_JYXX_ZL_PRN( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByVal strQueryDG As String, _
            ByVal strQueryHT As String, _
            ByVal strQueryDY As String, _
            ByVal strQueryRY As String, _
            ByVal blnControl As Boolean, _
            ByRef objRetDataSet As System.Data.DataSet) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim objTempDataSet As System.Data.DataSet = Nothing
            Dim strTempWhere As String = ""
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_JYXX_ZL_PRN = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL_PRN]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strQueryDG Is Nothing Then strQueryDG = ""
                strQueryDG = strQueryDG.Trim
                If strQueryHT Is Nothing Then strQueryHT = ""
                strQueryHT = strQueryHT.Trim
                If strQueryDY Is Nothing Then strQueryDY = ""
                strQueryDY = strQueryDY.Trim
                If strQueryRY Is Nothing Then strQueryRY = ""
                strQueryRY = strQueryRY.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '如果需要控制查看模式，则计算当前人员的所有下属人员
                Dim strRYLIST As String = ""
                Dim strBMLIST As String = ""
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                If blnControl = True Then
                    If Me.getCanRead_BMRY(strErrMsg, strUserId, strPassword, Now, strBMLIST, strRYLIST) = False Then
                        GoTo errProc
                    End If
                End If

                '计算最大物业数目
                Dim intMaxNum_DY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_物业租赁 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_DY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_DY < 1 Then intMaxNum_DY = 1
                If intMaxNum_DY > 4 Then intMaxNum_DY = 4

                '计算最大私佣业务员数目
                Dim intMaxNum_RY As Integer = 0
                strSQL = ""
                strSQL = strSQL + " select max(a.num)" + vbCr
                strSQL = strSQL + " from" + vbCr
                strSQL = strSQL + " (" + vbCr
                strSQL = strSQL + "   select 确认书号,COUNT(*) as num from 地产_B_二手_交易合同分配比例 where 状态标志&0x1=0x1 group by 确认书号" + vbCr
                strSQL = strSQL + " ) a" + vbCr
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objTempDataSet) = False Then
                    GoTo errProc
                End If
                If objTempDataSet.Tables.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL_PRN]无法获取数据！"
                    GoTo errProc
                End If
                If objTempDataSet.Tables(0).Rows.Count < 1 Then
                    strErrMsg = "错误：[getDataSet_ES_JYXX_ZL_PRN]无法获取数据！"
                    GoTo errProc
                End If
                intMaxNum_RY = CType(objTempDataSet.Tables(0).Rows(0).Item(0), Integer)
                Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
                If intMaxNum_RY < 1 Then intMaxNum_RY = 1
                If intMaxNum_RY > 9 Then intMaxNum_RY = 9

                '将纵表转换为横表显示
                Dim strXH As String = ""
                '*******************************************************************************************************************************************************************
                '创建结果的横表
                '*******************************************************************************************************************************************************************
                strSQL = ""
                strSQL = strSQL + "create table #tempTable01 " + vbCr
                strSQL = strSQL + "(" + vbCr
                strSQL = strSQL + "系统用00   integer      NULL DEFAULT(0)," + vbCr
                '交易共性列
                strSQL = strSQL + "交易类型   varchar(20)  NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "交易编号   varchar(20)  null default('')," + vbCr
                strSQL = strSQL + "交易日期   datetime     null," + vbCr
                strSQL = strSQL + "交易状态   integer      null default(1)," + vbCr
                strSQL = strSQL + "业主名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "客户名称   varchar(64)  null default('')," + vbCr
                strSQL = strSQL + "物业地址   varchar(640) null default('')," + vbCr
                strSQL = strSQL + "交易价格   money        null default(0)," + vbCr
                strSQL = strSQL + "交易面积   money        null default(0)," + vbCr
                strSQL = strSQL + "交易月租金 money        null default(0)," + vbCr
                '租赁确认书实际列
                strSQL = strSQL + "唯一标识         varchar(36)          null default('')," + vbCr
                strSQL = strSQL + "确认书号         varchar(20)          null default('')," + vbCr
                strSQL = strSQL + "订购日期         datetime             null," + vbCr
                strSQL = strSQL + "订购状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "甲方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "甲方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "甲方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "甲方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "甲方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方名称         varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方证件类型     integer              null default(0)," + vbCr
                strSQL = strSQL + "乙方证照号码     varchar(200)         null default('')," + vbCr
                strSQL = strSQL + "乙方代理人       varchar(64)          null default('')," + vbCr
                strSQL = strSQL + "乙方联系地址     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "乙方联系电话     varchar(128)         null default('')," + vbCr
                strSQL = strSQL + "房屋地址         varchar(640)         null default('')," + vbCr
                strSQL = strSQL + "交易总租金       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "交易总面积       numeric(10,4)        null default(0)," + vbCr
                strSQL = strSQL + "甲方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "乙方代理费       numeric(16,2)        null default(0)," + vbCr
                strSQL = strSQL + "代理费折扣       numeric(8,4)         null default(1)," + vbCr
                strSQL = strSQL + "计划交易日期     datetime             null," + vbCr
                strSQL = strSQL + "计划交楼日期     datetime             null," + vbCr
                strSQL = strSQL + "交楼状况说明     varchar(160)         null default('')," + vbCr
                strSQL = strSQL + "租期约定         integer              null default(0)," + vbCr
                strSQL = strSQL + "付租方式约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "税费支付约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "租金托管约定     integer              null default(0)," + vbCr
                strSQL = strSQL + "租赁保证金       money                null default(0)," + vbCr
                strSQL = strSQL + "滞纳金比例       money                null default(0)," + vbCr
                strSQL = strSQL + "年递增比例       money                null default(0)," + vbCr
                strSQL = strSQL + "缴租日           integer              null default(0)," + vbCr
                strSQL = strSQL + "租期月数         integer              null default(0)," + vbCr
                strSQL = strSQL + "登记人码         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记人名         varchar(16)          null default('')," + vbCr
                strSQL = strSQL + "登记日期         datetime             null," + vbCr
                strSQL = strSQL + "客源编号         varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册地址         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "查册费           money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "实收佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "合作佣金         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭机构         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭银行         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "按揭成数         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "按揭年限         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "业主区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "业主电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "售后意向         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "剩余物业         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区码         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "买家区名         varchar(120)         NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户来源         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客源其他         varchar(40)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "客户电邮         varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "购买目的         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "备注信息         varchar(600)         null default('')," + vbCr
                strSQL = strSQL + "租赁开始         datetime             NULL," + vbCr
                strSQL = strSQL + "租赁结束         datetime             NULL," + vbCr
                strSQL = strSQL + "水电煤气         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "电话费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "管理费           varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租赁发票         varchar(20)          NULL DEFAULT('')," + vbCr
                '租赁确认书虚拟列
                strSQL = strSQL + "付租方式约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租期约定名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "税费支付约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "租金托管约定名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "甲方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "乙方证件类型名称 varchar(20)          NULL DEFAULT('')," + vbCr
                '合同实际列
                strSQL = strSQL + "合同编号         varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同类型         integer              null default(1)," + vbCr
                strSQL = strSQL + "合同日期         datetime             null," + vbCr
                strSQL = strSQL + "合同状态         integer              null default(1)," + vbCr
                strSQL = strSQL + "付款方式         varchar(23)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "统计日期         datetime             null," + vbCr
                strSQL = strSQL + "结案日期         datetime             null," + vbCr
                strSQL = strSQL + "按揭返还         money                null default(0)," + vbCr
                strSQL = strSQL + "合同标志         integer              NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "解除日期         datetime             NULL," + vbCr
                strSQL = strSQL + "坏账金额         money                NULL DEFAULT(0)," + vbCr
                strSQL = strSQL + "坏账日期         datetime             NULL," + vbCr
                '合同虚拟列
                strSQL = strSQL + "合同唯一标识     varchar(36)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人码     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记人名     varchar(16)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同登记日期     datetime             null," + vbCr
                strSQL = strSQL + "合同备注信息     varchar(120)         null default('')," + vbCr
                strSQL = strSQL + "合同类型名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同状态名称     varchar(20)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "付款方式名称     varchar(80)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "合同解除         varchar(10)          NULL DEFAULT('')," + vbCr
                strSQL = strSQL + "坏账合同         varchar(10)          NULL DEFAULT('')," + vbCr
                '租赁确认书物业列(纵变横)
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '物业虚拟列
                    strSQL = strSQL + "单元房屋地址" + strXH + "     varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "单元面积" + strXH + "         numeric(10,4)        null default(0)," + vbCr
                    strSQL = strSQL + "单元户型" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "物业性质名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    strSQL = strSQL + "单元户型名称" + strXH + "     varchar(80)          null default('')," + vbCr
                    '物业实际列
                    strSQL = strSQL + "房产证号" + strXH + "         varchar(120)         null default('')," + vbCr
                    strSQL = strSQL + "房产证地址" + strXH + "       varchar(160)         null default('')," + vbCr
                    strSQL = strSQL + "房源编号" + strXH + "         varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "座向" + strXH + "             varchar(8)           null default('')," + vbCr
                    strSQL = strSQL + "楼高" + strXH + "             integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层" + strXH + "             integer              null default(1)," + vbCr
                    strSQL = strSQL + "楼龄" + strXH + "             integer              null default(0)," + vbCr
                    strSQL = strSQL + "物业性质" + strXH + "         varchar(15)          null default('')," + vbCr
                    strSQL = strSQL + "所在区域" + strXH + "         varchar(11)          null default('')," + vbCr
                    strSQL = strSQL + "月租金" + strXH + "           numeric(16,2)        null default(0)," + vbCr
                    strSQL = strSQL + "楼盘" + strXH + "             varchar(36)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼栋" + strXH + "             varchar(24)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单元" + strXH + "             varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "建成时间" + strXH + "         datetime             NULL," + vbCr
                    strSQL = strSQL + "空间类型" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋性质" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修档次" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "装修年限" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "噪音影响" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "家具设备" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "楼宇交通" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "房屋间隔" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观类型" + strXH + "         varchar(20)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "景观房数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "卧室数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "阳台数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "花园面积" + strXH + "         numeric(10,4)        NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "电梯数量" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼层户数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "楼盘期数" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                Next
                '租赁确认书业务员列(纵变横)
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    '人员虚拟列
                    strSQL = strSQL + "人员名称" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位名称" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级名称" + strXH + "     varchar(80)          NULL DEFAULT('')," + vbCr
                    '人员实际列
                    strSQL = strSQL + "人员代码" + strXH + "         varchar(16)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "单位代码" + strXH + "         varchar(12)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "团队编号" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "所属分组" + strXH + "         varchar(60)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "人员职级" + strXH + "         varchar(23)          NULL DEFAULT('')," + vbCr
                    strSQL = strSQL + "分配比例" + strXH + "         numeric(8,4)         NULL DEFAULT(0)," + vbCr
                    strSQL = strSQL + "直管标记" + strXH + "         integer              NULL DEFAULT(0)," + vbCr
                    If i = intMaxNum_RY - 1 Then
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)" + vbCr
                    Else
                        strSQL = strSQL + "状态标志" + strXH + "         integer              NULL DEFAULT(1)," + vbCr
                    End If
                Next
                strSQL = strSQL + ")" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strQueryDG][strQueryHT][strQueryDY][strQueryRY][权限控制]搜索[确认书]并写入结果表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "insert into #tempTable01 (" + vbCr
                strSQL = strSQL + "交易类型,交易编号,交易日期,交易状态,业主名称,客户名称,物业地址,交易价格,交易面积,交易月租金," + vbCr
                strSQL = strSQL + "唯一标识,确认书号,订购日期,订购状态," + vbCr
                strSQL = strSQL + "甲方名称,甲方证件类型,甲方证照号码,甲方代理人,甲方联系地址,甲方联系电话," + vbCr
                strSQL = strSQL + "乙方名称,乙方证件类型,乙方证照号码,乙方代理人,乙方联系地址,乙方联系电话," + vbCr
                strSQL = strSQL + "房屋地址,交易总租金,交易总面积,甲方代理费,乙方代理费,代理费折扣," + vbCr
                strSQL = strSQL + "计划交易日期,计划交楼日期,交楼状况说明,付租方式约定,税费支付约定,租金托管约定," + vbCr
                strSQL = strSQL + "租期约定,租赁保证金,滞纳金比例,年递增比例,缴租日,租期月数," + vbCr
                strSQL = strSQL + "登记人码,登记人名,登记日期,客源编号,查册地址,查册费,实收佣金,合作佣金,按揭机构,按揭银行,按揭成数,按揭年限," + vbCr
                strSQL = strSQL + "业主区码,业主区名,业主来源,业源其他,业主电邮,售后意向,剩余物业," + vbCr
                strSQL = strSQL + "买家区码,买家区名,客户来源,客源其他,客户电邮,购买目的," + vbCr
                strSQL = strSQL + "备注信息," + vbCr
                strSQL = strSQL + "租赁开始,租赁结束,水电煤气,电话费,管理费,租赁发票" + vbCr
                strSQL = strSQL + ")" + vbCr
                strSQL = strSQL + "select " + vbCr
                strSQL = strSQL + "'二手.租赁' as 交易类型,a.确认书号 as 交易编号,a.订购日期 as 交易日期,a.订购状态 as 交易状态,a.甲方名称 as 业主名称,a.乙方名称 as 客户名称,a.房屋地址 as 物业地址,a.交易总租金 as 交易价格,a.交易总面积 as 交易面积,a.交易月租金," + vbCr
                strSQL = strSQL + "a.唯一标识,a.确认书号,a.订购日期,a.订购状态," + vbCr
                strSQL = strSQL + "a.甲方名称,a.甲方证件类型,a.甲方证照号码,a.甲方代理人,a.甲方联系地址,a.甲方联系电话," + vbCr
                strSQL = strSQL + "a.乙方名称,a.乙方证件类型,a.乙方证照号码,a.乙方代理人,a.乙方联系地址,a.乙方联系电话," + vbCr
                strSQL = strSQL + "a.房屋地址,a.交易总租金,a.交易总面积,a.甲方代理费,a.乙方代理费,a.代理费折扣," + vbCr
                strSQL = strSQL + "a.计划交易日期,a.计划交楼日期,a.交楼状况说明,a.付租方式约定,a.税费支付约定,a.租金托管约定," + vbCr
                strSQL = strSQL + "a.租期约定,a.租赁保证金,a.滞纳金比例,a.年递增比例,a.缴租日,a.租期月数," + vbCr
                strSQL = strSQL + "a.登记人码,a.登记人名,a.登记日期,a.客源编号,a.查册地址,a.查册费,a.实收佣金,a.合作佣金,a.按揭机构,a.按揭银行,a.按揭成数,a.按揭年限," + vbCr
                strSQL = strSQL + "a.业主区码,a.业主区名,a.业主来源,a.业源其他,a.业主电邮,a.售后意向,a.剩余物业," + vbCr
                strSQL = strSQL + "a.买家区码,a.买家区名,a.客户来源,a.客源其他,a.客户电邮,a.购买目的," + vbCr
                strSQL = strSQL + "a.备注信息," + vbCr
                strSQL = strSQL + "a.租赁开始,a.租赁结束,a.水电煤气,a.电话费,a.管理费,a.租赁发票" + vbCr
                strTempWhere = ""
                If strQueryDG = "" Then
                    strSQL = strSQL + "from 地产_B_二手_确认书租赁 a" + vbCr
                Else
                    strSQL = strSQL + "from" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.* from 地产_B_二手_确认书租赁 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDG + vbCr
                    strSQL = strSQL + ") a" + vbCr
                End If
                If strQueryHT <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_交易合同 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryHT + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") b on a.确认书号=b.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "b.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and b.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryDY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "  select a.确认书号 from 地产_B_二手_物业租赁 a" + vbCr
                    strSQL = strSQL + "  where " + strQueryDY + vbCr
                    strSQL = strSQL + "  group by a.确认书号" + vbCr
                    strSQL = strSQL + ") c on a.确认书号=c.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "c.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and c.确认书号 is not null" + vbCr
                    End If
                End If
                If strQueryRY <> "" And blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      and a.状态标志 & 1 = 1" + vbCr                       '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf strQueryRY <> "" Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*,b.人员名称,c.组织名称 as 单位名称" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "        left join 公共_B_人员     b on a.人员代码=b.人员代码" + vbCr
                    strSQL = strSQL + "        left join 公共_B_组织机构 c on a.单位代码=c.组织代码" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where " + strQueryRY + vbCr
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                ElseIf blnControl = True Then
                    strSQL = strSQL + "left join" + vbCr
                    strSQL = strSQL + "(" + vbCr
                    strSQL = strSQL + "      select a.确认书号" + vbCr
                    strSQL = strSQL + "      from" + vbCr
                    strSQL = strSQL + "      (" + vbCr
                    strSQL = strSQL + "        select a.*" + vbCr
                    strSQL = strSQL + "        from 地产_B_二手_交易合同分配比例 a" + vbCr
                    strSQL = strSQL + "      ) a" + vbCr
                    strSQL = strSQL + "      where a.状态标志 & 1 = 1" + vbCr                     '私佣
                    strSQL = strSQL + "      and (a.人员代码 in (" + strRYLIST + ")" + vbCr       '是下属
                    If strBMLIST <> "" Then
                        strSQL = strSQL + "      or   a.单位代码 in (" + strBMLIST + "))" + vbCr  '这些单位的助理
                    Else
                        strSQL = strSQL + "      )" + vbCr                                        '不是行政助理
                    End If
                    strSQL = strSQL + "      group by a.确认书号" + vbCr
                    strSQL = strSQL + ") d on a.确认书号=d.确认书号" + vbCr
                    If strTempWhere = "" Then
                        strTempWhere = "d.确认书号 is not null" + vbCr
                    Else
                        strTempWhere = strTempWhere + "and d.确认书号 is not null" + vbCr
                    End If
                Else
                End If
                If strTempWhere <> "" Then
                    strSQL = strSQL + "where " + strTempWhere + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '计算确认书虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  付租方式约定名称 = case when 付租方式约定=0 then '月缴' when 付租方式约定=1 then '季缴' when 付租方式约定=2 then '半年缴' when 付租方式约定=3 then '年缴' else '' end," + vbCr
                strSQL = strSQL + "  税费支付约定名称 = case when 税费支付约定=0 then '各付各税' when 税费支付约定=1 then '甲方包税' when 税费支付约定=2 then '乙方包税' when 税费支付约定=3 then '其他' else '' end," + vbCr
                strSQL = strSQL + "  租金托管约定名称 = case when 租金托管约定=0 then '不托管租金' when 租金托管约定=1 then '托管租金' else '' end," + vbCr
                strSQL = strSQL + "  租期约定名称     = case when 租期约定=0 then '指定月数' when 租期约定=1 then '可与出租方约定' else '' end," + vbCr
                strSQL = strSQL + "  甲方证件类型名称 = case when 甲方证件类型=0 then '身份证' when 甲方证件类型=1 then '护照' when 甲方证件类型=2 then '营业执照' else '' end," + vbCr
                strSQL = strSQL + "  乙方证件类型名称 = case when 乙方证件类型=0 then '身份证' when 乙方证件类型=1 then '护照' when 乙方证件类型=2 then '营业执照' else '' end" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同实际列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同编号 = b.合同编号," + vbCr
                strSQL = strSQL + "  合同类型 = b.合同类型," + vbCr
                strSQL = strSQL + "  合同日期 = b.合同日期," + vbCr
                strSQL = strSQL + "  合同状态 = b.合同状态," + vbCr
                strSQL = strSQL + "  付款方式 = b.付款方式," + vbCr
                strSQL = strSQL + "  统计日期 = b.统计日期," + vbCr
                strSQL = strSQL + "  结案日期 = b.结案日期," + vbCr
                strSQL = strSQL + "  按揭返还 = b.按揭返还," + vbCr
                strSQL = strSQL + "  合同标志 = b.合同标志," + vbCr
                strSQL = strSQL + "  解除日期 = b.解除日期," + vbCr
                strSQL = strSQL + "  坏账金额 = b.坏账金额," + vbCr
                strSQL = strSQL + "  坏账日期 = b.坏账日期," + vbCr
                strSQL = strSQL + "  合同唯一标识 = b.唯一标识," + vbCr
                strSQL = strSQL + "  合同登记人码 = b.登记人码," + vbCr
                strSQL = strSQL + "  合同登记人名 = b.登记人名," + vbCr
                strSQL = strSQL + "  合同登记日期 = b.登记日期," + vbCr
                strSQL = strSQL + "  合同备注信息 = b.备注信息 " + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_二手_交易合同 b on a.交易编号=b.确认书号" + vbCr
                strSQL = strSQL + "where b.确认书号 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '计算合同虚拟列
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  合同类型名称 = '租赁合同'," + vbCr
                strSQL = strSQL + "  合同状态名称 = case when 合同状态 & 3 = 0 then '未审' when 合同状态 & 3 = 1 then '已审' when 合同状态 & 2 = 2 then '完成' else '' end," + vbCr
                strSQL = strSQL + "  合同解除     = case when 合同标志 & 0x1 = 0x1 then '√' else '×' end," + vbCr
                strSQL = strSQL + "  坏账合同     = case when 合同标志 & 0x2 = 0x2 then '√' else '×' end" + vbCr
                strSQL = strSQL + "update #tempTable01 set" + vbCr
                strSQL = strSQL + "  付款方式名称 = b.模版名称" + vbCr
                strSQL = strSQL + "from #tempTable01 a" + vbCr
                strSQL = strSQL + "left join 地产_B_公共_应收应付模版 b on a.付款方式=b.模版代码" + vbCr
                strSQL = strSQL + "where b.模版代码 is not null" + vbCr
                '*******************************************************************************************************************************************************************
                '按[strWhere]搜索
                '*******************************************************************************************************************************************************************
                If strWhere <> "" Then
                    strSQL = strSQL + "update #tempTable01 set 系统用00 = 1" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "where " + strWhere + vbCr
                    strSQL = strSQL + "delete #tempTable01 where isnull(系统用00,0)=0" + vbCr
                End If
                '*******************************************************************************************************************************************************************
                '物业信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @qrsh varchar(20)" + vbCr
                strSQL = strSQL + "declare @nxh  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @d_fwdz  varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_mj    money" + vbCr
                strSQL = strSQL + "declare @d_fczh  varchar(120)" + vbCr
                strSQL = strSQL + "declare @d_fczdz varchar(160)" + vbCr
                strSQL = strSQL + "declare @d_fybh  varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_zx    varchar(8)" + vbCr
                strSQL = strSQL + "declare @d_lc    integer" + vbCr
                strSQL = strSQL + "declare @d_ll    integer" + vbCr
                strSQL = strSQL + "declare @d_jg    varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_wyxz  varchar(15)" + vbCr
                strSQL = strSQL + "declare @d_szqy  varchar(11)" + vbCr
                strSQL = strSQL + "declare @d_jyje  money" + vbCr
                strSQL = strSQL + "declare @d_lp    varchar(36)" + vbCr
                strSQL = strSQL + "declare @d_ld    varchar(24)" + vbCr
                strSQL = strSQL + "declare @d_dy    varchar(16)" + vbCr
                strSQL = strSQL + "declare @d_jcsj  datetime" + vbCr
                strSQL = strSQL + "declare @d_kjlx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwxz  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxdc  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zxnx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_zyyx  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jjsb  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_lyjt  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_fwjg  varchar(12)" + vbCr
                strSQL = strSQL + "declare @d_jglx  varchar(20)" + vbCr
                strSQL = strSQL + "declare @d_jgfs  integer" + vbCr
                strSQL = strSQL + "declare @d_lg    integer" + vbCr
                strSQL = strSQL + "declare @d_wssl  integer" + vbCr
                strSQL = strSQL + "declare @d_ytsl  integer" + vbCr
                strSQL = strSQL + "declare @d_hymj  money" + vbCr
                strSQL = strSQL + "declare @d_dtsl  integer" + vbCr
                strSQL = strSQL + "declare @d_lchs  integer" + vbCr
                strSQL = strSQL + "declare @d_lpqs  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare @r_rydm  varchar(16)" + vbCr
                strSQL = strSQL + "declare @r_dwdm  varchar(12)" + vbCr
                strSQL = strSQL + "declare @r_tdbh  integer" + vbCr
                strSQL = strSQL + "declare @r_ssfz  varchar(60)" + vbCr
                strSQL = strSQL + "declare @r_ryzj  varchar(23)" + vbCr
                strSQL = strSQL + "declare @r_fpbl  money" + vbCr
                strSQL = strSQL + "declare @r_zgbj  integer" + vbCr
                strSQL = strSQL + "declare @r_ztbz  integer" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "declare cursor_temp00 CURSOR for" + vbCr
                strSQL = strSQL + "select 交易编号" + vbCr
                strSQL = strSQL + "from #tempTable01" + vbCr
                strSQL = strSQL + "order by 交易编号" + vbCr
                strSQL = strSQL + "open cursor_temp00" + vbCr
                strSQL = strSQL + "fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "begin" + vbCr
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  房屋地址,面积,房产证号,房产证地址,房源编号,座向,楼层,楼龄,间隔,物业性质,所在区域,月租金," + vbCr
                strSQL = strSQL + "  楼盘,楼栋,单元,建成时间,空间类型,房屋性质,装修档次,装修年限,噪音影响,家具设备,楼宇交通,房屋间隔," + vbCr
                strSQL = strSQL + "  景观类型,景观房数,楼高,卧室数量,阳台数量,花园面积,电梯数量,楼层户数,楼盘期数" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_物业租赁" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  order by 房屋地址" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "  @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "  @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址000 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积000     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型000     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号000     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址000   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号000     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向000         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层000         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄000         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质000     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域000     = @d_szqy," + vbCr
                strSQL = strSQL + "      月租金000       = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘000         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋000         = @d_ld," + vbCr
                strSQL = strSQL + "      单元000         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间000     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型000     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质000     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次000     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限000     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响000     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备000     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通000     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔000     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型000     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数000     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高000         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量000     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量000     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积000     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量000     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数000     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数000     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址001 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积001     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型001     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号001     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址001   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号001     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向001         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层001         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄001         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质001     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域001     = @d_szqy," + vbCr
                strSQL = strSQL + "      月租金001       = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘001         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋001         = @d_ld," + vbCr
                strSQL = strSQL + "      单元001         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间001     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型001     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质001     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次001     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限001     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响001     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备001     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通001     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔001     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型001     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数001     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高001         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量001     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量001     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积001     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量001     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数001     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数001     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址002 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积002     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型002     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号002     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址002   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号002     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向002         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层002         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄002         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质002     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域002     = @d_szqy," + vbCr
                strSQL = strSQL + "      月租金002       = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘002         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋002         = @d_ld," + vbCr
                strSQL = strSQL + "      单元002         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间002     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型002     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质002     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次002     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限002     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响002     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备002     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通002     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔002     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型002     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数002     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高002         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量002     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量002     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积002     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量002     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数002     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数002     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      单元房屋地址003 = @d_fwdz," + vbCr
                strSQL = strSQL + "      单元面积003     = @d_mj," + vbCr
                strSQL = strSQL + "      单元户型003     = @d_jg," + vbCr
                strSQL = strSQL + "      房产证号003     = @d_fczh," + vbCr
                strSQL = strSQL + "      房产证地址003   = @d_fczdz," + vbCr
                strSQL = strSQL + "      房源编号003     = @d_fybh," + vbCr
                strSQL = strSQL + "      座向003         = @d_zx," + vbCr
                strSQL = strSQL + "      楼层003         = @d_lc," + vbCr
                strSQL = strSQL + "      楼龄003         = @d_ll," + vbCr
                strSQL = strSQL + "      物业性质003     = @d_wyxz," + vbCr
                strSQL = strSQL + "      所在区域003     = @d_szqy," + vbCr
                strSQL = strSQL + "      月租金003       = @d_jyje," + vbCr
                strSQL = strSQL + "      楼盘003         = @d_lp," + vbCr
                strSQL = strSQL + "      楼栋003         = @d_ld," + vbCr
                strSQL = strSQL + "      单元003         = @d_dy," + vbCr
                strSQL = strSQL + "      建成时间003     = @d_jcsj," + vbCr
                strSQL = strSQL + "      空间类型003     = @d_kjlx," + vbCr
                strSQL = strSQL + "      房屋性质003     = @d_fwxz," + vbCr
                strSQL = strSQL + "      装修档次003     = @d_zxdc," + vbCr
                strSQL = strSQL + "      装修年限003     = @d_zxnx," + vbCr
                strSQL = strSQL + "      噪音影响003     = @d_zyyx," + vbCr
                strSQL = strSQL + "      家具设备003     = @d_jjsb," + vbCr
                strSQL = strSQL + "      楼宇交通003     = @d_lyjt," + vbCr
                strSQL = strSQL + "      房屋间隔003     = @d_fwjg," + vbCr
                strSQL = strSQL + "      景观类型003     = @d_jglx," + vbCr
                strSQL = strSQL + "      景观房数003     = @d_jgfs," + vbCr
                strSQL = strSQL + "      楼高003         = @d_lg," + vbCr
                strSQL = strSQL + "      卧室数量003     = @d_wssl," + vbCr
                strSQL = strSQL + "      阳台数量003     = @d_ytsl," + vbCr
                strSQL = strSQL + "      花园面积003     = @d_hymj," + vbCr
                strSQL = strSQL + "      电梯数量003     = @d_dtsl," + vbCr
                strSQL = strSQL + "      楼层户数003     = @d_lchs," + vbCr
                strSQL = strSQL + "      楼盘期数003     = @d_lpqs" + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @d_fwdz,@d_mj,@d_fczh,@d_fczdz,@d_fybh,@d_zx,@d_lc,@d_ll,@d_jg,@d_wyxz,@d_szqy,@d_jyje," + vbCr
                strSQL = strSQL + "    @d_lp,@d_ld,@d_dy,@d_jcsj,@d_kjlx,@d_fwxz,@d_zxdc,@d_zxnx,@d_zyyx,@d_jjsb,@d_lyjt,@d_fwjg," + vbCr
                strSQL = strSQL + "    @d_jglx,@d_jgfs,@d_lg,@d_wssl,@d_ytsl,@d_hymj,@d_dtsl,@d_lchs,@d_lpqs" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                '*******************************************************************************************************************************************************************
                '业务员信息变横表
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "  set @nxh = 0" + vbCr
                strSQL = strSQL + "  declare cursor_temp01 CURSOR for" + vbCr
                strSQL = strSQL + "  select" + vbCr
                strSQL = strSQL + "  人员代码,单位代码,团队编号,所属分组,人员职级,分配比例,直管标记,状态标志" + vbCr
                strSQL = strSQL + "  from 地产_B_二手_交易合同分配比例" + vbCr
                strSQL = strSQL + "  where 确认书号 = @qrsh" + vbCr
                strSQL = strSQL + "  and   状态标志 & 0x1 = 0x1" + vbCr
                strSQL = strSQL + "  order by 单位代码,团队编号,人员职级,人员代码" + vbCr
                strSQL = strSQL + "  open cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "  @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  while @@FETCH_STATUS = 0" + vbCr
                strSQL = strSQL + "  begin" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 0" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码000 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码000 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号000 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组000 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级000 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例000 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记000 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志000 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 1" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码001 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码001 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号001 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组001 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级001 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例001 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记001 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志001 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 2" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码002 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码002 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号002 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组002 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级002 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例002 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记002 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志002 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 3" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码003 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码003 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号003 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组003 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级003 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例003 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记003 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志003 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 4" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码004 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码004 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号004 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组004 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级004 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例004 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记004 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志004 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 5" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码005 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码005 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号005 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组005 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级005 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例005 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记005 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志005 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 6" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码006 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码006 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号006 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组006 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级006 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例006 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记006 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志006 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 7" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码007 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码007 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号007 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组007 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级007 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例007 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记007 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志007 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    if @nxh = 8" + vbCr
                strSQL = strSQL + "    update #tempTable01 set" + vbCr
                strSQL = strSQL + "      人员代码008 = @r_rydm," + vbCr
                strSQL = strSQL + "      单位代码008 = @r_dwdm," + vbCr
                strSQL = strSQL + "      团队编号008 = @r_tdbh," + vbCr
                strSQL = strSQL + "      所属分组008 = @r_ssfz," + vbCr
                strSQL = strSQL + "      人员职级008 = @r_ryzj," + vbCr
                strSQL = strSQL + "      分配比例008 = @r_fpbl," + vbCr
                strSQL = strSQL + "      直管标记008 = @r_zgbj," + vbCr
                strSQL = strSQL + "      状态标志008 = @r_ztbz " + vbCr
                strSQL = strSQL + "    where 确认书号 = @qrsh" + vbCr
                '*******************************************************************************************************************************************************************
                strSQL = strSQL + "    set @nxh = @nxh+1" + vbCr
                strSQL = strSQL + "    fetch next from cursor_temp01 into" + vbCr
                strSQL = strSQL + "    @r_rydm,@r_dwdm,@r_tdbh,@r_ssfz,@r_ryzj,@r_fpbl,@r_zgbj,@r_ztbz" + vbCr
                strSQL = strSQL + "  end" + vbCr
                strSQL = strSQL + "  close cursor_temp01" + vbCr
                strSQL = strSQL + "  deallocate cursor_temp01" + vbCr
                strSQL = strSQL + "  fetch next from cursor_temp00 into @qrsh" + vbCr
                strSQL = strSQL + "end" + vbCr
                strSQL = strSQL + "close cursor_temp00" + vbCr
                strSQL = strSQL + "deallocate cursor_temp00" + vbCr
                '*******************************************************************************************************************************************************************
                '计算物业的其他显示字段
                For i = 0 To intMaxNum_DY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  物业性质名称" + strXH + " = b.性质名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业性质 b on a.物业性质" + strXH + "=b.性质代码" + vbCr
                    strSQL = strSQL + "where b.性质代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.物业性质" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  所在区域名称" + strXH + " = b.区域名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_区域划分 b on a.所在区域" + strXH + "=b.区域代码" + vbCr
                    strSQL = strSQL + "where b.区域代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.所在区域" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单元户型名称" + strXH + " = b.间隔名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_公共_物业间隔 b on a.单元户型" + strXH + "=b.间隔代码" + vbCr
                    strSQL = strSQL + "where b.间隔代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单元户型" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '计算业务员的其他显示字段
                For i = 0 To intMaxNum_RY - 1 Step 1
                    strXH = Microsoft.VisualBasic.Right(("00" + i.ToString), 3)
                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员名称" + strXH + " = b.人员名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_人员 b on a.人员代码" + strXH + "=b.人员代码" + vbCr
                    strSQL = strSQL + "where b.人员代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  单位名称" + strXH + " = b.组织名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 公共_B_组织机构 b on a.单位代码" + strXH + "=b.组织代码" + vbCr
                    strSQL = strSQL + "where b.组织代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.单位代码" + strXH + ",'') <> ''" + vbCr

                    strSQL = strSQL + "update #tempTable01 set" + vbCr
                    strSQL = strSQL + "  人员职级名称" + strXH + " = b.职级名称" + vbCr
                    strSQL = strSQL + "from #tempTable01 a" + vbCr
                    strSQL = strSQL + "left join 地产_B_人事_职级定义 b on a.人员职级" + strXH + "=b.职级代码" + vbCr
                    strSQL = strSQL + "where b.职级代码 is not null" + vbCr
                    strSQL = strSQL + "and   isnull(a.人员职级" + strXH + ",'') <> ''" + vbCr
                Next
                '*******************************************************************************************************************************************************************
                '获取结果数据
                strSQL = strSQL + "select a.* from #tempTable01 a order by a.交易日期" + vbCr
                '*******************************************************************************************************************************************************************
                If objdacCommon.getDataSetBySQL(strErrMsg, objSqlConnection, strSQL, objRetDataSet) = False Then
                    GoTo errProc
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            getDataSet_ES_JYXX_ZL_PRN = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objTempDataSet)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objXJRY)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objDWLB)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手应收未收佣金表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索条件
        '     objestateErshouData        ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-01-07 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_YSWSYJB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_YSWSYJB = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_YSWSYJB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_YSWSYJB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     a.实收佣金           as 兴业实收," + vbCr
                        strSQL = strSQL + "     isnull(b.中介费额,0) as 实结佣金," + vbCr
                        strSQL = strSQL + "     isnull(a.实收佣金,0) - isnull(b.中介费额,0) as 未收佣金" + vbCr
                        strSQL = strSQL + "   from 地产_V_全部合同 a" + vbCr
                        strSQL = strSQL + "   left join" + vbCr
                        strSQL = strSQL + "   (" + vbCr
                        strSQL = strSQL + "     select 确认书号,SUM(中介费额) as 中介费额" + vbCr
                        strSQL = strSQL + "     from 地产_B_二手_交易合同结算书" + vbCr
                        strSQL = strSQL + "     group by 确认书号" + vbCr
                        strSQL = strSQL + "   ) b on a.交易编号=b.确认书号" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.交易日期" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_YSWSYJB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_YSWSYJB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手客源信息表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索条件
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-01-09 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_KYXXB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_KYXXB = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_KYXXB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_KYXXB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from 地产_V_全部交易 a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.客源编号,a.客户名称" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_KYXXB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_KYXXB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算中介部二手房源信息表的数据
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索条件
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-01-09 创建
        '----------------------------------------------------------------
        Public Function getDataSet_BB_FYXXB( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_BB_FYXXB = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_BB_FYXXB]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strWhere Is Nothing Then strWhere = ""
                strWhere = strWhere.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_VT_ES_BB_FYXXB)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select" + vbCr
                        strSQL = strSQL + "     a.物业编码,a.房屋地址,a.房产证号,a.房产证地址,a.面积,a.座向,a.楼层,a.楼龄," + vbCr
                        strSQL = strSQL + "     a.间隔,a.物业性质,a.所在区域,a.交易金额,a.房源编号,a.楼盘,a.楼栋,a.单元,a.建成时间," + vbCr
                        strSQL = strSQL + "     a.空间类型,a.房屋性质,a.装修档次,a.装修年限,a.噪音影响,a.家具设备,a.楼宇交通,a.房屋间隔," + vbCr
                        strSQL = strSQL + "     a.景观类型,a.景观房数,a.楼高,a.卧室数量,a.阳台数量,a.花园面积,a.电梯数量,a.楼层户数,a.楼盘期数," + vbCr
                        strSQL = strSQL + "     b.*," + vbCr
                        strSQL = strSQL + "     c.间隔名称," + vbCr
                        strSQL = strSQL + "     d.性质名称 as 物业性质名称," + vbCr
                        strSQL = strSQL + "     e.区域名称 as 所在区域名称 " + vbCr
                        strSQL = strSQL + "   from 地产_V_全部物业 a" + vbCr
                        strSQL = strSQL + "   left join 地产_V_全部交易      b on a.确认书号=b.交易编号" + vbCr
                        strSQL = strSQL + "   left join 地产_B_公共_物业间隔 c on a.间隔    =c.间隔代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_公共_物业性质 d on a.物业性质=d.性质代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_公共_区域划分 e on a.所在区域=e.区域代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.房源编号,a.业主名称" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_VT_ES_BB_FYXXB))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_BB_FYXXB = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 计算[strUserId]在指定时间点[objJCSJ]能够查看的部门和人员列表
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     objJCSJ                    ：检测时间
        '     strBMList                  ：部门数据库格式列表
        '     strRYList                  ：人员数据库格式列表
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        ' 更改
        '     zengxianglin 2010-01-09 创建
        '----------------------------------------------------------------
        Private Function getCanRead_BMRY( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal objJCSJ As System.DateTime, _
            ByRef strBMList As String, _
            ByRef strRYList As String) As Boolean

            Dim objdacEstateRenshiXingye As New Josco.JSOA.DataAccess.dacEstateRenshiXingye
            Dim objXJRY As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objDWLB As System.Collections.Specialized.NameValueCollection = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objdacCustomer As New Josco.JsKernal.DataAccess.dacCustomer
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon

            getCanRead_BMRY = False
            strErrMsg = ""
            strBMList = ""
            strRYList = ""

            Try
                Dim intCount As Integer = 0
                Dim i As Integer = 0
                Dim strBMDM As String = ""
                Dim strBMMC As String = ""

                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getCanRead_BMRY]未指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '计算部门信息
                If objdacCustomer.getBmdmAndBmmcByRydm(strErrMsg, objSqlConnection, strUserId, strBMDM, strBMMC) = False Then
                    GoTo errProc
                End If

                '计算下级人员
                If objdacEstateRenshiXingye.getAllXiashuRenyuan(strErrMsg, strUserId, strPassword, strUserId, objJCSJ, objXJRY) = False Then
                    GoTo errProc
                End If

                '计算行政助理管理的单位
                If objdacEstateRenshiXingye.getAllXingzhengZhuliDanwei(strErrMsg, strUserId, strPassword, strUserId, objJCSJ, objDWLB) = False Then
                    GoTo errProc
                End If

                '自己能看自己的业务
                If objXJRY Is Nothing Then
                    objXJRY = New System.Collections.Specialized.NameValueCollection
                    objXJRY.Add(strUserId, strUserId)
                Else
                    If objXJRY(strUserId) Is Nothing Then
                        objXJRY.Add(strUserId, strUserId)
                    End If
                End If

                '形成人员的数据库格式列表
                If objXJRY Is Nothing Then
                    intCount = 0
                Else
                    intCount = objXJRY.Count
                End If
                For i = 0 To intCount - 1 Step 1
                    If strRYList = "" Then
                        strRYList = "'" + objXJRY.Item(i) + "'"
                    Else
                        strRYList = strRYList + "," + "'" + objXJRY.Item(i) + "'"
                    End If
                Next

                '形成部门的数据库格式列表
                If objDWLB Is Nothing Then
                    intCount = 0
                Else
                    intCount = objDWLB.Count
                End If
                For i = 0 To intCount - 1 Step 1
                    If strBMList = "" Then
                        strBMList = "'" + objDWLB.Item(i) + "'"
                    Else
                        strBMList = strBMList + "," + "'" + objDWLB.Item(i) + "'"
                    End If
                Next
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            getCanRead_BMRY = True
            Exit Function
errProc:
            Josco.JSOA.DataAccess.dacEstateRenshiXingye.SafeRelease(objdacEstateRenshiXingye)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.DataAccess.dacCustomer.SafeRelease(objdacCustomer)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 获取“地产_B_二手_佣金计提”完全数据的数据集
        '     strErrMsg                  ：如果错误，则返回错误信息
        '     strUserId                  ：用户标识
        '     strPassword                ：用户密码
        '     strWhere                   ：搜索字符串
        '     objRetDataSet              ：信息数据集
        ' 返回
        '     True                       ：成功
        '     False                      ：失败
        '----------------------------------------------------------------
        Public Function getDataSet_ES_YJJT( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strWhere As String, _
            ByRef objRetDataSet As Josco.JSOA.Common.Data.estateErshouData) As Boolean

            Dim objTempDataSet As Josco.JSOA.Common.Data.estateErshouData = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""

            '初始化
            getDataSet_ES_YJJT = False
            objRetDataSet = Nothing
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                If strPassword Is Nothing Then strPassword = ""
                If strWhere.Length > 0 Then strWhere = strWhere.Trim()
                If strUserId.Trim = "" Then
                    strErrMsg = "错误：[getDataSet_ES_YJJT]未指定[连接用户]！"
                    GoTo errProc
                End If

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '获取数据
                Try
                    '创建数据集
                    objTempDataSet = New Josco.JSOA.Common.Data.estateErshouData(Josco.JSOA.Common.Data.estateErshouData.enumTableType.DC_B_ES_YJJT)

                    '创建SqlCommand
                    objSqlCommand = New System.Data.SqlClient.SqlCommand
                    objSqlCommand.Connection = objSqlConnection
                    objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                    '执行检索
                    With Me.m_objSqlDataAdapter
                        '准备SQL
                        strSQL = ""
                        strSQL = strSQL + " select a.*" + vbCr
                        strSQL = strSQL + " from" + vbCr
                        strSQL = strSQL + " (" + vbCr
                        strSQL = strSQL + "   select a.*," + vbCr
                        strSQL = strSQL + "     b.人员名称 as 经办人员名称," + vbCr
                        strSQL = strSQL + "     c.组织名称 as 经办单位名称," + vbCr
                        strSQL = strSQL + "     d.职级名称 as 人员职级名称 " + vbCr
                        strSQL = strSQL + "   from 地产_B_二手_佣金计提 a " + vbCr
                        strSQL = strSQL + "   left join 公共_B_人员          b on a.经办人员=b.人员代码" + vbCr
                        strSQL = strSQL + "   left join 公共_B_组织机构      c on a.经办单位=c.组织代码" + vbCr
                        strSQL = strSQL + "   left join 地产_B_人事_职级定义 d on a.人员职级=d.职级代码" + vbCr
                        strSQL = strSQL + " ) a" + vbCr
                        If strWhere <> "" Then
                            strSQL = strSQL + " where " + strWhere + vbCr
                        End If
                        strSQL = strSQL + " order by a.经办人员,a.计佣标准,a.接案年月,a.计佣年月" + vbCr

                        '设置参数
                        objSqlCommand.CommandText = strSQL
                        objSqlCommand.Parameters.Clear()
                        .SelectCommand = objSqlCommand

                        '执行操作
                        .Fill(objTempDataSet.Tables(Josco.JSOA.Common.Data.estateErshouData.TABLE_DC_B_ES_YJJT))
                    End With
                Catch ex As Exception
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try
                If objTempDataSet.Tables.Count < 1 Then
                    Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
                End If
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            '返回
            objRetDataSet = objTempDataSet
            getDataSet_ES_YJJT = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JSOA.Common.Data.estateErshouData.SafeRelease(objTempDataSet)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

        '----------------------------------------------------------------
        ' 保存“地产_B_二手_佣金计提”数据(X4)
        '     strErrMsg            ：如果错误，则返回错误信息
        '     strUserId            ：连接用户名
        '     strPassword          ：连接用户密码
        '     strKSRQ              ：开始日期
        '     strZZRQ              ：结束日期
        ' 返回
        '     True                 ：成功
        '     False                ：失败
        ' 更改
        '     zengxianglin 2011-01-19 创建
        '----------------------------------------------------------------
        Public Function doSaveData_ES_YJJT_X4( _
            ByRef strErrMsg As String, _
            ByVal strUserId As String, _
            ByVal strPassword As String, _
            ByVal strKSRQ As String, _
            ByVal strZZRQ As String) As Boolean

            Dim objPulicParameters As New Josco.JsKernal.Common.Utilities.PulicParameters
            Dim objSqlTransaction As System.Data.SqlClient.SqlTransaction = Nothing
            Dim objSqlConnection As System.Data.SqlClient.SqlConnection = Nothing
            Dim objSqlCommand As System.Data.SqlClient.SqlCommand = Nothing
            Dim objdacCommon As New Josco.JsKernal.DataAccess.dacCommon
            Dim strSQL As String = ""


            doSaveData_ES_YJJT_X4 = False
            strErrMsg = ""

            Try
                '检查
                If strUserId Is Nothing Then strUserId = ""
                strUserId = strUserId.Trim
                If strUserId = "" Then
                    strErrMsg = "错误：[doSaveData_ES_YJJT_X4]没有指定[连接用户]！"
                    GoTo errProc
                End If
                If strPassword Is Nothing Then strPassword = ""
                strPassword = strPassword.Trim
                If strKSRQ Is Nothing Then strKSRQ = ""
                If strKSRQ = "" Then
                    strErrMsg = "错误：[doSaveData_ES_YJJT_X4]没有指定[开始日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strKSRQ) = False Then
                    strErrMsg = "错误：[doSaveData_ES_YJJT_X4]无效的日期[" + strKSRQ + "]！"
                    GoTo errProc
                End If
                If strZZRQ Is Nothing Then strZZRQ = ""
                If strZZRQ = "" Then
                    strErrMsg = "错误：[doSaveData_ES_YJJT_X4]没有指定[结束日期]！"
                    GoTo errProc
                End If
                If objPulicParameters.isDatetimeString(strZZRQ) = False Then
                    strErrMsg = "错误：[doSaveData_ES_YJJT_X4]无效的日期[" + strZZRQ + "]！"
                    GoTo errProc
                End If
                Dim objZZRQ As System.DateTime = CType(strZZRQ, System.DateTime)
                Dim intJYNY As Integer = objZZRQ.Year * 100 + objZZRQ.Month

                '获取连接
                If objdacCommon.getConnection(strErrMsg, strUserId, strPassword, objSqlConnection) = False Then
                    GoTo errProc
                End If

                '创建SqlCommand
                objSqlCommand = New System.Data.SqlClient.SqlCommand
                objSqlCommand.Connection = objSqlConnection
                objSqlCommand.CommandTimeout = Josco.JsKernal.Common.jsoaConfiguration.CommandTimeout

                '开始事务
                objSqlTransaction = objSqlConnection.BeginTransaction
                objSqlCommand.Transaction = objSqlTransaction

                '事务处理
                Try
                    '删除“地产_B_二手_佣金计提”现有数据
                    strSQL = ""
                    strSQL = strSQL + " delete from 地产_B_二手_佣金计提" + vbCr
                    strSQL = strSQL + " where 计佣年月 = @jyny" + vbCr
                    strSQL = strSQL + " and   计佣标准 = 4" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@jyny", intJYNY)
                    objSqlCommand.ExecuteNonQuery()

                    '计算临时数据
                    strSQL = ""
                    strSQL = strSQL + "select * into #tempTable00 from dbo.uf_estate_es_getESYJFAFPB_ZRY(@ksrq,@zzrq,0,@rydm,@jcsj)" + vbCr
                    '保存“地产_B_二手_佣金计提”直管计提数据(X4)
                    strSQL = strSQL + " insert into 地产_B_二手_佣金计提(" + vbCr
                    strSQL = strSQL + " 唯一标识," + vbCr
                    strSQL = strSQL + " 计佣年月," + vbCr
                    strSQL = strSQL + " 接案年月," + vbCr
                    strSQL = strSQL + " 计佣开始," + vbCr
                    strSQL = strSQL + " 计佣结束," + vbCr
                    strSQL = strSQL + " 经办人员," + vbCr
                    strSQL = strSQL + " 计佣标准," + vbCr
                    strSQL = strSQL + " 经办单位," + vbCr
                    strSQL = strSQL + " 团队编号," + vbCr
                    strSQL = strSQL + " 直管标记," + vbCr
                    strSQL = strSQL + " 人员职级," + vbCr
                    strSQL = strSQL + " 业绩标记," + vbCr
                    strSQL = strSQL + " 月初业绩," + vbCr
                    strSQL = strSQL + " 本月业绩," + vbCr
                    strSQL = strSQL + " 计提佣金" + vbCr
                    strSQL = strSQL + " )" + vbCr
                    strSQL = strSQL + " select" + vbCr
                    strSQL = strSQL + " newid() as 唯一标识," + vbCr
                    strSQL = strSQL + " a.计佣年月," + vbCr
                    strSQL = strSQL + " a.接案年月," + vbCr
                    strSQL = strSQL + " @ksrq as 计佣开始," + vbCr
                    strSQL = strSQL + " @zzrq as 计佣结束," + vbCr
                    strSQL = strSQL + " a.经办人员," + vbCr
                    strSQL = strSQL + " a.计佣标准," + vbCr
                    strSQL = strSQL + " a.经办单位," + vbCr
                    strSQL = strSQL + " a.团队编号," + vbCr
                    strSQL = strSQL + " a.直管标记," + vbCr
                    strSQL = strSQL + " a.计佣职级 as 人员职级," + vbCr
                    strSQL = strSQL + " a.状态标志 as 业绩标记," + vbCr
                    strSQL = strSQL + " a.月初业绩," + vbCr
                    strSQL = strSQL + " a.佣金合计 as 本月业绩," + vbCr
                    strSQL = strSQL + " a.计提合计 as 计提佣金" + vbCr
                    strSQL = strSQL + " from" + vbCr
                    strSQL = strSQL + " ("
                    strSQL = strSQL + "   select * from #tempTable00"
                    strSQL = strSQL + "   where 显示级别 = 5" + vbCr
                    strSQL = strSQL + "   and   计佣标准 = 4" + vbCr
                    strSQL = strSQL + "   and   计佣档级 = 2" + vbCr
                    strSQL = strSQL + "   and   状态标志 & 0x1 = 0x0" + vbCr
                    strSQL = strSQL + " ) a" + vbCr
                    '保存“地产_B_二手_佣金计提”私佣计提数据(X4)
                    strSQL = strSQL + " insert into 地产_B_二手_佣金计提(" + vbCr
                    strSQL = strSQL + " 唯一标识," + vbCr
                    strSQL = strSQL + " 计佣年月," + vbCr
                    strSQL = strSQL + " 接案年月," + vbCr
                    strSQL = strSQL + " 计佣开始," + vbCr
                    strSQL = strSQL + " 计佣结束," + vbCr
                    strSQL = strSQL + " 经办人员," + vbCr
                    strSQL = strSQL + " 计佣标准," + vbCr
                    strSQL = strSQL + " 经办单位," + vbCr
                    strSQL = strSQL + " 团队编号," + vbCr
                    strSQL = strSQL + " 直管标记," + vbCr
                    strSQL = strSQL + " 人员职级," + vbCr
                    strSQL = strSQL + " 业绩标记," + vbCr
                    strSQL = strSQL + " 月初业绩," + vbCr
                    strSQL = strSQL + " 本月业绩," + vbCr
                    strSQL = strSQL + " 计提佣金" + vbCr
                    strSQL = strSQL + " )" + vbCr
                    strSQL = strSQL + " select" + vbCr
                    strSQL = strSQL + " newid() as 唯一标识," + vbCr
                    strSQL = strSQL + " a.计佣年月," + vbCr
                    strSQL = strSQL + " a.接案年月," + vbCr
                    strSQL = strSQL + " @ksrq as 计佣开始," + vbCr
                    strSQL = strSQL + " @zzrq as 计佣结束," + vbCr
                    strSQL = strSQL + " a.经办人员," + vbCr
                    strSQL = strSQL + " a.计佣标准," + vbCr
                    strSQL = strSQL + " a.经办单位," + vbCr
                    strSQL = strSQL + " a.团队编号," + vbCr
                    strSQL = strSQL + " a.直管标记," + vbCr
                    strSQL = strSQL + " a.计佣职级 as 人员职级," + vbCr
                    strSQL = strSQL + " a.状态标志 as 业绩标记," + vbCr
                    strSQL = strSQL + " a.月初业绩," + vbCr
                    strSQL = strSQL + " a.佣金合计 as 本月业绩," + vbCr
                    strSQL = strSQL + " a.计提合计 as 计提佣金" + vbCr
                    strSQL = strSQL + " from" + vbCr
                    strSQL = strSQL + " ("
                    strSQL = strSQL + "   select * from #tempTable00"
                    strSQL = strSQL + "   where 显示级别 = 3" + vbCr
                    strSQL = strSQL + "   and   计佣标准 = 4" + vbCr
                    strSQL = strSQL + "   and   状态标志 & 0x1 = 0x1" + vbCr
                    strSQL = strSQL + " ) a" + vbCr
                    objSqlCommand.CommandText = strSQL
                    objSqlCommand.Parameters.Clear()
                    objSqlCommand.Parameters.AddWithValue("@ksrq", CType(strKSRQ, System.DateTime))
                    objSqlCommand.Parameters.AddWithValue("@zzrq", CType(strZZRQ, System.DateTime))
                    objSqlCommand.Parameters.AddWithValue("@rydm", strUserId)
                    objSqlCommand.Parameters.AddWithValue("@jcsj", CType(strZZRQ, System.DateTime))
                    objSqlCommand.ExecuteNonQuery()
                Catch ex As Exception
                    objSqlTransaction.Rollback()
                    strErrMsg = ex.Message
                    GoTo errProc
                End Try

                '提交事务
                objSqlTransaction.Commit()
            Catch ex As Exception
                strErrMsg = ex.Message
                GoTo errProc
            End Try

            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)

            doSaveData_ES_YJJT_X4 = True
            Exit Function
errProc:
            Josco.JsKernal.Common.Utilities.PulicParameters.SafeRelease(objPulicParameters)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlConnection)
            Josco.JsKernal.Common.Utilities.ResourceManager.SafeRelease(objSqlCommand)
            Josco.JsKernal.DataAccess.dacCommon.SafeRelease(objdacCommon)
            Exit Function

        End Function

    End Class

End Namespace
